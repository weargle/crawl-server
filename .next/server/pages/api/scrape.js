"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/scrape";
exports.ids = ["pages/api/scrape"];
exports.modules = {

/***/ "@dqbd/tiktoken":
/*!*********************************!*\
  !*** external "@dqbd/tiktoken" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@dqbd/tiktoken");

/***/ }),

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("@supabase/supabase-js");

/***/ }),

/***/ "ajv":
/*!**********************!*\
  !*** external "ajv" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("ajv");

/***/ }),

/***/ "async":
/*!************************!*\
  !*** external "async" ***!
  \************************/
/***/ ((module) => {

module.exports = require("async");

/***/ }),

/***/ "dotenv":
/*!*************************!*\
  !*** external "dotenv" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("dotenv");

/***/ }),

/***/ "dotenv/config":
/*!********************************!*\
  !*** external "dotenv/config" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("dotenv/config");

/***/ }),

/***/ "form-data":
/*!****************************!*\
  !*** external "form-data" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("form-data");

/***/ }),

/***/ "ioredis":
/*!**************************!*\
  !*** external "ioredis" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("ioredis");

/***/ }),

/***/ "joplin-turndown-plugin-gfm":
/*!*********************************************!*\
  !*** external "joplin-turndown-plugin-gfm" ***!
  \*********************************************/
/***/ ((module) => {

module.exports = require("joplin-turndown-plugin-gfm");

/***/ }),

/***/ "openai?22eb":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("openai");

/***/ }),

/***/ "pdf-parse":
/*!****************************!*\
  !*** external "pdf-parse" ***!
  \****************************/
/***/ ((module) => {

module.exports = require("pdf-parse");

/***/ }),

/***/ "rate-limiter-flexible":
/*!****************************************!*\
  !*** external "rate-limiter-flexible" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("rate-limiter-flexible");

/***/ }),

/***/ "redis":
/*!************************!*\
  !*** external "redis" ***!
  \************************/
/***/ ((module) => {

module.exports = require("redis");

/***/ }),

/***/ "robots-parser":
/*!********************************!*\
  !*** external "robots-parser" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("robots-parser");

/***/ }),

/***/ "scrapingbee":
/*!******************************!*\
  !*** external "scrapingbee" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("scrapingbee");

/***/ }),

/***/ "turndown":
/*!***************************!*\
  !*** external "turndown" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("turndown");

/***/ }),

/***/ "xml2js":
/*!*************************!*\
  !*** external "xml2js" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("xml2js");

/***/ }),

/***/ "@anthropic-ai/sdk":
/*!************************************!*\
  !*** external "@anthropic-ai/sdk" ***!
  \************************************/
/***/ ((module) => {

module.exports = import("@anthropic-ai/sdk");;

/***/ }),

/***/ "axios":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = import("axios");;

/***/ }),

/***/ "cheerio":
/*!**************************!*\
  !*** external "cheerio" ***!
  \**************************/
/***/ ((module) => {

module.exports = import("cheerio");;

/***/ }),

/***/ "openai?089f":
/*!*************************!*\
  !*** external "openai" ***!
  \*************************/
/***/ ((module) => {

module.exports = import("openai");;

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "(api)/./src/lib/LLM-extraction/helpers.ts":
/*!*******************************************!*\
  !*** ./src/lib/LLM-extraction/helpers.ts ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   numTokensFromString: () => (/* binding */ numTokensFromString)\n/* harmony export */ });\n/* harmony import */ var _dqbd_tiktoken__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @dqbd/tiktoken */ \"@dqbd/tiktoken\");\n/* harmony import */ var _dqbd_tiktoken__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_dqbd_tiktoken__WEBPACK_IMPORTED_MODULE_0__);\n\n// This function calculates the number of tokens in a text string using GPT-3.5-turbo model\nfunction numTokensFromString(message, model) {\n    const encoder = (0,_dqbd_tiktoken__WEBPACK_IMPORTED_MODULE_0__.encoding_for_model)(model);\n    // Encode the message into tokens\n    const tokens = encoder.encode(message);\n    // Free the encoder resources after use\n    encoder.free();\n    // Return the number of tokens\n    return tokens.length;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL0xMTS1leHRyYWN0aW9uL2hlbHBlcnMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQW9EO0FBR3BELDJGQUEyRjtBQUNwRixTQUFTQyxvQkFBb0JDLE9BQWUsRUFBRUMsS0FBYTtJQUNoRSxNQUFNQyxVQUFVSixrRUFBa0JBLENBQUNHO0lBRW5DLGlDQUFpQztJQUNqQyxNQUFNRSxTQUFTRCxRQUFRRSxPQUFPSjtJQUU5Qix1Q0FBdUM7SUFDdkNFLFFBQVFHO0lBRVIsOEJBQThCO0lBQzlCLE9BQU9GLE9BQU9HO0FBQ2hCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmlyZWNyYXdsLXNjcmFwZXItanMvLi9zcmMvbGliL0xMTS1leHRyYWN0aW9uL2hlbHBlcnMudHM/YTViZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlbmNvZGluZ19mb3JfbW9kZWwgfSBmcm9tIFwiQGRxYmQvdGlrdG9rZW5cIjtcbmltcG9ydCB7IFRpa3Rva2VuTW9kZWwgfSBmcm9tIFwiQGRxYmQvdGlrdG9rZW5cIjtcblxuLy8gVGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIHRoZSBudW1iZXIgb2YgdG9rZW5zIGluIGEgdGV4dCBzdHJpbmcgdXNpbmcgR1BULTMuNS10dXJibyBtb2RlbFxuZXhwb3J0IGZ1bmN0aW9uIG51bVRva2Vuc0Zyb21TdHJpbmcobWVzc2FnZTogc3RyaW5nLCBtb2RlbDogc3RyaW5nKTogbnVtYmVyIHtcbiAgY29uc3QgZW5jb2RlciA9IGVuY29kaW5nX2Zvcl9tb2RlbChtb2RlbCBhcyBUaWt0b2tlbk1vZGVsKTtcblxuICAvLyBFbmNvZGUgdGhlIG1lc3NhZ2UgaW50byB0b2tlbnNcbiAgY29uc3QgdG9rZW5zID0gZW5jb2Rlci5lbmNvZGUobWVzc2FnZSk7XG5cbiAgLy8gRnJlZSB0aGUgZW5jb2RlciByZXNvdXJjZXMgYWZ0ZXIgdXNlXG4gIGVuY29kZXIuZnJlZSgpO1xuXG4gIC8vIFJldHVybiB0aGUgbnVtYmVyIG9mIHRva2Vuc1xuICByZXR1cm4gdG9rZW5zLmxlbmd0aDtcbn1cbiJdLCJuYW1lcyI6WyJlbmNvZGluZ19mb3JfbW9kZWwiLCJudW1Ub2tlbnNGcm9tU3RyaW5nIiwibWVzc2FnZSIsIm1vZGVsIiwiZW5jb2RlciIsInRva2VucyIsImVuY29kZSIsImZyZWUiLCJsZW5ndGgiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/lib/LLM-extraction/helpers.ts\n");

/***/ }),

/***/ "(api)/./src/lib/LLM-extraction/index.ts":
/*!*****************************************!*\
  !*** ./src/lib/LLM-extraction/index.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateCompletions: () => (/* binding */ generateCompletions)\n/* harmony export */ });\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! openai */ \"openai?089f\");\n/* harmony import */ var ajv__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ajv */ \"ajv\");\n/* harmony import */ var ajv__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(ajv__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _models__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./models */ \"(api)/./src/lib/LLM-extraction/models.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([openai__WEBPACK_IMPORTED_MODULE_0__]);\nopenai__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nconst ajv = new (ajv__WEBPACK_IMPORTED_MODULE_1___default())(); // Initialize AJV for JSON schema validation\n\n// Generate completion using OpenAI\nasync function generateCompletions(documents, extractionOptions) {\n    // const schema = zodToJsonSchema(options.schema)\n    const schema = extractionOptions.extractionSchema;\n    const prompt = extractionOptions.extractionPrompt;\n    const switchVariable = \"openAI\"; // Placholder, want to think more about how we abstract the model provider\n    const completions = await Promise.all(documents.map(async (document)=>{\n        switch(switchVariable){\n            case \"openAI\":\n                const llm = new openai__WEBPACK_IMPORTED_MODULE_0__[\"default\"]();\n                try {\n                    const completionResult = await (0,_models__WEBPACK_IMPORTED_MODULE_2__.generateOpenAICompletions)({\n                        client: llm,\n                        document: document,\n                        schema: schema,\n                        prompt: prompt\n                    });\n                    // Validate the JSON output against the schema using AJV\n                    const validate = ajv.compile(schema);\n                    if (!validate(completionResult.llm_extraction)) {\n                        //TODO: add Custom Error handling middleware that bubbles this up with proper Error code, etc.\n                        throw new Error(`JSON parsing error(s): ${validate.errors?.map((err)=>err.message).join(\", \")}\\n\\nLLM extraction did not match the extraction schema you provided. This could be because of a model hallucination, or an Error on our side. Try adjusting your prompt, and if it doesn't work reach out to support.`);\n                    }\n                    return completionResult;\n                } catch (error) {\n                    console.error(`Error generating completions: ${error}`);\n                    throw new Error(`Error generating completions: ${error.message}`);\n                }\n            default:\n                throw new Error(\"Invalid client\");\n        }\n    }));\n    return completions;\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL0xMTS1leHRyYWN0aW9uL2luZGV4LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7O0FBQzRCO0FBQ047QUFDdEIsTUFBTUUsTUFBTSxJQUFJRCw0Q0FBR0EsSUFBSSw0Q0FBNEM7QUFFZDtBQUdyRCxtQ0FBbUM7QUFDNUIsZUFBZUcsb0JBQ3BCQyxTQUFxQixFQUNyQkMsaUJBQW1DO0lBRW5DLGlEQUFpRDtJQUVqRCxNQUFNQyxTQUFTRCxrQkFBa0JFO0lBQ2pDLE1BQU1DLFNBQVNILGtCQUFrQkk7SUFFakMsTUFBTUMsaUJBQWlCLFVBQVUsMEVBQTBFO0lBRTNHLE1BQU1DLGNBQWMsTUFBTUMsUUFBUUMsSUFDaENULFVBQVVVLElBQUksT0FBT0M7UUFDbkIsT0FBUUw7WUFDTixLQUFLO2dCQUNILE1BQU1NLE1BQU0sSUFBSWpCLDhDQUFNQTtnQkFDdEIsSUFBRztvQkFDSCxNQUFNa0IsbUJBQW1CLE1BQU1mLGtFQUF5QkEsQ0FBQzt3QkFDdkRnQixRQUFRRjt3QkFDUkQsVUFBVUE7d0JBQ1ZULFFBQVFBO3dCQUNSRSxRQUFRQTtvQkFDVjtvQkFDQSx3REFBd0Q7b0JBQ3hELE1BQU1XLFdBQVdsQixJQUFJbUIsUUFBUWQ7b0JBQzdCLElBQUksQ0FBQ2EsU0FBU0YsaUJBQWlCSSxpQkFBaUI7d0JBQzlDLDhGQUE4Rjt3QkFDOUYsTUFBTSxJQUFJQyxNQUNSLENBQUMsdUJBQXVCLEVBQUVILFNBQVNJLFFBQy9CVCxJQUFJLENBQUNVLE1BQVFBLElBQUlDLFNBQ2xCQyxLQUFLLE1BQU0scU5BQXFOLENBQUM7b0JBRXhPO29CQUVBLE9BQU9UO2dCQUNULEVBQUUsT0FBT1UsT0FBTztvQkFDZEMsUUFBUUQsTUFBTSxDQUFDLDhCQUE4QixFQUFFQSxNQUFNLENBQUM7b0JBQ3RELE1BQU0sSUFBSUwsTUFBTSxDQUFDLDhCQUE4QixFQUFFSyxNQUFNRixRQUFRLENBQUM7Z0JBQ2xFO1lBQ0E7Z0JBQ0UsTUFBTSxJQUFJSCxNQUFNO1FBQ3BCO0lBQ0Y7SUFHRixPQUFPWDtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmlyZWNyYXdsLXNjcmFwZXItanMvLi9zcmMvbGliL0xMTS1leHRyYWN0aW9uL2luZGV4LnRzP2EyYTAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFR1cm5kb3duIGZyb20gXCJ0dXJuZG93blwiO1xuaW1wb3J0IE9wZW5BSSBmcm9tIFwib3BlbmFpXCI7XG5pbXBvcnQgQWp2IGZyb20gXCJhanZcIjtcbmNvbnN0IGFqdiA9IG5ldyBBanYoKTsgLy8gSW5pdGlhbGl6ZSBBSlYgZm9yIEpTT04gc2NoZW1hIHZhbGlkYXRpb25cblxuaW1wb3J0IHsgZ2VuZXJhdGVPcGVuQUlDb21wbGV0aW9ucyB9IGZyb20gXCIuL21vZGVsc1wiO1xuaW1wb3J0IHsgRG9jdW1lbnQsIEV4dHJhY3Rvck9wdGlvbnMgfSBmcm9tIFwiLi4vZW50aXRpZXNcIjtcblxuLy8gR2VuZXJhdGUgY29tcGxldGlvbiB1c2luZyBPcGVuQUlcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZW5lcmF0ZUNvbXBsZXRpb25zKFxuICBkb2N1bWVudHM6IERvY3VtZW50W10sXG4gIGV4dHJhY3Rpb25PcHRpb25zOiBFeHRyYWN0b3JPcHRpb25zXG4pOiBQcm9taXNlPERvY3VtZW50W10+IHtcbiAgLy8gY29uc3Qgc2NoZW1hID0gem9kVG9Kc29uU2NoZW1hKG9wdGlvbnMuc2NoZW1hKVxuXG4gIGNvbnN0IHNjaGVtYSA9IGV4dHJhY3Rpb25PcHRpb25zLmV4dHJhY3Rpb25TY2hlbWE7XG4gIGNvbnN0IHByb21wdCA9IGV4dHJhY3Rpb25PcHRpb25zLmV4dHJhY3Rpb25Qcm9tcHQ7XG5cbiAgY29uc3Qgc3dpdGNoVmFyaWFibGUgPSBcIm9wZW5BSVwiOyAvLyBQbGFjaG9sZGVyLCB3YW50IHRvIHRoaW5rIG1vcmUgYWJvdXQgaG93IHdlIGFic3RyYWN0IHRoZSBtb2RlbCBwcm92aWRlclxuXG4gIGNvbnN0IGNvbXBsZXRpb25zID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgZG9jdW1lbnRzLm1hcChhc3luYyAoZG9jdW1lbnQ6IERvY3VtZW50KSA9PiB7XG4gICAgICBzd2l0Y2ggKHN3aXRjaFZhcmlhYmxlKSB7XG4gICAgICAgIGNhc2UgXCJvcGVuQUlcIjpcbiAgICAgICAgICBjb25zdCBsbG0gPSBuZXcgT3BlbkFJKCk7XG4gICAgICAgICAgdHJ5e1xuICAgICAgICAgIGNvbnN0IGNvbXBsZXRpb25SZXN1bHQgPSBhd2FpdCBnZW5lcmF0ZU9wZW5BSUNvbXBsZXRpb25zKHtcbiAgICAgICAgICAgIGNsaWVudDogbGxtLFxuICAgICAgICAgICAgZG9jdW1lbnQ6IGRvY3VtZW50LFxuICAgICAgICAgICAgc2NoZW1hOiBzY2hlbWEsXG4gICAgICAgICAgICBwcm9tcHQ6IHByb21wdCxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAvLyBWYWxpZGF0ZSB0aGUgSlNPTiBvdXRwdXQgYWdhaW5zdCB0aGUgc2NoZW1hIHVzaW5nIEFKVlxuICAgICAgICAgIGNvbnN0IHZhbGlkYXRlID0gYWp2LmNvbXBpbGUoc2NoZW1hKTtcbiAgICAgICAgICBpZiAoIXZhbGlkYXRlKGNvbXBsZXRpb25SZXN1bHQubGxtX2V4dHJhY3Rpb24pKSB7XG4gICAgICAgICAgICAvL1RPRE86IGFkZCBDdXN0b20gRXJyb3IgaGFuZGxpbmcgbWlkZGxld2FyZSB0aGF0IGJ1YmJsZXMgdGhpcyB1cCB3aXRoIHByb3BlciBFcnJvciBjb2RlLCBldGMuXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICAgIGBKU09OIHBhcnNpbmcgZXJyb3Iocyk6ICR7dmFsaWRhdGUuZXJyb3JzXG4gICAgICAgICAgICAgICAgPy5tYXAoKGVycikgPT4gZXJyLm1lc3NhZ2UpXG4gICAgICAgICAgICAgICAgLmpvaW4oXCIsIFwiKX1cXG5cXG5MTE0gZXh0cmFjdGlvbiBkaWQgbm90IG1hdGNoIHRoZSBleHRyYWN0aW9uIHNjaGVtYSB5b3UgcHJvdmlkZWQuIFRoaXMgY291bGQgYmUgYmVjYXVzZSBvZiBhIG1vZGVsIGhhbGx1Y2luYXRpb24sIG9yIGFuIEVycm9yIG9uIG91ciBzaWRlLiBUcnkgYWRqdXN0aW5nIHlvdXIgcHJvbXB0LCBhbmQgaWYgaXQgZG9lc24ndCB3b3JrIHJlYWNoIG91dCB0byBzdXBwb3J0LmBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmV0dXJuIGNvbXBsZXRpb25SZXN1bHQ7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgRXJyb3IgZ2VuZXJhdGluZyBjb21wbGV0aW9uczogJHtlcnJvcn1gKTtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgY29tcGxldGlvbnM6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgY2xpZW50XCIpO1xuICAgICAgfVxuICAgIH0pXG4gICk7XG5cbiAgcmV0dXJuIGNvbXBsZXRpb25zO1xufVxuIl0sIm5hbWVzIjpbIk9wZW5BSSIsIkFqdiIsImFqdiIsImdlbmVyYXRlT3BlbkFJQ29tcGxldGlvbnMiLCJnZW5lcmF0ZUNvbXBsZXRpb25zIiwiZG9jdW1lbnRzIiwiZXh0cmFjdGlvbk9wdGlvbnMiLCJzY2hlbWEiLCJleHRyYWN0aW9uU2NoZW1hIiwicHJvbXB0IiwiZXh0cmFjdGlvblByb21wdCIsInN3aXRjaFZhcmlhYmxlIiwiY29tcGxldGlvbnMiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwiZG9jdW1lbnQiLCJsbG0iLCJjb21wbGV0aW9uUmVzdWx0IiwiY2xpZW50IiwidmFsaWRhdGUiLCJjb21waWxlIiwibGxtX2V4dHJhY3Rpb24iLCJFcnJvciIsImVycm9ycyIsImVyciIsIm1lc3NhZ2UiLCJqb2luIiwiZXJyb3IiLCJjb25zb2xlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/lib/LLM-extraction/index.ts\n");

/***/ }),

/***/ "(api)/./src/lib/LLM-extraction/models.ts":
/*!******************************************!*\
  !*** ./src/lib/LLM-extraction/models.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateOpenAICompletions: () => (/* binding */ generateOpenAICompletions)\n/* harmony export */ });\nconst defaultPrompt = \"You are a professional web scraper. Extract the contents of the webpage\";\nfunction prepareOpenAIDoc(document) {\n    // Check if the markdown content exists in the document\n    if (!document.markdown) {\n        throw new Error(\"Markdown content is missing in the document. This is likely due to an error in the scraping process. Please try again or reach out to help@mendable.ai\");\n    }\n    return [\n        {\n            type: \"text\",\n            text: document.markdown\n        }\n    ];\n}\nasync function generateOpenAICompletions({ client, model = \"gpt-4-turbo\", document, schema, prompt = defaultPrompt, temperature }) {\n    const openai = client;\n    const content = prepareOpenAIDoc(document);\n    const completion = await openai.chat.completions.create({\n        model,\n        messages: [\n            {\n                role: \"system\",\n                content: prompt\n            },\n            {\n                role: \"user\",\n                content\n            }\n        ],\n        tools: [\n            {\n                type: \"function\",\n                function: {\n                    name: \"extract_content\",\n                    description: \"Extracts the content from the given webpage(s)\",\n                    parameters: schema\n                }\n            }\n        ],\n        tool_choice: {\n            \"type\": \"function\",\n            \"function\": {\n                \"name\": \"extract_content\"\n            }\n        },\n        temperature\n    });\n    const c = completion.choices[0].message.tool_calls[0].function.arguments;\n    // Extract the LLM extraction content from the completion response\n    const llmExtraction = JSON.parse(c);\n    // Return the document with the LLM extraction content added\n    return {\n        ...document,\n        llm_extraction: llmExtraction\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL0xMTS1leHRyYWN0aW9uL21vZGVscy50cyIsIm1hcHBpbmdzIjoiOzs7O0FBUUEsTUFBTUEsZ0JBQ0o7QUFFRixTQUFTQyxpQkFDUEMsUUFBa0I7SUFFbEIsdURBQXVEO0lBQ3ZELElBQUksQ0FBQ0EsU0FBU0MsVUFBVTtRQUN0QixNQUFNLElBQUlDLE1BQ1I7SUFFSjtJQUVBLE9BQU87UUFBQztZQUFFQyxNQUFNO1lBQVFDLE1BQU1KLFNBQVNDO1FBQVM7S0FBRTtBQUNwRDtBQUVPLGVBQWVJLDBCQUEwQixFQUM5Q0MsTUFBTSxFQUNOQyxRQUFRLGFBQWEsRUFDckJQLFFBQVEsRUFDUlEsTUFBTSxFQUNOQyxTQUFTWCxhQUFhLEVBQ3RCWSxXQUFXLEVBUVo7SUFDQyxNQUFNQyxTQUFTTDtJQUNmLE1BQU1NLFVBQVViLGlCQUFpQkM7SUFFakMsTUFBTWEsYUFBYSxNQUFNRixPQUFPRyxLQUFLQyxZQUFZQyxPQUFPO1FBQ3REVDtRQUNBVSxVQUFVO1lBQ1I7Z0JBQ0VDLE1BQU07Z0JBQ05OLFNBQVNIO1lBQ1g7WUFDQTtnQkFBRVMsTUFBTTtnQkFBUU47WUFBUTtTQUN6QjtRQUNETyxPQUFPO1lBQ0w7Z0JBQ0VoQixNQUFNO2dCQUNOaUIsVUFBVTtvQkFDUkMsTUFBTTtvQkFDTkMsYUFBYTtvQkFDYkMsWUFBWWY7Z0JBQ2Q7WUFDRjtTQUNEO1FBQ0RnQixhQUFhO1lBQUUsUUFBUTtZQUFZLFlBQVk7Z0JBQUMsUUFBUTtZQUFpQjtRQUFDO1FBQzFFZDtJQUNGO0lBRUEsTUFBTWUsSUFBSVosV0FBV2EsT0FBTyxDQUFDLEVBQUUsQ0FBQ0MsUUFBUUMsVUFBVSxDQUFDLEVBQUUsQ0FBQ1IsU0FBU1M7SUFFL0Qsa0VBQWtFO0lBQ2xFLE1BQU1DLGdCQUFnQkMsS0FBS0MsTUFBTVA7SUFFakMsNERBQTREO0lBQzVELE9BQU87UUFDTCxHQUFHekIsUUFBUTtRQUNYaUMsZ0JBQWdCSDtJQUNsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmlyZWNyYXdsLXNjcmFwZXItanMvLi9zcmMvbGliL0xMTS1leHRyYWN0aW9uL21vZGVscy50cz9jNDkwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBPcGVuQUkgZnJvbSBcIm9wZW5haVwiO1xuaW1wb3J0IHsgRG9jdW1lbnQgfSBmcm9tIFwiLi4vLi4vbGliL2VudGl0aWVzXCI7XG5cbmV4cG9ydCB0eXBlIFNjcmFwZXJDb21wbGV0aW9uUmVzdWx0ID0ge1xuICBkYXRhOiBhbnkgfCBudWxsO1xuICB1cmw6IHN0cmluZztcbn07XG5cbmNvbnN0IGRlZmF1bHRQcm9tcHQgPVxuICBcIllvdSBhcmUgYSBwcm9mZXNzaW9uYWwgd2ViIHNjcmFwZXIuIEV4dHJhY3QgdGhlIGNvbnRlbnRzIG9mIHRoZSB3ZWJwYWdlXCI7XG5cbmZ1bmN0aW9uIHByZXBhcmVPcGVuQUlEb2MoXG4gIGRvY3VtZW50OiBEb2N1bWVudFxuKTogT3BlbkFJLkNoYXQuQ29tcGxldGlvbnMuQ2hhdENvbXBsZXRpb25Db250ZW50UGFydFtdIHtcbiAgLy8gQ2hlY2sgaWYgdGhlIG1hcmtkb3duIGNvbnRlbnQgZXhpc3RzIGluIHRoZSBkb2N1bWVudFxuICBpZiAoIWRvY3VtZW50Lm1hcmtkb3duKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgXCJNYXJrZG93biBjb250ZW50IGlzIG1pc3NpbmcgaW4gdGhlIGRvY3VtZW50LiBUaGlzIGlzIGxpa2VseSBkdWUgdG8gYW4gZXJyb3IgaW4gdGhlIHNjcmFwaW5nIHByb2Nlc3MuIFBsZWFzZSB0cnkgYWdhaW4gb3IgcmVhY2ggb3V0IHRvIGhlbHBAbWVuZGFibGUuYWlcIlxuICAgICk7XG4gIH1cblxuICByZXR1cm4gW3sgdHlwZTogXCJ0ZXh0XCIsIHRleHQ6IGRvY3VtZW50Lm1hcmtkb3duIH1dO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVPcGVuQUlDb21wbGV0aW9ucyh7XG4gIGNsaWVudCxcbiAgbW9kZWwgPSBcImdwdC00LXR1cmJvXCIsXG4gIGRvY3VtZW50LFxuICBzY2hlbWEsIC8vVE9ETyAtIGFkZCB6b2QgZHluYW1pYyB0eXBlIGNoZWNraW5nXG4gIHByb21wdCA9IGRlZmF1bHRQcm9tcHQsXG4gIHRlbXBlcmF0dXJlLFxufToge1xuICBjbGllbnQ6IE9wZW5BSTtcbiAgbW9kZWw/OiBzdHJpbmc7XG4gIGRvY3VtZW50OiBEb2N1bWVudDtcbiAgc2NoZW1hOiBhbnk7IC8vIFRoaXMgc2hvdWxkIGJlIHJlcGxhY2VkIHdpdGggYSBwcm9wZXIgWm9kIHNjaGVtYSB0eXBlIHdoZW4gYXZhaWxhYmxlXG4gIHByb21wdD86IHN0cmluZztcbiAgdGVtcGVyYXR1cmU/OiBudW1iZXI7XG59KTogUHJvbWlzZTxEb2N1bWVudD4ge1xuICBjb25zdCBvcGVuYWkgPSBjbGllbnQgYXMgT3BlbkFJO1xuICBjb25zdCBjb250ZW50ID0gcHJlcGFyZU9wZW5BSURvYyhkb2N1bWVudCk7XG5cbiAgY29uc3QgY29tcGxldGlvbiA9IGF3YWl0IG9wZW5haS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgbW9kZWwsXG4gICAgbWVzc2FnZXM6IFtcbiAgICAgIHtcbiAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgY29udGVudDogcHJvbXB0LFxuICAgICAgfSxcbiAgICAgIHsgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQgfSxcbiAgICBdLFxuICAgIHRvb2xzOiBbXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFwiZnVuY3Rpb25cIixcbiAgICAgICAgZnVuY3Rpb246IHtcbiAgICAgICAgICBuYW1lOiBcImV4dHJhY3RfY29udGVudFwiLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIkV4dHJhY3RzIHRoZSBjb250ZW50IGZyb20gdGhlIGdpdmVuIHdlYnBhZ2UocylcIixcbiAgICAgICAgICBwYXJhbWV0ZXJzOiBzY2hlbWEsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIF0sXG4gICAgdG9vbF9jaG9pY2U6IHsgXCJ0eXBlXCI6IFwiZnVuY3Rpb25cIiwgXCJmdW5jdGlvblwiOiB7XCJuYW1lXCI6IFwiZXh0cmFjdF9jb250ZW50XCJ9fSxcbiAgICB0ZW1wZXJhdHVyZSxcbiAgfSk7XG5cbiAgY29uc3QgYyA9IGNvbXBsZXRpb24uY2hvaWNlc1swXS5tZXNzYWdlLnRvb2xfY2FsbHNbMF0uZnVuY3Rpb24uYXJndW1lbnRzO1xuXG4gIC8vIEV4dHJhY3QgdGhlIExMTSBleHRyYWN0aW9uIGNvbnRlbnQgZnJvbSB0aGUgY29tcGxldGlvbiByZXNwb25zZVxuICBjb25zdCBsbG1FeHRyYWN0aW9uID0gSlNPTi5wYXJzZShjKTtcblxuICAvLyBSZXR1cm4gdGhlIGRvY3VtZW50IHdpdGggdGhlIExMTSBleHRyYWN0aW9uIGNvbnRlbnQgYWRkZWRcbiAgcmV0dXJuIHtcbiAgICAuLi5kb2N1bWVudCxcbiAgICBsbG1fZXh0cmFjdGlvbjogbGxtRXh0cmFjdGlvbixcbiAgfTtcbn1cblxuIl0sIm5hbWVzIjpbImRlZmF1bHRQcm9tcHQiLCJwcmVwYXJlT3BlbkFJRG9jIiwiZG9jdW1lbnQiLCJtYXJrZG93biIsIkVycm9yIiwidHlwZSIsInRleHQiLCJnZW5lcmF0ZU9wZW5BSUNvbXBsZXRpb25zIiwiY2xpZW50IiwibW9kZWwiLCJzY2hlbWEiLCJwcm9tcHQiLCJ0ZW1wZXJhdHVyZSIsIm9wZW5haSIsImNvbnRlbnQiLCJjb21wbGV0aW9uIiwiY2hhdCIsImNvbXBsZXRpb25zIiwiY3JlYXRlIiwibWVzc2FnZXMiLCJyb2xlIiwidG9vbHMiLCJmdW5jdGlvbiIsIm5hbWUiLCJkZXNjcmlwdGlvbiIsInBhcmFtZXRlcnMiLCJ0b29sX2Nob2ljZSIsImMiLCJjaG9pY2VzIiwibWVzc2FnZSIsInRvb2xfY2FsbHMiLCJhcmd1bWVudHMiLCJsbG1FeHRyYWN0aW9uIiwiSlNPTiIsInBhcnNlIiwibGxtX2V4dHJhY3Rpb24iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/lib/LLM-extraction/models.ts\n");

/***/ }),

/***/ "(api)/./src/lib/html-to-markdown.ts":
/*!*************************************!*\
  !*** ./src/lib/html-to-markdown.ts ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   parseMarkdown: () => (/* binding */ parseMarkdown)\n/* harmony export */ });\nfunction parseMarkdown(html) {\n    var TurndownService = __webpack_require__(/*! turndown */ \"turndown\");\n    var turndownPluginGfm = __webpack_require__(/*! joplin-turndown-plugin-gfm */ \"joplin-turndown-plugin-gfm\");\n    const turndownService = new TurndownService();\n    turndownService.addRule(\"inlineLink\", {\n        filter: function(node, options) {\n            return options.linkStyle === \"inlined\" && node.nodeName === \"A\" && node.getAttribute(\"href\");\n        },\n        replacement: function(content, node) {\n            var href = node.getAttribute(\"href\").trim();\n            var title = node.title ? ' \"' + node.title + '\"' : \"\";\n            return \"[\" + content.trim() + \"](\" + href + title + \")\\n\";\n        }\n    });\n    var gfm = turndownPluginGfm.gfm;\n    turndownService.use(gfm);\n    let markdownContent = turndownService.turndown(html);\n    // multiple line links\n    let insideLinkContent = false;\n    let newMarkdownContent = \"\";\n    let linkOpenCount = 0;\n    for(let i = 0; i < markdownContent.length; i++){\n        const char = markdownContent[i];\n        if (char == \"[\") {\n            linkOpenCount++;\n        } else if (char == \"]\") {\n            linkOpenCount = Math.max(0, linkOpenCount - 1);\n        }\n        insideLinkContent = linkOpenCount > 0;\n        if (insideLinkContent && char == \"\\n\") {\n            newMarkdownContent += \"\\\\\" + \"\\n\";\n        } else {\n            newMarkdownContent += char;\n        }\n    }\n    markdownContent = newMarkdownContent;\n    // Remove [Skip to Content](#page) and [Skip to content](#skip)\n    markdownContent = markdownContent.replace(/\\[Skip to Content\\]\\(#[^\\)]*\\)/gi, \"\");\n    return markdownContent;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL2h0bWwtdG8tbWFya2Rvd24udHMiLCJtYXBwaW5ncyI6Ijs7OztBQUNPLFNBQVNBLGNBQWNDLElBQVk7SUFDeEMsSUFBSUMsa0JBQWtCQyxtQkFBT0EsQ0FBQywwQkFBVTtJQUN4QyxJQUFJQyxvQkFBb0JELG1CQUFPQSxDQUFDO0lBR2hDLE1BQU1FLGtCQUFrQixJQUFJSDtJQUM1QkcsZ0JBQWdCQyxRQUFRLGNBQWM7UUFDcENDLFFBQVEsU0FBVUMsSUFBSSxFQUFFQyxPQUFPO1lBQzdCLE9BQ0VBLFFBQVFDLGNBQWMsYUFDdEJGLEtBQUtHLGFBQWEsT0FDbEJILEtBQUtJLGFBQWE7UUFFdEI7UUFDQUMsYUFBYSxTQUFVQyxPQUFPLEVBQUVOLElBQUk7WUFDbEMsSUFBSU8sT0FBT1AsS0FBS0ksYUFBYSxRQUFRSTtZQUNyQyxJQUFJQyxRQUFRVCxLQUFLUyxRQUFRLE9BQU9ULEtBQUtTLFFBQVEsTUFBTTtZQUNuRCxPQUFPLE1BQU1ILFFBQVFFLFNBQVMsT0FBT0QsT0FBT0UsUUFBUTtRQUN0RDtJQUNGO0lBQ0EsSUFBSUMsTUFBTWQsa0JBQWtCYztJQUM1QmIsZ0JBQWdCYyxJQUFJRDtJQUNwQixJQUFJRSxrQkFBa0JmLGdCQUFnQmdCLFNBQVNwQjtJQUUvQyxzQkFBc0I7SUFDdEIsSUFBSXFCLG9CQUFvQjtJQUN4QixJQUFJQyxxQkFBcUI7SUFDekIsSUFBSUMsZ0JBQWdCO0lBQ3BCLElBQUssSUFBSUMsSUFBSSxHQUFHQSxJQUFJTCxnQkFBZ0JNLFFBQVFELElBQUs7UUFDL0MsTUFBTUUsT0FBT1AsZUFBZSxDQUFDSyxFQUFFO1FBRS9CLElBQUlFLFFBQVEsS0FBSztZQUNmSDtRQUNGLE9BQU8sSUFBSUcsUUFBUSxLQUFLO1lBQ3RCSCxnQkFBZ0JJLEtBQUtDLElBQUksR0FBR0wsZ0JBQWdCO1FBQzlDO1FBQ0FGLG9CQUFvQkUsZ0JBQWdCO1FBRXBDLElBQUlGLHFCQUFxQkssUUFBUSxNQUFNO1lBQ3JDSixzQkFBc0IsT0FBTztRQUMvQixPQUFPO1lBQ0xBLHNCQUFzQkk7UUFDeEI7SUFDRjtJQUNBUCxrQkFBa0JHO0lBRWxCLCtEQUErRDtJQUMvREgsa0JBQWtCQSxnQkFBZ0JVLFFBQ2hDLG9DQUNBO0lBR0YsT0FBT1Y7QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL2ZpcmVjcmF3bC1zY3JhcGVyLWpzLy4vc3JjL2xpYi9odG1sLXRvLW1hcmtkb3duLnRzP2M2MWUiXSwic291cmNlc0NvbnRlbnQiOlsiXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VNYXJrZG93bihodG1sOiBzdHJpbmcpIHtcbiAgdmFyIFR1cm5kb3duU2VydmljZSA9IHJlcXVpcmUoXCJ0dXJuZG93blwiKTtcbiAgdmFyIHR1cm5kb3duUGx1Z2luR2ZtID0gcmVxdWlyZSgnam9wbGluLXR1cm5kb3duLXBsdWdpbi1nZm0nKVxuXG5cbiAgY29uc3QgdHVybmRvd25TZXJ2aWNlID0gbmV3IFR1cm5kb3duU2VydmljZSgpO1xuICB0dXJuZG93blNlcnZpY2UuYWRkUnVsZShcImlubGluZUxpbmtcIiwge1xuICAgIGZpbHRlcjogZnVuY3Rpb24gKG5vZGUsIG9wdGlvbnMpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIG9wdGlvbnMubGlua1N0eWxlID09PSBcImlubGluZWRcIiAmJlxuICAgICAgICBub2RlLm5vZGVOYW1lID09PSBcIkFcIiAmJlxuICAgICAgICBub2RlLmdldEF0dHJpYnV0ZShcImhyZWZcIilcbiAgICAgICk7XG4gICAgfSxcbiAgICByZXBsYWNlbWVudDogZnVuY3Rpb24gKGNvbnRlbnQsIG5vZGUpIHtcbiAgICAgIHZhciBocmVmID0gbm9kZS5nZXRBdHRyaWJ1dGUoXCJocmVmXCIpLnRyaW0oKTtcbiAgICAgIHZhciB0aXRsZSA9IG5vZGUudGl0bGUgPyAnIFwiJyArIG5vZGUudGl0bGUgKyAnXCInIDogXCJcIjtcbiAgICAgIHJldHVybiBcIltcIiArIGNvbnRlbnQudHJpbSgpICsgXCJdKFwiICsgaHJlZiArIHRpdGxlICsgXCIpXFxuXCI7XG4gICAgfSxcbiAgfSk7XG4gIHZhciBnZm0gPSB0dXJuZG93blBsdWdpbkdmbS5nZm07XG4gIHR1cm5kb3duU2VydmljZS51c2UoZ2ZtKTtcbiAgbGV0IG1hcmtkb3duQ29udGVudCA9IHR1cm5kb3duU2VydmljZS50dXJuZG93bihodG1sKTtcblxuICAvLyBtdWx0aXBsZSBsaW5lIGxpbmtzXG4gIGxldCBpbnNpZGVMaW5rQ29udGVudCA9IGZhbHNlO1xuICBsZXQgbmV3TWFya2Rvd25Db250ZW50ID0gXCJcIjtcbiAgbGV0IGxpbmtPcGVuQ291bnQgPSAwO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IG1hcmtkb3duQ29udGVudC5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGNoYXIgPSBtYXJrZG93bkNvbnRlbnRbaV07XG5cbiAgICBpZiAoY2hhciA9PSBcIltcIikge1xuICAgICAgbGlua09wZW5Db3VudCsrO1xuICAgIH0gZWxzZSBpZiAoY2hhciA9PSBcIl1cIikge1xuICAgICAgbGlua09wZW5Db3VudCA9IE1hdGgubWF4KDAsIGxpbmtPcGVuQ291bnQgLSAxKTtcbiAgICB9XG4gICAgaW5zaWRlTGlua0NvbnRlbnQgPSBsaW5rT3BlbkNvdW50ID4gMDtcblxuICAgIGlmIChpbnNpZGVMaW5rQ29udGVudCAmJiBjaGFyID09IFwiXFxuXCIpIHtcbiAgICAgIG5ld01hcmtkb3duQ29udGVudCArPSBcIlxcXFxcIiArIFwiXFxuXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5ld01hcmtkb3duQ29udGVudCArPSBjaGFyO1xuICAgIH1cbiAgfVxuICBtYXJrZG93bkNvbnRlbnQgPSBuZXdNYXJrZG93bkNvbnRlbnQ7XG5cbiAgLy8gUmVtb3ZlIFtTa2lwIHRvIENvbnRlbnRdKCNwYWdlKSBhbmQgW1NraXAgdG8gY29udGVudF0oI3NraXApXG4gIG1hcmtkb3duQ29udGVudCA9IG1hcmtkb3duQ29udGVudC5yZXBsYWNlKFxuICAgIC9cXFtTa2lwIHRvIENvbnRlbnRcXF1cXCgjW15cXCldKlxcKS9naSxcbiAgICBcIlwiXG4gICk7XG5cbiAgcmV0dXJuIG1hcmtkb3duQ29udGVudDtcbn1cbiJdLCJuYW1lcyI6WyJwYXJzZU1hcmtkb3duIiwiaHRtbCIsIlR1cm5kb3duU2VydmljZSIsInJlcXVpcmUiLCJ0dXJuZG93blBsdWdpbkdmbSIsInR1cm5kb3duU2VydmljZSIsImFkZFJ1bGUiLCJmaWx0ZXIiLCJub2RlIiwib3B0aW9ucyIsImxpbmtTdHlsZSIsIm5vZGVOYW1lIiwiZ2V0QXR0cmlidXRlIiwicmVwbGFjZW1lbnQiLCJjb250ZW50IiwiaHJlZiIsInRyaW0iLCJ0aXRsZSIsImdmbSIsInVzZSIsIm1hcmtkb3duQ29udGVudCIsInR1cm5kb3duIiwiaW5zaWRlTGlua0NvbnRlbnQiLCJuZXdNYXJrZG93bkNvbnRlbnQiLCJsaW5rT3BlbkNvdW50IiwiaSIsImxlbmd0aCIsImNoYXIiLCJNYXRoIiwibWF4IiwicmVwbGFjZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/html-to-markdown.ts\n");

/***/ }),

/***/ "(api)/./src/lib/parseApi.ts":
/*!*****************************!*\
  !*** ./src/lib/parseApi.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   parseApi: () => (/* binding */ parseApi),\n/* harmony export */   uuidToFcUuid: () => (/* binding */ uuidToFcUuid)\n/* harmony export */ });\nfunction parseApi(api) {\n    // Handle older versions of the API that don't have the fc- prefix\n    if (!api.startsWith(\"fc-\")) {\n        return api;\n    }\n    // remove the fc- prefix\n    // re add all the dashes based on the uuidv4 format\n    // 3d478a29-6e59-403e-85c7-94aba81ffd2a\n    const uuid = api.replace(/^fc-/, \"\").replace(/(.{8})(.{4})(.{4})(.{4})(.{12})/, \"$1-$2-$3-$4-$5\");\n    return uuid;\n}\nfunction uuidToFcUuid(uuid) {\n    const uuidWithoutDashes = uuid.replace(/-/g, \"\");\n    return `fc-${uuidWithoutDashes}`;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL3BhcnNlQXBpLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQU8sU0FBU0EsU0FBU0MsR0FBVztJQUNsQyxrRUFBa0U7SUFDbEUsSUFBSSxDQUFDQSxJQUFJQyxXQUFXLFFBQVE7UUFDMUIsT0FBT0Q7SUFDVDtJQUVBLHdCQUF3QjtJQUN4QixtREFBbUQ7SUFDbkQsdUNBQXVDO0lBQ3ZDLE1BQU1FLE9BQU9GLElBQ1ZHLFFBQVEsUUFBUSxJQUNoQkEsUUFBUSxtQ0FBbUM7SUFDOUMsT0FBT0Q7QUFDVDtBQUdPLFNBQVNFLGFBQWFGLElBQVk7SUFDdkMsTUFBTUcsb0JBQW9CSCxLQUFLQyxRQUFRLE1BQU07SUFDN0MsT0FBTyxDQUFDLEdBQUcsRUFBRUUsa0JBQWtCLENBQUM7QUFDbEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9maXJlY3Jhd2wtc2NyYXBlci1qcy8uL3NyYy9saWIvcGFyc2VBcGkudHM/ZThjYSJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gcGFyc2VBcGkoYXBpOiBzdHJpbmcpIHtcbiAgLy8gSGFuZGxlIG9sZGVyIHZlcnNpb25zIG9mIHRoZSBBUEkgdGhhdCBkb24ndCBoYXZlIHRoZSBmYy0gcHJlZml4XG4gIGlmICghYXBpLnN0YXJ0c1dpdGgoXCJmYy1cIikpIHtcbiAgICByZXR1cm4gYXBpO1xuICB9XG5cbiAgLy8gcmVtb3ZlIHRoZSBmYy0gcHJlZml4XG4gIC8vIHJlIGFkZCBhbGwgdGhlIGRhc2hlcyBiYXNlZCBvbiB0aGUgdXVpZHY0IGZvcm1hdFxuICAvLyAzZDQ3OGEyOS02ZTU5LTQwM2UtODVjNy05NGFiYTgxZmZkMmFcbiAgY29uc3QgdXVpZCA9IGFwaVxuICAgIC5yZXBsYWNlKC9eZmMtLywgXCJcIilcbiAgICAucmVwbGFjZSgvKC57OH0pKC57NH0pKC57NH0pKC57NH0pKC57MTJ9KS8sIFwiJDEtJDItJDMtJDQtJDVcIik7XG4gIHJldHVybiB1dWlkO1xufVxuXG5cbmV4cG9ydCBmdW5jdGlvbiB1dWlkVG9GY1V1aWQodXVpZDogc3RyaW5nKSB7XG4gIGNvbnN0IHV1aWRXaXRob3V0RGFzaGVzID0gdXVpZC5yZXBsYWNlKC8tL2csIFwiXCIpO1xuICByZXR1cm4gYGZjLSR7dXVpZFdpdGhvdXREYXNoZXN9YDtcbn1cbiJdLCJuYW1lcyI6WyJwYXJzZUFwaSIsImFwaSIsInN0YXJ0c1dpdGgiLCJ1dWlkIiwicmVwbGFjZSIsInV1aWRUb0ZjVXVpZCIsInV1aWRXaXRob3V0RGFzaGVzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/lib/parseApi.ts\n");

/***/ }),

/***/ "(api)/./src/lib/redis.ts":
/*!**************************!*\
  !*** ./src/lib/redis.ts ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! redis */ \"redis\");\n/* harmony import */ var redis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(redis__WEBPACK_IMPORTED_MODULE_0__);\n\nlet redisClient;\nif (true) {\n    if (!global.redis) {\n        redisClient = redis__WEBPACK_IMPORTED_MODULE_0__.createClient({\n            url: process.env.REDIS_URL,\n            legacyMode: true\n        });\n        redisClient.connect().catch(console.error);\n        global.redis = redisClient;\n    } else {\n        redisClient = global.redis;\n    }\n    console.log(process.env.REDIS_URL);\n    redisClient.on(\"connect\", (err)=>{\n        try {\n            if (!err) console.log(\"Connected to Redis Session Store!\");\n        } catch (error) {}\n    });\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (redisClient);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL3JlZGlzLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUErQjtBQUUvQixJQUFJQztBQUVKLElBQUksSUFBa0IsRUFBYTtJQUNqQyxJQUFJLENBQUNDLE9BQU9GLE9BQU87UUFDakJDLGNBQWNELCtDQUFrQkcsQ0FBQztZQUMvQkMsS0FBS0MsUUFBUUMsSUFBSUM7WUFDakJDLFlBQVk7UUFDZDtRQUNBUCxZQUFZUSxVQUFVQyxNQUFNQyxRQUFRQztRQUNwQ1YsT0FBT0YsUUFBUUM7SUFDakIsT0FBTztRQUNMQSxjQUFjQyxPQUFPRjtJQUN2QjtJQUNBVyxRQUFRRSxJQUFJUixRQUFRQyxJQUFJQztJQUN4Qk4sWUFBWWEsR0FBRyxXQUFXLENBQUNDO1FBQ3pCLElBQUk7WUFDRixJQUFJLENBQUNBLEtBQUtKLFFBQVFFLElBQUk7UUFDeEIsRUFBRSxPQUFPRCxPQUFPLENBQUM7SUFDbkI7QUFDRjtBQUVBLGlFQUFlWCxXQUFXQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmlyZWNyYXdsLXNjcmFwZXItanMvLi9zcmMvbGliL3JlZGlzLnRzPzkyNWQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgcmVkaXMgZnJvbSAncmVkaXMnO1xuXG5sZXQgcmVkaXNDbGllbnQ6IHJlZGlzLlJlZGlzQ2xpZW50VHlwZTtcblxuaWYgKHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnKSB7XG4gIGlmICghZ2xvYmFsLnJlZGlzKSB7XG4gICAgcmVkaXNDbGllbnQgPSByZWRpcy5jcmVhdGVDbGllbnQoe1xuICAgICAgdXJsOiBwcm9jZXNzLmVudi5SRURJU19VUkwsXG4gICAgICBsZWdhY3lNb2RlOiB0cnVlLFxuICAgIH0pO1xuICAgIHJlZGlzQ2xpZW50LmNvbm5lY3QoKS5jYXRjaChjb25zb2xlLmVycm9yKTtcbiAgICBnbG9iYWwucmVkaXMgPSByZWRpc0NsaWVudDtcbiAgfSBlbHNlIHtcbiAgICByZWRpc0NsaWVudCA9IGdsb2JhbC5yZWRpcztcbiAgfVxuICBjb25zb2xlLmxvZyhwcm9jZXNzLmVudi5SRURJU19VUkwpXG4gIHJlZGlzQ2xpZW50Lm9uKFwiY29ubmVjdFwiLCAoZXJyKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghZXJyKSBjb25zb2xlLmxvZyhcIkNvbm5lY3RlZCB0byBSZWRpcyBTZXNzaW9uIFN0b3JlIVwiKTtcbiAgICB9IGNhdGNoIChlcnJvcikge31cbiAgfSk7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHJlZGlzQ2xpZW50OyJdLCJuYW1lcyI6WyJyZWRpcyIsInJlZGlzQ2xpZW50IiwiZ2xvYmFsIiwiY3JlYXRlQ2xpZW50IiwidXJsIiwicHJvY2VzcyIsImVudiIsIlJFRElTX1VSTCIsImxlZ2FjeU1vZGUiLCJjb25uZWN0IiwiY2F0Y2giLCJjb25zb2xlIiwiZXJyb3IiLCJsb2ciLCJvbiIsImVyciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/lib/redis.ts\n");

/***/ }),

/***/ "(api)/./src/lib/withAuth.ts":
/*!*****************************!*\
  !*** ./src/lib/withAuth.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   withAuth: () => (/* binding */ withAuth)\n/* harmony export */ });\nlet warningCount = 0;\nfunction withAuth(originalFunction) {\n    return async function(...args) {\n        if (process.env.USE_DB_AUTHENTICATION === \"false\") {\n            if (warningCount < 5) {\n                console.warn(\"WARNING - You're bypassing authentication\");\n                warningCount++;\n            }\n            return {\n                success: true\n            };\n        } else {\n            try {\n                return await originalFunction(...args);\n            } catch (error) {\n                console.error(\"Error in withAuth function: \", error);\n                return {\n                    success: false,\n                    error: error.message\n                };\n            }\n        }\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvbGliL3dpdGhBdXRoLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFFQSxJQUFJQSxlQUFlO0FBRVosU0FBU0MsU0FDZEMsZ0JBQTRDO0lBRTVDLE9BQU8sZUFBZ0IsR0FBR0MsSUFBTztRQUMvQixJQUFJQyxRQUFRQyxJQUFJQywwQkFBMEIsU0FBUztZQUNqRCxJQUFJTixlQUFlLEdBQUc7Z0JBQ3BCTyxRQUFRQyxLQUFLO2dCQUNiUjtZQUNGO1lBQ0EsT0FBTztnQkFBRVMsU0FBUztZQUFLO1FBQ3pCLE9BQU87WUFDTCxJQUFJO2dCQUNGLE9BQU8sTUFBTVAsb0JBQW9CQztZQUNuQyxFQUFFLE9BQU9PLE9BQU87Z0JBQ2RILFFBQVFHLE1BQU0sZ0NBQWdDQTtnQkFDOUMsT0FBTztvQkFBRUQsU0FBUztvQkFBT0MsT0FBT0EsTUFBTUM7Z0JBQVE7WUFDaEQ7UUFDRjtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9maXJlY3Jhd2wtc2NyYXBlci1qcy8uL3NyYy9saWIvd2l0aEF1dGgudHM/NjM3YSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBdXRoUmVzcG9uc2UgfSBmcm9tIFwiLi4vLi4vc3JjL3R5cGVzXCI7XG5cbmxldCB3YXJuaW5nQ291bnQgPSAwO1xuXG5leHBvcnQgZnVuY3Rpb24gd2l0aEF1dGg8VCBleHRlbmRzIEF1dGhSZXNwb25zZSwgVSBleHRlbmRzIGFueVtdPihcbiAgb3JpZ2luYWxGdW5jdGlvbjogKC4uLmFyZ3M6IFUpID0+IFByb21pc2U8VD5cbikge1xuICByZXR1cm4gYXN5bmMgZnVuY3Rpb24gKC4uLmFyZ3M6IFUpOiBQcm9taXNlPFQ+IHtcbiAgICBpZiAocHJvY2Vzcy5lbnYuVVNFX0RCX0FVVEhFTlRJQ0FUSU9OID09PSBcImZhbHNlXCIpIHtcbiAgICAgIGlmICh3YXJuaW5nQ291bnQgPCA1KSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcIldBUk5JTkcgLSBZb3UncmUgYnlwYXNzaW5nIGF1dGhlbnRpY2F0aW9uXCIpO1xuICAgICAgICB3YXJuaW5nQ291bnQrKztcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfSBhcyBUO1xuICAgIH0gZWxzZSB7XG4gICAgICB0cnkge1xuICAgICAgICByZXR1cm4gYXdhaXQgb3JpZ2luYWxGdW5jdGlvbiguLi5hcmdzKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBpbiB3aXRoQXV0aCBmdW5jdGlvbjogXCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH0gYXMgVDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG59XG4iXSwibmFtZXMiOlsid2FybmluZ0NvdW50Iiwid2l0aEF1dGgiLCJvcmlnaW5hbEZ1bmN0aW9uIiwiYXJncyIsInByb2Nlc3MiLCJlbnYiLCJVU0VfREJfQVVUSEVOVElDQVRJT04iLCJjb25zb2xlIiwid2FybiIsInN1Y2Nlc3MiLCJlcnJvciIsIm1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/lib/withAuth.ts\n");

/***/ }),

/***/ "(api)/./src/pages/api/auth.ts":
/*!*******************************!*\
  !*** ./src/pages/api/auth.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authenticateUser: () => (/* binding */ authenticateUser),\n/* harmony export */   supaAuthenticateUser: () => (/* binding */ supaAuthenticateUser)\n/* harmony export */ });\n/* harmony import */ var _lib_parseApi__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/parseApi */ \"(api)/./src/lib/parseApi.ts\");\n/* harmony import */ var _services_rate_limiter__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../services/rate-limiter */ \"(api)/./src/services/rate-limiter.ts\");\n/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../types */ \"(api)/./src/types.ts\");\n/* harmony import */ var _services_supabase__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../services/supabase */ \"(api)/./src/services/supabase.ts\");\n/* harmony import */ var _lib_withAuth__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../lib/withAuth */ \"(api)/./src/lib/withAuth.ts\");\n\n\n\n\n\nasync function authenticateUser(req, res, mode) {\n    return (0,_lib_withAuth__WEBPACK_IMPORTED_MODULE_4__.withAuth)(supaAuthenticateUser)(req, res, mode);\n}\nasync function supaAuthenticateUser(req, res, mode) {\n    const authHeader = req.headers.authorization;\n    if (!authHeader) {\n        return {\n            success: false,\n            error: \"Unauthorized\",\n            status: 401\n        };\n    }\n    const token = authHeader.split(\" \")[1]; // Extract the token from \"Bearer <token>\"\n    if (!token) {\n        return {\n            success: false,\n            error: \"Unauthorized: Token missing\",\n            status: 401\n        };\n    }\n    try {\n        const incomingIP = req.headers[\"x-forwarded-for\"] || req.socket.remoteAddress;\n        const iptoken = incomingIP + token;\n        await (0,_services_rate_limiter__WEBPACK_IMPORTED_MODULE_1__.getRateLimiter)(token === \"this_is_just_a_preview_token\" ? _types__WEBPACK_IMPORTED_MODULE_2__.RateLimiterMode.Preview : mode).consume(iptoken);\n    } catch (rateLimiterRes) {\n        console.error(rateLimiterRes);\n        return {\n            success: false,\n            error: \"Rate limit exceeded. Too many requests, try again in 1 minute.\",\n            status: 429\n        };\n    }\n    if (token === \"this_is_just_a_preview_token\" && (mode === _types__WEBPACK_IMPORTED_MODULE_2__.RateLimiterMode.Scrape || mode === _types__WEBPACK_IMPORTED_MODULE_2__.RateLimiterMode.Preview || mode === _types__WEBPACK_IMPORTED_MODULE_2__.RateLimiterMode.Search)) {\n        return {\n            success: true,\n            team_id: \"preview\"\n        };\n    // check the origin of the request and make sure its from firecrawl.dev\n    // const origin = req.headers.origin;\n    // if (origin && origin.includes(\"firecrawl.dev\")){\n    //   return { success: true, team_id: \"preview\" };\n    // }\n    // if(process.env.ENV !== \"production\") {\n    //   return { success: true, team_id: \"preview\" };\n    // }\n    // return { success: false, error: \"Unauthorized: Invalid token\", status: 401 };\n    }\n    const normalizedApi = (0,_lib_parseApi__WEBPACK_IMPORTED_MODULE_0__.parseApi)(token);\n    // make sure api key is valid, based on the api_keys table in supabase\n    const { data, error } = await _services_supabase__WEBPACK_IMPORTED_MODULE_3__.supabase_service.from(\"api_keys\").select(\"*\").eq(\"key\", normalizedApi);\n    if (error || !data || data.length === 0) {\n        return {\n            success: false,\n            error: \"Unauthorized: Invalid token\",\n            status: 401\n        };\n    }\n    return {\n        success: true,\n        team_id: data[0].team_id\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvcGFnZXMvYXBpL2F1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUE4QztBQUNlO0FBQ0Q7QUFDRDtBQUNiO0FBR3ZDLGVBQWVLLGlCQUFpQkMsR0FBRyxFQUFFQyxHQUFHLEVBQUVDLElBQXNCO0lBQ3JFLE9BQU9KLHVEQUFRQSxDQUFDSyxzQkFBc0JILEtBQUtDLEtBQUtDO0FBQ2xEO0FBRU8sZUFBZUMscUJBQ3BCSCxHQUFHLEVBQ0hDLEdBQUcsRUFDSEMsSUFBc0I7SUFRdEIsTUFBTUUsYUFBYUosSUFBSUssUUFBUUM7SUFDL0IsSUFBSSxDQUFDRixZQUFZO1FBQ2YsT0FBTztZQUFFRyxTQUFTO1lBQU9DLE9BQU87WUFBZ0JDLFFBQVE7UUFBSTtJQUM5RDtJQUNBLE1BQU1DLFFBQVFOLFdBQVdPLE1BQU0sSUFBSSxDQUFDLEVBQUUsRUFBRSwwQ0FBMEM7SUFDbEYsSUFBSSxDQUFDRCxPQUFPO1FBQ1YsT0FBTztZQUNMSCxTQUFTO1lBQ1RDLE9BQU87WUFDUEMsUUFBUTtRQUNWO0lBQ0Y7SUFFQSxJQUFJO1FBQ0YsTUFBTUcsYUFBY1osSUFBSUssT0FBTyxDQUFDLGtCQUFrQixJQUNoREwsSUFBSWEsT0FBT0M7UUFDYixNQUFNQyxVQUFVSCxhQUFhRjtRQUM3QixNQUFNZixzRUFBY0EsQ0FDbEJlLFVBQVUsaUNBQWlDZCxtREFBZUEsQ0FBQ29CLFVBQVVkLE1BQ3JFZSxRQUFRRjtJQUNaLEVBQUUsT0FBT0csZ0JBQWdCO1FBQ3ZCQyxRQUFRWCxNQUFNVTtRQUNkLE9BQU87WUFDTFgsU0FBUztZQUNUQyxPQUFPO1lBQ1BDLFFBQVE7UUFDVjtJQUNGO0lBRUEsSUFDRUMsVUFBVSxrQ0FDVFIsQ0FBQUEsU0FBU04sbURBQWVBLENBQUN3QixVQUFVbEIsU0FBU04sbURBQWVBLENBQUNvQixXQUFXZCxTQUFTTixtREFBZUEsQ0FBQ3lCLE1BQUssR0FDdEc7UUFDQSxPQUFPO1lBQUVkLFNBQVM7WUFBTWUsU0FBUztRQUFVO0lBQzNDLHVFQUF1RTtJQUN2RSxxQ0FBcUM7SUFDckMsbURBQW1EO0lBQ25ELGtEQUFrRDtJQUNsRCxJQUFJO0lBQ0oseUNBQXlDO0lBQ3pDLGtEQUFrRDtJQUNsRCxJQUFJO0lBRUosZ0ZBQWdGO0lBQ2xGO0lBRUEsTUFBTUMsZ0JBQWdCN0IsdURBQVFBLENBQUNnQjtJQUMvQixzRUFBc0U7SUFDdEUsTUFBTSxFQUFFYyxJQUFJLEVBQUVoQixLQUFLLEVBQUUsR0FBRyxNQUFNWCxnRUFBZ0JBLENBQzNDNEIsS0FBSyxZQUNMQyxPQUFPLEtBQ1BDLEdBQUcsT0FBT0o7SUFDYixJQUFJZixTQUFTLENBQUNnQixRQUFRQSxLQUFLSSxXQUFXLEdBQUc7UUFDdkMsT0FBTztZQUNMckIsU0FBUztZQUNUQyxPQUFPO1lBQ1BDLFFBQVE7UUFDVjtJQUNGO0lBRUEsT0FBTztRQUFFRixTQUFTO1FBQU1lLFNBQVNFLElBQUksQ0FBQyxFQUFFLENBQUNGO0lBQVE7QUFDbkQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9maXJlY3Jhd2wtc2NyYXBlci1qcy8uL3NyYy9wYWdlcy9hcGkvYXV0aC50cz9iMDM4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHBhcnNlQXBpIH0gZnJvbSBcIi4uLy4uL2xpYi9wYXJzZUFwaVwiO1xuaW1wb3J0IHsgZ2V0UmF0ZUxpbWl0ZXIgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvcmF0ZS1saW1pdGVyXCI7XG5pbXBvcnQgeyBBdXRoUmVzcG9uc2UsIFJhdGVMaW1pdGVyTW9kZSB9IGZyb20gXCIuLi8uLi90eXBlc1wiO1xuaW1wb3J0IHsgc3VwYWJhc2Vfc2VydmljZSB9IGZyb20gXCIuLi8uLi9zZXJ2aWNlcy9zdXBhYmFzZVwiO1xuaW1wb3J0IHsgd2l0aEF1dGggfSBmcm9tIFwiLi4vLi4vbGliL3dpdGhBdXRoXCI7XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGF1dGhlbnRpY2F0ZVVzZXIocmVxLCByZXMsIG1vZGU/OiBSYXRlTGltaXRlck1vZGUpIDogUHJvbWlzZTxBdXRoUmVzcG9uc2U+IHtcbiAgcmV0dXJuIHdpdGhBdXRoKHN1cGFBdXRoZW50aWNhdGVVc2VyKShyZXEsIHJlcywgbW9kZSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdXBhQXV0aGVudGljYXRlVXNlcihcbiAgcmVxLFxuICByZXMsXG4gIG1vZGU/OiBSYXRlTGltaXRlck1vZGVcbik6IFByb21pc2U8e1xuICBzdWNjZXNzOiBib29sZWFuO1xuICB0ZWFtX2lkPzogc3RyaW5nO1xuICBlcnJvcj86IHN0cmluZztcbiAgc3RhdHVzPzogbnVtYmVyO1xufT4ge1xuXG4gIGNvbnN0IGF1dGhIZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xuICBpZiAoIWF1dGhIZWFkZXIpIHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIsIHN0YXR1czogNDAxIH07XG4gIH1cbiAgY29uc3QgdG9rZW4gPSBhdXRoSGVhZGVyLnNwbGl0KFwiIFwiKVsxXTsgLy8gRXh0cmFjdCB0aGUgdG9rZW4gZnJvbSBcIkJlYXJlciA8dG9rZW4+XCJcbiAgaWYgKCF0b2tlbikge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiBcIlVuYXV0aG9yaXplZDogVG9rZW4gbWlzc2luZ1wiLFxuICAgICAgc3RhdHVzOiA0MDEsXG4gICAgfTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgaW5jb21pbmdJUCA9IChyZXEuaGVhZGVyc1tcIngtZm9yd2FyZGVkLWZvclwiXSB8fFxuICAgICAgcmVxLnNvY2tldC5yZW1vdGVBZGRyZXNzKSBhcyBzdHJpbmc7XG4gICAgY29uc3QgaXB0b2tlbiA9IGluY29taW5nSVAgKyB0b2tlbjtcbiAgICBhd2FpdCBnZXRSYXRlTGltaXRlcihcbiAgICAgIHRva2VuID09PSBcInRoaXNfaXNfanVzdF9hX3ByZXZpZXdfdG9rZW5cIiA/IFJhdGVMaW1pdGVyTW9kZS5QcmV2aWV3IDogbW9kZVxuICAgICkuY29uc3VtZShpcHRva2VuKTtcbiAgfSBjYXRjaCAocmF0ZUxpbWl0ZXJSZXMpIHtcbiAgICBjb25zb2xlLmVycm9yKHJhdGVMaW1pdGVyUmVzKTtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogXCJSYXRlIGxpbWl0IGV4Y2VlZGVkLiBUb28gbWFueSByZXF1ZXN0cywgdHJ5IGFnYWluIGluIDEgbWludXRlLlwiLFxuICAgICAgc3RhdHVzOiA0MjksXG4gICAgfTtcbiAgfVxuXG4gIGlmIChcbiAgICB0b2tlbiA9PT0gXCJ0aGlzX2lzX2p1c3RfYV9wcmV2aWV3X3Rva2VuXCIgJiZcbiAgICAobW9kZSA9PT0gUmF0ZUxpbWl0ZXJNb2RlLlNjcmFwZSB8fCBtb2RlID09PSBSYXRlTGltaXRlck1vZGUuUHJldmlldyB8fCBtb2RlID09PSBSYXRlTGltaXRlck1vZGUuU2VhcmNoKVxuICApIHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB0ZWFtX2lkOiBcInByZXZpZXdcIiB9O1xuICAgIC8vIGNoZWNrIHRoZSBvcmlnaW4gb2YgdGhlIHJlcXVlc3QgYW5kIG1ha2Ugc3VyZSBpdHMgZnJvbSBmaXJlY3Jhd2wuZGV2XG4gICAgLy8gY29uc3Qgb3JpZ2luID0gcmVxLmhlYWRlcnMub3JpZ2luO1xuICAgIC8vIGlmIChvcmlnaW4gJiYgb3JpZ2luLmluY2x1ZGVzKFwiZmlyZWNyYXdsLmRldlwiKSl7XG4gICAgLy8gICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB0ZWFtX2lkOiBcInByZXZpZXdcIiB9O1xuICAgIC8vIH1cbiAgICAvLyBpZihwcm9jZXNzLmVudi5FTlYgIT09IFwicHJvZHVjdGlvblwiKSB7XG4gICAgLy8gICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCB0ZWFtX2lkOiBcInByZXZpZXdcIiB9O1xuICAgIC8vIH1cblxuICAgIC8vIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVbmF1dGhvcml6ZWQ6IEludmFsaWQgdG9rZW5cIiwgc3RhdHVzOiA0MDEgfTtcbiAgfVxuXG4gIGNvbnN0IG5vcm1hbGl6ZWRBcGkgPSBwYXJzZUFwaSh0b2tlbik7XG4gIC8vIG1ha2Ugc3VyZSBhcGkga2V5IGlzIHZhbGlkLCBiYXNlZCBvbiB0aGUgYXBpX2tleXMgdGFibGUgaW4gc3VwYWJhc2VcbiAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vfc2VydmljZVxuICAgIC5mcm9tKFwiYXBpX2tleXNcIilcbiAgICAuc2VsZWN0KFwiKlwiKVxuICAgIC5lcShcImtleVwiLCBub3JtYWxpemVkQXBpKTtcbiAgaWYgKGVycm9yIHx8ICFkYXRhIHx8IGRhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IFwiVW5hdXRob3JpemVkOiBJbnZhbGlkIHRva2VuXCIsXG4gICAgICBzdGF0dXM6IDQwMSxcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdGVhbV9pZDogZGF0YVswXS50ZWFtX2lkIH07XG59XG4iXSwibmFtZXMiOlsicGFyc2VBcGkiLCJnZXRSYXRlTGltaXRlciIsIlJhdGVMaW1pdGVyTW9kZSIsInN1cGFiYXNlX3NlcnZpY2UiLCJ3aXRoQXV0aCIsImF1dGhlbnRpY2F0ZVVzZXIiLCJyZXEiLCJyZXMiLCJtb2RlIiwic3VwYUF1dGhlbnRpY2F0ZVVzZXIiLCJhdXRoSGVhZGVyIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJzdWNjZXNzIiwiZXJyb3IiLCJzdGF0dXMiLCJ0b2tlbiIsInNwbGl0IiwiaW5jb21pbmdJUCIsInNvY2tldCIsInJlbW90ZUFkZHJlc3MiLCJpcHRva2VuIiwiUHJldmlldyIsImNvbnN1bWUiLCJyYXRlTGltaXRlclJlcyIsImNvbnNvbGUiLCJTY3JhcGUiLCJTZWFyY2giLCJ0ZWFtX2lkIiwibm9ybWFsaXplZEFwaSIsImRhdGEiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJsZW5ndGgiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/auth.ts\n");

/***/ }),

/***/ "(api)/./src/pages/api/scrape.ts":
/*!*********************************!*\
  !*** ./src/pages/api/scrape.ts ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   scrapeHelper: () => (/* binding */ scrapeHelper)\n/* harmony export */ });\n/* harmony import */ var _auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./auth */ \"(api)/./src/pages/api/auth.ts\");\n/* harmony import */ var _lib_LLM_extraction_helpers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../lib/LLM-extraction/helpers */ \"(api)/./src/lib/LLM-extraction/helpers.ts\");\n/* harmony import */ var _scraper_WebScraper__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../scraper/WebScraper */ \"(api)/./src/scraper/WebScraper/index.ts\");\n/* harmony import */ var _scraper_WebScraper_utils_blocklist__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../scraper/WebScraper/utils/blocklist */ \"(api)/./src/scraper/WebScraper/utils/blocklist.ts\");\n/* harmony import */ var _services_billing_credit_billing__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../..//services/billing/credit_billing */ \"(api)/./src/services/billing/credit_billing.ts\");\n/* harmony import */ var _services_logging_log_job__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../services/logging/log_job */ \"(api)/./src/services/logging/log_job.ts\");\n/* harmony import */ var _types__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../types */ \"(api)/./src/types.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_scraper_WebScraper__WEBPACK_IMPORTED_MODULE_2__]);\n_scraper_WebScraper__WEBPACK_IMPORTED_MODULE_2__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\nasync function scrapeHelper(req, team_id, crawlerOptions, pageOptions, extractorOptions) {\n    const url = req.body.url;\n    if (!url) {\n        return {\n            success: false,\n            error: \"Url is required\",\n            returnCode: 400\n        };\n    }\n    if ((0,_scraper_WebScraper_utils_blocklist__WEBPACK_IMPORTED_MODULE_3__.isUrlBlocked)(url)) {\n        return {\n            success: false,\n            error: \"Firecrawl currently does not support social media scraping due to policy restrictions. We're actively working on building support for it.\",\n            returnCode: 403\n        };\n    }\n    const a = new _scraper_WebScraper__WEBPACK_IMPORTED_MODULE_2__.WebScraperDataProvider();\n    await a.setOptions({\n        mode: \"single_urls\",\n        urls: [\n            url\n        ],\n        crawlerOptions: {\n            ...crawlerOptions\n        },\n        pageOptions: pageOptions,\n        extractorOptions: extractorOptions\n    });\n    const docs = await a.getDocuments(false);\n    // make sure doc.content is not empty\n    const filteredDocs = docs.filter((doc)=>doc.content && doc.content.trim().length > 0);\n    if (filteredDocs.length === 0) {\n        return {\n            success: true,\n            error: \"No page found\",\n            returnCode: 200\n        };\n    }\n    let creditsToBeBilled = filteredDocs.length;\n    const creditsPerLLMExtract = 5;\n    if (extractorOptions.mode === \"llm-extraction\") {\n        creditsToBeBilled = creditsToBeBilled + creditsPerLLMExtract * filteredDocs.length;\n    }\n    const billingResult = await (0,_services_billing_credit_billing__WEBPACK_IMPORTED_MODULE_4__.billTeam)(team_id, creditsToBeBilled);\n    if (!billingResult.success) {\n        return {\n            success: false,\n            error: \"Failed to bill team. Insufficient credits or subscription not found.\",\n            returnCode: 402\n        };\n    }\n    return {\n        success: true,\n        data: filteredDocs[0],\n        returnCode: 200\n    };\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (async (req, res)=>{\n    try {\n        // make sure to authenticate user first, Bearer <token>\n        const { success, team_id, error, status } = await (0,_auth__WEBPACK_IMPORTED_MODULE_0__.authenticateUser)(req, res, _types__WEBPACK_IMPORTED_MODULE_6__.RateLimiterMode.Scrape);\n        if (!success) {\n            res.status(status).json({\n                error\n            });\n        }\n        const crawlerOptions = req.body.crawlerOptions ?? {};\n        const pageOptions = req.body.pageOptions ?? {\n            onlyMainContent: false\n        };\n        const extractorOptions = req.body.extractorOptions ?? {\n            mode: \"markdown\"\n        };\n        const origin = req.body.origin ?? \"api\";\n        try {\n            const { success: creditsCheckSuccess, message: creditsCheckMessage } = await (0,_services_billing_credit_billing__WEBPACK_IMPORTED_MODULE_4__.checkTeamCredits)(team_id, 1);\n            if (!creditsCheckSuccess) {\n                res.status(402).json({\n                    error: \"Insufficient credits\"\n                });\n            }\n        } catch (error) {\n            console.error(error);\n            res.status(500).json({\n                error: \"Internal server error\"\n            });\n        }\n        const startTime = new Date().getTime();\n        const result = await scrapeHelper(req, team_id, crawlerOptions, pageOptions, extractorOptions);\n        const endTime = new Date().getTime();\n        const timeTakenInSeconds = (endTime - startTime) / 1000;\n        const numTokens = result.data && result.data.markdown ? (0,_lib_LLM_extraction_helpers__WEBPACK_IMPORTED_MODULE_1__.numTokensFromString)(result.data.markdown, \"gpt-3.5-turbo\") : 0;\n        (0,_services_logging_log_job__WEBPACK_IMPORTED_MODULE_5__.logJob)({\n            success: result.success,\n            message: result.error,\n            num_docs: 1,\n            docs: [\n                result.data\n            ],\n            time_taken: timeTakenInSeconds,\n            team_id: team_id,\n            mode: \"scrape\",\n            url: req.body.url,\n            crawlerOptions: crawlerOptions,\n            pageOptions: pageOptions,\n            origin: origin,\n            extractor_options: extractorOptions,\n            num_tokens: numTokens\n        });\n        res.status(result.returnCode).json(result);\n    } catch (error) {\n        console.error(error);\n        res.status(500).json({\n            error: error.message\n        });\n    }\n});\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O1FBQzdCLE1BQU1DLFNBQVMsTUFBTXhDLGFBQ25CQyxLQUNBQyxTQUNBQyxnQkFDQUMsYUFDQUM7UUFFRixNQUFNb0MsVUFBVSxJQUFJSCxPQUFPQztRQUMzQixNQUFNRyxxQkFBcUIsQ0FBQ0QsVUFBVUosU0FBUSxJQUFLO1FBQ25ELE1BQU1NLFlBQVksT0FBUWpCLFFBQVFjLE9BQU9kLEtBQUtrQixXQUFZbkQsZ0ZBQW1CQSxDQUFDK0MsT0FBT2QsS0FBS2tCLFVBQVUsbUJBQW1CO1FBRXZIOUMsaUVBQU1BLENBQUM7WUFDTFUsU0FBU2dDLE9BQU9oQztZQUNoQjBCLFNBQVNNLE9BQU8vQjtZQUNoQm9DLFVBQVU7WUFDVjlCLE1BQU07Z0JBQUN5QixPQUFPZDthQUFLO1lBQ25Cb0IsWUFBWUo7WUFDWnhDLFNBQVNBO1lBQ1RXLE1BQU07WUFDTlAsS0FBS0wsSUFBSU0sS0FBS0Q7WUFDZEgsZ0JBQWdCQTtZQUNoQkMsYUFBYUE7WUFDYjRCLFFBQVFBO1lBQ1JlLG1CQUFtQjFDO1lBQ25CMkMsWUFBWUw7UUFDZDtRQUNBaEIsSUFBSUMsT0FBT1ksT0FBTzlCLFlBQVlvQixLQUFLVTtJQUNyQyxFQUFFLE9BQU8vQixPQUFPO1FBQ2QyQixRQUFRM0IsTUFBTUE7UUFDZGtCLElBQUlDLE9BQU8sS0FBS0UsS0FBSztZQUFFckIsT0FBT0EsTUFBTXlCO1FBQVE7SUFDOUM7QUFDTixHQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmlyZWNyYXdsLXNjcmFwZXItanMvLi9zcmMvcGFnZXMvYXBpL3NjcmFwZS50cz9kZjQ3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7VmVyY2VsUmVxdWVzdCwgVmVyY2VsUmVzcG9uc2V9IGZyb20gXCJAdmVyY2VsL25vZGVcIlxuaW1wb3J0IHsgYXV0aGVudGljYXRlVXNlciB9IGZyb20gXCIuL2F1dGhcIjtcbmltcG9ydCB7IG51bVRva2Vuc0Zyb21TdHJpbmcgfSBmcm9tIFwiLi4vLi4vbGliL0xMTS1leHRyYWN0aW9uL2hlbHBlcnNcIjtcbmltcG9ydCB7IEV4dHJhY3Rvck9wdGlvbnMgfSBmcm9tIFwiLi4vLi4vbGliL2VudGl0aWVzXCI7XG5pbXBvcnQgeyBXZWJTY3JhcGVyRGF0YVByb3ZpZGVyIH0gZnJvbSBcIi4uLy4uL3NjcmFwZXIvV2ViU2NyYXBlclwiO1xuaW1wb3J0IHsgaXNVcmxCbG9ja2VkIH0gZnJvbSBcIi4uLy4uL3NjcmFwZXIvV2ViU2NyYXBlci91dGlscy9ibG9ja2xpc3RcIjtcbmltcG9ydCB7IGJpbGxUZWFtLCBjaGVja1RlYW1DcmVkaXRzIH0gZnJvbSBcIi4uLy4uLy9zZXJ2aWNlcy9iaWxsaW5nL2NyZWRpdF9iaWxsaW5nXCI7XG5pbXBvcnQgeyBsb2dKb2IgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvbG9nZ2luZy9sb2dfam9iXCI7XG5pbXBvcnQgeyBSYXRlTGltaXRlck1vZGUgfSBmcm9tIFwiLi4vLi4vdHlwZXNcIjtcbmltcG9ydCB7IERvY3VtZW50IH0gZnJvbSBcIi4uLy4uL2xpYi9lbnRpdGllc1wiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2NyYXBlSGVscGVyKFxuICByZXE6IFZlcmNlbFJlcXVlc3QsXG4gIHRlYW1faWQ6IHN0cmluZyxcbiAgY3Jhd2xlck9wdGlvbnM6IGFueSxcbiAgcGFnZU9wdGlvbnM6IGFueSxcbiAgZXh0cmFjdG9yT3B0aW9uczogRXh0cmFjdG9yT3B0aW9uc1xuKTogUHJvbWlzZTx7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIGVycm9yPzogc3RyaW5nO1xuICBkYXRhPzogRG9jdW1lbnQ7XG4gIHJldHVybkNvZGU6IG51bWJlcjtcbn0+IHtcbiAgY29uc3QgdXJsID0gcmVxLmJvZHkudXJsO1xuICBpZiAoIXVybCkge1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJVcmwgaXMgcmVxdWlyZWRcIiwgcmV0dXJuQ29kZTogNDAwIH07XG4gIH1cblxuICBpZiAoaXNVcmxCbG9ja2VkKHVybCkpIHtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRmlyZWNyYXdsIGN1cnJlbnRseSBkb2VzIG5vdCBzdXBwb3J0IHNvY2lhbCBtZWRpYSBzY3JhcGluZyBkdWUgdG8gcG9saWN5IHJlc3RyaWN0aW9ucy4gV2UncmUgYWN0aXZlbHkgd29ya2luZyBvbiBidWlsZGluZyBzdXBwb3J0IGZvciBpdC5cIiwgcmV0dXJuQ29kZTogNDAzIH07XG4gIH1cblxuXG4gIGNvbnN0IGEgPSBuZXcgV2ViU2NyYXBlckRhdGFQcm92aWRlcigpO1xuICBhd2FpdCBhLnNldE9wdGlvbnMoe1xuICAgIG1vZGU6IFwic2luZ2xlX3VybHNcIixcbiAgICB1cmxzOiBbdXJsXSxcbiAgICBjcmF3bGVyT3B0aW9uczoge1xuICAgICAgLi4uY3Jhd2xlck9wdGlvbnMsXG4gICAgfSxcbiAgICBwYWdlT3B0aW9uczogcGFnZU9wdGlvbnMsXG4gICAgZXh0cmFjdG9yT3B0aW9uczogZXh0cmFjdG9yT3B0aW9uc1xuICB9KTtcblxuICBjb25zdCBkb2NzID0gYXdhaXQgYS5nZXREb2N1bWVudHMoZmFsc2UpO1xuICAvLyBtYWtlIHN1cmUgZG9jLmNvbnRlbnQgaXMgbm90IGVtcHR5XG4gIGNvbnN0IGZpbHRlcmVkRG9jcyA9IGRvY3MuZmlsdGVyKFxuICAgIChkb2M6IHsgY29udGVudD86IHN0cmluZyB9KSA9PiBkb2MuY29udGVudCAmJiBkb2MuY29udGVudC50cmltKCkubGVuZ3RoID4gMFxuICApO1xuICBpZiAoZmlsdGVyZWREb2NzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGVycm9yOiBcIk5vIHBhZ2UgZm91bmRcIiwgcmV0dXJuQ29kZTogMjAwIH07XG4gIH1cblxuXG4gIGxldCBjcmVkaXRzVG9CZUJpbGxlZCA9ICBmaWx0ZXJlZERvY3MubGVuZ3RoO1xuICBjb25zdCBjcmVkaXRzUGVyTExNRXh0cmFjdCA9IDU7XG5cbiAgaWYgKGV4dHJhY3Rvck9wdGlvbnMubW9kZSA9PT0gXCJsbG0tZXh0cmFjdGlvblwiKXtcbiAgICBjcmVkaXRzVG9CZUJpbGxlZCA9IGNyZWRpdHNUb0JlQmlsbGVkICsgKGNyZWRpdHNQZXJMTE1FeHRyYWN0ICogZmlsdGVyZWREb2NzLmxlbmd0aClcbiAgfVxuXG4gIGNvbnN0IGJpbGxpbmdSZXN1bHQgPSBhd2FpdCBiaWxsVGVhbShcbiAgICB0ZWFtX2lkLFxuICAgIGNyZWRpdHNUb0JlQmlsbGVkXG4gICk7XG4gIGlmICghYmlsbGluZ1Jlc3VsdC5zdWNjZXNzKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6XG4gICAgICAgIFwiRmFpbGVkIHRvIGJpbGwgdGVhbS4gSW5zdWZmaWNpZW50IGNyZWRpdHMgb3Igc3Vic2NyaXB0aW9uIG5vdCBmb3VuZC5cIixcbiAgICAgIHJldHVybkNvZGU6IDQwMixcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBzdWNjZXNzOiB0cnVlLFxuICAgIGRhdGE6IGZpbHRlcmVkRG9jc1swXSxcbiAgICByZXR1cm5Db2RlOiAyMDAsXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIChyZXE6IFZlcmNlbFJlcXVlc3QsIHJlczogVmVyY2VsUmVzcG9uc2UpID0+IHtcbiAgICB0cnkge1xuICAgICAgICAvLyBtYWtlIHN1cmUgdG8gYXV0aGVudGljYXRlIHVzZXIgZmlyc3QsIEJlYXJlciA8dG9rZW4+XG4gICAgICAgIGNvbnN0IHsgc3VjY2VzcywgdGVhbV9pZCwgZXJyb3IsIHN0YXR1cyB9ID0gYXdhaXQgYXV0aGVudGljYXRlVXNlcihcbiAgICAgICAgICByZXEsXG4gICAgICAgICAgcmVzLFxuICAgICAgICAgIFJhdGVMaW1pdGVyTW9kZS5TY3JhcGVcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICAgICAgcmVzLnN0YXR1cyhzdGF0dXMpLmpzb24oeyBlcnJvciB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjcmF3bGVyT3B0aW9ucyA9IHJlcS5ib2R5LmNyYXdsZXJPcHRpb25zID8/IHt9O1xuICAgICAgICBjb25zdCBwYWdlT3B0aW9ucyA9IHJlcS5ib2R5LnBhZ2VPcHRpb25zID8/IHsgb25seU1haW5Db250ZW50OiBmYWxzZSB9O1xuICAgICAgICBjb25zdCBleHRyYWN0b3JPcHRpb25zID0gcmVxLmJvZHkuZXh0cmFjdG9yT3B0aW9ucyA/PyB7XG4gICAgICAgICAgbW9kZTogXCJtYXJrZG93blwiXG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb3JpZ2luID0gcmVxLmJvZHkub3JpZ2luID8/IFwiYXBpXCI7XG4gICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgeyBzdWNjZXNzOiBjcmVkaXRzQ2hlY2tTdWNjZXNzLCBtZXNzYWdlOiBjcmVkaXRzQ2hlY2tNZXNzYWdlIH0gPVxuICAgICAgICAgICAgYXdhaXQgY2hlY2tUZWFtQ3JlZGl0cyh0ZWFtX2lkLCAxKTtcbiAgICAgICAgICBpZiAoIWNyZWRpdHNDaGVja1N1Y2Nlc3MpIHtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAyKS5qc29uKHsgZXJyb3I6IFwiSW5zdWZmaWNpZW50IGNyZWRpdHNcIiB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogXCJJbnRlcm5hbCBzZXJ2ZXIgZXJyb3JcIiB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2NyYXBlSGVscGVyKFxuICAgICAgICAgIHJlcSxcbiAgICAgICAgICB0ZWFtX2lkLFxuICAgICAgICAgIGNyYXdsZXJPcHRpb25zLFxuICAgICAgICAgIHBhZ2VPcHRpb25zLFxuICAgICAgICAgIGV4dHJhY3Rvck9wdGlvbnNcbiAgICAgICAgKTtcbiAgICAgICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICBjb25zdCB0aW1lVGFrZW5JblNlY29uZHMgPSAoZW5kVGltZSAtIHN0YXJ0VGltZSkgLyAxMDAwO1xuICAgICAgICBjb25zdCBudW1Ub2tlbnMgPSAocmVzdWx0LmRhdGEgJiYgcmVzdWx0LmRhdGEubWFya2Rvd24pID8gbnVtVG9rZW5zRnJvbVN0cmluZyhyZXN1bHQuZGF0YS5tYXJrZG93biwgXCJncHQtMy41LXR1cmJvXCIpIDogMDtcbiAgICBcbiAgICAgICAgbG9nSm9iKHtcbiAgICAgICAgICBzdWNjZXNzOiByZXN1bHQuc3VjY2VzcyxcbiAgICAgICAgICBtZXNzYWdlOiByZXN1bHQuZXJyb3IsXG4gICAgICAgICAgbnVtX2RvY3M6IDEsXG4gICAgICAgICAgZG9jczogW3Jlc3VsdC5kYXRhXSxcbiAgICAgICAgICB0aW1lX3Rha2VuOiB0aW1lVGFrZW5JblNlY29uZHMsXG4gICAgICAgICAgdGVhbV9pZDogdGVhbV9pZCxcbiAgICAgICAgICBtb2RlOiBcInNjcmFwZVwiLFxuICAgICAgICAgIHVybDogcmVxLmJvZHkudXJsLFxuICAgICAgICAgIGNyYXdsZXJPcHRpb25zOiBjcmF3bGVyT3B0aW9ucyxcbiAgICAgICAgICBwYWdlT3B0aW9uczogcGFnZU9wdGlvbnMsXG4gICAgICAgICAgb3JpZ2luOiBvcmlnaW4sIFxuICAgICAgICAgIGV4dHJhY3Rvcl9vcHRpb25zOiBleHRyYWN0b3JPcHRpb25zLFxuICAgICAgICAgIG51bV90b2tlbnM6IG51bVRva2Vuc1xuICAgICAgICB9KTtcbiAgICAgICAgcmVzLnN0YXR1cyhyZXN1bHQucmV0dXJuQ29kZSkuanNvbihyZXN1bHQpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XG4gICAgICB9XG59Il0sIm5hbWVzIjpbImF1dGhlbnRpY2F0ZVVzZXIiLCJudW1Ub2tlbnNGcm9tU3RyaW5nIiwiV2ViU2NyYXBlckRhdGFQcm92aWRlciIsImlzVXJsQmxvY2tlZCIsImJpbGxUZWFtIiwiY2hlY2tUZWFtQ3JlZGl0cyIsImxvZ0pvYiIsIlJhdGVMaW1pdGVyTW9kZSIsInNjcmFwZUhlbHBlciIsInJlcSIsInRlYW1faWQiLCJjcmF3bGVyT3B0aW9ucyIsInBhZ2VPcHRpb25zIiwiZXh0cmFjdG9yT3B0aW9ucyIsInVybCIsImJvZHkiLCJzdWNjZXNzIiwiZXJyb3IiLCJyZXR1cm5Db2RlIiwiYSIsInNldE9wdGlvbnMiLCJtb2RlIiwidXJscyIsImRvY3MiLCJnZXREb2N1bWVudHMiLCJmaWx0ZXJlZERvY3MiLCJmaWx0ZXIiLCJkb2MiLCJjb250ZW50IiwidHJpbSIsImxlbmd0aCIsImNyZWRpdHNUb0JlQmlsbGVkIiwiY3JlZGl0c1BlckxMTUV4dHJhY3QiLCJiaWxsaW5nUmVzdWx0IiwiZGF0YSIsInJlcyIsInN0YXR1cyIsIlNjcmFwZSIsImpzb24iLCJvbmx5TWFpbkNvbnRlbnQiLCJvcmlnaW4iLCJjcmVkaXRzQ2hlY2tTdWNjZXNzIiwibWVzc2FnZSIsImNyZWRpdHNDaGVja01lc3NhZ2UiLCJjb25zb2xlIiwic3RhcnRUaW1lIiwiRGF0ZSIsImdldFRpbWUiLCJyZXN1bHQiLCJlbmRUaW1lIiwidGltZVRha2VuSW5TZWNvbmRzIiwibnVtVG9rZW5zIiwibWFya2Rvd24iLCJudW1fZG9jcyIsInRpbWVfdGFrZW4iLCJleHRyYWN0b3Jfb3B0aW9ucyIsIm51bV90b2tlbnMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/pages/api/scrape.ts\n");

/***/ }),

/***/ "(api)/./src/scraper/WebScraper/crawler.ts":
/*!*******************************************!*\
  !*** ./src/scraper/WebScraper/crawler.ts ***!
  \*******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WebCrawler: () => (/* binding */ WebCrawler)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! axios */ \"axios\");\n/* harmony import */ var cheerio__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! cheerio */ \"cheerio\");\n/* harmony import */ var url__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! url */ \"url\");\n/* harmony import */ var url__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(url__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _sitemap__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./sitemap */ \"(api)/./src/scraper/WebScraper/sitemap.ts\");\n/* harmony import */ var async__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! async */ \"async\");\n/* harmony import */ var async__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(async__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var _single_url__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./single_url */ \"(api)/./src/scraper/WebScraper/single_url.ts\");\n/* harmony import */ var robots_parser__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! robots-parser */ \"robots-parser\");\n/* harmony import */ var robots_parser__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(robots_parser__WEBPACK_IMPORTED_MODULE_6__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_0__, cheerio__WEBPACK_IMPORTED_MODULE_1__, _sitemap__WEBPACK_IMPORTED_MODULE_3__, _single_url__WEBPACK_IMPORTED_MODULE_5__]);\n([axios__WEBPACK_IMPORTED_MODULE_0__, cheerio__WEBPACK_IMPORTED_MODULE_1__, _sitemap__WEBPACK_IMPORTED_MODULE_3__, _single_url__WEBPACK_IMPORTED_MODULE_5__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\nclass WebCrawler {\n    constructor({ initialUrl, includes, excludes, maxCrawledLinks, limit = 10000, generateImgAltText = false }){\n        this.visited = new Set();\n        this.crawledUrls = new Set();\n        this.initialUrl = initialUrl;\n        this.baseUrl = new url__WEBPACK_IMPORTED_MODULE_2__.URL(initialUrl).origin;\n        this.includes = includes ?? [];\n        this.excludes = excludes ?? [];\n        this.limit = limit;\n        this.robotsTxtUrl = `${this.baseUrl}/robots.txt`;\n        this.robots = robots_parser__WEBPACK_IMPORTED_MODULE_6___default()(this.robotsTxtUrl, \"\");\n        // Deprecated, use limit instead\n        this.maxCrawledLinks = maxCrawledLinks ?? limit;\n        this.generateImgAltText = generateImgAltText ?? false;\n    }\n    filterLinks(sitemapLinks, limit) {\n        return sitemapLinks.filter((link)=>{\n            const url = new url__WEBPACK_IMPORTED_MODULE_2__.URL(link);\n            const path = url.pathname;\n            // Check if the link should be excluded\n            if (this.excludes.length > 0 && this.excludes[0] !== \"\") {\n                if (this.excludes.some((excludePattern)=>new RegExp(excludePattern).test(path))) {\n                    return false;\n                }\n            }\n            // Check if the link matches the include patterns, if any are specified\n            if (this.includes.length > 0 && this.includes[0] !== \"\") {\n                return this.includes.some((includePattern)=>new RegExp(includePattern).test(path));\n            }\n            const isAllowed = this.robots.isAllowed(link, \"FireCrawlAgent\") ?? true;\n            // Check if the link is disallowed by robots.txt\n            if (!isAllowed) {\n                console.log(`Link disallowed by robots.txt: ${link}`);\n                return false;\n            }\n            return true;\n        }).slice(0, limit);\n    }\n    async start(inProgress, concurrencyLimit = 5, limit = 10000) {\n        // Fetch and parse robots.txt\n        try {\n            const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].get(this.robotsTxtUrl);\n            this.robots = robots_parser__WEBPACK_IMPORTED_MODULE_6___default()(this.robotsTxtUrl, response.data);\n        } catch (error) {\n            console.error(`Failed to fetch robots.txt from ${this.robotsTxtUrl}`);\n        }\n        const sitemapLinks = await this.tryFetchSitemapLinks(this.initialUrl);\n        if (sitemapLinks.length > 0) {\n            const filteredLinks = this.filterLinks(sitemapLinks, limit);\n            return filteredLinks;\n        }\n        const urls = await this.crawlUrls([\n            this.initialUrl\n        ], concurrencyLimit, inProgress);\n        if (urls.length === 0 && this.filterLinks([\n            this.initialUrl\n        ], limit).length > 0) {\n            return [\n                this.initialUrl\n            ];\n        }\n        // make sure to run include exclude here again\n        return this.filterLinks(urls, limit);\n    }\n    async crawlUrls(urls, concurrencyLimit, inProgress) {\n        const queue = async__WEBPACK_IMPORTED_MODULE_4___default().queue(async (task, callback)=>{\n            if (this.crawledUrls.size >= this.maxCrawledLinks) {\n                if (callback && typeof callback === \"function\") {\n                    callback();\n                }\n                return;\n            }\n            const newUrls = await this.crawl(task);\n            newUrls.forEach((url)=>this.crawledUrls.add(url));\n            if (inProgress && newUrls.length > 0) {\n                inProgress({\n                    current: this.crawledUrls.size,\n                    total: this.maxCrawledLinks,\n                    status: \"SCRAPING\",\n                    currentDocumentUrl: newUrls[newUrls.length - 1]\n                });\n            } else if (inProgress) {\n                inProgress({\n                    current: this.crawledUrls.size,\n                    total: this.maxCrawledLinks,\n                    status: \"SCRAPING\",\n                    currentDocumentUrl: task\n                });\n            }\n            await this.crawlUrls(newUrls, concurrencyLimit, inProgress);\n            if (callback && typeof callback === \"function\") {\n                callback();\n            }\n        }, concurrencyLimit);\n        queue.push(urls.filter((url)=>!this.visited.has(url) && this.robots.isAllowed(url, \"FireCrawlAgent\")), (err)=>{\n            if (err) console.error(err);\n        });\n        await queue.drain();\n        return Array.from(this.crawledUrls);\n    }\n    async crawl(url) {\n        if (this.visited.has(url) || !this.robots.isAllowed(url, \"FireCrawlAgent\")) return [];\n        this.visited.add(url);\n        if (!url.startsWith(\"http\")) {\n            url = \"https://\" + url;\n        }\n        if (url.endsWith(\"/\")) {\n            url = url.slice(0, -1);\n        }\n        if (this.isFile(url) || this.isSocialMediaOrEmail(url)) {\n            return [];\n        }\n        try {\n            let content;\n            // If it is the first link, fetch with scrapingbee\n            if (this.visited.size === 1) {\n                content = await (0,_single_url__WEBPACK_IMPORTED_MODULE_5__.scrapWithScrapingBee)(url, \"load\");\n            } else {\n                const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].get(url);\n                content = response.data;\n            }\n            const $ = (0,cheerio__WEBPACK_IMPORTED_MODULE_1__.load)(content);\n            let links = [];\n            $(\"a\").each((_, element)=>{\n                const href = $(element).attr(\"href\");\n                if (href) {\n                    let fullUrl = href;\n                    if (!href.startsWith(\"http\")) {\n                        fullUrl = new url__WEBPACK_IMPORTED_MODULE_2__.URL(href, this.baseUrl).toString();\n                    }\n                    const url = new url__WEBPACK_IMPORTED_MODULE_2__.URL(fullUrl);\n                    const path = url.pathname;\n                    if (// fullUrl.startsWith(this.initialUrl) && // this condition makes it stop crawling back the url\n                    this.isInternalLink(fullUrl) && this.matchesPattern(fullUrl) && this.noSections(fullUrl) && this.matchesIncludes(path) && !this.matchesExcludes(path) && this.robots.isAllowed(fullUrl, \"FireCrawlAgent\")) {\n                        links.push(fullUrl);\n                    }\n                }\n            });\n            return links.filter((link)=>!this.visited.has(link));\n        } catch (error) {\n            return [];\n        }\n    }\n    matchesIncludes(url) {\n        if (this.includes.length === 0 || this.includes[0] == \"\") return true;\n        return this.includes.some((pattern)=>new RegExp(pattern).test(url));\n    }\n    matchesExcludes(url) {\n        if (this.excludes.length === 0 || this.excludes[0] == \"\") return false;\n        return this.excludes.some((pattern)=>new RegExp(pattern).test(url));\n    }\n    noSections(link) {\n        return !link.includes(\"#\");\n    }\n    isInternalLink(link) {\n        const urlObj = new url__WEBPACK_IMPORTED_MODULE_2__.URL(link, this.baseUrl);\n        const domainWithoutProtocol = this.baseUrl.replace(/^https?:\\/\\//, \"\");\n        return urlObj.hostname === domainWithoutProtocol;\n    }\n    matchesPattern(link) {\n        return true; // Placeholder for future pattern matching implementation\n    }\n    isFile(url) {\n        const fileExtensions = [\n            \".png\",\n            \".jpg\",\n            \".jpeg\",\n            \".gif\",\n            \".css\",\n            \".js\",\n            \".ico\",\n            \".svg\",\n            // \".pdf\", \n            \".zip\",\n            \".exe\",\n            \".dmg\",\n            \".mp4\",\n            \".mp3\",\n            \".pptx\",\n            \".docx\",\n            \".xlsx\",\n            \".xml\"\n        ];\n        return fileExtensions.some((ext)=>url.endsWith(ext));\n    }\n    isSocialMediaOrEmail(url) {\n        const socialMediaOrEmail = [\n            \"facebook.com\",\n            \"twitter.com\",\n            \"linkedin.com\",\n            \"instagram.com\",\n            \"pinterest.com\",\n            \"mailto:\"\n        ];\n        return socialMediaOrEmail.some((ext)=>url.includes(ext));\n    }\n    async tryFetchSitemapLinks(url) {\n        const sitemapUrl = url.endsWith(\"/sitemap.xml\") ? url : `${url}/sitemap.xml`;\n        try {\n            const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].get(sitemapUrl);\n            if (response.status === 200) {\n                return await (0,_sitemap__WEBPACK_IMPORTED_MODULE_3__.getLinksFromSitemap)(sitemapUrl);\n            }\n        } catch (error) {\n        // Error handling for failed sitemap fetch\n        }\n        return [];\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL2NyYXdsZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBMEI7QUFDYztBQUNkO0FBQ3NCO0FBQ3RCO0FBRTBCO0FBQ1g7QUFFbEMsTUFBTU87SUFhWEMsWUFBWSxFQUNWQyxVQUFVLEVBQ1ZDLFFBQVEsRUFDUkMsUUFBUSxFQUNSQyxlQUFlLEVBQ2ZDLFFBQVEsS0FBSyxFQUNiQyxxQkFBcUIsS0FBSyxFQVEzQixDQUFFO2FBckJLQyxVQUF1QixJQUFJQzthQUMzQkMsY0FBMkIsSUFBSUQ7UUFxQnJDLElBQUksQ0FBQ1AsYUFBYUE7UUFDbEIsSUFBSSxDQUFDUyxVQUFVLElBQUloQixvQ0FBR0EsQ0FBQ08sWUFBWVU7UUFDbkMsSUFBSSxDQUFDVCxXQUFXQSxZQUFZLEVBQUU7UUFDOUIsSUFBSSxDQUFDQyxXQUFXQSxZQUFZLEVBQUU7UUFDOUIsSUFBSSxDQUFDRSxRQUFRQTtRQUNiLElBQUksQ0FBQ08sZUFBZSxDQUFDLEVBQUUsSUFBSSxDQUFDRixRQUFRLFdBQVcsQ0FBQztRQUNoRCxJQUFJLENBQUNHLFNBQVNmLG9EQUFZQSxDQUFDLElBQUksQ0FBQ2MsY0FBYztRQUM5QyxnQ0FBZ0M7UUFDaEMsSUFBSSxDQUFDUixrQkFBa0JBLG1CQUFtQkM7UUFDMUMsSUFBSSxDQUFDQyxxQkFBcUJBLHNCQUFzQjtJQUNsRDtJQUdRUSxZQUFZQyxZQUFzQixFQUFFVixLQUFhLEVBQVk7UUFDbkUsT0FBT1UsYUFDSkMsT0FBTyxDQUFDQztZQUNQLE1BQU1DLE1BQU0sSUFBSXhCLG9DQUFHQSxDQUFDdUI7WUFDcEIsTUFBTUUsT0FBT0QsSUFBSUU7WUFFakIsdUNBQXVDO1lBQ3ZDLElBQUksSUFBSSxDQUFDakIsU0FBU2tCLFNBQVMsS0FBSyxJQUFJLENBQUNsQixRQUFRLENBQUMsRUFBRSxLQUFLLElBQUk7Z0JBQ3ZELElBQ0UsSUFBSSxDQUFDQSxTQUFTbUIsS0FBSyxDQUFDQyxpQkFDbEIsSUFB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b3VyY2VzIjpbIndlYnBhY2s6Ly9maXJlY3Jhd2wtc2NyYXBlci1qcy8uL3NyYy9zY3JhcGVyL1dlYlNjcmFwZXIvY3Jhd2xlci50cz84OGM5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBheGlvcyBmcm9tIFwiYXhpb3NcIjtcbmltcG9ydCBjaGVlcmlvLCB7IGxvYWQgfSBmcm9tIFwiY2hlZXJpb1wiO1xuaW1wb3J0IHsgVVJMIH0gZnJvbSBcInVybFwiO1xuaW1wb3J0IHsgZ2V0TGlua3NGcm9tU2l0ZW1hcCB9IGZyb20gXCIuL3NpdGVtYXBcIjtcbmltcG9ydCBhc3luYyBmcm9tIFwiYXN5bmNcIjtcbmltcG9ydCB7IFByb2dyZXNzIH0gZnJvbSBcIi4uLy4uL2xpYi9lbnRpdGllc1wiO1xuaW1wb3J0IHsgc2NyYXBXaXRoU2NyYXBpbmdCZWUgfSBmcm9tIFwiLi9zaW5nbGVfdXJsXCI7XG5pbXBvcnQgcm9ib3RzUGFyc2VyIGZyb20gXCJyb2JvdHMtcGFyc2VyXCI7XG5cbmV4cG9ydCBjbGFzcyBXZWJDcmF3bGVyIHtcbiAgcHJpdmF0ZSBpbml0aWFsVXJsOiBzdHJpbmc7XG4gIHByaXZhdGUgYmFzZVVybDogc3RyaW5nO1xuICBwcml2YXRlIGluY2x1ZGVzOiBzdHJpbmdbXTtcbiAgcHJpdmF0ZSBleGNsdWRlczogc3RyaW5nW107XG4gIHByaXZhdGUgbWF4Q3Jhd2xlZExpbmtzOiBudW1iZXI7XG4gIHByaXZhdGUgdmlzaXRlZDogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XG4gIHByaXZhdGUgY3Jhd2xlZFVybHM6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xuICBwcml2YXRlIGxpbWl0OiBudW1iZXI7XG4gIHByaXZhdGUgcm9ib3RzVHh0VXJsOiBzdHJpbmc7XG4gIHByaXZhdGUgcm9ib3RzOiBhbnk7XG4gIHByaXZhdGUgZ2VuZXJhdGVJbWdBbHRUZXh0OiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKHtcbiAgICBpbml0aWFsVXJsLFxuICAgIGluY2x1ZGVzLFxuICAgIGV4Y2x1ZGVzLFxuICAgIG1heENyYXdsZWRMaW5rcyxcbiAgICBsaW1pdCA9IDEwMDAwLFxuICAgIGdlbmVyYXRlSW1nQWx0VGV4dCA9IGZhbHNlLFxuICB9OiB7XG4gICAgaW5pdGlhbFVybDogc3RyaW5nO1xuICAgIGluY2x1ZGVzPzogc3RyaW5nW107XG4gICAgZXhjbHVkZXM/OiBzdHJpbmdbXTtcbiAgICBtYXhDcmF3bGVkTGlua3M/OiBudW1iZXI7XG4gICAgbGltaXQ/OiBudW1iZXI7XG4gICAgZ2VuZXJhdGVJbWdBbHRUZXh0PzogYm9vbGVhbjtcbiAgfSkge1xuICAgIHRoaXMuaW5pdGlhbFVybCA9IGluaXRpYWxVcmw7XG4gICAgdGhpcy5iYXNlVXJsID0gbmV3IFVSTChpbml0aWFsVXJsKS5vcmlnaW47XG4gICAgdGhpcy5pbmNsdWRlcyA9IGluY2x1ZGVzID8/IFtdO1xuICAgIHRoaXMuZXhjbHVkZXMgPSBleGNsdWRlcyA/PyBbXTtcbiAgICB0aGlzLmxpbWl0ID0gbGltaXQ7XG4gICAgdGhpcy5yb2JvdHNUeHRVcmwgPSBgJHt0aGlzLmJhc2VVcmx9L3JvYm90cy50eHRgO1xuICAgIHRoaXMucm9ib3RzID0gcm9ib3RzUGFyc2VyKHRoaXMucm9ib3RzVHh0VXJsLCBcIlwiKTtcbiAgICAvLyBEZXByZWNhdGVkLCB1c2UgbGltaXQgaW5zdGVhZFxuICAgIHRoaXMubWF4Q3Jhd2xlZExpbmtzID0gbWF4Q3Jhd2xlZExpbmtzID8/IGxpbWl0O1xuICAgIHRoaXMuZ2VuZXJhdGVJbWdBbHRUZXh0ID0gZ2VuZXJhdGVJbWdBbHRUZXh0ID8/IGZhbHNlO1xuICB9XG5cblxuICBwcml2YXRlIGZpbHRlckxpbmtzKHNpdGVtYXBMaW5rczogc3RyaW5nW10sIGxpbWl0OiBudW1iZXIpOiBzdHJpbmdbXSB7XG4gICAgcmV0dXJuIHNpdGVtYXBMaW5rc1xuICAgICAgLmZpbHRlcigobGluaykgPT4ge1xuICAgICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKGxpbmspO1xuICAgICAgICBjb25zdCBwYXRoID0gdXJsLnBhdGhuYW1lO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBsaW5rIHNob3VsZCBiZSBleGNsdWRlZFxuICAgICAgICBpZiAodGhpcy5leGNsdWRlcy5sZW5ndGggPiAwICYmIHRoaXMuZXhjbHVkZXNbMF0gIT09IFwiXCIpIHtcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICB0aGlzLmV4Y2x1ZGVzLnNvbWUoKGV4Y2x1ZGVQYXR0ZXJuKSA9PlxuICAgICAgICAgICAgICBuZXcgUmVnRXhwKGV4Y2x1ZGVQYXR0ZXJuKS50ZXN0KHBhdGgpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGxpbmsgbWF0Y2hlcyB0aGUgaW5jbHVkZSBwYXR0ZXJucywgaWYgYW55IGFyZSBzcGVjaWZpZWRcbiAgICAgICAgaWYgKHRoaXMuaW5jbHVkZXMubGVuZ3RoID4gMCAmJiB0aGlzLmluY2x1ZGVzWzBdICE9PSBcIlwiKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuaW5jbHVkZXMuc29tZSgoaW5jbHVkZVBhdHRlcm4pID0+XG4gICAgICAgICAgICBuZXcgUmVnRXhwKGluY2x1ZGVQYXR0ZXJuKS50ZXN0KHBhdGgpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGlzQWxsb3dlZCA9IHRoaXMucm9ib3RzLmlzQWxsb3dlZChsaW5rLCBcIkZpcmVDcmF3bEFnZW50XCIpID8/IHRydWU7XG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBsaW5rIGlzIGRpc2FsbG93ZWQgYnkgcm9ib3RzLnR4dFxuICAgICAgICBpZiAoIWlzQWxsb3dlZCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGBMaW5rIGRpc2FsbG93ZWQgYnkgcm9ib3RzLnR4dDogJHtsaW5rfWApO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSlcbiAgICAgIC5zbGljZSgwLCBsaW1pdCk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc3RhcnQoXG4gICAgaW5Qcm9ncmVzcz86IChwcm9ncmVzczogUHJvZ3Jlc3MpID0+IHZvaWQsXG4gICAgY29uY3VycmVuY3lMaW1pdDogbnVtYmVyID0gNSxcbiAgICBsaW1pdDogbnVtYmVyID0gMTAwMDBcbiAgKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIC8vIEZldGNoIGFuZCBwYXJzZSByb2JvdHMudHh0XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KHRoaXMucm9ib3RzVHh0VXJsKTtcbiAgICAgIHRoaXMucm9ib3RzID0gcm9ib3RzUGFyc2VyKHRoaXMucm9ib3RzVHh0VXJsLCByZXNwb25zZS5kYXRhKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGZldGNoIHJvYm90cy50eHQgZnJvbSAke3RoaXMucm9ib3RzVHh0VXJsfWApO1xuICAgIH1cblxuICAgIGNvbnN0IHNpdGVtYXBMaW5rcyA9IGF3YWl0IHRoaXMudHJ5RmV0Y2hTaXRlbWFwTGlua3ModGhpcy5pbml0aWFsVXJsKTtcbiAgICBpZiAoc2l0ZW1hcExpbmtzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGZpbHRlcmVkTGlua3MgPSB0aGlzLmZpbHRlckxpbmtzKHNpdGVtYXBMaW5rcywgbGltaXQpO1xuICAgICAgcmV0dXJuIGZpbHRlcmVkTGlua3M7XG4gICAgfVxuXG4gICAgY29uc3QgdXJscyA9IGF3YWl0IHRoaXMuY3Jhd2xVcmxzKFxuICAgICAgW3RoaXMuaW5pdGlhbFVybF0sXG4gICAgICBjb25jdXJyZW5jeUxpbWl0LFxuICAgICAgaW5Qcm9ncmVzc1xuICAgICk7XG4gICAgaWYgKFxuICAgICAgdXJscy5sZW5ndGggPT09IDAgJiZcbiAgICAgIHRoaXMuZmlsdGVyTGlua3MoW3RoaXMuaW5pdGlhbFVybF0sIGxpbWl0KS5sZW5ndGggPiAwXG4gICAgKSB7XG4gICAgICByZXR1cm4gW3RoaXMuaW5pdGlhbFVybF07XG4gICAgfVxuXG4gICAgLy8gbWFrZSBzdXJlIHRvIHJ1biBpbmNsdWRlIGV4Y2x1ZGUgaGVyZSBhZ2FpblxuICAgIHJldHVybiB0aGlzLmZpbHRlckxpbmtzKHVybHMsIGxpbWl0KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY3Jhd2xVcmxzKFxuICAgIHVybHM6IHN0cmluZ1tdLFxuICAgIGNvbmN1cnJlbmN5TGltaXQ6IG51bWJlcixcbiAgICBpblByb2dyZXNzPzogKHByb2dyZXNzOiBQcm9ncmVzcykgPT4gdm9pZFxuICApOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3QgcXVldWUgPSBhc3luYy5xdWV1ZShhc3luYyAodGFzazogc3RyaW5nLCBjYWxsYmFjaykgPT4ge1xuICAgICAgaWYgKHRoaXMuY3Jhd2xlZFVybHMuc2l6ZSA+PSB0aGlzLm1heENyYXdsZWRMaW5rcykge1xuICAgICAgICBpZiAoY2FsbGJhY2sgJiYgdHlwZW9mIGNhbGxiYWNrID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IG5ld1VybHMgPSBhd2FpdCB0aGlzLmNyYXdsKHRhc2spO1xuICAgICAgbmV3VXJscy5mb3JFYWNoKCh1cmwpID0+IHRoaXMuY3Jhd2xlZFVybHMuYWRkKHVybCkpO1xuICAgICAgaWYgKGluUHJvZ3Jlc3MgJiYgbmV3VXJscy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGluUHJvZ3Jlc3Moe1xuICAgICAgICAgIGN1cnJlbnQ6IHRoaXMuY3Jhd2xlZFVybHMuc2l6ZSxcbiAgICAgICAgICB0b3RhbDogdGhpcy5tYXhDcmF3bGVkTGlua3MsXG4gICAgICAgICAgc3RhdHVzOiBcIlNDUkFQSU5HXCIsXG4gICAgICAgICAgY3VycmVudERvY3VtZW50VXJsOiBuZXdVcmxzW25ld1VybHMubGVuZ3RoIC0gMV0sXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmIChpblByb2dyZXNzKSB7XG4gICAgICAgIGluUHJvZ3Jlc3Moe1xuICAgICAgICAgIGN1cnJlbnQ6IHRoaXMuY3Jhd2xlZFVybHMuc2l6ZSxcbiAgICAgICAgICB0b3RhbDogdGhpcy5tYXhDcmF3bGVkTGlua3MsXG4gICAgICAgICAgc3RhdHVzOiBcIlNDUkFQSU5HXCIsXG4gICAgICAgICAgY3VycmVudERvY3VtZW50VXJsOiB0YXNrLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IHRoaXMuY3Jhd2xVcmxzKG5ld1VybHMsIGNvbmN1cnJlbmN5TGltaXQsIGluUHJvZ3Jlc3MpO1xuICAgICAgaWYgKGNhbGxiYWNrICYmIHR5cGVvZiBjYWxsYmFjayA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgfSwgY29uY3VycmVuY3lMaW1pdCk7XG5cbiAgICBxdWV1ZS5wdXNoKFxuICAgICAgdXJscy5maWx0ZXIoXG4gICAgICAgICh1cmwpID0+XG4gICAgICAgICAgIXRoaXMudmlzaXRlZC5oYXModXJsKSAmJiB0aGlzLnJvYm90cy5pc0FsbG93ZWQodXJsLCBcIkZpcmVDcmF3bEFnZW50XCIpXG4gICAgICApLFxuICAgICAgKGVycikgPT4ge1xuICAgICAgICBpZiAoZXJyKSBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICB9XG4gICAgKTtcbiAgICBhd2FpdCBxdWV1ZS5kcmFpbigpO1xuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuY3Jhd2xlZFVybHMpO1xuICB9XG5cbiAgYXN5bmMgY3Jhd2wodXJsOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgaWYgKHRoaXMudmlzaXRlZC5oYXModXJsKSB8fCAhdGhpcy5yb2JvdHMuaXNBbGxvd2VkKHVybCwgXCJGaXJlQ3Jhd2xBZ2VudFwiKSlcbiAgICAgIHJldHVybiBbXTtcbiAgICB0aGlzLnZpc2l0ZWQuYWRkKHVybCk7XG4gICAgaWYgKCF1cmwuc3RhcnRzV2l0aChcImh0dHBcIikpIHtcbiAgICAgIHVybCA9IFwiaHR0cHM6Ly9cIiArIHVybDtcbiAgICB9XG4gICAgaWYgKHVybC5lbmRzV2l0aChcIi9cIikpIHtcbiAgICAgIHVybCA9IHVybC5zbGljZSgwLCAtMSk7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzRmlsZSh1cmwpIHx8IHRoaXMuaXNTb2NpYWxNZWRpYU9yRW1haWwodXJsKSkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBsZXQgY29udGVudDtcbiAgICAgIC8vIElmIGl0IGlzIHRoZSBmaXJzdCBsaW5rLCBmZXRjaCB3aXRoIHNjcmFwaW5nYmVlXG4gICAgICBpZiAodGhpcy52aXNpdGVkLnNpemUgPT09IDEpIHtcbiAgICAgICAgY29udGVudCA9IGF3YWl0IHNjcmFwV2l0aFNjcmFwaW5nQmVlKHVybCwgXCJsb2FkXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQodXJsKTtcbiAgICAgICAgY29udGVudCA9IHJlc3BvbnNlLmRhdGE7XG4gICAgICB9XG4gICAgICBjb25zdCAkID0gbG9hZChjb250ZW50KTtcbiAgICAgIGxldCBsaW5rczogc3RyaW5nW10gPSBbXTtcblxuICAgICAgJChcImFcIikuZWFjaCgoXywgZWxlbWVudCkgPT4ge1xuICAgICAgICBjb25zdCBocmVmID0gJChlbGVtZW50KS5hdHRyKFwiaHJlZlwiKTtcbiAgICAgICAgaWYgKGhyZWYpIHtcbiAgICAgICAgICBsZXQgZnVsbFVybCA9IGhyZWY7XG4gICAgICAgICAgaWYgKCFocmVmLnN0YXJ0c1dpdGgoXCJodHRwXCIpKSB7XG4gICAgICAgICAgICBmdWxsVXJsID0gbmV3IFVSTChocmVmLCB0aGlzLmJhc2VVcmwpLnRvU3RyaW5nKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHVybCA9IG5ldyBVUkwoZnVsbFVybCk7XG4gICAgICAgICAgY29uc3QgcGF0aCA9IHVybC5wYXRobmFtZTtcblxuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIC8vIGZ1bGxVcmwuc3RhcnRzV2l0aCh0aGlzLmluaXRpYWxVcmwpICYmIC8vIHRoaXMgY29uZGl0aW9uIG1ha2VzIGl0IHN0b3AgY3Jhd2xpbmcgYmFjayB0aGUgdXJsXG4gICAgICAgICAgICB0aGlzLmlzSW50ZXJuYWxMaW5rKGZ1bGxVcmwpICYmXG4gICAgICAgICAgICB0aGlzLm1hdGNoZXNQYXR0ZXJuKGZ1bGxVcmwpICYmXG4gICAgICAgICAgICB0aGlzLm5vU2VjdGlvbnMoZnVsbFVybCkgJiZcbiAgICAgICAgICAgIHRoaXMubWF0Y2hlc0luY2x1ZGVzKHBhdGgpICYmXG4gICAgICAgICAgICAhdGhpcy5tYXRjaGVzRXhjbHVkZXMocGF0aCkgJiZcbiAgICAgICAgICAgIHRoaXMucm9ib3RzLmlzQWxsb3dlZChmdWxsVXJsLCBcIkZpcmVDcmF3bEFnZW50XCIpXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBsaW5rcy5wdXNoKGZ1bGxVcmwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBsaW5rcy5maWx0ZXIoKGxpbmspID0+ICF0aGlzLnZpc2l0ZWQuaGFzKGxpbmspKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgbWF0Y2hlc0luY2x1ZGVzKHVybDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMuaW5jbHVkZXMubGVuZ3RoID09PSAwIHx8IHRoaXMuaW5jbHVkZXNbMF0gPT0gXCJcIikgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIHRoaXMuaW5jbHVkZXMuc29tZSgocGF0dGVybikgPT4gbmV3IFJlZ0V4cChwYXR0ZXJuKS50ZXN0KHVybCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBtYXRjaGVzRXhjbHVkZXModXJsOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBpZiAodGhpcy5leGNsdWRlcy5sZW5ndGggPT09IDAgfHwgdGhpcy5leGNsdWRlc1swXSA9PSBcIlwiKSByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIHRoaXMuZXhjbHVkZXMuc29tZSgocGF0dGVybikgPT4gbmV3IFJlZ0V4cChwYXR0ZXJuKS50ZXN0KHVybCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBub1NlY3Rpb25zKGxpbms6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhbGluay5pbmNsdWRlcyhcIiNcIik7XG4gIH1cblxuICBwcml2YXRlIGlzSW50ZXJuYWxMaW5rKGxpbms6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHVybE9iaiA9IG5ldyBVUkwobGluaywgdGhpcy5iYXNlVXJsKTtcbiAgICBjb25zdCBkb21haW5XaXRob3V0UHJvdG9jb2wgPSB0aGlzLmJhc2VVcmwucmVwbGFjZSgvXmh0dHBzPzpcXC9cXC8vLCBcIlwiKTtcbiAgICByZXR1cm4gdXJsT2JqLmhvc3RuYW1lID09PSBkb21haW5XaXRob3V0UHJvdG9jb2w7XG4gIH1cblxuICBwcml2YXRlIG1hdGNoZXNQYXR0ZXJuKGxpbms6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0cnVlOyAvLyBQbGFjZWhvbGRlciBmb3IgZnV0dXJlIHBhdHRlcm4gbWF0Y2hpbmcgaW1wbGVtZW50YXRpb25cbiAgfVxuXG4gIHByaXZhdGUgaXNGaWxlKHVybDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZmlsZUV4dGVuc2lvbnMgPSBbXG4gICAgICBcIi5wbmdcIixcbiAgICAgIFwiLmpwZ1wiLFxuICAgICAgXCIuanBlZ1wiLFxuICAgICAgXCIuZ2lmXCIsXG4gICAgICBcIi5jc3NcIixcbiAgICAgIFwiLmpzXCIsXG4gICAgICBcIi5pY29cIixcbiAgICAgIFwiLnN2Z1wiLFxuICAgICAgLy8gXCIucGRmXCIsIFxuICAgICAgXCIuemlwXCIsXG4gICAgICBcIi5leGVcIixcbiAgICAgIFwiLmRtZ1wiLFxuICAgICAgXCIubXA0XCIsXG4gICAgICBcIi5tcDNcIixcbiAgICAgIFwiLnBwdHhcIixcbiAgICAgIFwiLmRvY3hcIixcbiAgICAgIFwiLnhsc3hcIixcbiAgICAgIFwiLnhtbFwiLFxuICAgIF07XG4gICAgcmV0dXJuIGZpbGVFeHRlbnNpb25zLnNvbWUoKGV4dCkgPT4gdXJsLmVuZHNXaXRoKGV4dCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc1NvY2lhbE1lZGlhT3JFbWFpbCh1cmw6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHNvY2lhbE1lZGlhT3JFbWFpbCA9IFtcbiAgICAgIFwiZmFjZWJvb2suY29tXCIsXG4gICAgICBcInR3aXR0ZXIuY29tXCIsXG4gICAgICBcImxpbmtlZGluLmNvbVwiLFxuICAgICAgXCJpbnN0YWdyYW0uY29tXCIsXG4gICAgICBcInBpbnRlcmVzdC5jb21cIixcbiAgICAgIFwibWFpbHRvOlwiLFxuICAgIF07XG4gICAgcmV0dXJuIHNvY2lhbE1lZGlhT3JFbWFpbC5zb21lKChleHQpID0+IHVybC5pbmNsdWRlcyhleHQpKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdHJ5RmV0Y2hTaXRlbWFwTGlua3ModXJsOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3Qgc2l0ZW1hcFVybCA9IHVybC5lbmRzV2l0aChcIi9zaXRlbWFwLnhtbFwiKVxuICAgICAgPyB1cmxcbiAgICAgIDogYCR7dXJsfS9zaXRlbWFwLnhtbGA7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KHNpdGVtYXBVcmwpO1xuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBnZXRMaW5rc0Zyb21TaXRlbWFwKHNpdGVtYXBVcmwpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBFcnJvciBoYW5kbGluZyBmb3IgZmFpbGVkIHNpdGVtYXAgZmV0Y2hcbiAgICB9XG4gICAgcmV0dXJuIFtdO1xuICB9XG59XG4iXSwibmFtZXMiOlsiYXhpb3MiLCJsb2FkIiwiVVJMIiwiZ2V0TGlua3NGcm9tU2l0ZW1hcCIsImFzeW5jIiwic2NyYXBXaXRoU2NyYXBpbmdCZWUiLCJyb2JvdHNQYXJzZXIiLCJXZWJDcmF3bGVyIiwiY29uc3RydWN0b3IiLCJpbml0aWFsVXJsIiwiaW5jbHVkZXMiLCJleGNsdWRlcyIsIm1heENyYXdsZWRMaW5rcyIsImxpbWl0IiwiZ2VuZXJhdGVJbWdBbHRUZXh0IiwidmlzaXRlZCIsIlNldCIsImNyYXdsZWRVcmxzIiwiYmFzZVVybCIsIm9yaWdpbiIsInJvYm90c1R4dFVybCIsInJvYm90cyIsImZpbHRlckxpbmtzIiwic2l0ZW1hcExpbmtzIiwiZmlsdGVyIiwibGluayIsInVybCIsInBhdGgiLCJwYXRobmFtZSIsImxlbmd0aCIsInNvbWUiLCJleGNsdWRlUGF0dGVybiIsIlJlZ0V4cCIsInRlc3QiLCJpbmNsdWRlUGF0dGVybiIsImlzQWxsb3dlZCIsImNvbnNvbGUiLCJsb2ciLCJzbGljZSIsInN0YXJ0IiwiaW5Qcm9ncmVzcyIsImNvbmN1cnJlbmN5TGltaXQiLCJyZXNwb25zZSIsImdldCIsImRhdGEiLCJlcnJvciIsInRyeUZldGNoU2l0ZW1hcExpbmtzIiwiZmlsdGVyZWRMaW5rcyIsInVybHMiLCJjcmF3bFVybHMiLCJxdWV1ZSIsInRhc2siLCJjYWxsYmFjayIsInNpemUiLCJuZXdVcmxzIiwiY3Jhd2wiLCJmb3JFYWNoIiwiYWRkIiwiY3VycmVudCIsInRvdGFsIiwic3RhdHVzIiwiY3VycmVudERvY3VtZW50VXJsIiwicHVzaCIsImhhcyIsImVyciIsImRyYWluIiwiQXJyYXkiLCJmcm9tIiwic3RhcnRzV2l0aCIsImVuZHNXaXRoIiwiaXNGaWxlIiwiaXNTb2NpYWxNZWRpYU9yRW1haWwiLCJjb250ZW50IiwiJCIsImxpbmtzIiwiZWFjaCIsIl8iLCJlbGVtZW50IiwiaHJlZiIsImF0dHIiLCJmdWxsVXJsIiwidG9TdHJpbmciLCJpc0ludGVybmFsTGluayIsIm1hdGNoZXNQYXR0ZXJuIiwibm9TZWN0aW9ucyIsIm1hdGNoZXNJbmNsdWRlcyIsIm1hdGNoZXNFeGNsdWRlcyIsInBhdHRlcm4iLCJ1cmxPYmoiLCJkb21haW5XaXRob3V0UHJvdG9jb2wiLCJyZXBsYWNlIiwiaG9zdG5hbWUiLCJmaWxlRXh0ZW5zaW9ucyIsImV4dCIsInNvY2lhbE1lZGlhT3JFbWFpbCIsInNpdGVtYXBVcmwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/scraper/WebScraper/crawler.ts\n");

/***/ }),

/***/ "(api)/./src/scraper/WebScraper/index.ts":
/*!*****************************************!*\
  !*** ./src/scraper/WebScraper/index.ts ***!
  \*****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   WebScraperDataProvider: () => (/* binding */ WebScraperDataProvider)\n/* harmony export */ });\n/* harmony import */ var _single_url__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./single_url */ \"(api)/./src/scraper/WebScraper/single_url.ts\");\n/* harmony import */ var _sitemap__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./sitemap */ \"(api)/./src/scraper/WebScraper/sitemap.ts\");\n/* harmony import */ var _crawler__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./crawler */ \"(api)/./src/scraper/WebScraper/crawler.ts\");\n/* harmony import */ var _services_redis__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../services/redis */ \"(api)/./src/services/redis.ts\");\n/* harmony import */ var _utils_imageDescription__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./utils/imageDescription */ \"(api)/./src/scraper/WebScraper/utils/imageDescription.ts\");\n/* harmony import */ var _utils_pdfProcessor__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utils/pdfProcessor */ \"(api)/./src/scraper/WebScraper/utils/pdfProcessor.ts\");\n/* harmony import */ var _utils_replacePaths__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./utils/replacePaths */ \"(api)/./src/scraper/WebScraper/utils/replacePaths.ts\");\n/* harmony import */ var _lib_LLM_extraction__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../lib/LLM-extraction */ \"(api)/./src/lib/LLM-extraction/index.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_single_url__WEBPACK_IMPORTED_MODULE_0__, _sitemap__WEBPACK_IMPORTED_MODULE_1__, _crawler__WEBPACK_IMPORTED_MODULE_2__, _utils_imageDescription__WEBPACK_IMPORTED_MODULE_4__, _utils_pdfProcessor__WEBPACK_IMPORTED_MODULE_5__, _lib_LLM_extraction__WEBPACK_IMPORTED_MODULE_7__]);\n([_single_url__WEBPACK_IMPORTED_MODULE_0__, _sitemap__WEBPACK_IMPORTED_MODULE_1__, _crawler__WEBPACK_IMPORTED_MODULE_2__, _utils_imageDescription__WEBPACK_IMPORTED_MODULE_4__, _utils_pdfProcessor__WEBPACK_IMPORTED_MODULE_5__, _lib_LLM_extraction__WEBPACK_IMPORTED_MODULE_7__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n\n\n\n\n\nclass WebScraperDataProvider {\n    authorize() {\n        throw new Error(\"Method not implemented.\");\n    }\n    authorizeNango() {\n        throw new Error(\"Method not implemented.\");\n    }\n    async convertUrlsToDocuments(urls, inProgress) {\n        const totalUrls = urls.length;\n        let processedUrls = 0;\n        const results = new Array(urls.length).fill(null);\n        for(let i = 0; i < urls.length; i += this.concurrentRequests){\n            const batchUrls = urls.slice(i, i + this.concurrentRequests);\n            await Promise.all(batchUrls.map(async (url, index)=>{\n                const result = await (0,_single_url__WEBPACK_IMPORTED_MODULE_0__.scrapSingleUrl)(url, true, this.pageOptions);\n                processedUrls++;\n                if (inProgress) {\n                    inProgress({\n                        current: processedUrls,\n                        total: totalUrls,\n                        status: \"SCRAPING\",\n                        currentDocumentUrl: url\n                    });\n                }\n                results[i + index] = result;\n            }));\n        }\n        return results.filter((result)=>result !== null);\n    }\n    async getDocuments(useCaching = false, inProgress) {\n        if (this.urls[0].trim() === \"\") {\n            throw new Error(\"Url is required\");\n        }\n        if (!useCaching) {\n            if (this.mode === \"crawl\") {\n                const crawler = new _crawler__WEBPACK_IMPORTED_MODULE_2__.WebCrawler({\n                    initialUrl: this.urls[0],\n                    includes: this.includes,\n                    excludes: this.excludes,\n                    maxCrawledLinks: this.maxCrawledLinks,\n                    limit: this.limit,\n                    generateImgAltText: this.generateImgAltText\n                });\n                let links = await crawler.start(inProgress, 5, this.limit);\n                if (this.returnOnlyUrls) {\n                    inProgress({\n                        current: links.length,\n                        total: links.length,\n                        status: \"COMPLETED\",\n                        currentDocumentUrl: this.urls[0]\n                    });\n                    return links.map((url)=>({\n                            content: \"\",\n                            markdown: \"\",\n                            metadata: {\n                                sourceURL: url\n                            }\n                        }));\n                }\n                let pdfLinks = links.filter((link)=>link.endsWith(\".pdf\"));\n                let pdfDocuments = [];\n                for (let pdfLink of pdfLinks){\n                    const pdfContent = await (0,_utils_pdfProcessor__WEBPACK_IMPORTED_MODULE_5__.fetchAndProcessPdf)(pdfLink);\n                    pdfDocuments.push({\n                        content: pdfContent,\n                        metadata: {\n                            sourceURL: pdfLink\n                        },\n                        provider: \"web-scraper\"\n                    });\n                }\n                links = links.filter((link)=>!link.endsWith(\".pdf\"));\n                let documents = await this.convertUrlsToDocuments(links, inProgress);\n                documents = await this.getSitemapData(this.urls[0], documents);\n                if (this.replaceAllPathsWithAbsolutePaths) {\n                    documents = (0,_utils_replacePaths__WEBPACK_IMPORTED_MODULE_6__.replacePathsWithAbsolutePaths)(documents);\n                } else {\n                    documents = (0,_utils_replacePaths__WEBPACK_IMPORTED_MODULE_6__.replaceImgPathsWithAbsolutePaths)(documents);\n                }\n                if (this.generateImgAltText) {\n                    documents = await this.generatesImgAltText(documents);\n                }\n                documents = documents.concat(pdfDocuments);\n                // CACHING DOCUMENTS\n                // - parent document\n                const cachedParentDocumentString = await (0,_services_redis__WEBPACK_IMPORTED_MODULE_3__.getValue)(\"web-scraper-cache:\" + this.normalizeUrl(this.urls[0]));\n                if (cachedParentDocumentString != null) {\n                    let cachedParentDocument = JSON.parse(cachedParentDocumentString);\n                    if (!cachedParentDocument.childrenLinks || cachedParentDocument.childrenLinks.length < links.length - 1) {\n                        cachedParentDocument.childrenLinks = links.filter((link)=>link !== this.urls[0]);\n                        await (0,_services_redis__WEBPACK_IMPORTED_MODULE_3__.setValue)(\"web-scraper-cache:\" + this.normalizeUrl(this.urls[0]), JSON.stringify(cachedParentDocument), 60 * 60 * 24 * 10); // 10 days\n                    }\n                } else {\n                    let parentDocument = documents.filter((document)=>this.normalizeUrl(document.metadata.sourceURL) === this.normalizeUrl(this.urls[0]));\n                    await this.setCachedDocuments(parentDocument, links);\n                }\n                await this.setCachedDocuments(documents.filter((document)=>this.normalizeUrl(document.metadata.sourceURL) !== this.normalizeUrl(this.urls[0])), []);\n                documents = this.removeChildLinks(documents);\n                documents = documents.splice(0, this.limit);\n                return documents;\n            }\n            if (this.mode === \"single_urls\") {\n                let pdfLinks = this.urls.filter((link)=>link.endsWith(\".pdf\"));\n                let pdfDocuments = [];\n                for (let pdfLink of pdfLinks){\n                    const pdfContent = await (0,_utils_pdfProcessor__WEBPACK_IMPORTED_MODULE_5__.fetchAndProcessPdf)(pdfLink);\n                    pdfDocuments.push({\n                        content: pdfContent,\n                        metadata: {\n                            sourceURL: pdfLink\n                        },\n                        provider: \"web-scraper\"\n                    });\n                }\n                let documents = await this.convertUrlsToDocuments(this.urls.filter((link)=>!link.endsWith(\".pdf\")), inProgress);\n                if (this.replaceAllPathsWithAbsolutePaths) {\n                    documents = (0,_utils_replacePaths__WEBPACK_IMPORTED_MODULE_6__.replacePathsWithAbsolutePaths)(documents);\n                } else {\n                    documents = (0,_utils_replacePaths__WEBPACK_IMPORTED_MODULE_6__.replaceImgPathsWithAbsolutePaths)(documents);\n                }\n                if (this.generateImgAltText) {\n                    documents = await this.generatesImgAltText(documents);\n                }\n                const baseUrl = new URL(this.urls[0]).origin;\n                documents = await this.getSitemapData(baseUrl, documents);\n                documents = documents.concat(pdfDocuments);\n                if (this.extractorOptions.mode === \"llm-extraction\") {\n                    documents = await (0,_lib_LLM_extraction__WEBPACK_IMPORTED_MODULE_7__.generateCompletions)(documents, this.extractorOptions);\n                }\n                await this.setCachedDocuments(documents);\n                documents = this.removeChildLinks(documents);\n                documents = documents.splice(0, this.limit);\n                return documents;\n            }\n            if (this.mode === \"sitemap\") {\n                let links = await (0,_sitemap__WEBPACK_IMPORTED_MODULE_1__.getLinksFromSitemap)(this.urls[0]);\n                let pdfLinks = links.filter((link)=>link.endsWith(\".pdf\"));\n                let pdfDocuments = [];\n                for (let pdfLink of pdfLinks){\n                    const pdfContent = await (0,_utils_pdfProcessor__WEBPACK_IMPORTED_MODULE_5__.fetchAndProcessPdf)(pdfLink);\n                    pdfDocuments.push({\n                        content: pdfContent,\n                        metadata: {\n                            sourceURL: pdfLink\n                        },\n                        provider: \"web-scraper\"\n                    });\n                }\n                links = links.filter((link)=>!link.endsWith(\".pdf\"));\n                let documents = await this.convertUrlsToDocuments(links.slice(0, this.limit), inProgress);\n                documents = await this.getSitemapData(this.urls[0], documents);\n                if (this.replaceAllPathsWithAbsolutePaths) {\n                    documents = (0,_utils_replacePaths__WEBPACK_IMPORTED_MODULE_6__.replacePathsWithAbsolutePaths)(documents);\n                } else {\n                    documents = (0,_utils_replacePaths__WEBPACK_IMPORTED_MODULE_6__.replaceImgPathsWithAbsolutePaths)(documents);\n                }\n                if (this.generateImgAltText) {\n                    documents = await this.generatesImgAltText(documents);\n                }\n                documents = documents.concat(pdfDocuments);\n                await this.setCachedDocuments(documents);\n                documents = this.removeChildLinks(documents);\n                documents = documents.splice(0, this.limit);\n                return documents;\n            }\n            return [];\n        }\n        let documents = await this.getCachedDocuments(this.urls.slice(0, this.limit));\n        if (documents.length < this.limit) {\n            const newDocuments = await this.getDocuments(false, inProgress);\n            newDocuments.forEach((doc)=>{\n                if (!documents.some((d)=>this.normalizeUrl(d.metadata.sourceURL) === this.normalizeUrl(doc.metadata?.sourceURL))) {\n                    documents.push(doc);\n                }\n            });\n        }\n        documents = this.filterDocsExcludeInclude(documents);\n        documents = this.removeChildLinks(documents);\n        documents = documents.splice(0, this.limit);\n        return documents;\n    }\n    filterDocsExcludeInclude(documents) {\n        return documents.filter((document)=>{\n            const url = new URL(document.metadata.sourceURL);\n            const path = url.pathname;\n            if (this.excludes.length > 0 && this.excludes[0] !== \"\") {\n                // Check if the link should be excluded\n                if (this.excludes.some((excludePattern)=>new RegExp(excludePattern).test(path))) {\n                    return false;\n                }\n            }\n            if (this.includes.length > 0 && this.includes[0] !== \"\") {\n                // Check if the link matches the include patterns, if any are specified\n                if (this.includes.length > 0) {\n                    return this.includes.some((includePattern)=>new RegExp(includePattern).test(path));\n                }\n            }\n            return true;\n        });\n    }\n    normalizeUrl(url) {\n        if (url.includes(\"//www.\")) {\n            return url.replace(\"//www.\", \"//\");\n        }\n        return url;\n    }\n    removeChildLinks(documents) {\n        for (let document of documents){\n            if (document?.childrenLinks) delete document.childrenLinks;\n        }\n        return documents;\n    }\n    async setCachedDocuments(documents, childrenLinks) {\n        for (const document of documents){\n            if (document.content.trim().length === 0) {\n                continue;\n            }\n            const normalizedUrl = this.normalizeUrl(document.metadata.sourceURL);\n            await (0,_services_redis__WEBPACK_IMPORTED_MODULE_3__.setValue)(\"web-scraper-cache:\" + normalizedUrl, JSON.stringify({\n                ...document,\n                childrenLinks: childrenLinks || []\n            }), 60 * 60 * 24 * 10); // 10 days\n        }\n    }\n    async getCachedDocuments(urls) {\n        let documents = [];\n        for (const url of urls){\n            const normalizedUrl = this.normalizeUrl(url);\n            console.log(\"Getting cached document for web-scraper-cache:\" + normalizedUrl);\n            const cachedDocumentString = await (0,_services_redis__WEBPACK_IMPORTED_MODULE_3__.getValue)(\"web-scraper-cache:\" + normalizedUrl);\n            if (cachedDocumentString) {\n                const cachedDocument = JSON.parse(cachedDocumentString);\n                documents.push(cachedDocument);\n                // get children documents\n                for (const childUrl of cachedDocument.childrenLinks){\n                    const normalizedChildUrl = this.normalizeUrl(childUrl);\n                    const childCachedDocumentString = await (0,_services_redis__WEBPACK_IMPORTED_MODULE_3__.getValue)(\"web-scraper-cache:\" + normalizedChildUrl);\n                    if (childCachedDocumentString) {\n                        const childCachedDocument = JSON.parse(childCachedDocumentString);\n                        if (!documents.find((doc)=>doc.metadata.sourceURL === childCachedDocument.metadata.sourceURL)) {\n                            documents.push(childCachedDocument);\n                        }\n                    }\n                }\n            }\n        }\n        return documents;\n    }\n    setOptions(options) {\n        if (!options.urls) {\n            throw new Error(\"Urls are required\");\n        }\n        this.urls = options.urls;\n        this.mode = options.mode;\n        this.concurrentRequests = options.concurrentRequests ?? 20;\n        this.includes = options.crawlerOptions?.includes ?? [];\n        this.excludes = options.crawlerOptions?.excludes ?? [];\n        this.maxCrawledLinks = options.crawlerOptions?.maxCrawledLinks ?? 1000;\n        this.returnOnlyUrls = options.crawlerOptions?.returnOnlyUrls ?? false;\n        this.limit = options.crawlerOptions?.limit ?? 10000;\n        this.generateImgAltText = options.crawlerOptions?.generateImgAltText ?? false;\n        this.pageOptions = options.pageOptions ?? {\n            onlyMainContent: false\n        };\n        this.extractorOptions = options.extractorOptions ?? {\n            mode: \"markdown\"\n        };\n        this.replaceAllPathsWithAbsolutePaths = options.crawlerOptions?.replaceAllPathsWithAbsolutePaths ?? false;\n        //! @nicolas, for some reason this was being injected and breakign everything. Don't have time to find source of the issue so adding this check\n        this.excludes = this.excludes.filter((item)=>item !== \"\");\n        // make sure all urls start with https://\n        this.urls = this.urls.map((url)=>{\n            if (!url.trim().startsWith(\"http\")) {\n                return `https://${url}`;\n            }\n            return url;\n        });\n    }\n    async getSitemapData(baseUrl, documents) {\n        const sitemapData = await (0,_sitemap__WEBPACK_IMPORTED_MODULE_1__.fetchSitemapData)(baseUrl);\n        if (sitemapData) {\n            for(let i = 0; i < documents.length; i++){\n                const docInSitemapData = sitemapData.find((data)=>this.normalizeUrl(data.loc) === this.normalizeUrl(documents[i].metadata.sourceURL));\n                if (docInSitemapData) {\n                    let sitemapDocData = {};\n                    if (docInSitemapData.changefreq) {\n                        sitemapDocData.changefreq = docInSitemapData.changefreq;\n                    }\n                    if (docInSitemapData.priority) {\n                        sitemapDocData.priority = Number(docInSitemapData.priority);\n                    }\n                    if (docInSitemapData.lastmod) {\n                        sitemapDocData.lastmod = docInSitemapData.lastmod;\n                    }\n                    if (Object.keys(sitemapDocData).length !== 0) {\n                        documents[i].metadata.sitemap = sitemapDocData;\n                    }\n                }\n            }\n        }\n        return documents;\n    }\n    constructor(){\n        this.urls = [\n            \"\"\n        ];\n        this.mode = \"single_urls\";\n        this.limit = 10000;\n        this.concurrentRequests = 20;\n        this.generateImgAltText = false;\n        this.replaceAllPathsWithAbsolutePaths = false;\n        this.generateImgAltTextModel = \"gpt-4-turbo\";\n        this.generatesImgAltText = async (documents)=>{\n            await Promise.all(documents.map(async (document)=>{\n                const images = document.content.match(/!\\[.*?\\]\\((.*?)\\)/g) || [];\n                await Promise.all(images.map(async (image)=>{\n                    let imageUrl = image.match(/\\(([^)]+)\\)/)[1];\n                    let altText = image.match(/\\[(.*?)\\]/)[1];\n                    if (!altText && !imageUrl.startsWith(\"data:image\") && /\\.(png|jpeg|gif|webp)$/.test(imageUrl)) {\n                        const imageIndex = document.content.indexOf(image);\n                        const contentLength = document.content.length;\n                        let backText = document.content.substring(imageIndex + image.length, Math.min(imageIndex + image.length + 1000, contentLength));\n                        let frontTextStartIndex = Math.max(imageIndex - 1000, 0);\n                        let frontText = document.content.substring(frontTextStartIndex, imageIndex);\n                        altText = await (0,_utils_imageDescription__WEBPACK_IMPORTED_MODULE_4__.getImageDescription)(imageUrl, backText, frontText, this.generateImgAltTextModel);\n                    }\n                    document.content = document.content.replace(image, `![${altText}](${imageUrl})`);\n                }));\n            }));\n            return documents;\n        };\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QWdCMUQsU0FBU3pCLFFBQVFuQzt3QkFDdkMsSUFBSXVILFdBQVczRCxTQUFTekIsUUFBUXFGLFVBQzlCSixhQUFhSCxNQUFNakgsUUFDbkJ5SCxLQUFLQyxJQUFJTixhQUFhSCxNQUFNakgsU0FBUyxNQUFNc0g7d0JBRTdDLElBQUlLLHNCQUFzQkYsS0FBS0csSUFBSVIsYUFBYSxNQUFNO3dCQUN0RCxJQUFJUyxZQUFZakUsU0FBU3pCLFFBQVFxRixVQUMvQkcscUJBQ0FQO3dCQUVGRCxVQUFVLE1BQU1oSSw0RUFBbUJBLENBQ2pDK0gsVUFDQUssVUFDQU0sV0FDQSxJQUFJLENBQUNmO29CQUNUO29CQUVBbEQsU0FBU3pCLFVBQVV5QixTQUFTekIsUUFBUThDLFFBQ2xDZ0MsT0FDQSxDQUFDLEVBQUUsRUFBRUUsUUFBUSxFQUFFLEVBQUVELFNBQVMsQ0FBQyxDQUFDO2dCQUVoQztZQUVKO1lBR0YsT0FBT25FO1FBQ1Q7O0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9maXJlY3Jhd2wtc2NyYXBlci1qcy8uL3NyYy9zY3JhcGVyL1dlYlNjcmFwZXIvaW5kZXgudHM/MmVhMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEb2N1bWVudCwgRXh0cmFjdG9yT3B0aW9ucywgUGFnZU9wdGlvbnMsIFdlYlNjcmFwZXJPcHRpb25zIH0gZnJvbSBcIi4uLy4uL2xpYi9lbnRpdGllc1wiO1xuaW1wb3J0IHsgUHJvZ3Jlc3MgfSBmcm9tIFwiLi4vLi4vbGliL2VudGl0aWVzXCI7XG5pbXBvcnQgeyBzY3JhcFNpbmdsZVVybCB9IGZyb20gXCIuL3NpbmdsZV91cmxcIjtcbmltcG9ydCB7IFNpdGVtYXBFbnRyeSwgZmV0Y2hTaXRlbWFwRGF0YSwgZ2V0TGlua3NGcm9tU2l0ZW1hcCB9IGZyb20gXCIuL3NpdGVtYXBcIjtcbmltcG9ydCB7IFdlYkNyYXdsZXIgfSBmcm9tIFwiLi9jcmF3bGVyXCI7XG5pbXBvcnQgeyBnZXRWYWx1ZSwgc2V0VmFsdWUgfSBmcm9tIFwiLi4vLi4vc2VydmljZXMvcmVkaXNcIjtcbmltcG9ydCB7IGdldEltYWdlRGVzY3JpcHRpb24gfSBmcm9tIFwiLi91dGlscy9pbWFnZURlc2NyaXB0aW9uXCI7XG5pbXBvcnQgeyBmZXRjaEFuZFByb2Nlc3NQZGYgfSBmcm9tIFwiLi91dGlscy9wZGZQcm9jZXNzb3JcIjtcbmltcG9ydCB7IHJlcGxhY2VJbWdQYXRoc1dpdGhBYnNvbHV0ZVBhdGhzLCByZXBsYWNlUGF0aHNXaXRoQWJzb2x1dGVQYXRocyB9IGZyb20gXCIuL3V0aWxzL3JlcGxhY2VQYXRoc1wiO1xuaW1wb3J0IE9wZW5BSSBmcm9tICdvcGVuYWknXG5pbXBvcnQgeyBnZW5lcmF0ZUNvbXBsZXRpb25zIH0gZnJvbSBcIi4uLy4uL2xpYi9MTE0tZXh0cmFjdGlvblwiO1xuXG5cbmV4cG9ydCBjbGFzcyBXZWJTY3JhcGVyRGF0YVByb3ZpZGVyIHtcbiAgcHJpdmF0ZSB1cmxzOiBzdHJpbmdbXSA9IFtcIlwiXTtcbiAgcHJpdmF0ZSBtb2RlOiBcInNpbmdsZV91cmxzXCIgfCBcInNpdGVtYXBcIiB8IFwiY3Jhd2xcIiA9IFwic2luZ2xlX3VybHNcIjtcbiAgcHJpdmF0ZSBpbmNsdWRlczogc3RyaW5nW107XG4gIHByaXZhdGUgZXhjbHVkZXM6IHN0cmluZ1tdO1xuICBwcml2YXRlIG1heENyYXdsZWRMaW5rczogbnVtYmVyO1xuICBwcml2YXRlIHJldHVybk9ubHlVcmxzOiBib29sZWFuO1xuICBwcml2YXRlIGxpbWl0OiBudW1iZXIgPSAxMDAwMDtcbiAgcHJpdmF0ZSBjb25jdXJyZW50UmVxdWVzdHM6IG51bWJlciA9IDIwO1xuICBwcml2YXRlIGdlbmVyYXRlSW1nQWx0VGV4dDogYm9vbGVhbiA9IGZhbHNlO1xuICBwcml2YXRlIHBhZ2VPcHRpb25zPzogUGFnZU9wdGlvbnM7XG4gIHByaXZhdGUgZXh0cmFjdG9yT3B0aW9ucz86IEV4dHJhY3Rvck9wdGlvbnM7XG4gIHByaXZhdGUgcmVwbGFjZUFsbFBhdGhzV2l0aEFic29sdXRlUGF0aHM/OiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgZ2VuZXJhdGVJbWdBbHRUZXh0TW9kZWw6IFwiZ3B0LTQtdHVyYm9cIiB8IFwiY2xhdWRlLTMtb3B1c1wiID0gXCJncHQtNC10dXJib1wiO1xuXG4gIGF1dGhvcml6ZSgpOiB2b2lkIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNZXRob2Qgbm90IGltcGxlbWVudGVkLlwiKTtcbiAgfVxuXG4gIGF1dGhvcml6ZU5hbmdvKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjb252ZXJ0VXJsc1RvRG9jdW1lbnRzKFxuICAgIHVybHM6IHN0cmluZ1tdLFxuICAgIGluUHJvZ3Jlc3M/OiAocHJvZ3Jlc3M6IFByb2dyZXNzKSA9PiB2b2lkXG4gICk6IFByb21pc2U8RG9jdW1lbnRbXT4ge1xuICAgIGNvbnN0IHRvdGFsVXJscyA9IHVybHMubGVuZ3RoO1xuICAgIGxldCBwcm9jZXNzZWRVcmxzID0gMDtcbiAgXG4gICAgY29uc3QgcmVzdWx0czogKERvY3VtZW50IHwgbnVsbClbXSA9IG5ldyBBcnJheSh1cmxzLmxlbmd0aCkuZmlsbChudWxsKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVybHMubGVuZ3RoOyBpICs9IHRoaXMuY29uY3VycmVudFJlcXVlc3RzKSB7XG4gICAgICBjb25zdCBiYXRjaFVybHMgPSB1cmxzLnNsaWNlKGksIGkgKyB0aGlzLmNvbmN1cnJlbnRSZXF1ZXN0cyk7XG4gICAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgYmF0Y2hVcmxzLm1hcChhc3luYyAodXJsLCBpbmRleCkgPT4ge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNjcmFwU2luZ2xlVXJsKHVybCwgdHJ1ZSwgdGhpcy5wYWdlT3B0aW9ucyk7XG4gICAgICAgICAgcHJvY2Vzc2VkVXJscysrO1xuICAgICAgICAgIGlmIChpblByb2dyZXNzKSB7XG4gICAgICAgICAgICBpblByb2dyZXNzKHtcbiAgICAgICAgICAgICAgY3VycmVudDogcHJvY2Vzc2VkVXJscyxcbiAgICAgICAgICAgICAgdG90YWw6IHRvdGFsVXJscyxcbiAgICAgICAgICAgICAgc3RhdHVzOiBcIlNDUkFQSU5HXCIsXG4gICAgICAgICAgICAgIGN1cnJlbnREb2N1bWVudFVybDogdXJsLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc3VsdHNbaSArIGluZGV4XSA9IHJlc3VsdDtcbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQgIT09IG51bGwpIGFzIERvY3VtZW50W107XG4gIH1cblxuICBhc3luYyBnZXREb2N1bWVudHMoXG4gICAgdXNlQ2FjaGluZzogYm9vbGVhbiA9IGZhbHNlLFxuICAgIGluUHJvZ3Jlc3M/OiAocHJvZ3Jlc3M6IFByb2dyZXNzKSA9PiB2b2lkXG4gICk6IFByb21pc2U8RG9jdW1lbnRbXT4ge1xuICAgIFxuICAgIGlmICh0aGlzLnVybHNbMF0udHJpbSgpID09PSBcIlwiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVcmwgaXMgcmVxdWlyZWRcIik7XG4gICAgfVxuXG4gICAgaWYgKCF1c2VDYWNoaW5nKSB7XG4gICAgICBpZiAodGhpcy5tb2RlID09PSBcImNyYXdsXCIpIHtcbiAgICAgICAgY29uc3QgY3Jhd2xlciA9IG5ldyBXZWJDcmF3bGVyKHtcbiAgICAgICAgICBpbml0aWFsVXJsOiB0aGlzLnVybHNbMF0sXG4gICAgICAgICAgaW5jbHVkZXM6IHRoaXMuaW5jbHVkZXMsXG4gICAgICAgICAgZXhjbHVkZXM6IHRoaXMuZXhjbHVkZXMsXG4gICAgICAgICAgbWF4Q3Jhd2xlZExpbmtzOiB0aGlzLm1heENyYXdsZWRMaW5rcyxcbiAgICAgICAgICBsaW1pdDogdGhpcy5saW1pdCxcbiAgICAgICAgICBnZW5lcmF0ZUltZ0FsdFRleHQ6IHRoaXMuZ2VuZXJhdGVJbWdBbHRUZXh0LFxuICAgICAgICB9KTtcbiAgICAgICAgbGV0IGxpbmtzID0gYXdhaXQgY3Jhd2xlci5zdGFydChpblByb2dyZXNzLCA1LCB0aGlzLmxpbWl0KTtcbiAgICAgICAgaWYgKHRoaXMucmV0dXJuT25seVVybHMpIHtcbiAgICAgICAgICBpblByb2dyZXNzKHtcbiAgICAgICAgICAgIGN1cnJlbnQ6IGxpbmtzLmxlbmd0aCxcbiAgICAgICAgICAgIHRvdGFsOiBsaW5rcy5sZW5ndGgsXG4gICAgICAgICAgICBzdGF0dXM6IFwiQ09NUExFVEVEXCIsXG4gICAgICAgICAgICBjdXJyZW50RG9jdW1lbnRVcmw6IHRoaXMudXJsc1swXSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gbGlua3MubWFwKCh1cmwpID0+ICh7XG4gICAgICAgICAgICBjb250ZW50OiBcIlwiLFxuICAgICAgICAgICAgbWFya2Rvd246IFwiXCIsXG4gICAgICAgICAgICBtZXRhZGF0YTogeyBzb3VyY2VVUkw6IHVybCB9LFxuICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBwZGZMaW5rcyA9IGxpbmtzLmZpbHRlcigobGluaykgPT4gbGluay5lbmRzV2l0aChcIi5wZGZcIikpO1xuICAgICAgICBsZXQgcGRmRG9jdW1lbnRzOiBEb2N1bWVudFtdID0gW107XG4gICAgICAgIGZvciAobGV0IHBkZkxpbmsgb2YgcGRmTGlua3MpIHtcbiAgICAgICAgICBjb25zdCBwZGZDb250ZW50ID0gYXdhaXQgZmV0Y2hBbmRQcm9jZXNzUGRmKHBkZkxpbmspO1xuICAgICAgICAgIHBkZkRvY3VtZW50cy5wdXNoKHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IHBkZkNvbnRlbnQsXG4gICAgICAgICAgICBtZXRhZGF0YTogeyBzb3VyY2VVUkw6IHBkZkxpbmsgfSxcbiAgICAgICAgICAgIHByb3ZpZGVyOiBcIndlYi1zY3JhcGVyXCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBsaW5rcyA9IGxpbmtzLmZpbHRlcigobGluaykgPT4gIWxpbmsuZW5kc1dpdGgoXCIucGRmXCIpKTtcblxuICAgICAgICBsZXQgZG9jdW1lbnRzID0gYXdhaXQgdGhpcy5jb252ZXJ0VXJsc1RvRG9jdW1lbnRzKGxpbmtzLCBpblByb2dyZXNzKTtcbiAgICAgICAgZG9jdW1lbnRzID0gYXdhaXQgdGhpcy5nZXRTaXRlbWFwRGF0YSh0aGlzLnVybHNbMF0sIGRvY3VtZW50cyk7XG5cbiAgICAgICAgaWYgKHRoaXMucmVwbGFjZUFsbFBhdGhzV2l0aEFic29sdXRlUGF0aHMpIHtcbiAgICAgICAgICBkb2N1bWVudHMgPSByZXBsYWNlUGF0aHNXaXRoQWJzb2x1dGVQYXRocyhkb2N1bWVudHMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRvY3VtZW50cyA9IHJlcGxhY2VJbWdQYXRoc1dpdGhBYnNvbHV0ZVBhdGhzKGRvY3VtZW50cyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5nZW5lcmF0ZUltZ0FsdFRleHQpIHtcbiAgICAgICAgICBkb2N1bWVudHMgPSBhd2FpdCB0aGlzLmdlbmVyYXRlc0ltZ0FsdFRleHQoZG9jdW1lbnRzKTtcbiAgICAgICAgfVxuICAgICAgICBkb2N1bWVudHMgPSBkb2N1bWVudHMuY29uY2F0KHBkZkRvY3VtZW50cyk7XG5cbiAgICAgICAgLy8gQ0FDSElORyBET0NVTUVOVFNcbiAgICAgICAgLy8gLSBwYXJlbnQgZG9jdW1lbnRcbiAgICAgICAgY29uc3QgY2FjaGVkUGFyZW50RG9jdW1lbnRTdHJpbmcgPSBhd2FpdCBnZXRWYWx1ZShcbiAgICAgICAgICBcIndlYi1zY3JhcGVyLWNhY2hlOlwiICsgdGhpcy5ub3JtYWxpemVVcmwodGhpcy51cmxzWzBdKVxuICAgICAgICApO1xuICAgICAgICBpZiAoY2FjaGVkUGFyZW50RG9jdW1lbnRTdHJpbmcgIT0gbnVsbCkge1xuICAgICAgICAgIGxldCBjYWNoZWRQYXJlbnREb2N1bWVudCA9IEpTT04ucGFyc2UoY2FjaGVkUGFyZW50RG9jdW1lbnRTdHJpbmcpO1xuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICFjYWNoZWRQYXJlbnREb2N1bWVudC5jaGlsZHJlbkxpbmtzIHx8XG4gICAgICAgICAgICBjYWNoZWRQYXJlbnREb2N1bWVudC5jaGlsZHJlbkxpbmtzLmxlbmd0aCA8IGxpbmtzLmxlbmd0aCAtIDFcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGNhY2hlZFBhcmVudERvY3VtZW50LmNoaWxkcmVuTGlua3MgPSBsaW5rcy5maWx0ZXIoXG4gICAgICAgICAgICAgIChsaW5rKSA9PiBsaW5rICE9PSB0aGlzLnVybHNbMF1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBhd2FpdCBzZXRWYWx1ZShcbiAgICAgICAgICAgICAgXCJ3ZWItc2NyYXBlci1jYWNoZTpcIiArIHRoaXMubm9ybWFsaXplVXJsKHRoaXMudXJsc1swXSksXG4gICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGNhY2hlZFBhcmVudERvY3VtZW50KSxcbiAgICAgICAgICAgICAgNjAgKiA2MCAqIDI0ICogMTBcbiAgICAgICAgICAgICk7IC8vIDEwIGRheXNcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbGV0IHBhcmVudERvY3VtZW50ID0gZG9jdW1lbnRzLmZpbHRlcihcbiAgICAgICAgICAgIChkb2N1bWVudCkgPT5cbiAgICAgICAgICAgICAgdGhpcy5ub3JtYWxpemVVcmwoZG9jdW1lbnQubWV0YWRhdGEuc291cmNlVVJMKSA9PT1cbiAgICAgICAgICAgICAgdGhpcy5ub3JtYWxpemVVcmwodGhpcy51cmxzWzBdKVxuICAgICAgICAgICk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5zZXRDYWNoZWREb2N1bWVudHMocGFyZW50RG9jdW1lbnQsIGxpbmtzKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGF3YWl0IHRoaXMuc2V0Q2FjaGVkRG9jdW1lbnRzKFxuICAgICAgICAgIGRvY3VtZW50cy5maWx0ZXIoXG4gICAgICAgICAgICAoZG9jdW1lbnQpID0+XG4gICAgICAgICAgICAgIHRoaXMubm9ybWFsaXplVXJsKGRvY3VtZW50Lm1ldGFkYXRhLnNvdXJjZVVSTCkgIT09XG4gICAgICAgICAgICAgIHRoaXMubm9ybWFsaXplVXJsKHRoaXMudXJsc1swXSlcbiAgICAgICAgICApLFxuICAgICAgICAgIFtdXG4gICAgICAgICk7XG4gICAgICAgIGRvY3VtZW50cyA9IHRoaXMucmVtb3ZlQ2hpbGRMaW5rcyhkb2N1bWVudHMpO1xuICAgICAgICBkb2N1bWVudHMgPSBkb2N1bWVudHMuc3BsaWNlKDAsIHRoaXMubGltaXQpO1xuICAgICAgICByZXR1cm4gZG9jdW1lbnRzO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5tb2RlID09PSBcInNpbmdsZV91cmxzXCIpIHtcbiAgICAgICAgbGV0IHBkZkxpbmtzID0gdGhpcy51cmxzLmZpbHRlcigobGluaykgPT4gbGluay5lbmRzV2l0aChcIi5wZGZcIikpO1xuICAgICAgICBsZXQgcGRmRG9jdW1lbnRzOiBEb2N1bWVudFtdID0gW107XG4gICAgICAgIGZvciAobGV0IHBkZkxpbmsgb2YgcGRmTGlua3MpIHtcbiAgICAgICAgICBjb25zdCBwZGZDb250ZW50ID0gYXdhaXQgZmV0Y2hBbmRQcm9jZXNzUGRmKHBkZkxpbmspO1xuICAgICAgICAgIHBkZkRvY3VtZW50cy5wdXNoKHtcbiAgICAgICAgICAgIGNvbnRlbnQ6IHBkZkNvbnRlbnQsXG4gICAgICAgICAgICBtZXRhZGF0YTogeyBzb3VyY2VVUkw6IHBkZkxpbmsgfSxcbiAgICAgICAgICAgIHByb3ZpZGVyOiBcIndlYi1zY3JhcGVyXCJcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBkb2N1bWVudHMgPSBhd2FpdCB0aGlzLmNvbnZlcnRVcmxzVG9Eb2N1bWVudHMoXG4gICAgICAgICAgdGhpcy51cmxzLmZpbHRlcigobGluaykgPT4gIWxpbmsuZW5kc1dpdGgoXCIucGRmXCIpKSxcbiAgICAgICAgICBpblByb2dyZXNzXG4gICAgICAgICk7XG5cbiAgICAgICAgaWYgKHRoaXMucmVwbGFjZUFsbFBhdGhzV2l0aEFic29sdXRlUGF0aHMpIHtcbiAgICAgICAgICBkb2N1bWVudHMgPSByZXBsYWNlUGF0aHNXaXRoQWJzb2x1dGVQYXRocyhkb2N1bWVudHMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRvY3VtZW50cyA9IHJlcGxhY2VJbWdQYXRoc1dpdGhBYnNvbHV0ZVBhdGhzKGRvY3VtZW50cyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5nZW5lcmF0ZUltZ0FsdFRleHQpIHtcbiAgICAgICAgICBkb2N1bWVudHMgPSBhd2FpdCB0aGlzLmdlbmVyYXRlc0ltZ0FsdFRleHQoZG9jdW1lbnRzKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBiYXNlVXJsID0gbmV3IFVSTCh0aGlzLnVybHNbMF0pLm9yaWdpbjtcbiAgICAgICAgZG9jdW1lbnRzID0gYXdhaXQgdGhpcy5nZXRTaXRlbWFwRGF0YShiYXNlVXJsLCBkb2N1bWVudHMpO1xuICAgICAgICBkb2N1bWVudHMgPSBkb2N1bWVudHMuY29uY2F0KHBkZkRvY3VtZW50cyk7XG5cbiAgICAgICAgaWYodGhpcy5leHRyYWN0b3JPcHRpb25zLm1vZGUgPT09IFwibGxtLWV4dHJhY3Rpb25cIikge1xuICAgICAgICAgIGRvY3VtZW50cyA9IGF3YWl0IGdlbmVyYXRlQ29tcGxldGlvbnMoXG4gICAgICAgICAgICBkb2N1bWVudHMsXG4gICAgICAgICAgICB0aGlzLmV4dHJhY3Rvck9wdGlvbnNcbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICBhd2FpdCB0aGlzLnNldENhY2hlZERvY3VtZW50cyhkb2N1bWVudHMpO1xuICAgICAgICBkb2N1bWVudHMgPSB0aGlzLnJlbW92ZUNoaWxkTGlua3MoZG9jdW1lbnRzKTtcbiAgICAgICAgZG9jdW1lbnRzID0gZG9jdW1lbnRzLnNwbGljZSgwLCB0aGlzLmxpbWl0KTtcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50cztcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm1vZGUgPT09IFwic2l0ZW1hcFwiKSB7XG4gICAgICAgIGxldCBsaW5rcyA9IGF3YWl0IGdldExpbmtzRnJvbVNpdGVtYXAodGhpcy51cmxzWzBdKTtcbiAgICAgICAgbGV0IHBkZkxpbmtzID0gbGlua3MuZmlsdGVyKChsaW5rKSA9PiBsaW5rLmVuZHNXaXRoKFwiLnBkZlwiKSk7XG4gICAgICAgIGxldCBwZGZEb2N1bWVudHM6IERvY3VtZW50W10gPSBbXTtcbiAgICAgICAgZm9yIChsZXQgcGRmTGluayBvZiBwZGZMaW5rcykge1xuICAgICAgICAgIGNvbnN0IHBkZkNvbnRlbnQgPSBhd2FpdCBmZXRjaEFuZFByb2Nlc3NQZGYocGRmTGluayk7XG4gICAgICAgICAgcGRmRG9jdW1lbnRzLnB1c2goe1xuICAgICAgICAgICAgY29udGVudDogcGRmQ29udGVudCxcbiAgICAgICAgICAgIG1ldGFkYXRhOiB7IHNvdXJjZVVSTDogcGRmTGluayB9LFxuICAgICAgICAgICAgcHJvdmlkZXI6IFwid2ViLXNjcmFwZXJcIlxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGxpbmtzID0gbGlua3MuZmlsdGVyKChsaW5rKSA9PiAhbGluay5lbmRzV2l0aChcIi5wZGZcIikpO1xuXG4gICAgICAgIGxldCBkb2N1bWVudHMgPSBhd2FpdCB0aGlzLmNvbnZlcnRVcmxzVG9Eb2N1bWVudHMoXG4gICAgICAgICAgbGlua3Muc2xpY2UoMCwgdGhpcy5saW1pdCksXG4gICAgICAgICAgaW5Qcm9ncmVzc1xuICAgICAgICApO1xuXG4gICAgICAgIGRvY3VtZW50cyA9IGF3YWl0IHRoaXMuZ2V0U2l0ZW1hcERhdGEodGhpcy51cmxzWzBdLCBkb2N1bWVudHMpO1xuXG4gICAgICAgIGlmICh0aGlzLnJlcGxhY2VBbGxQYXRoc1dpdGhBYnNvbHV0ZVBhdGhzKSB7XG4gICAgICAgICAgZG9jdW1lbnRzID0gcmVwbGFjZVBhdGhzV2l0aEFic29sdXRlUGF0aHMoZG9jdW1lbnRzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkb2N1bWVudHMgPSByZXBsYWNlSW1nUGF0aHNXaXRoQWJzb2x1dGVQYXRocyhkb2N1bWVudHMpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMuZ2VuZXJhdGVJbWdBbHRUZXh0KSB7XG4gICAgICAgICAgZG9jdW1lbnRzID0gYXdhaXQgdGhpcy5nZW5lcmF0ZXNJbWdBbHRUZXh0KGRvY3VtZW50cyk7XG4gICAgICAgIH1cbiAgICAgICAgZG9jdW1lbnRzID0gZG9jdW1lbnRzLmNvbmNhdChwZGZEb2N1bWVudHMpO1xuXG4gICAgICAgIGF3YWl0IHRoaXMuc2V0Q2FjaGVkRG9jdW1lbnRzKGRvY3VtZW50cyk7XG4gICAgICAgIGRvY3VtZW50cyA9IHRoaXMucmVtb3ZlQ2hpbGRMaW5rcyhkb2N1bWVudHMpO1xuICAgICAgICBkb2N1bWVudHMgPSBkb2N1bWVudHMuc3BsaWNlKDAsIHRoaXMubGltaXQpO1xuICAgICAgICByZXR1cm4gZG9jdW1lbnRzO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgbGV0IGRvY3VtZW50cyA9IGF3YWl0IHRoaXMuZ2V0Q2FjaGVkRG9jdW1lbnRzKFxuICAgICAgdGhpcy51cmxzLnNsaWNlKDAsIHRoaXMubGltaXQpXG4gICAgKTtcbiAgICBpZiAoZG9jdW1lbnRzLmxlbmd0aCA8IHRoaXMubGltaXQpIHtcbiAgICAgIGNvbnN0IG5ld0RvY3VtZW50czogRG9jdW1lbnRbXSA9IGF3YWl0IHRoaXMuZ2V0RG9jdW1lbnRzKFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgaW5Qcm9ncmVzc1xuICAgICAgKTtcbiAgICAgIG5ld0RvY3VtZW50cy5mb3JFYWNoKChkb2MpID0+IHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICFkb2N1bWVudHMuc29tZShcbiAgICAgICAgICAgIChkKSA9PlxuICAgICAgICAgICAgICB0aGlzLm5vcm1hbGl6ZVVybChkLm1ldGFkYXRhLnNvdXJjZVVSTCkgPT09XG4gICAgICAgICAgICAgIHRoaXMubm9ybWFsaXplVXJsKGRvYy5tZXRhZGF0YT8uc291cmNlVVJMKVxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgZG9jdW1lbnRzLnB1c2goZG9jKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIGRvY3VtZW50cyA9IHRoaXMuZmlsdGVyRG9jc0V4Y2x1ZGVJbmNsdWRlKGRvY3VtZW50cyk7XG4gICAgZG9jdW1lbnRzID0gdGhpcy5yZW1vdmVDaGlsZExpbmtzKGRvY3VtZW50cyk7XG4gICAgZG9jdW1lbnRzID0gZG9jdW1lbnRzLnNwbGljZSgwLCB0aGlzLmxpbWl0KTtcbiAgICByZXR1cm4gZG9jdW1lbnRzO1xuICB9XG5cbiAgcHJpdmF0ZSBmaWx0ZXJEb2NzRXhjbHVkZUluY2x1ZGUoZG9jdW1lbnRzOiBEb2N1bWVudFtdKTogRG9jdW1lbnRbXSB7XG4gICAgcmV0dXJuIGRvY3VtZW50cy5maWx0ZXIoKGRvY3VtZW50KSA9PiB7XG4gICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKGRvY3VtZW50Lm1ldGFkYXRhLnNvdXJjZVVSTCk7XG4gICAgICBjb25zdCBwYXRoID0gdXJsLnBhdGhuYW1lO1xuXG4gICAgICBpZiAodGhpcy5leGNsdWRlcy5sZW5ndGggPiAwICYmIHRoaXMuZXhjbHVkZXNbMF0gIT09IFwiXCIpIHtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGxpbmsgc2hvdWxkIGJlIGV4Y2x1ZGVkXG4gICAgICAgIGlmIChcbiAgICAgICAgICB0aGlzLmV4Y2x1ZGVzLnNvbWUoKGV4Y2x1ZGVQYXR0ZXJuKSA9PlxuICAgICAgICAgICAgbmV3IFJlZ0V4cChleGNsdWRlUGF0dGVybikudGVzdChwYXRoKVxuICAgICAgICAgIClcbiAgICAgICAgKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLmluY2x1ZGVzLmxlbmd0aCA+IDAgJiYgdGhpcy5pbmNsdWRlc1swXSAhPT0gXCJcIikge1xuICAgICAgICAvLyBDaGVjayBpZiB0aGUgbGluayBtYXRjaGVzIHRoZSBpbmNsdWRlIHBhdHRlcm5zLCBpZiBhbnkgYXJlIHNwZWNpZmllZFxuICAgICAgICBpZiAodGhpcy5pbmNsdWRlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuaW5jbHVkZXMuc29tZSgoaW5jbHVkZVBhdHRlcm4pID0+XG4gICAgICAgICAgICBuZXcgUmVnRXhwKGluY2x1ZGVQYXR0ZXJuKS50ZXN0KHBhdGgpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIG5vcm1hbGl6ZVVybCh1cmw6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKHVybC5pbmNsdWRlcyhcIi8vd3d3LlwiKSkge1xuICAgICAgcmV0dXJuIHVybC5yZXBsYWNlKFwiLy93d3cuXCIsIFwiLy9cIik7XG4gICAgfVxuICAgIHJldHVybiB1cmw7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUNoaWxkTGlua3MoZG9jdW1lbnRzOiBEb2N1bWVudFtdKTogRG9jdW1lbnRbXSB7XG4gICAgZm9yIChsZXQgZG9jdW1lbnQgb2YgZG9jdW1lbnRzKSB7XG4gICAgICBpZiAoZG9jdW1lbnQ/LmNoaWxkcmVuTGlua3MpIGRlbGV0ZSBkb2N1bWVudC5jaGlsZHJlbkxpbmtzO1xuICAgIH1cbiAgICByZXR1cm4gZG9jdW1lbnRzO1xuICB9XG5cbiAgYXN5bmMgc2V0Q2FjaGVkRG9jdW1lbnRzKGRvY3VtZW50czogRG9jdW1lbnRbXSwgY2hpbGRyZW5MaW5rcz86IHN0cmluZ1tdKSB7XG4gICAgZm9yIChjb25zdCBkb2N1bWVudCBvZiBkb2N1bWVudHMpIHtcbiAgICAgIGlmIChkb2N1bWVudC5jb250ZW50LnRyaW0oKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb25zdCBub3JtYWxpemVkVXJsID0gdGhpcy5ub3JtYWxpemVVcmwoZG9jdW1lbnQubWV0YWRhdGEuc291cmNlVVJMKTtcbiAgICAgIGF3YWl0IHNldFZhbHVlKFxuICAgICAgICBcIndlYi1zY3JhcGVyLWNhY2hlOlwiICsgbm9ybWFsaXplZFVybCxcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIC4uLmRvY3VtZW50LFxuICAgICAgICAgIGNoaWxkcmVuTGlua3M6IGNoaWxkcmVuTGlua3MgfHwgW10sXG4gICAgICAgIH0pLFxuICAgICAgICA2MCAqIDYwICogMjQgKiAxMFxuICAgICAgKTsgLy8gMTAgZGF5c1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGdldENhY2hlZERvY3VtZW50cyh1cmxzOiBzdHJpbmdbXSk6IFByb21pc2U8RG9jdW1lbnRbXT4ge1xuICAgIGxldCBkb2N1bWVudHM6IERvY3VtZW50W10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IHVybCBvZiB1cmxzKSB7XG4gICAgICBjb25zdCBub3JtYWxpemVkVXJsID0gdGhpcy5ub3JtYWxpemVVcmwodXJsKTtcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBcIkdldHRpbmcgY2FjaGVkIGRvY3VtZW50IGZvciB3ZWItc2NyYXBlci1jYWNoZTpcIiArIG5vcm1hbGl6ZWRVcmxcbiAgICAgICk7XG4gICAgICBjb25zdCBjYWNoZWREb2N1bWVudFN0cmluZyA9IGF3YWl0IGdldFZhbHVlKFxuICAgICAgICBcIndlYi1zY3JhcGVyLWNhY2hlOlwiICsgbm9ybWFsaXplZFVybFxuICAgICAgKTtcbiAgICAgIGlmIChjYWNoZWREb2N1bWVudFN0cmluZykge1xuICAgICAgICBjb25zdCBjYWNoZWREb2N1bWVudCA9IEpTT04ucGFyc2UoY2FjaGVkRG9jdW1lbnRTdHJpbmcpO1xuICAgICAgICBkb2N1bWVudHMucHVzaChjYWNoZWREb2N1bWVudCk7XG5cbiAgICAgICAgLy8gZ2V0IGNoaWxkcmVuIGRvY3VtZW50c1xuICAgICAgICBmb3IgKGNvbnN0IGNoaWxkVXJsIG9mIGNhY2hlZERvY3VtZW50LmNoaWxkcmVuTGlua3MpIHtcbiAgICAgICAgICBjb25zdCBub3JtYWxpemVkQ2hpbGRVcmwgPSB0aGlzLm5vcm1hbGl6ZVVybChjaGlsZFVybCk7XG4gICAgICAgICAgY29uc3QgY2hpbGRDYWNoZWREb2N1bWVudFN0cmluZyA9IGF3YWl0IGdldFZhbHVlKFxuICAgICAgICAgICAgXCJ3ZWItc2NyYXBlci1jYWNoZTpcIiArIG5vcm1hbGl6ZWRDaGlsZFVybFxuICAgICAgICAgICk7XG4gICAgICAgICAgaWYgKGNoaWxkQ2FjaGVkRG9jdW1lbnRTdHJpbmcpIHtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkQ2FjaGVkRG9jdW1lbnQgPSBKU09OLnBhcnNlKGNoaWxkQ2FjaGVkRG9jdW1lbnRTdHJpbmcpO1xuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAhZG9jdW1lbnRzLmZpbmQoXG4gICAgICAgICAgICAgICAgKGRvYykgPT5cbiAgICAgICAgICAgICAgICAgIGRvYy5tZXRhZGF0YS5zb3VyY2VVUkwgPT09XG4gICAgICAgICAgICAgICAgICBjaGlsZENhY2hlZERvY3VtZW50Lm1ldGFkYXRhLnNvdXJjZVVSTFxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgZG9jdW1lbnRzLnB1c2goY2hpbGRDYWNoZWREb2N1bWVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkb2N1bWVudHM7XG4gIH1cblxuICBzZXRPcHRpb25zKG9wdGlvbnM6IFdlYlNjcmFwZXJPcHRpb25zKTogdm9pZCB7XG4gICAgaWYgKCFvcHRpb25zLnVybHMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIlVybHMgYXJlIHJlcXVpcmVkXCIpO1xuICAgIH1cblxuICAgIHRoaXMudXJscyA9IG9wdGlvbnMudXJscztcbiAgICB0aGlzLm1vZGUgPSBvcHRpb25zLm1vZGU7XG4gICAgdGhpcy5jb25jdXJyZW50UmVxdWVzdHMgPSBvcHRpb25zLmNvbmN1cnJlbnRSZXF1ZXN0cyA/PyAyMDtcbiAgICB0aGlzLmluY2x1ZGVzID0gb3B0aW9ucy5jcmF3bGVyT3B0aW9ucz8uaW5jbHVkZXMgPz8gW107XG4gICAgdGhpcy5leGNsdWRlcyA9IG9wdGlvbnMuY3Jhd2xlck9wdGlvbnM/LmV4Y2x1ZGVzID8/IFtdO1xuICAgIHRoaXMubWF4Q3Jhd2xlZExpbmtzID0gb3B0aW9ucy5jcmF3bGVyT3B0aW9ucz8ubWF4Q3Jhd2xlZExpbmtzID8/IDEwMDA7XG4gICAgdGhpcy5yZXR1cm5Pbmx5VXJscyA9IG9wdGlvbnMuY3Jhd2xlck9wdGlvbnM/LnJldHVybk9ubHlVcmxzID8/IGZhbHNlO1xuICAgIHRoaXMubGltaXQgPSBvcHRpb25zLmNyYXdsZXJPcHRpb25zPy5saW1pdCA/PyAxMDAwMDtcbiAgICB0aGlzLmdlbmVyYXRlSW1nQWx0VGV4dCA9XG4gICAgICBvcHRpb25zLmNyYXdsZXJPcHRpb25zPy5nZW5lcmF0ZUltZ0FsdFRleHQgPz8gZmFsc2U7XG4gICAgdGhpcy5wYWdlT3B0aW9ucyA9IG9wdGlvbnMucGFnZU9wdGlvbnMgPz8ge29ubHlNYWluQ29udGVudDogZmFsc2V9O1xuICAgIHRoaXMuZXh0cmFjdG9yT3B0aW9ucyA9IG9wdGlvbnMuZXh0cmFjdG9yT3B0aW9ucyA/PyB7bW9kZTogXCJtYXJrZG93blwifVxuICAgIHRoaXMucmVwbGFjZUFsbFBhdGhzV2l0aEFic29sdXRlUGF0aHMgPSBvcHRpb25zLmNyYXdsZXJPcHRpb25zPy5yZXBsYWNlQWxsUGF0aHNXaXRoQWJzb2x1dGVQYXRocyA/PyBmYWxzZTtcblxuICAgIC8vISBAbmljb2xhcywgZm9yIHNvbWUgcmVhc29uIHRoaXMgd2FzIGJlaW5nIGluamVjdGVkIGFuZCBicmVha2lnbiBldmVyeXRoaW5nLiBEb24ndCBoYXZlIHRpbWUgdG8gZmluZCBzb3VyY2Ugb2YgdGhlIGlzc3VlIHNvIGFkZGluZyB0aGlzIGNoZWNrXG4gICAgdGhpcy5leGNsdWRlcyA9IHRoaXMuZXhjbHVkZXMuZmlsdGVyKChpdGVtKSA9PiBpdGVtICE9PSBcIlwiKTtcblxuICAgIC8vIG1ha2Ugc3VyZSBhbGwgdXJscyBzdGFydCB3aXRoIGh0dHBzOi8vXG4gICAgdGhpcy51cmxzID0gdGhpcy51cmxzLm1hcCgodXJsKSA9PiB7XG4gICAgICBpZiAoIXVybC50cmltKCkuc3RhcnRzV2l0aChcImh0dHBcIikpIHtcbiAgICAgICAgcmV0dXJuIGBodHRwczovLyR7dXJsfWA7XG4gICAgICB9XG4gICAgICByZXR1cm4gdXJsO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRTaXRlbWFwRGF0YShiYXNlVXJsOiBzdHJpbmcsIGRvY3VtZW50czogRG9jdW1lbnRbXSkge1xuICAgIGNvbnN0IHNpdGVtYXBEYXRhID0gYXdhaXQgZmV0Y2hTaXRlbWFwRGF0YShiYXNlVXJsKTtcbiAgICBpZiAoc2l0ZW1hcERhdGEpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZG9jdW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGRvY0luU2l0ZW1hcERhdGEgPSBzaXRlbWFwRGF0YS5maW5kKFxuICAgICAgICAgIChkYXRhKSA9PlxuICAgICAgICAgICAgdGhpcy5ub3JtYWxpemVVcmwoZGF0YS5sb2MpID09PVxuICAgICAgICAgICAgdGhpcy5ub3JtYWxpemVVcmwoZG9jdW1lbnRzW2ldLm1ldGFkYXRhLnNvdXJjZVVSTClcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGRvY0luU2l0ZW1hcERhdGEpIHtcbiAgICAgICAgICBsZXQgc2l0ZW1hcERvY0RhdGE6IFBhcnRpYWw8U2l0ZW1hcEVudHJ5PiA9IHt9O1xuICAgICAgICAgIGlmIChkb2NJblNpdGVtYXBEYXRhLmNoYW5nZWZyZXEpIHtcbiAgICAgICAgICAgIHNpdGVtYXBEb2NEYXRhLmNoYW5nZWZyZXEgPSBkb2NJblNpdGVtYXBEYXRhLmNoYW5nZWZyZXE7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChkb2NJblNpdGVtYXBEYXRhLnByaW9yaXR5KSB7XG4gICAgICAgICAgICBzaXRlbWFwRG9jRGF0YS5wcmlvcml0eSA9IE51bWJlcihkb2NJblNpdGVtYXBEYXRhLnByaW9yaXR5KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGRvY0luU2l0ZW1hcERhdGEubGFzdG1vZCkge1xuICAgICAgICAgICAgc2l0ZW1hcERvY0RhdGEubGFzdG1vZCA9IGRvY0luU2l0ZW1hcERhdGEubGFzdG1vZDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHNpdGVtYXBEb2NEYXRhKS5sZW5ndGggIT09IDApIHtcbiAgICAgICAgICAgIGRvY3VtZW50c1tpXS5tZXRhZGF0YS5zaXRlbWFwID0gc2l0ZW1hcERvY0RhdGE7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkb2N1bWVudHM7XG4gIH1cbiAgZ2VuZXJhdGVzSW1nQWx0VGV4dCA9IGFzeW5jIChkb2N1bWVudHM6IERvY3VtZW50W10pOiBQcm9taXNlPERvY3VtZW50W10+ID0+IHtcbiAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgIGRvY3VtZW50cy5tYXAoYXN5bmMgKGRvY3VtZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IGltYWdlcyA9IGRvY3VtZW50LmNvbnRlbnQubWF0Y2goLyFcXFsuKj9cXF1cXCgoLio/KVxcKS9nKSB8fCBbXTtcblxuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICBpbWFnZXMubWFwKGFzeW5jIChpbWFnZTogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICBsZXQgaW1hZ2VVcmwgPSBpbWFnZS5tYXRjaCgvXFwoKFteKV0rKVxcKS8pWzFdO1xuICAgICAgICAgICAgbGV0IGFsdFRleHQgPSBpbWFnZS5tYXRjaCgvXFxbKC4qPylcXF0vKVsxXTtcblxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAhYWx0VGV4dCAmJlxuICAgICAgICAgICAgICAhaW1hZ2VVcmwuc3RhcnRzV2l0aChcImRhdGE6aW1hZ2VcIikgJiZcbiAgICAgICAgICAgICAgL1xcLihwbmd8anBlZ3xnaWZ8d2VicCkkLy50ZXN0KGltYWdlVXJsKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGltYWdlSW5kZXggPSBkb2N1bWVudC5jb250ZW50LmluZGV4T2YoaW1hZ2UpO1xuICAgICAgICAgICAgICBjb25zdCBjb250ZW50TGVuZ3RoID0gZG9jdW1lbnQuY29udGVudC5sZW5ndGg7XG4gICAgICAgICAgICAgIGxldCBiYWNrVGV4dCA9IGRvY3VtZW50LmNvbnRlbnQuc3Vic3RyaW5nKFxuICAgICAgICAgICAgICAgIGltYWdlSW5kZXggKyBpbWFnZS5sZW5ndGgsXG4gICAgICAgICAgICAgICAgTWF0aC5taW4oaW1hZ2VJbmRleCArIGltYWdlLmxlbmd0aCArIDEwMDAsIGNvbnRlbnRMZW5ndGgpXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIGxldCBmcm9udFRleHRTdGFydEluZGV4ID0gTWF0aC5tYXgoaW1hZ2VJbmRleCAtIDEwMDAsIDApO1xuICAgICAgICAgICAgICBsZXQgZnJvbnRUZXh0ID0gZG9jdW1lbnQuY29udGVudC5zdWJzdHJpbmcoXG4gICAgICAgICAgICAgICAgZnJvbnRUZXh0U3RhcnRJbmRleCxcbiAgICAgICAgICAgICAgICBpbWFnZUluZGV4XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIGFsdFRleHQgPSBhd2FpdCBnZXRJbWFnZURlc2NyaXB0aW9uKFxuICAgICAgICAgICAgICAgIGltYWdlVXJsLFxuICAgICAgICAgICAgICAgIGJhY2tUZXh0LFxuICAgICAgICAgICAgICAgIGZyb250VGV4dFxuICAgICAgICAgICAgICAsIHRoaXMuZ2VuZXJhdGVJbWdBbHRUZXh0TW9kZWwpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBkb2N1bWVudC5jb250ZW50ID0gZG9jdW1lbnQuY29udGVudC5yZXBsYWNlKFxuICAgICAgICAgICAgICBpbWFnZSxcbiAgICAgICAgICAgICAgYCFbJHthbHRUZXh0fV0oJHtpbWFnZVVybH0pYFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgcmV0dXJuIGRvY3VtZW50cztcbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJzY3JhcFNpbmdsZVVybCIsImZldGNoU2l0ZW1hcERhdGEiLCJnZXRMaW5rc0Zyb21TaXRlbWFwIiwiV2ViQ3Jhd2xlciIsImdldFZhbHVlIiwic2V0VmFsdWUiLCJnZXRJbWFnZURlc2NyaXB0aW9uIiwiZmV0Y2hBbmRQcm9jZXNzUGRmIiwicmVwbGFjZUltZ1BhdGhzV2l0aEFic29sdXRlUGF0aHMiLCJyZXBsYWNlUGF0aHNXaXRoQWJzb2x1dGVQYXRocyIsImdlbmVyYXRlQ29tcGxldGlvbnMiLCJXZWJTY3JhcGVyRGF0YVByb3ZpZGVyIiwiYXV0aG9yaXplIiwiRXJyb3IiLCJhdXRob3JpemVOYW5nbyIsImNvbnZlcnRVcmxzVG9Eb2N1bWVudHMiLCJ1cmxzIiwiaW5Qcm9ncmVzcyIsInRvdGFsVXJscyIsImxlbmd0aCIsInByb2Nlc3NlZFVybHMiLCJyZXN1bHRzIiwiQXJyYXkiLCJmaWxsIiwiaSIsImNvbmN1cnJlbnRSZXF1ZXN0cyIsImJhdGNoVXJscyIsInNsaWNlIiwiUHJvbWlzZSIsImFsbCIsIm1hcCIsInVybCIsImluZGV4IiwicmVzdWx0IiwicGFnZU9wdGlvbnMiLCJjdXJyZW50IiwidG90YWwiLCJzdGF0dXMiLCJjdXJyZW50RG9jdW1lbnRVcmwiLCJmaWx0ZXIiLCJnZXREb2N1bWVudHMiLCJ1c2VDYWNoaW5nIiwidHJpbSIsIm1vZGUiLCJjcmF3bGVyIiwiaW5pdGlhbFVybCIsImluY2x1ZGVzIiwiZXhjbHVkZXMiLCJtYXhDcmF3bGVkTGlua3MiLCJsaW1pdCIsImdlbmVyYXRlSW1nQWx0VGV4dCIsImxpbmtzIiwic3RhcnQiLCJyZXR1cm5Pbmx5VXJscyIsImNvbnRlbnQiLCJtYXJrZG93biIsIm1ldGFkYXRhIiwic291cmNlVVJMIiwicGRmTGlua3MiLCJsaW5rIiwiZW5kc1dpdGgiLCJwZGZEb2N1bWVudHMiLCJwZGZMaW5rIiwicGRmQ29udGVudCIsInB1c2giLCJwcm92aWRlciIsImRvY3VtZW50cyIsImdldFNpdGVtYXBEYXRhIiwicmVwbGFjZUFsbFBhdGhzV2l0aEFic29sdXRlUGF0aHMiLCJnZW5lcmF0ZXNJbWdBbHRUZXh0IiwiY29uY2F0IiwiY2FjaGVkUGFyZW50RG9jdW1lbnRTdHJpbmciLCJub3JtYWxpemVVcmwiLCJjYWNoZWRQYXJlbnREb2N1bWVudCIsIkpTT04iLCJwYXJzZSIsImNoaWxkcmVuTGlua3MiLCJzdHJpbmdpZnkiLCJwYXJlbnREb2N1bWVudCIsImRvY3VtZW50Iiwic2V0Q2FjaGVkRG9jdW1lbnRzIiwicmVtb3ZlQ2hpbGRMaW5rcyIsInNwbGljZSIsImJhc2VVcmwiLCJVUkwiLCJvcmlnaW4iLCJleHRyYWN0b3JPcHRpb25zIiwiZ2V0Q2FjaGVkRG9jdW1lbnRzIiwibmV3RG9jdW1lbnRzIiwiZm9yRWFjaCIsImRvYyIsInNvbWUiLCJkIiwiZmlsdGVyRG9jc0V4Y2x1ZGVJbmNsdWRlIiwicGF0aCIsInBhdGhuYW1lIiwiZXhjbHVkZVBhdHRlcm4iLCJSZWdFeHAiLCJ0ZXN0IiwiaW5jbHVkZVBhdHRlcm4iLCJyZXBsYWNlIiwibm9ybWFsaXplZFVybCIsImNvbnNvbGUiLCJsb2ciLCJjYWNoZWREb2N1bWVudFN0cmluZyIsImNhY2hlZERvY3VtZW50IiwiY2hpbGRVcmwiLCJub3JtYWxpemVkQ2hpbGRVcmwiLCJjaGlsZENhY2hlZERvY3VtZW50U3RyaW5nIiwiY2hpbGRDYWNoZWREb2N1bWVudCIsImZpbmQiLCJzZXRPcHRpb25zIiwib3B0aW9ucyIsImNyYXdsZXJPcHRpb25zIiwib25seU1haW5Db250ZW50IiwiaXRlbSIsInN0YXJ0c1dpdGgiLCJzaXRlbWFwRGF0YSIsImRvY0luU2l0ZW1hcERhdGEiLCJkYXRhIiwibG9jIiwic2l0ZW1hcERvY0RhdGEiLCJjaGFuZ2VmcmVxIiwicHJpb3JpdHkiLCJOdW1iZXIiLCJsYXN0bW9kIiwiT2JqZWN0Iiwia2V5cyIsInNpdGVtYXAiLCJnZW5lcmF0ZUltZ0FsdFRleHRNb2RlbCIsImltYWdlcyIsIm1hdGNoIiwiaW1hZ2UiLCJpbWFnZVVybCIsImFsdFRleHQiLCJpbWFnZUluZGV4IiwiaW5kZXhPZiIsImNvbnRlbnRMZW5ndGgiLCJiYWNrVGV4dCIsInN1YnN0cmluZyIsIk1hdGgiLCJtaW4iLCJmcm9udFRleHRTdGFydEluZGV4IiwibWF4IiwiZnJvbnRUZXh0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/scraper/WebScraper/index.ts\n");

/***/ }),

/***/ "(api)/./src/scraper/WebScraper/single_url.ts":
/*!**********************************************!*\
  !*** ./src/scraper/WebScraper/single_url.ts ***!
  \**********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   generateRequestParams: () => (/* binding */ generateRequestParams),\n/* harmony export */   scrapSingleUrl: () => (/* binding */ scrapSingleUrl),\n/* harmony export */   scrapWithCustomFirecrawl: () => (/* binding */ scrapWithCustomFirecrawl),\n/* harmony export */   scrapWithPlaywright: () => (/* binding */ scrapWithPlaywright),\n/* harmony export */   scrapWithScrapingBee: () => (/* binding */ scrapWithScrapingBee)\n/* harmony export */ });\n/* harmony import */ var cheerio__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! cheerio */ \"cheerio\");\n/* harmony import */ var scrapingbee__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! scrapingbee */ \"scrapingbee\");\n/* harmony import */ var scrapingbee__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(scrapingbee__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var _utils_metadata__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils/metadata */ \"(api)/./src/scraper/WebScraper/utils/metadata.ts\");\n/* harmony import */ var dotenv__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! dotenv */ \"dotenv\");\n/* harmony import */ var dotenv__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(dotenv__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var _lib_html_to_markdown__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../lib/html-to-markdown */ \"(api)/./src/lib/html-to-markdown.ts\");\n/* harmony import */ var _utils_excludeTags__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utils/excludeTags */ \"(api)/./src/scraper/WebScraper/utils/excludeTags.ts\");\n/* harmony import */ var _utils_custom_website_params__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./utils/custom/website_params */ \"(api)/./src/scraper/WebScraper/utils/custom/website_params.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([cheerio__WEBPACK_IMPORTED_MODULE_0__]);\ncheerio__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\ndotenv__WEBPACK_IMPORTED_MODULE_3___default().config();\nasync function generateRequestParams(url, wait_browser = \"domcontentloaded\", timeout = 15000) {\n    const defaultParams = {\n        url: url,\n        params: {\n            timeout: timeout,\n            wait_browser: wait_browser\n        },\n        headers: {\n            \"ScrapingService-Request\": \"TRUE\"\n        }\n    };\n    try {\n        const urlKey = new URL(url).hostname;\n        if (_utils_custom_website_params__WEBPACK_IMPORTED_MODULE_6__.urlSpecificParams.hasOwnProperty(urlKey)) {\n            return {\n                ...defaultParams,\n                ..._utils_custom_website_params__WEBPACK_IMPORTED_MODULE_6__.urlSpecificParams[urlKey]\n            };\n        } else {\n            return defaultParams;\n        }\n    } catch (error) {\n        console.error(`Error generating URL key: ${error}`);\n        return defaultParams;\n    }\n}\nasync function scrapWithCustomFirecrawl(url, options) {\n    try {\n        // TODO: merge the custom firecrawl scraper into mono-repo when ready\n        return null;\n    } catch (error) {\n        console.error(`Error scraping with custom firecrawl-scraper: ${error}`);\n        return \"\";\n    }\n}\nasync function scrapWithScrapingBee(url, wait_browser = \"domcontentloaded\", timeout = 15000) {\n    try {\n        const client = new scrapingbee__WEBPACK_IMPORTED_MODULE_1__.ScrapingBeeClient(process.env.SCRAPING_BEE_API_KEY);\n        const clientParams = await generateRequestParams(url, wait_browser, timeout);\n        const response = await client.get(clientParams);\n        if (response.status !== 200 && response.status !== 404) {\n            console.error(`Scraping bee error in ${url} with status code ${response.status}`);\n            return \"\";\n        }\n        const decoder = new TextDecoder();\n        const text = decoder.decode(response.data);\n        return text;\n    } catch (error) {\n        console.error(`Error scraping with Scraping Bee: ${error}`);\n        return \"\";\n    }\n}\nasync function scrapWithPlaywright(url) {\n    try {\n        const response = await fetch(process.env.PLAYWRIGHT_MICROSERVICE_URL, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                url: url\n            })\n        });\n        if (!response.ok) {\n            console.error(`Error fetching w/ playwright server -> URL: ${url} with status: ${response.status}`);\n            return \"\";\n        }\n        const data = await response.json();\n        const html = data.content;\n        return html ?? \"\";\n    } catch (error) {\n        console.error(`Error scraping with Puppeteer: ${error}`);\n        return \"\";\n    }\n}\nasync function scrapSingleUrl(urlToScrap, toMarkdown = true, pageOptions = {\n    onlyMainContent: true\n}) {\n    urlToScrap = urlToScrap.trim();\n    const removeUnwantedElements = (html, pageOptions)=>{\n        const soup = cheerio__WEBPACK_IMPORTED_MODULE_0__.load(html);\n        soup(\"script, style, iframe, noscript, meta, head\").remove();\n        if (pageOptions.onlyMainContent) {\n            // remove any other tags that are not in the main content\n            _utils_excludeTags__WEBPACK_IMPORTED_MODULE_5__.excludeNonMainTags.forEach((tag)=>{\n                soup(tag).remove();\n            });\n        }\n        return soup.html();\n    };\n    const attemptScraping = async (url, method)=>{\n        let text = \"\";\n        switch(method){\n            case \"firecrawl-scraper\":\n                text = await scrapWithCustomFirecrawl(url);\n                break;\n            case \"scrapingBee\":\n                if (process.env.SCRAPING_BEE_API_KEY) {\n                    text = await scrapWithScrapingBee(url, \"domcontentloaded\", pageOptions.fallback === false ? 7000 : 15000);\n                }\n                break;\n            case \"playwright\":\n                if (process.env.PLAYWRIGHT_MICROSERVICE_URL) {\n                    text = await scrapWithPlaywright(url);\n                }\n                break;\n            case \"scrapingBeeLoad\":\n                if (process.env.SCRAPING_BEE_API_KEY) {\n                    text = await scrapWithScrapingBee(url, \"networkidle2\");\n                }\n                break;\n            case \"fetch\":\n                try {\n                    const response = await fetch(url);\n                    if (!response.ok) {\n                        console.error(`Error fetching URL: ${url} with status: ${response.status}`);\n                        return \"\";\n                    }\n                    text = await response.text();\n                } catch (error) {\n                    console.error(`Error scraping URL: ${error}`);\n                    return \"\";\n                }\n                break;\n        }\n        //* TODO: add an optional to return markdown or structured/extracted content \n        let cleanedHtml = removeUnwantedElements(text, pageOptions);\n        return [\n            await (0,_lib_html_to_markdown__WEBPACK_IMPORTED_MODULE_4__.parseMarkdown)(cleanedHtml),\n            text\n        ];\n    };\n    try {\n        // TODO: comment this out once we're ready to merge firecrawl-scraper into the mono-repo\n        // let [text, html] = await attemptScraping(urlToScrap, 'firecrawl-scraper');\n        // if (!text || text.length < 100) {\n        //   console.log(\"Falling back to scraping bee load\");\n        //   [text, html] = await attemptScraping(urlToScrap, 'scrapingBeeLoad');\n        // }\n        let [text, html] = await attemptScraping(urlToScrap, \"scrapingBee\");\n        // Basically means that it is using /search endpoint\n        if (pageOptions.fallback === false) {\n            const soup = cheerio__WEBPACK_IMPORTED_MODULE_0__.load(html);\n            const metadata = (0,_utils_metadata__WEBPACK_IMPORTED_MODULE_2__.extractMetadata)(soup, urlToScrap);\n            return {\n                url: urlToScrap,\n                content: text,\n                markdown: text,\n                metadata: {\n                    ...metadata,\n                    sourceURL: urlToScrap\n                }\n            };\n        }\n        if (!text || text.length < 100) {\n            console.log(\"Falling back to playwright\");\n            [text, html] = await attemptScraping(urlToScrap, \"playwright\");\n        }\n        if (!text || text.length < 100) {\n            console.log(\"Falling back to scraping bee load\");\n            [text, html] = await attemptScraping(urlToScrap, \"scrapingBeeLoad\");\n        }\n        if (!text || text.length < 100) {\n            console.log(\"Falling back to fetch\");\n            [text, html] = await attemptScraping(urlToScrap, \"fetch\");\n        }\n        const soup = cheerio__WEBPACK_IMPORTED_MODULE_0__.load(html);\n        const metadata = (0,_utils_metadata__WEBPACK_IMPORTED_MODULE_2__.extractMetadata)(soup, urlToScrap);\n        return {\n            content: text,\n            markdown: text,\n            metadata: {\n                ...metadata,\n                sourceURL: urlToScrap\n            }\n        };\n    } catch (error) {\n        console.error(`Error: ${error} - Failed to fetch URL: ${urlToScrap}`);\n        return {\n            content: \"\",\n            markdown: \"\",\n            metadata: {\n                sourceURL: urlToScrap\n            }\n        };\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL3NpbmdsZV91cmwudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBbUM7QUFDYTtBQUNHO0FBQ3ZCO0FBRStCO0FBQ0Y7QUFDUztBQUVsRUcsb0RBQWFJO0FBRU4sZUFBZUMsc0JBQ3BCQyxHQUFXLEVBQ1hDLGVBQXVCLGtCQUFrQixFQUN6Q0MsVUFBa0IsS0FBSztJQUV2QixNQUFNQyxnQkFBZ0I7UUFDcEJILEtBQUtBO1FBQ0xJLFFBQVE7WUFBRUYsU0FBU0E7WUFBU0QsY0FBY0E7UUFBYTtRQUN2REksU0FBUztZQUFFLDJCQUEyQjtRQUFPO0lBQy9DO0lBRUEsSUFBSTtRQUNGLE1BQU1DLFNBQVMsSUFBSUMsSUFBSVAsS0FBS1E7UUFDNUIsSUFBSVgsMkVBQWlCQSxDQUFDWSxlQUFlSCxTQUFTO1lBQzVDLE9BQU87Z0JBQUUsR0FBR0gsYUFBYTtnQkFBRSxHQUFHTiwyRUFBaUIsQ0FBQ1MsT0FBTztZQUFDO1FBQzFELE9BQU87WUFDTCxPQUFPSDtRQUNUO0lBQ0YsRUFBRSxPQUFPTyxPQUFPO1FBQ2RDLFFBQVFELE1BQU0sQ0FBQywwQkFBMEIsRUFBRUEsTUFBTSxDQUFDO1FBQ2xELE9BQU9QO0lBQ1Q7QUFDRjtBQUNPLGVBQWVTLHlCQUNwQlosR0FBVyxFQUNYYSxPQUFhO0lBRWIsSUFBSTtRQUNGLHFFQUFxRTtRQUNyRSxPQUFPO0lBQ1QsRUFBRSxPQUFPSCxPQUFPO1FBQ2RDLFFBQVFELE1BQU0sQ0FBQyw4Q0FBOEMsRUFBRUEsTUFBTSxDQUFDO1FBQ3RFLE9BQU87SUFDVDtBQUNGO0FBRU8sZUFBZUkscUJBQ3BCZCxHQUFXLEVBQ1hDLGVBQXVCLGtCQUFrQixFQUN6Q0MsVUFBa0IsS0FBSztJQUV2QixJQUFJO1FBQ0YsTUFBTWEsU0FBUyxJQUFJdkIsMERBQWlCQSxDQUFDd0IsUUFBUUMsSUFBSUM7UUFDakQsTUFBTUMsZUFBZSxNQUFNcEIsc0JBQ3pCQyxLQUNBQyxjQUNBQztR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O2dCQUFFRSxXQUFXaEI7WUFBVztRQUNqRDtJQUNGLEVBQUUsT0FBTzlCLE9BQU87UUFDZEMsUUFBUUQsTUFBTSxDQUFDLE9BQU8sRUFBRUEsTUFBTSx3QkFBd0IsRUFBRThCLFdBQVcsQ0FBQztRQUNwRSxPQUFPO1lBQ0xGLFNBQVM7WUFDVGlCLFVBQVU7WUFDVkQsVUFBVTtnQkFBRUUsV0FBV2hCO1lBQVc7UUFDcEM7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmlyZWNyYXdsLXNjcmFwZXItanMvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL3NpbmdsZV91cmwudHM/MjA3MiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBjaGVlcmlvIGZyb20gXCJjaGVlcmlvXCI7XG5pbXBvcnQgeyBTY3JhcGluZ0JlZUNsaWVudCB9IGZyb20gXCJzY3JhcGluZ2JlZVwiO1xuaW1wb3J0IHsgZXh0cmFjdE1ldGFkYXRhIH0gZnJvbSBcIi4vdXRpbHMvbWV0YWRhdGFcIjtcbmltcG9ydCBkb3RlbnYgZnJvbSBcImRvdGVudlwiO1xuaW1wb3J0IHsgRG9jdW1lbnQsIFBhZ2VPcHRpb25zIH0gZnJvbSBcIi4uLy4uL2xpYi9lbnRpdGllc1wiO1xuaW1wb3J0IHsgcGFyc2VNYXJrZG93biB9IGZyb20gXCIuLi8uLi9saWIvaHRtbC10by1tYXJrZG93blwiO1xuaW1wb3J0IHsgZXhjbHVkZU5vbk1haW5UYWdzIH0gZnJvbSBcIi4vdXRpbHMvZXhjbHVkZVRhZ3NcIjtcbmltcG9ydCB7IHVybFNwZWNpZmljUGFyYW1zIH0gZnJvbSBcIi4vdXRpbHMvY3VzdG9tL3dlYnNpdGVfcGFyYW1zXCI7XG5cbmRvdGVudi5jb25maWcoKTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlUmVxdWVzdFBhcmFtcyhcbiAgdXJsOiBzdHJpbmcsXG4gIHdhaXRfYnJvd3Nlcjogc3RyaW5nID0gXCJkb21jb250ZW50bG9hZGVkXCIsXG4gIHRpbWVvdXQ6IG51bWJlciA9IDE1MDAwXG4pOiBQcm9taXNlPGFueT4ge1xuICBjb25zdCBkZWZhdWx0UGFyYW1zID0ge1xuICAgIHVybDogdXJsLFxuICAgIHBhcmFtczogeyB0aW1lb3V0OiB0aW1lb3V0LCB3YWl0X2Jyb3dzZXI6IHdhaXRfYnJvd3NlciB9LFxuICAgIGhlYWRlcnM6IHsgXCJTY3JhcGluZ1NlcnZpY2UtUmVxdWVzdFwiOiBcIlRSVUVcIiB9LFxuICB9O1xuXG4gIHRyeSB7XG4gICAgY29uc3QgdXJsS2V5ID0gbmV3IFVSTCh1cmwpLmhvc3RuYW1lO1xuICAgIGlmICh1cmxTcGVjaWZpY1BhcmFtcy5oYXNPd25Qcm9wZXJ0eSh1cmxLZXkpKSB7XG4gICAgICByZXR1cm4geyAuLi5kZWZhdWx0UGFyYW1zLCAuLi51cmxTcGVjaWZpY1BhcmFtc1t1cmxLZXldIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBkZWZhdWx0UGFyYW1zO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKGBFcnJvciBnZW5lcmF0aW5nIFVSTCBrZXk6ICR7ZXJyb3J9YCk7XG4gICAgcmV0dXJuIGRlZmF1bHRQYXJhbXM7XG4gIH1cbn1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzY3JhcFdpdGhDdXN0b21GaXJlY3Jhd2woXG4gIHVybDogc3RyaW5nLFxuICBvcHRpb25zPzogYW55XG4pOiBQcm9taXNlPHN0cmluZz4ge1xuICB0cnkge1xuICAgIC8vIFRPRE86IG1lcmdlIHRoZSBjdXN0b20gZmlyZWNyYXdsIHNjcmFwZXIgaW50byBtb25vLXJlcG8gd2hlbiByZWFkeVxuICAgIHJldHVybiBudWxsO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHNjcmFwaW5nIHdpdGggY3VzdG9tIGZpcmVjcmF3bC1zY3JhcGVyOiAke2Vycm9yfWApO1xuICAgIHJldHVybiBcIlwiO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzY3JhcFdpdGhTY3JhcGluZ0JlZShcbiAgdXJsOiBzdHJpbmcsXG4gIHdhaXRfYnJvd3Nlcjogc3RyaW5nID0gXCJkb21jb250ZW50bG9hZGVkXCIsXG4gIHRpbWVvdXQ6IG51bWJlciA9IDE1MDAwXG4pOiBQcm9taXNlPHN0cmluZz4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNsaWVudCA9IG5ldyBTY3JhcGluZ0JlZUNsaWVudChwcm9jZXNzLmVudi5TQ1JBUElOR19CRUVfQVBJX0tFWSk7XG4gICAgY29uc3QgY2xpZW50UGFyYW1zID0gYXdhaXQgZ2VuZXJhdGVSZXF1ZXN0UGFyYW1zKFxuICAgICAgdXJsLFxuICAgICAgd2FpdF9icm93c2VyLFxuICAgICAgdGltZW91dFxuICAgICk7XG4gICAgXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjbGllbnQuZ2V0KGNsaWVudFBhcmFtcyk7XG5cbiAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDAgJiYgcmVzcG9uc2Uuc3RhdHVzICE9PSA0MDQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIGBTY3JhcGluZyBiZWUgZXJyb3IgaW4gJHt1cmx9IHdpdGggc3RhdHVzIGNvZGUgJHtyZXNwb25zZS5zdGF0dXN9YFxuICAgICAgKTtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbiAgICBjb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7XG4gICAgY29uc3QgdGV4dCA9IGRlY29kZXIuZGVjb2RlKHJlc3BvbnNlLmRhdGEpO1xuICAgIHJldHVybiB0ZXh0O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHNjcmFwaW5nIHdpdGggU2NyYXBpbmcgQmVlOiAke2Vycm9yfWApO1xuICAgIHJldHVybiBcIlwiO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzY3JhcFdpdGhQbGF5d3JpZ2h0KHVybDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHByb2Nlc3MuZW52LlBMQVlXUklHSFRfTUlDUk9TRVJWSUNFX1VSTCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyB1cmw6IHVybCB9KSxcbiAgICB9KTtcblxuICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXG4gICAgICAgIGBFcnJvciBmZXRjaGluZyB3LyBwbGF5d3JpZ2h0IHNlcnZlciAtPiBVUkw6ICR7dXJsfSB3aXRoIHN0YXR1czogJHtyZXNwb25zZS5zdGF0dXN9YFxuICAgICAgKTtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cblxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgY29uc3QgaHRtbCA9IGRhdGEuY29udGVudDtcbiAgICByZXR1cm4gaHRtbCA/PyBcIlwiO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIHNjcmFwaW5nIHdpdGggUHVwcGV0ZWVyOiAke2Vycm9yfWApO1xuICAgIHJldHVybiBcIlwiO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzY3JhcFNpbmdsZVVybChcbiAgdXJsVG9TY3JhcDogc3RyaW5nLFxuICB0b01hcmtkb3duOiBib29sZWFuID0gdHJ1ZSxcbiAgcGFnZU9wdGlvbnM6IFBhZ2VPcHRpb25zID0geyBvbmx5TWFpbkNvbnRlbnQ6IHRydWUgfVxuKTogUHJvbWlzZTxEb2N1bWVudD4ge1xuICB1cmxUb1NjcmFwID0gdXJsVG9TY3JhcC50cmltKCk7XG5cbiAgY29uc3QgcmVtb3ZlVW53YW50ZWRFbGVtZW50cyA9IChodG1sOiBzdHJpbmcsIHBhZ2VPcHRpb25zOiBQYWdlT3B0aW9ucykgPT4ge1xuICAgIGNvbnN0IHNvdXAgPSBjaGVlcmlvLmxvYWQoaHRtbCk7XG4gICAgc291cChcInNjcmlwdCwgc3R5bGUsIGlmcmFtZSwgbm9zY3JpcHQsIG1ldGEsIGhlYWRcIikucmVtb3ZlKCk7XG4gICAgaWYgKHBhZ2VPcHRpb25zLm9ubHlNYWluQ29udGVudCkge1xuICAgICAgLy8gcmVtb3ZlIGFueSBvdGhlciB0YWdzIHRoYXQgYXJlIG5vdCBpbiB0aGUgbWFpbiBjb250ZW50XG4gICAgICBleGNsdWRlTm9uTWFpblRhZ3MuZm9yRWFjaCgodGFnKSA9PiB7XG4gICAgICAgIHNvdXAodGFnKS5yZW1vdmUoKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gc291cC5odG1sKCk7XG4gIH07XG5cbiAgY29uc3QgYXR0ZW1wdFNjcmFwaW5nID0gYXN5bmMgKFxuICAgIHVybDogc3RyaW5nLFxuICAgIG1ldGhvZDpcbiAgICAgIHwgXCJmaXJlY3Jhd2wtc2NyYXBlclwiXG4gICAgICB8IFwic2NyYXBpbmdCZWVcIlxuICAgICAgfCBcInBsYXl3cmlnaHRcIlxuICAgICAgfCBcInNjcmFwaW5nQmVlTG9hZFwiXG4gICAgICB8IFwiZmV0Y2hcIlxuICApID0+IHtcbiAgICBsZXQgdGV4dCA9IFwiXCI7XG4gICAgc3dpdGNoIChtZXRob2QpIHtcbiAgICAgIGNhc2UgXCJmaXJlY3Jhd2wtc2NyYXBlclwiOlxuICAgICAgICB0ZXh0ID0gYXdhaXQgc2NyYXBXaXRoQ3VzdG9tRmlyZWNyYXdsKHVybCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInNjcmFwaW5nQmVlXCI6XG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5TQ1JBUElOR19CRUVfQVBJX0tFWSkge1xuICAgICAgICAgIHRleHQgPSBhd2FpdCBzY3JhcFdpdGhTY3JhcGluZ0JlZShcbiAgICAgICAgICAgIHVybCxcbiAgICAgICAgICAgIFwiZG9tY29udGVudGxvYWRlZFwiLFxuICAgICAgICAgICAgcGFnZU9wdGlvbnMuZmFsbGJhY2sgPT09IGZhbHNlID8gNzAwMCA6IDE1MDAwXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJwbGF5d3JpZ2h0XCI6XG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5QTEFZV1JJR0hUX01JQ1JPU0VSVklDRV9VUkwpIHtcbiAgICAgICAgICB0ZXh0ID0gYXdhaXQgc2NyYXBXaXRoUGxheXdyaWdodCh1cmwpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInNjcmFwaW5nQmVlTG9hZFwiOlxuICAgICAgICBpZiAocHJvY2Vzcy5lbnYuU0NSQVBJTkdfQkVFX0FQSV9LRVkpIHtcbiAgICAgICAgICB0ZXh0ID0gYXdhaXQgc2NyYXBXaXRoU2NyYXBpbmdCZWUodXJsLCBcIm5ldHdvcmtpZGxlMlwiKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJmZXRjaFwiOlxuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsKTtcbiAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgICAgICBgRXJyb3IgZmV0Y2hpbmcgVVJMOiAke3VybH0gd2l0aCBzdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzfWBcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBFcnJvciBzY3JhcGluZyBVUkw6ICR7ZXJyb3J9YCk7XG4gICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgLy8qIFRPRE86IGFkZCBhbiBvcHRpb25hbCB0byByZXR1cm4gbWFya2Rvd24gb3Igc3RydWN0dXJlZC9leHRyYWN0ZWQgY29udGVudCBcbiAgICBsZXQgY2xlYW5lZEh0bWwgPSByZW1vdmVVbndhbnRlZEVsZW1lbnRzKHRleHQsIHBhZ2VPcHRpb25zKTtcblxuICAgIHJldHVybiBbYXdhaXQgcGFyc2VNYXJrZG93bihjbGVhbmVkSHRtbCksIHRleHRdO1xuICB9O1xuXG4gIHRyeSB7XG4gICAgLy8gVE9ETzogY29tbWVudCB0aGlzIG91dCBvbmNlIHdlJ3JlIHJlYWR5IHRvIG1lcmdlIGZpcmVjcmF3bC1zY3JhcGVyIGludG8gdGhlIG1vbm8tcmVwb1xuICAgIC8vIGxldCBbdGV4dCwgaHRtbF0gPSBhd2FpdCBhdHRlbXB0U2NyYXBpbmcodXJsVG9TY3JhcCwgJ2ZpcmVjcmF3bC1zY3JhcGVyJyk7XG4gICAgLy8gaWYgKCF0ZXh0IHx8IHRleHQubGVuZ3RoIDwgMTAwKSB7XG4gICAgLy8gICBjb25zb2xlLmxvZyhcIkZhbGxpbmcgYmFjayB0byBzY3JhcGluZyBiZWUgbG9hZFwiKTtcbiAgICAvLyAgIFt0ZXh0LCBodG1sXSA9IGF3YWl0IGF0dGVtcHRTY3JhcGluZyh1cmxUb1NjcmFwLCAnc2NyYXBpbmdCZWVMb2FkJyk7XG4gICAgLy8gfVxuXG4gICAgbGV0IFt0ZXh0LCBodG1sXSA9IGF3YWl0IGF0dGVtcHRTY3JhcGluZyh1cmxUb1NjcmFwLCBcInNjcmFwaW5nQmVlXCIpO1xuICAgIC8vIEJhc2ljYWxseSBtZWFucyB0aGF0IGl0IGlzIHVzaW5nIC9zZWFyY2ggZW5kcG9pbnRcbiAgICBpZiAocGFnZU9wdGlvbnMuZmFsbGJhY2sgPT09IGZhbHNlKSB7XG4gICAgICBjb25zdCBzb3VwID0gY2hlZXJpby5sb2FkKGh0bWwpO1xuICAgICAgY29uc3QgbWV0YWRhdGEgPSBleHRyYWN0TWV0YWRhdGEoc291cCwgdXJsVG9TY3JhcCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB1cmw6IHVybFRvU2NyYXAsXG4gICAgICAgIGNvbnRlbnQ6IHRleHQsXG4gICAgICAgIG1hcmtkb3duOiB0ZXh0LFxuICAgICAgICBtZXRhZGF0YTogeyAuLi5tZXRhZGF0YSwgc291cmNlVVJMOiB1cmxUb1NjcmFwIH0sXG4gICAgICB9IGFzIERvY3VtZW50O1xuICAgIH1cbiAgICBpZiAoIXRleHQgfHwgdGV4dC5sZW5ndGggPCAxMDApIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiRmFsbGluZyBiYWNrIHRvIHBsYXl3cmlnaHRcIik7XG4gICAgICBbdGV4dCwgaHRtbF0gPSBhd2FpdCBhdHRlbXB0U2NyYXBpbmcodXJsVG9TY3JhcCwgXCJwbGF5d3JpZ2h0XCIpO1xuICAgIH1cblxuICAgIGlmICghdGV4dCB8fCB0ZXh0Lmxlbmd0aCA8IDEwMCkge1xuICAgICAgY29uc29sZS5sb2coXCJGYWxsaW5nIGJhY2sgdG8gc2NyYXBpbmcgYmVlIGxvYWRcIik7XG4gICAgICBbdGV4dCwgaHRtbF0gPSBhd2FpdCBhdHRlbXB0U2NyYXBpbmcodXJsVG9TY3JhcCwgXCJzY3JhcGluZ0JlZUxvYWRcIik7XG4gICAgfVxuICAgIGlmICghdGV4dCB8fCB0ZXh0Lmxlbmd0aCA8IDEwMCkge1xuICAgICAgY29uc29sZS5sb2coXCJGYWxsaW5nIGJhY2sgdG8gZmV0Y2hcIik7XG4gICAgICBbdGV4dCwgaHRtbF0gPSBhd2FpdCBhdHRlbXB0U2NyYXBpbmcodXJsVG9TY3JhcCwgXCJmZXRjaFwiKTtcbiAgICB9XG5cbiAgICBjb25zdCBzb3VwID0gY2hlZXJpby5sb2FkKGh0bWwpO1xuICAgIGNvbnN0IG1ldGFkYXRhID0gZXh0cmFjdE1ldGFkYXRhKHNvdXAsIHVybFRvU2NyYXApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbnRlbnQ6IHRleHQsXG4gICAgICBtYXJrZG93bjogdGV4dCxcbiAgICAgIG1ldGFkYXRhOiB7IC4uLm1ldGFkYXRhLCBzb3VyY2VVUkw6IHVybFRvU2NyYXAgfSxcbiAgICB9IGFzIERvY3VtZW50O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yOiAke2Vycm9yfSAtIEZhaWxlZCB0byBmZXRjaCBVUkw6ICR7dXJsVG9TY3JhcH1gKTtcbiAgICByZXR1cm4ge1xuICAgICAgY29udGVudDogXCJcIixcbiAgICAgIG1hcmtkb3duOiBcIlwiLFxuICAgICAgbWV0YWRhdGE6IHsgc291cmNlVVJMOiB1cmxUb1NjcmFwIH0sXG4gICAgfSBhcyBEb2N1bWVudDtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImNoZWVyaW8iLCJTY3JhcGluZ0JlZUNsaWVudCIsImV4dHJhY3RNZXRhZGF0YSIsImRvdGVudiIsInBhcnNlTWFya2Rvd24iLCJleGNsdWRlTm9uTWFpblRhZ3MiLCJ1cmxTcGVjaWZpY1BhcmFtcyIsImNvbmZpZyIsImdlbmVyYXRlUmVxdWVzdFBhcmFtcyIsInVybCIsIndhaXRfYnJvd3NlciIsInRpbWVvdXQiLCJkZWZhdWx0UGFyYW1zIiwicGFyYW1zIiwiaGVhZGVycyIsInVybEtleSIsIlVSTCIsImhvc3RuYW1lIiwiaGFzT3duUHJvcGVydHkiLCJlcnJvciIsImNvbnNvbGUiLCJzY3JhcFdpdGhDdXN0b21GaXJlY3Jhd2wiLCJvcHRpb25zIiwic2NyYXBXaXRoU2NyYXBpbmdCZWUiLCJjbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiU0NSQVBJTkdfQkVFX0FQSV9LRVkiLCJjbGllbnRQYXJhbXMiLCJyZXNwb25zZSIsImdldCIsInN0YXR1cyIsImRlY29kZXIiLCJUZXh0RGVjb2RlciIsInRleHQiLCJkZWNvZGUiLCJkYXRhIiwic2NyYXBXaXRoUGxheXdyaWdodCIsImZldGNoIiwiUExBWVdSSUdIVF9NSUNST1NFUlZJQ0VfVVJMIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJvayIsImpzb24iLCJodG1sIiwiY29udGVudCIsInNjcmFwU2luZ2xlVXJsIiwidXJsVG9TY3JhcCIsInRvTWFya2Rvd24iLCJwYWdlT3B0aW9ucyIsIm9ubHlNYWluQ29udGVudCIsInRyaW0iLCJyZW1vdmVVbndhbnRlZEVsZW1lbnRzIiwic291cCIsImxvYWQiLCJyZW1vdmUiLCJmb3JFYWNoIiwidGFnIiwiYXR0ZW1wdFNjcmFwaW5nIiwiZmFsbGJhY2siLCJjbGVhbmVkSHRtbCIsIm1ldGFkYXRhIiwibWFya2Rvd24iLCJzb3VyY2VVUkwiLCJsZW5ndGgiLCJsb2ciXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/scraper/WebScraper/single_url.ts\n");

/***/ }),

/***/ "(api)/./src/scraper/WebScraper/sitemap.ts":
/*!*******************************************!*\
  !*** ./src/scraper/WebScraper/sitemap.ts ***!
  \*******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   fetchSitemapData: () => (/* binding */ fetchSitemapData),\n/* harmony export */   getLinksFromSitemap: () => (/* binding */ getLinksFromSitemap)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! axios */ \"axios\");\n/* harmony import */ var xml2js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! xml2js */ \"xml2js\");\n/* harmony import */ var xml2js__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(xml2js__WEBPACK_IMPORTED_MODULE_1__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_0__]);\naxios__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\nasync function getLinksFromSitemap(sitemapUrl, allUrls = []) {\n    try {\n        let content;\n        try {\n            const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].get(sitemapUrl);\n            content = response.data;\n        } catch (error) {\n            console.error(`Request failed for ${sitemapUrl}: ${error}`);\n            return allUrls;\n        }\n        const parsed = await (0,xml2js__WEBPACK_IMPORTED_MODULE_1__.parseStringPromise)(content);\n        const root = parsed.urlset || parsed.sitemapindex;\n        if (root && root.sitemap) {\n            for (const sitemap of root.sitemap){\n                if (sitemap.loc && sitemap.loc.length > 0) {\n                    await getLinksFromSitemap(sitemap.loc[0], allUrls);\n                }\n            }\n        } else if (root && root.url) {\n            for (const url of root.url){\n                if (url.loc && url.loc.length > 0) {\n                    allUrls.push(url.loc[0]);\n                }\n            }\n        }\n    } catch (error) {\n        console.error(`Error processing ${sitemapUrl}: ${error}`);\n    }\n    return allUrls;\n}\nconst fetchSitemapData = async (url)=>{\n    const sitemapUrl = url.endsWith(\"/sitemap.xml\") ? url : `${url}/sitemap.xml`;\n    try {\n        const response = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].get(sitemapUrl);\n        if (response.status === 200) {\n            const xml = response.data;\n            const parsedXml = await (0,xml2js__WEBPACK_IMPORTED_MODULE_1__.parseStringPromise)(xml);\n            const sitemapData = [];\n            if (parsedXml.urlset && parsedXml.urlset.url) {\n                for (const urlElement of parsedXml.urlset.url){\n                    const sitemapEntry = {\n                        loc: urlElement.loc[0]\n                    };\n                    if (urlElement.lastmod) sitemapEntry.lastmod = urlElement.lastmod[0];\n                    if (urlElement.changefreq) sitemapEntry.changefreq = urlElement.changefreq[0];\n                    if (urlElement.priority) sitemapEntry.priority = Number(urlElement.priority[0]);\n                    sitemapData.push(sitemapEntry);\n                }\n            }\n            return sitemapData;\n        }\n        return null;\n    } catch (error) {\n    // Error handling for failed sitemap fetch\n    }\n    return [];\n};\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL3NpdGVtYXAudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBMEI7QUFDa0I7QUFFckMsZUFBZUUsb0JBQ3BCQyxVQUFrQixFQUNsQkMsVUFBb0IsRUFBRTtJQUV0QixJQUFJO1FBQ0YsSUFBSUM7UUFDSixJQUFJO1lBQ0YsTUFBTUMsV0FBVyxNQUFNTixpREFBU08sQ0FBQ0o7WUFDakNFLFVBQVVDLFNBQVNFO1FBQ3JCLEVBQUUsT0FBT0MsT0FBTztZQUNkQyxRQUFRRCxNQUFNLENBQUMsbUJBQW1CLEVBQUVOLFdBQVcsRUFBRSxFQUFFTSxNQUFNLENBQUM7WUFDMUQsT0FBT0w7UUFDVDtRQUVBLE1BQU1PLFNBQVMsTUFBTVYsMERBQWtCQSxDQUFDSTtRQUN4QyxNQUFNTyxPQUFPRCxPQUFPRSxVQUFVRixPQUFPRztRQUVyQyxJQUFJRixRQUFRQSxLQUFLRyxTQUFTO1lBQ3hCLEtBQUssTUFBTUEsV0FBV0gsS0FBS0csUUFBUztnQkFDbEMsSUFBSUEsUUFBUUMsT0FBT0QsUUFBUUMsSUFBSUMsU0FBUyxHQUFHO29CQUN6QyxNQUFNZixvQkFBb0JhLFFBQVFDLEdBQUcsQ0FBQyxFQUFFLEVBQUVaO2dCQUM1QztZQUNGO1FBQ0YsT0FBTyxJQUFJUSxRQUFRQSxLQUFLTSxLQUFLO1lBQzNCLEtBQUssTUFBTUEsT0FBT04sS0FBS00sSUFBSztnQkFDMUIsSUFBSUEsSUFBSUYsT0FBT0UsSUFBSUYsSUFBSUMsU0FBUyxHQUFHO29CQUNqQ2IsUUFBUWUsS0FBS0QsSUFBSUYsR0FBRyxDQUFDLEVBQUU7Z0JBQ3pCO1lBQ0Y7UUFDRjtJQUNGLEVBQUUsT0FBT1AsT0FBTztRQUNkQyxRQUFRRCxNQUFNLENBQUMsaUJBQWlCLEVBQUVOLFdBQVcsRUFBRSxFQUFFTSxNQUFNLENBQUM7SUFDMUQ7SUFFQSxPQUFPTDtBQUNUO0FBRU8sTUFBTWdCLG1CQUFtQixPQUFPRjtJQUNyQyxNQUFNZixhQUFhZSxJQUFJRyxTQUFTLGtCQUFrQkgsTUFBTSxDQUFDLEVBQUVBLElBQUksWUFBWSxDQUFDO0lBQzVFLElBQUk7UUFDRixNQUFNWixXQUFXLE1BQU1OLGlEQUFTTyxDQUFDSjtRQUNqQyxJQUFJRyxTQUFTZ0IsV0FBVyxLQUFLO1lBQzNCLE1BQU1DLE1BQU1qQixTQUFTRTtZQUNyQixNQUFNZ0IsWUFBWSxNQUFNdkIsMERBQWtCQSxDQUFDc0I7WUFFM0MsTUFBTUUsY0FBOEIsRUFBRTtZQUN0QyxJQUFJRCxVQUFVWCxVQUFVVyxVQUFVWCxPQUFPSyxLQUFLO2dCQUM1QyxLQUFLLE1BQU1RLGNBQWNGLFVBQVVYLE9BQU9LLElBQUs7b0JBQzdDLE1BQU1TLGVBQTZCO3dCQUFFWCxLQUFLVSxXQUFXVixHQUFHLENBQUMsRUFBRTtvQkFBQztvQkFDNUQsSUFBSVUsV0FBV0UsU0FBU0QsYUFBYUMsVUFBVUYsV0FBV0UsT0FBTyxDQUFDLEVBQUU7b0JBQ3BFLElBQUlGLFdBQVdHLFlBQVlGLGFBQWFFLGFBQWFILFdBQVdHLFVBQVUsQ0FBQyxFQUFFO29CQUM3RSxJQUFJSCxXQUFXSSxVQUFVSCxhQUFhRyxXQUFXQyxPQUFPTCxXQUFXSSxRQUFRLENBQUMsRUFBRTtvQkFDOUVMLFlBQVlOLEtBQUtRO2dCQUNuQjtZQUNGO1lBRUEsT0FBT0Y7UUFDVDtRQUNBLE9BQU87SUFDVCxFQUFFLE9BQU9oQixPQUFPO0lBQ2QsMENBQTBDO0lBQzVDO0lBQ0EsT0FBTyxFQUFFO0FBQ1gsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL2ZpcmVjcmF3bC1zY3JhcGVyLWpzLy4vc3JjL3NjcmFwZXIvV2ViU2NyYXBlci9zaXRlbWFwLnRzPzMwNGQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGF4aW9zIGZyb20gXCJheGlvc1wiO1xuaW1wb3J0IHsgcGFyc2VTdHJpbmdQcm9taXNlIH0gZnJvbSBcInhtbDJqc1wiO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0TGlua3NGcm9tU2l0ZW1hcChcbiAgc2l0ZW1hcFVybDogc3RyaW5nLFxuICBhbGxVcmxzOiBzdHJpbmdbXSA9IFtdXG4pOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gIHRyeSB7XG4gICAgbGV0IGNvbnRlbnQ6IHN0cmluZztcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQoc2l0ZW1hcFVybCk7XG4gICAgICBjb250ZW50ID0gcmVzcG9uc2UuZGF0YTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgUmVxdWVzdCBmYWlsZWQgZm9yICR7c2l0ZW1hcFVybH06ICR7ZXJyb3J9YCk7XG4gICAgICByZXR1cm4gYWxsVXJscztcbiAgICB9XG5cbiAgICBjb25zdCBwYXJzZWQgPSBhd2FpdCBwYXJzZVN0cmluZ1Byb21pc2UoY29udGVudCk7XG4gICAgY29uc3Qgcm9vdCA9IHBhcnNlZC51cmxzZXQgfHwgcGFyc2VkLnNpdGVtYXBpbmRleDtcblxuICAgIGlmIChyb290ICYmIHJvb3Quc2l0ZW1hcCkge1xuICAgICAgZm9yIChjb25zdCBzaXRlbWFwIG9mIHJvb3Quc2l0ZW1hcCkge1xuICAgICAgICBpZiAoc2l0ZW1hcC5sb2MgJiYgc2l0ZW1hcC5sb2MubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGF3YWl0IGdldExpbmtzRnJvbVNpdGVtYXAoc2l0ZW1hcC5sb2NbMF0sIGFsbFVybHMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChyb290ICYmIHJvb3QudXJsKSB7XG4gICAgICBmb3IgKGNvbnN0IHVybCBvZiByb290LnVybCkge1xuICAgICAgICBpZiAodXJsLmxvYyAmJiB1cmwubG9jLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBhbGxVcmxzLnB1c2godXJsLmxvY1swXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihgRXJyb3IgcHJvY2Vzc2luZyAke3NpdGVtYXBVcmx9OiAke2Vycm9yfWApO1xuICB9XG5cbiAgcmV0dXJuIGFsbFVybHM7XG59XG5cbmV4cG9ydCBjb25zdCBmZXRjaFNpdGVtYXBEYXRhID0gYXN5bmMgKHVybDogc3RyaW5nKTogUHJvbWlzZTxTaXRlbWFwRW50cnlbXSB8IG51bGw+ID0+IHtcbiAgY29uc3Qgc2l0ZW1hcFVybCA9IHVybC5lbmRzV2l0aChcIi9zaXRlbWFwLnhtbFwiKSA/IHVybCA6IGAke3VybH0vc2l0ZW1hcC54bWxgO1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3MuZ2V0KHNpdGVtYXBVcmwpO1xuICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgY29uc3QgeG1sID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgIGNvbnN0IHBhcnNlZFhtbCA9IGF3YWl0IHBhcnNlU3RyaW5nUHJvbWlzZSh4bWwpO1xuXG4gICAgICBjb25zdCBzaXRlbWFwRGF0YTogU2l0ZW1hcEVudHJ5W10gPSBbXTtcbiAgICAgIGlmIChwYXJzZWRYbWwudXJsc2V0ICYmIHBhcnNlZFhtbC51cmxzZXQudXJsKSB7XG4gICAgICAgIGZvciAoY29uc3QgdXJsRWxlbWVudCBvZiBwYXJzZWRYbWwudXJsc2V0LnVybCkge1xuICAgICAgICAgIGNvbnN0IHNpdGVtYXBFbnRyeTogU2l0ZW1hcEVudHJ5ID0geyBsb2M6IHVybEVsZW1lbnQubG9jWzBdIH07XG4gICAgICAgICAgaWYgKHVybEVsZW1lbnQubGFzdG1vZCkgc2l0ZW1hcEVudHJ5Lmxhc3Rtb2QgPSB1cmxFbGVtZW50Lmxhc3Rtb2RbMF07XG4gICAgICAgICAgaWYgKHVybEVsZW1lbnQuY2hhbmdlZnJlcSkgc2l0ZW1hcEVudHJ5LmNoYW5nZWZyZXEgPSB1cmxFbGVtZW50LmNoYW5nZWZyZXFbMF07XG4gICAgICAgICAgaWYgKHVybEVsZW1lbnQucHJpb3JpdHkpIHNpdGVtYXBFbnRyeS5wcmlvcml0eSA9IE51bWJlcih1cmxFbGVtZW50LnByaW9yaXR5WzBdKTtcbiAgICAgICAgICBzaXRlbWFwRGF0YS5wdXNoKHNpdGVtYXBFbnRyeSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHNpdGVtYXBEYXRhO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAvLyBFcnJvciBoYW5kbGluZyBmb3IgZmFpbGVkIHNpdGVtYXAgZmV0Y2hcbiAgfVxuICByZXR1cm4gW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2l0ZW1hcEVudHJ5IHtcbiAgbG9jOiBzdHJpbmc7XG4gIGxhc3Rtb2Q/OiBzdHJpbmc7XG4gIGNoYW5nZWZyZXE/OiBzdHJpbmc7XG4gIHByaW9yaXR5PzogbnVtYmVyO1xufSJdLCJuYW1lcyI6WyJheGlvcyIsInBhcnNlU3RyaW5nUHJvbWlzZSIsImdldExpbmtzRnJvbVNpdGVtYXAiLCJzaXRlbWFwVXJsIiwiYWxsVXJscyIsImNvbnRlbnQiLCJyZXNwb25zZSIsImdldCIsImRhdGEiLCJlcnJvciIsImNvbnNvbGUiLCJwYXJzZWQiLCJyb290IiwidXJsc2V0Iiwic2l0ZW1hcGluZGV4Iiwic2l0ZW1hcCIsImxvYyIsImxlbmd0aCIsInVybCIsInB1c2giLCJmZXRjaFNpdGVtYXBEYXRhIiwiZW5kc1dpdGgiLCJzdGF0dXMiLCJ4bWwiLCJwYXJzZWRYbWwiLCJzaXRlbWFwRGF0YSIsInVybEVsZW1lbnQiLCJzaXRlbWFwRW50cnkiLCJsYXN0bW9kIiwiY2hhbmdlZnJlcSIsInByaW9yaXR5IiwiTnVtYmVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/scraper/WebScraper/sitemap.ts\n");

/***/ }),

/***/ "(api)/./src/scraper/WebScraper/utils/blocklist.ts":
/*!***************************************************!*\
  !*** ./src/scraper/WebScraper/utils/blocklist.ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   isUrlBlocked: () => (/* binding */ isUrlBlocked)\n/* harmony export */ });\nconst socialMediaBlocklist = [\n    \"facebook.com\",\n    \"twitter.com\",\n    \"instagram.com\",\n    \"linkedin.com\",\n    \"pinterest.com\",\n    \"snapchat.com\",\n    \"tiktok.com\",\n    \"reddit.com\",\n    \"tumblr.com\",\n    \"flickr.com\",\n    \"whatsapp.com\",\n    \"wechat.com\",\n    \"telegram.org\"\n];\nconst allowedUrls = [\n    \"linkedin.com/pulse\"\n];\nfunction isUrlBlocked(url) {\n    if (allowedUrls.some((allowedUrl)=>url.includes(allowedUrl))) {\n        return false;\n    }\n    return socialMediaBlocklist.some((domain)=>url.includes(domain));\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL3V0aWxzL2Jsb2NrbGlzdC50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQUEsTUFBTUEsdUJBQXVCO0lBQzNCO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0NBQ0Q7QUFFRCxNQUFNQyxjQUFjO0lBQ2xCO0NBQ0Q7QUFFTSxTQUFTQyxhQUFhQyxHQUFXO0lBQ3RDLElBQUlGLFlBQVlHLEtBQUtDLENBQUFBLGFBQWNGLElBQUlHLFNBQVNELGNBQWM7UUFDNUQsT0FBTztJQUNUO0lBRUEsT0FBT0wscUJBQXFCSSxLQUFLRyxDQUFBQSxTQUFVSixJQUFJRyxTQUFTQztBQUMxRCIsInNvdXJjZXMiOlsid2VicGFjazovL2ZpcmVjcmF3bC1zY3JhcGVyLWpzLy4vc3JjL3NjcmFwZXIvV2ViU2NyYXBlci91dGlscy9ibG9ja2xpc3QudHM/NmZmMiJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBzb2NpYWxNZWRpYUJsb2NrbGlzdCA9IFtcbiAgJ2ZhY2Vib29rLmNvbScsXG4gICd0d2l0dGVyLmNvbScsXG4gICdpbnN0YWdyYW0uY29tJyxcbiAgJ2xpbmtlZGluLmNvbScsXG4gICdwaW50ZXJlc3QuY29tJyxcbiAgJ3NuYXBjaGF0LmNvbScsXG4gICd0aWt0b2suY29tJyxcbiAgJ3JlZGRpdC5jb20nLFxuICAndHVtYmxyLmNvbScsXG4gICdmbGlja3IuY29tJyxcbiAgJ3doYXRzYXBwLmNvbScsXG4gICd3ZWNoYXQuY29tJyxcbiAgJ3RlbGVncmFtLm9yZycsXG5dO1xuXG5jb25zdCBhbGxvd2VkVXJscyA9IFtcbiAgJ2xpbmtlZGluLmNvbS9wdWxzZSdcbl07XG5cbmV4cG9ydCBmdW5jdGlvbiBpc1VybEJsb2NrZWQodXJsOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgaWYgKGFsbG93ZWRVcmxzLnNvbWUoYWxsb3dlZFVybCA9PiB1cmwuaW5jbHVkZXMoYWxsb3dlZFVybCkpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgcmV0dXJuIHNvY2lhbE1lZGlhQmxvY2tsaXN0LnNvbWUoZG9tYWluID0+IHVybC5pbmNsdWRlcyhkb21haW4pKTtcbn1cbiJdLCJuYW1lcyI6WyJzb2NpYWxNZWRpYUJsb2NrbGlzdCIsImFsbG93ZWRVcmxzIiwiaXNVcmxCbG9ja2VkIiwidXJsIiwic29tZSIsImFsbG93ZWRVcmwiLCJpbmNsdWRlcyIsImRvbWFpbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/scraper/WebScraper/utils/blocklist.ts\n");

/***/ }),

/***/ "(api)/./src/scraper/WebScraper/utils/custom/website_params.ts":
/*!***************************************************************!*\
  !*** ./src/scraper/WebScraper/utils/custom/website_params.ts ***!
  \***************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   urlSpecificParams: () => (/* binding */ urlSpecificParams)\n/* harmony export */ });\nconst urlSpecificParams = {\n    \"platform.openai.com\": {\n        params: {\n            wait_browser: \"networkidle2\",\n            block_resources: false\n        },\n        headers: {\n            \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36\",\n            \"sec-fetch-site\": \"same-origin\",\n            \"sec-fetch-mode\": \"cors\",\n            \"sec-fetch-dest\": \"empty\",\n            referer: \"https://www.google.com/\",\n            \"accept-language\": \"en-US,en;q=0.9\",\n            \"accept-encoding\": \"gzip, deflate, br\",\n            accept: \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\"\n        },\n        cookies: {\n            __cf_bm: \"mC1On8P2GWT3A5UeSYH6z_MP94xcTAdZ5jfNi9IT2U0-1714327136-1.0.1.1-ILAP5pSX_Oo9PPo2iHEYCYX.p9a0yRBNLr58GHyrzYNDJ537xYpG50MXxUYVdfrD.h3FV5O7oMlRKGA0scbxaQ\"\n        }\n    },\n    \"support.greenpay.me\": {\n        params: {\n            wait_browser: \"networkidle2\",\n            block_resources: false\n        },\n        headers: {\n            \"User-Agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/124.0.0.0 Safari/537.36\",\n            \"sec-fetch-site\": \"same-origin\",\n            \"sec-fetch-mode\": \"cors\",\n            \"sec-fetch-dest\": \"empty\",\n            referer: \"https://www.google.com/\",\n            \"accept-language\": \"en-US,en;q=0.9\",\n            \"accept-encoding\": \"gzip, deflate, br\",\n            accept: \"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\"\n        }\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL3V0aWxzL2N1c3RvbS93ZWJzaXRlX3BhcmFtcy50cyIsIm1hcHBpbmdzIjoiOzs7O0FBQU8sTUFBTUEsb0JBQW9CO0lBQy9CLHVCQUF1QjtRQUNyQkMsUUFBUTtZQUNOQyxjQUFjO1lBQ2RDLGlCQUFpQjtRQUNuQjtRQUNBQyxTQUFTO1lBQ1AsY0FDRTtZQUNGLGtCQUFrQjtZQUNsQixrQkFBa0I7WUFDbEIsa0JBQWtCO1lBQ2xCQyxTQUFTO1lBQ1QsbUJBQW1CO1lBQ25CLG1CQUFtQjtZQUNuQkMsUUFDRTtRQUNKO1FBQ0FDLFNBQVM7WUFDUEMsU0FDRTtRQUNKO0lBQ0Y7SUFDQSx1QkFBc0I7UUFDcEJQLFFBQVE7WUFDSkMsY0FBYztZQUNkQyxpQkFBaUI7UUFDbkI7UUFDQUMsU0FBUztZQUNQLGNBQ0U7WUFDRixrQkFBa0I7WUFDbEIsa0JBQWtCO1lBQ2xCLGtCQUFrQjtZQUNsQkMsU0FBUztZQUNULG1CQUFtQjtZQUNuQixtQkFBbUI7WUFDbkJDLFFBQ0U7UUFDSjtJQUNKO0FBQ0YsRUFBRSIsInNvdXJjZXMiOlsid2VicGFjazovL2ZpcmVjcmF3bC1zY3JhcGVyLWpzLy4vc3JjL3NjcmFwZXIvV2ViU2NyYXBlci91dGlscy9jdXN0b20vd2Vic2l0ZV9wYXJhbXMudHM/MTBkYSJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgdXJsU3BlY2lmaWNQYXJhbXMgPSB7XG4gIFwicGxhdGZvcm0ub3BlbmFpLmNvbVwiOiB7XG4gICAgcGFyYW1zOiB7XG4gICAgICB3YWl0X2Jyb3dzZXI6IFwibmV0d29ya2lkbGUyXCIsXG4gICAgICBibG9ja19yZXNvdXJjZXM6IGZhbHNlLFxuICAgIH0sXG4gICAgaGVhZGVyczoge1xuICAgICAgXCJVc2VyLUFnZW50XCI6XG4gICAgICAgIFwiTW96aWxsYS81LjAgKE1hY2ludG9zaDsgSW50ZWwgTWFjIE9TIFggMTBfMTVfNykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEyNC4wLjAuMCBTYWZhcmkvNTM3LjM2XCIsXG4gICAgICBcInNlYy1mZXRjaC1zaXRlXCI6IFwic2FtZS1vcmlnaW5cIixcbiAgICAgIFwic2VjLWZldGNoLW1vZGVcIjogXCJjb3JzXCIsXG4gICAgICBcInNlYy1mZXRjaC1kZXN0XCI6IFwiZW1wdHlcIixcbiAgICAgIHJlZmVyZXI6IFwiaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9cIixcbiAgICAgIFwiYWNjZXB0LWxhbmd1YWdlXCI6IFwiZW4tVVMsZW47cT0wLjlcIixcbiAgICAgIFwiYWNjZXB0LWVuY29kaW5nXCI6IFwiZ3ppcCwgZGVmbGF0ZSwgYnJcIixcbiAgICAgIGFjY2VwdDpcbiAgICAgICAgXCJ0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS9hdmlmLGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgsYXBwbGljYXRpb24vc2lnbmVkLWV4Y2hhbmdlO3Y9YjM7cT0wLjlcIixcbiAgICB9LFxuICAgIGNvb2tpZXM6IHtcbiAgICAgIF9fY2ZfYm06XG4gICAgICAgIFwibUMxT244UDJHV1QzQTVVZVNZSDZ6X01QOTR4Y1RBZFo1amZOaTlJVDJVMC0xNzE0MzI3MTM2LTEuMC4xLjEtSUxBUDVwU1hfT285UFBvMmlIRVlDWVgucDlhMHlSQk5McjU4R0h5cnpZTkRKNTM3eFlwRzUwTVh4VVlWZGZyRC5oM0ZWNU83b01sUktHQTBzY2J4YVFcIixcbiAgICB9LFxuICB9LFxuICBcInN1cHBvcnQuZ3JlZW5wYXkubWVcIjp7XG4gICAgcGFyYW1zOiB7XG4gICAgICAgIHdhaXRfYnJvd3NlcjogXCJuZXR3b3JraWRsZTJcIixcbiAgICAgICAgYmxvY2tfcmVzb3VyY2VzOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIFwiVXNlci1BZ2VudFwiOlxuICAgICAgICAgIFwiTW96aWxsYS81LjAgKE1hY2ludG9zaDsgSW50ZWwgTWFjIE9TIFggMTBfMTVfNykgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzEyNC4wLjAuMCBTYWZhcmkvNTM3LjM2XCIsXG4gICAgICAgIFwic2VjLWZldGNoLXNpdGVcIjogXCJzYW1lLW9yaWdpblwiLFxuICAgICAgICBcInNlYy1mZXRjaC1tb2RlXCI6IFwiY29yc1wiLFxuICAgICAgICBcInNlYy1mZXRjaC1kZXN0XCI6IFwiZW1wdHlcIixcbiAgICAgICAgcmVmZXJlcjogXCJodHRwczovL3d3dy5nb29nbGUuY29tL1wiLFxuICAgICAgICBcImFjY2VwdC1sYW5ndWFnZVwiOiBcImVuLVVTLGVuO3E9MC45XCIsXG4gICAgICAgIFwiYWNjZXB0LWVuY29kaW5nXCI6IFwiZ3ppcCwgZGVmbGF0ZSwgYnJcIixcbiAgICAgICAgYWNjZXB0OlxuICAgICAgICAgIFwidGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2UvYXZpZixpbWFnZS93ZWJwLGltYWdlL2FwbmcsKi8qO3E9MC44LGFwcGxpY2F0aW9uL3NpZ25lZC1leGNoYW5nZTt2PWIzO3E9MC45XCIsXG4gICAgICB9LFxuICB9XG59O1xuIl0sIm5hbWVzIjpbInVybFNwZWNpZmljUGFyYW1zIiwicGFyYW1zIiwid2FpdF9icm93c2VyIiwiYmxvY2tfcmVzb3VyY2VzIiwiaGVhZGVycyIsInJlZmVyZXIiLCJhY2NlcHQiLCJjb29raWVzIiwiX19jZl9ibSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/scraper/WebScraper/utils/custom/website_params.ts\n");

/***/ }),

/***/ "(api)/./src/scraper/WebScraper/utils/excludeTags.ts":
/*!*****************************************************!*\
  !*** ./src/scraper/WebScraper/utils/excludeTags.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   excludeNonMainTags: () => (/* binding */ excludeNonMainTags)\n/* harmony export */ });\nconst excludeNonMainTags = [\n    \"header\",\n    \"footer\",\n    \"nav\",\n    \"aside\",\n    \".header\",\n    \".top\",\n    \".navbar\",\n    \"#header\",\n    \".footer\",\n    \".bottom\",\n    \"#footer\",\n    \".sidebar\",\n    \".side\",\n    \".aside\",\n    \"#sidebar\",\n    \".modal\",\n    \".popup\",\n    \"#modal\",\n    \".overlay\",\n    \".ad\",\n    \".ads\",\n    \".advert\",\n    \"#ad\",\n    \".lang-selector\",\n    \".language\",\n    \"#language-selector\",\n    \".social\",\n    \".social-media\",\n    \".social-links\",\n    \"#social\",\n    \".menu\",\n    \".navigation\",\n    \"#nav\",\n    \".breadcrumbs\",\n    \"#breadcrumbs\",\n    \".form\",\n    \"form\",\n    \"#search-form\",\n    \".search\",\n    \"#search\",\n    \".share\",\n    \"#share\",\n    \".pagination\",\n    \"#pagination\",\n    \".widget\",\n    \"#widget\",\n    \".related\",\n    \"#related\",\n    \".tag\",\n    \"#tag\",\n    \".category\",\n    \"#category\",\n    \".comment\",\n    \"#comment\",\n    \".reply\",\n    \"#reply\",\n    \".author\",\n    \"#author\"\n];\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL3V0aWxzL2V4Y2x1ZGVUYWdzLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFBTyxNQUFNQSxxQkFBcUI7SUFDaEM7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7Q0FDRCxDQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmlyZWNyYXdsLXNjcmFwZXItanMvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL3V0aWxzL2V4Y2x1ZGVUYWdzLnRzPzkyZWUiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IGV4Y2x1ZGVOb25NYWluVGFncyA9IFtcbiAgXCJoZWFkZXJcIixcbiAgXCJmb290ZXJcIixcbiAgXCJuYXZcIixcbiAgXCJhc2lkZVwiLFxuICBcIi5oZWFkZXJcIixcbiAgXCIudG9wXCIsXG4gIFwiLm5hdmJhclwiLFxuICBcIiNoZWFkZXJcIixcbiAgXCIuZm9vdGVyXCIsXG4gIFwiLmJvdHRvbVwiLFxuICBcIiNmb290ZXJcIixcbiAgXCIuc2lkZWJhclwiLFxuICBcIi5zaWRlXCIsXG4gIFwiLmFzaWRlXCIsXG4gIFwiI3NpZGViYXJcIixcbiAgXCIubW9kYWxcIixcbiAgXCIucG9wdXBcIixcbiAgXCIjbW9kYWxcIixcbiAgXCIub3ZlcmxheVwiLFxuICBcIi5hZFwiLFxuICBcIi5hZHNcIixcbiAgXCIuYWR2ZXJ0XCIsXG4gIFwiI2FkXCIsXG4gIFwiLmxhbmctc2VsZWN0b3JcIixcbiAgXCIubGFuZ3VhZ2VcIixcbiAgXCIjbGFuZ3VhZ2Utc2VsZWN0b3JcIixcbiAgXCIuc29jaWFsXCIsXG4gIFwiLnNvY2lhbC1tZWRpYVwiLFxuICBcIi5zb2NpYWwtbGlua3NcIixcbiAgXCIjc29jaWFsXCIsXG4gIFwiLm1lbnVcIixcbiAgXCIubmF2aWdhdGlvblwiLFxuICBcIiNuYXZcIixcbiAgXCIuYnJlYWRjcnVtYnNcIixcbiAgXCIjYnJlYWRjcnVtYnNcIixcbiAgXCIuZm9ybVwiLFxuICBcImZvcm1cIixcbiAgXCIjc2VhcmNoLWZvcm1cIixcbiAgXCIuc2VhcmNoXCIsXG4gIFwiI3NlYXJjaFwiLFxuICBcIi5zaGFyZVwiLFxuICBcIiNzaGFyZVwiLFxuICBcIi5wYWdpbmF0aW9uXCIsXG4gIFwiI3BhZ2luYXRpb25cIixcbiAgXCIud2lkZ2V0XCIsXG4gIFwiI3dpZGdldFwiLFxuICBcIi5yZWxhdGVkXCIsXG4gIFwiI3JlbGF0ZWRcIixcbiAgXCIudGFnXCIsXG4gIFwiI3RhZ1wiLFxuICBcIi5jYXRlZ29yeVwiLFxuICBcIiNjYXRlZ29yeVwiLFxuICBcIi5jb21tZW50XCIsXG4gIFwiI2NvbW1lbnRcIixcbiAgXCIucmVwbHlcIixcbiAgXCIjcmVwbHlcIixcbiAgXCIuYXV0aG9yXCIsXG4gIFwiI2F1dGhvclwiLFxuXTtcbiJdLCJuYW1lcyI6WyJleGNsdWRlTm9uTWFpblRhZ3MiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/scraper/WebScraper/utils/excludeTags.ts\n");

/***/ }),

/***/ "(api)/./src/scraper/WebScraper/utils/imageDescription.ts":
/*!**********************************************************!*\
  !*** ./src/scraper/WebScraper/utils/imageDescription.ts ***!
  \**********************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getImageDescription: () => (/* binding */ getImageDescription)\n/* harmony export */ });\n/* harmony import */ var _anthropic_ai_sdk__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @anthropic-ai/sdk */ \"@anthropic-ai/sdk\");\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! axios */ \"axios\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_anthropic_ai_sdk__WEBPACK_IMPORTED_MODULE_0__, axios__WEBPACK_IMPORTED_MODULE_1__]);\n([_anthropic_ai_sdk__WEBPACK_IMPORTED_MODULE_0__, axios__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\nasync function getImageDescription(imageUrl, backText, frontText, model = \"gpt-4-turbo\") {\n    try {\n        const prompt = \"What's in the image? You need to answer with the content for the alt tag of the image. To help you with the context, the image is in the following text: \" + backText + \" and the following text: \" + frontText + \". Be super concise.\";\n        switch(model){\n            case \"claude-3-opus\":\n                {\n                    if (!process.env.ANTHROPIC_API_KEY) {\n                        throw new Error(\"No Anthropic API key provided\");\n                    }\n                    const imageRequest = await axios__WEBPACK_IMPORTED_MODULE_1__[\"default\"].get(imageUrl, {\n                        responseType: \"arraybuffer\"\n                    });\n                    const imageMediaType = \"image/png\";\n                    const imageData = Buffer.from(imageRequest.data, \"binary\").toString(\"base64\");\n                    const anthropic = new _anthropic_ai_sdk__WEBPACK_IMPORTED_MODULE_0__[\"default\"]();\n                    const response = await anthropic.messages.create({\n                        model: \"claude-3-opus-20240229\",\n                        max_tokens: 1024,\n                        messages: [\n                            {\n                                role: \"user\",\n                                content: [\n                                    {\n                                        type: \"image\",\n                                        source: {\n                                            type: \"base64\",\n                                            media_type: imageMediaType,\n                                            data: imageData\n                                        }\n                                    },\n                                    {\n                                        type: \"text\",\n                                        text: prompt\n                                    }\n                                ]\n                            }\n                        ]\n                    });\n                    return response.content[0].text;\n                }\n            default:\n                {\n                    if (!process.env.OPENAI_API_KEY) {\n                        throw new Error(\"No OpenAI API key provided\");\n                    }\n                    const { OpenAI } = __webpack_require__(/*! openai */ \"openai?22eb\");\n                    const openai = new OpenAI();\n                    const response = await openai.chat.completions.create({\n                        model: \"gpt-4-turbo\",\n                        messages: [\n                            {\n                                role: \"user\",\n                                content: [\n                                    {\n                                        type: \"text\",\n                                        text: prompt\n                                    },\n                                    {\n                                        type: \"image_url\",\n                                        image_url: {\n                                            url: imageUrl\n                                        }\n                                    }\n                                ]\n                            }\n                        ]\n                    });\n                    return response.choices[0].message.content;\n                }\n        }\n    } catch (error) {\n        console.error(\"Error generating image alt text:\", error?.message);\n        return \"\";\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL3V0aWxzL2ltYWdlRGVzY3JpcHRpb24udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQTBDO0FBQ2hCO0FBRW5CLGVBQWVFLG9CQUNwQkMsUUFBZ0IsRUFDaEJDLFFBQWdCLEVBQ2hCQyxTQUFpQixFQUNqQkMsUUFBZ0IsYUFBYTtJQUU3QixJQUFJO1FBQ0YsTUFBTUMsU0FBUyw4SkFDYkgsV0FDQSw4QkFDQUMsWUFDQTtRQUVGLE9BQVFDO1lBQ04sS0FBSztnQkFBaUI7b0JBQ3BCLElBQUksQ0FBQ0UsUUFBUUMsSUFBSUMsbUJBQW1CO3dCQUNsQyxNQUFNLElBQUlDLE1BQU07b0JBQ2xCO29CQUNBLE1BQU1DLGVBQWUsTUFBTVgsaURBQVNZLENBQUNWLFVBQVU7d0JBQUVXLGNBQWM7b0JBQWM7b0JBQzdFLE1BQU1DLGlCQUFpQjtvQkFDdkIsTUFBTUMsWUFBWUMsT0FBT0MsS0FBS04sYUFBYU8sTUFBTSxVQUFVQyxTQUFTO29CQUVwRSxNQUFNQyxZQUFZLElBQUlyQix5REFBU0E7b0JBQy9CLE1BQU1zQixXQUFXLE1BQU1ELFVBQVVFLFNBQVNDLE9BQU87d0JBQy9DbEIsT0FBTzt3QkFDUG1CLFlBQVk7d0JBQ1pGLFVBQVU7NEJBQ1I7Z0NBQ0VHLE1BQU07Z0NBQ05DLFNBQVM7b0NBQ1A7d0NBQ0VDLE1BQU07d0NBQ05DLFFBQVE7NENBQ05ELE1BQU07NENBQ05FLFlBQVlmOzRDQUNaSSxNQUFNSDt3Q0FDUjtvQ0FDRjtvQ0FDQTt3Q0FDRVksTUFBTTt3Q0FDTkcsTUFBTXhCO29DQUNSO2lDQUNEOzRCQUNIO3lCQUNEO29CQUNIO29CQUVBLE9BQU9lLFNBQVNLLE9BQU8sQ0FBQyxFQUFFLENBQUNJO2dCQUM3QjtZQUNBO2dCQUFTO29CQUNQLElBQUksQ0FBQ3ZCLFFBQVFDLElBQUl1QixnQkFBZ0I7d0JBQy9CLE1BQU0sSUFBSXJCLE1BQU07b0JBQ2xCO29CQUVBLE1BQU0sRUFBRXNCLE1BQU0sRUFBRSxHQUFHQyxtQkFBT0EsQ0FBQywyQkFBUTtvQkFDbkMsTUFBTUMsU0FBUyxJQUFJRjtvQkFFbkIsTUFBTVgsV0FBVyxNQUFNYSxPQUFPQyxLQUFLQyxZQUFZYixPQUFPO3dCQUNwRGxCLE9BQU87d0JBQ1BpQixVQUFVOzRCQUNSO2dDQUNFRyxNQUFNO2dDQUNOQyxTQUFTO29DQUNQO3dDQUNFQyxNQUFNO3dDQUNORyxNQUFNeEI7b0NBQ1I7b0NBQ0E7d0NBQ0VxQixNQUFNO3dDQUNOVSxXQUFXOzRDQUNUQyxLQUFLcEM7d0NBQ1A7b0NBQ0Y7aUNBQ0Q7NEJBQ0g7eUJBQ0Q7b0JBQ0g7b0JBQ0EsT0FBT21CLFNBQVNrQixPQUFPLENBQUMsRUFBRSxDQUFDQyxRQUFRZDtnQkFDckM7UUFDRjtJQUNGLEVBQUUsT0FBT2UsT0FBTztRQUNkQyxRQUFRRCxNQUFNLG9DQUFvQ0EsT0FBT0Q7UUFDekQsT0FBTztJQUNUO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9maXJlY3Jhd2wtc2NyYXBlci1qcy8uL3NyYy9zY3JhcGVyL1dlYlNjcmFwZXIvdXRpbHMvaW1hZ2VEZXNjcmlwdGlvbi50cz84N2QzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBBbnRocm9waWMgZnJvbSAnQGFudGhyb3BpYy1haS9zZGsnO1xuaW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJztcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEltYWdlRGVzY3JpcHRpb24oXG4gIGltYWdlVXJsOiBzdHJpbmcsXG4gIGJhY2tUZXh0OiBzdHJpbmcsXG4gIGZyb250VGV4dDogc3RyaW5nLFxuICBtb2RlbDogc3RyaW5nID0gXCJncHQtNC10dXJib1wiXG4pOiBQcm9taXNlPHN0cmluZz4ge1xuICB0cnkge1xuICAgIGNvbnN0IHByb21wdCA9IFwiV2hhdCdzIGluIHRoZSBpbWFnZT8gWW91IG5lZWQgdG8gYW5zd2VyIHdpdGggdGhlIGNvbnRlbnQgZm9yIHRoZSBhbHQgdGFnIG9mIHRoZSBpbWFnZS4gVG8gaGVscCB5b3Ugd2l0aCB0aGUgY29udGV4dCwgdGhlIGltYWdlIGlzIGluIHRoZSBmb2xsb3dpbmcgdGV4dDogXCIgK1xuICAgICAgYmFja1RleHQgK1xuICAgICAgXCIgYW5kIHRoZSBmb2xsb3dpbmcgdGV4dDogXCIgK1xuICAgICAgZnJvbnRUZXh0ICtcbiAgICAgIFwiLiBCZSBzdXBlciBjb25jaXNlLlwiXG5cbiAgICBzd2l0Y2ggKG1vZGVsKSB7XG4gICAgICBjYXNlICdjbGF1ZGUtMy1vcHVzJzoge1xuICAgICAgICBpZiAoIXByb2Nlc3MuZW52LkFOVEhST1BJQ19BUElfS0VZKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gQW50aHJvcGljIEFQSSBrZXkgcHJvdmlkZWRcIik7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW1hZ2VSZXF1ZXN0ID0gYXdhaXQgYXhpb3MuZ2V0KGltYWdlVXJsLCB7IHJlc3BvbnNlVHlwZTogJ2FycmF5YnVmZmVyJyB9KTtcbiAgICAgICAgY29uc3QgaW1hZ2VNZWRpYVR5cGUgPSAnaW1hZ2UvcG5nJztcbiAgICAgICAgY29uc3QgaW1hZ2VEYXRhID0gQnVmZmVyLmZyb20oaW1hZ2VSZXF1ZXN0LmRhdGEsICdiaW5hcnknKS50b1N0cmluZygnYmFzZTY0Jyk7XG5cbiAgICAgICAgY29uc3QgYW50aHJvcGljID0gbmV3IEFudGhyb3BpYygpO1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFudGhyb3BpYy5tZXNzYWdlcy5jcmVhdGUoe1xuICAgICAgICAgIG1vZGVsOiBcImNsYXVkZS0zLW9wdXMtMjAyNDAyMjlcIixcbiAgICAgICAgICBtYXhfdG9rZW5zOiAxMDI0LFxuICAgICAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgICAgICBjb250ZW50OiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJpbWFnZVwiLFxuICAgICAgICAgICAgICAgICAgc291cmNlOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiYmFzZTY0XCIsXG4gICAgICAgICAgICAgICAgICAgIG1lZGlhX3R5cGU6IGltYWdlTWVkaWFUeXBlLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiBpbWFnZURhdGEsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgICAgICAgICB0ZXh0OiBwcm9tcHRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9XG4gICAgICAgICAgXVxuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuY29udGVudFswXS50ZXh0O1xuICAgICAgfVxuICAgICAgZGVmYXVsdDoge1xuICAgICAgICBpZiAoIXByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTm8gT3BlbkFJIEFQSSBrZXkgcHJvdmlkZWRcIik7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IE9wZW5BSSB9ID0gcmVxdWlyZShcIm9wZW5haVwiKTtcbiAgICAgICAgY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSgpO1xuICAgICAgXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgICAgICBtb2RlbDogXCJncHQtNC10dXJib1wiLFxuICAgICAgICAgIG1lc3NhZ2VzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgICAgICBjb250ZW50OiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgICAgICAgICB0ZXh0OiBwcm9tcHQsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICB0eXBlOiBcImltYWdlX3VybFwiLFxuICAgICAgICAgICAgICAgICAgaW1hZ2VfdXJsOiB7XG4gICAgICAgICAgICAgICAgICAgIHVybDogaW1hZ2VVcmwsXG4gICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnQ7XG4gICAgICB9XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBnZW5lcmF0aW5nIGltYWdlIGFsdCB0ZXh0OlwiLCBlcnJvcj8ubWVzc2FnZSk7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJBbnRocm9waWMiLCJheGlvcyIsImdldEltYWdlRGVzY3JpcHRpb24iLCJpbWFnZVVybCIsImJhY2tUZXh0IiwiZnJvbnRUZXh0IiwibW9kZWwiLCJwcm9tcHQiLCJwcm9jZXNzIiwiZW52IiwiQU5USFJPUElDX0FQSV9LRVkiLCJFcnJvciIsImltYWdlUmVxdWVzdCIsImdldCIsInJlc3BvbnNlVHlwZSIsImltYWdlTWVkaWFUeXBlIiwiaW1hZ2VEYXRhIiwiQnVmZmVyIiwiZnJvbSIsImRhdGEiLCJ0b1N0cmluZyIsImFudGhyb3BpYyIsInJlc3BvbnNlIiwibWVzc2FnZXMiLCJjcmVhdGUiLCJtYXhfdG9rZW5zIiwicm9sZSIsImNvbnRlbnQiLCJ0eXBlIiwic291cmNlIiwibWVkaWFfdHlwZSIsInRleHQiLCJPUEVOQUlfQVBJX0tFWSIsIk9wZW5BSSIsInJlcXVpcmUiLCJvcGVuYWkiLCJjaGF0IiwiY29tcGxldGlvbnMiLCJpbWFnZV91cmwiLCJ1cmwiLCJjaG9pY2VzIiwibWVzc2FnZSIsImVycm9yIiwiY29uc29sZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/scraper/WebScraper/utils/imageDescription.ts\n");

/***/ }),

/***/ "(api)/./src/scraper/WebScraper/utils/metadata.ts":
/*!**************************************************!*\
  !*** ./src/scraper/WebScraper/utils/metadata.ts ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   extractMetadata: () => (/* binding */ extractMetadata)\n/* harmony export */ });\nfunction extractMetadata(soup, url) {\n    let title = null;\n    let description = null;\n    let language = null;\n    let keywords = null;\n    let robots = null;\n    let ogTitle = null;\n    let ogDescription = null;\n    let ogUrl = null;\n    let ogImage = null;\n    let ogAudio = null;\n    let ogDeterminer = null;\n    let ogLocale = null;\n    let ogLocaleAlternate = null;\n    let ogSiteName = null;\n    let ogVideo = null;\n    let dctermsCreated = null;\n    let dcDateCreated = null;\n    let dcDate = null;\n    let dctermsType = null;\n    let dcType = null;\n    let dctermsAudience = null;\n    let dctermsSubject = null;\n    let dcSubject = null;\n    let dcDescription = null;\n    let dctermsKeywords = null;\n    let modifiedTime = null;\n    let publishedTime = null;\n    let articleTag = null;\n    let articleSection = null;\n    try {\n        title = soup(\"title\").text() || null;\n        description = soup('meta[name=\"description\"]').attr(\"content\") || null;\n        // Assuming the language is part of the URL as per the regex pattern\n        const pattern = /([a-zA-Z]+-[A-Z]{2})/;\n        const match = pattern.exec(url);\n        language = match ? match[1] : null;\n        keywords = soup('meta[name=\"keywords\"]').attr(\"content\") || null;\n        robots = soup('meta[name=\"robots\"]').attr(\"content\") || null;\n        ogTitle = soup('meta[property=\"og:title\"]').attr(\"content\") || null;\n        ogDescription = soup('meta[property=\"og:description\"]').attr(\"content\") || null;\n        ogUrl = soup('meta[property=\"og:url\"]').attr(\"content\") || null;\n        ogImage = soup('meta[property=\"og:image\"]').attr(\"content\") || null;\n        ogAudio = soup('meta[property=\"og:audio\"]').attr(\"content\") || null;\n        ogDeterminer = soup('meta[property=\"og:determiner\"]').attr(\"content\") || null;\n        ogLocale = soup('meta[property=\"og:locale\"]').attr(\"content\") || null;\n        ogLocaleAlternate = soup('meta[property=\"og:locale:alternate\"]').map((i, el)=>soup(el).attr(\"content\")).get() || null;\n        ogSiteName = soup('meta[property=\"og:site_name\"]').attr(\"content\") || null;\n        ogVideo = soup('meta[property=\"og:video\"]').attr(\"content\") || null;\n        articleSection = soup('meta[name=\"article:section\"]').attr(\"content\") || null;\n        articleTag = soup('meta[name=\"article:tag\"]').attr(\"content\") || null;\n        publishedTime = soup('meta[property=\"article:published_time\"]').attr(\"content\") || null;\n        modifiedTime = soup('meta[property=\"article:modified_time\"]').attr(\"content\") || null;\n        dctermsKeywords = soup('meta[name=\"dcterms.keywords\"]').attr(\"content\") || null;\n        dcDescription = soup('meta[name=\"dc.description\"]').attr(\"content\") || null;\n        dcSubject = soup('meta[name=\"dc.subject\"]').attr(\"content\") || null;\n        dctermsSubject = soup('meta[name=\"dcterms.subject\"]').attr(\"content\") || null;\n        dctermsAudience = soup('meta[name=\"dcterms.audience\"]').attr(\"content\") || null;\n        dcType = soup('meta[name=\"dc.type\"]').attr(\"content\") || null;\n        dctermsType = soup('meta[name=\"dcterms.type\"]').attr(\"content\") || null;\n        dcDate = soup('meta[name=\"dc.date\"]').attr(\"content\") || null;\n        dcDateCreated = soup('meta[name=\"dc.date.created\"]').attr(\"content\") || null;\n        dctermsCreated = soup('meta[name=\"dcterms.created\"]').attr(\"content\") || null;\n    } catch (error) {\n        console.error(\"Error extracting metadata:\", error);\n    }\n    return {\n        ...title ? {\n            title\n        } : {},\n        ...description ? {\n            description\n        } : {},\n        ...language ? {\n            language\n        } : {},\n        ...keywords ? {\n            keywords\n        } : {},\n        ...robots ? {\n            robots\n        } : {},\n        ...ogTitle ? {\n            ogTitle\n        } : {},\n        ...ogDescription ? {\n            ogDescription\n        } : {},\n        ...ogUrl ? {\n            ogUrl\n        } : {},\n        ...ogImage ? {\n            ogImage\n        } : {},\n        ...ogAudio ? {\n            ogAudio\n        } : {},\n        ...ogDeterminer ? {\n            ogDeterminer\n        } : {},\n        ...ogLocale ? {\n            ogLocale\n        } : {},\n        ...ogLocaleAlternate ? {\n            ogLocaleAlternate\n        } : {},\n        ...ogSiteName ? {\n            ogSiteName\n        } : {},\n        ...ogVideo ? {\n            ogVideo\n        } : {},\n        ...dctermsCreated ? {\n            dctermsCreated\n        } : {},\n        ...dcDateCreated ? {\n            dcDateCreated\n        } : {},\n        ...dcDate ? {\n            dcDate\n        } : {},\n        ...dctermsType ? {\n            dctermsType\n        } : {},\n        ...dcType ? {\n            dcType\n        } : {},\n        ...dctermsAudience ? {\n            dctermsAudience\n        } : {},\n        ...dctermsSubject ? {\n            dctermsSubject\n        } : {},\n        ...dcSubject ? {\n            dcSubject\n        } : {},\n        ...dcDescription ? {\n            dcDescription\n        } : {},\n        ...dctermsKeywords ? {\n            dctermsKeywords\n        } : {},\n        ...modifiedTime ? {\n            modifiedTime\n        } : {},\n        ...publishedTime ? {\n            publishedTime\n        } : {},\n        ...articleTag ? {\n            articleTag\n        } : {},\n        ...articleSection ? {\n            articleSection\n        } : {}\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL3V0aWxzL21ldGFkYXRhLnRzIiwibWFwcGluZ3MiOiI7Ozs7QUFpQ08sU0FBU0EsZ0JBQWdCQyxJQUFnQixFQUFFQyxHQUFXO0lBQzNELElBQUlDLFFBQXVCO0lBQzNCLElBQUlDLGNBQTZCO0lBQ2pDLElBQUlDLFdBQTBCO0lBQzlCLElBQUlDLFdBQTBCO0lBQzlCLElBQUlDLFNBQXdCO0lBQzVCLElBQUlDLFVBQXlCO0lBQzdCLElBQUlDLGdCQUErQjtJQUNuQyxJQUFJQyxRQUF1QjtJQUMzQixJQUFJQyxVQUF5QjtJQUM3QixJQUFJQyxVQUF5QjtJQUM3QixJQUFJQyxlQUE4QjtJQUNsQyxJQUFJQyxXQUEwQjtJQUM5QixJQUFJQyxvQkFBcUM7SUFDekMsSUFBSUMsYUFBNEI7SUFDaEMsSUFBSUMsVUFBeUI7SUFDN0IsSUFBSUMsaUJBQWdDO0lBQ3BDLElBQUlDLGdCQUErQjtJQUNuQyxJQUFJQyxTQUF3QjtJQUM1QixJQUFJQyxjQUE2QjtJQUNqQyxJQUFJQyxTQUF3QjtJQUM1QixJQUFJQyxrQkFBaUM7SUFDckMsSUFBSUMsaUJBQWdDO0lBQ3BDLElBQUlDLFlBQTJCO0lBQy9CLElBQUlDLGdCQUErQjtJQUNuQyxJQUFJQyxrQkFBaUM7SUFDckMsSUFBSUMsZUFBOEI7SUFDbEMsSUFBSUMsZ0JBQStCO0lBQ25DLElBQUlDLGFBQTRCO0lBQ2hDLElBQUlDLGlCQUFnQztJQUVwQyxJQUFJO1FBQ0Y1QixRQUFRRixLQUFLLFNBQVMrQixVQUFVO1FBQ2hDNUIsY0FBY0gsS0FBSyw0QkFBNEJnQyxLQUFLLGNBQWM7UUFFbEUsb0VBQW9FO1FBQ3BFLE1BQU1DLFVBQVU7UUFDaEIsTUFBTUMsUUFBUUQsUUFBUUUsS0FBS2xDO1FBQzNCRyxXQUFXOEIsUUFBUUEsS0FBSyxDQUFDLEVBQUUsR0FBRztRQUU5QjdCLFdBQVdMLEtBQUsseUJBQXlCZ0MsS0FBSyxjQUFjO1FBQzVEMUIsU0FBU04sS0FBSyx1QkFBdUJn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SUMsU0FBUztZQUFFQTtRQUFPLElBQUksQ0FBQyxDQUFDO1FBQzVCLEdBQUlDLGNBQWM7WUFBRUE7UUFBWSxJQUFJLENBQUMsQ0FBQztRQUN0QyxHQUFJQyxTQUFTO1lBQUVBO1FBQU8sSUFBSSxDQUFDLENBQUM7UUFDNUIsR0FBSUMsa0JBQWtCO1lBQUVBO1FBQWdCLElBQUksQ0FBQyxDQUFDO1FBQzlDLEdBQUlDLGlCQUFpQjtZQUFFQTtRQUFlLElBQUksQ0FBQyxDQUFDO1FBQzVDLEdBQUlDLFlBQVk7WUFBRUE7UUFBVSxJQUFJLENBQUMsQ0FBQztRQUNsQyxHQUFJQyxnQkFBZ0I7WUFBRUE7UUFBYyxJQUFJLENBQUMsQ0FBQztRQUMxQyxHQUFJQyxrQkFBa0I7WUFBRUE7UUFBZ0IsSUFBSSxDQUFDLENBQUM7UUFDOUMsR0FBSUMsZUFBZTtZQUFFQTtRQUFhLElBQUksQ0FBQyxDQUFDO1FBQ3hDLEdBQUlDLGdCQUFnQjtZQUFFQTtRQUFjLElBQUksQ0FBQyxDQUFDO1FBQzFDLEdBQUlDLGFBQWE7WUFBRUE7UUFBVyxJQUFJLENBQUMsQ0FBQztRQUNwQyxHQUFJQyxpQkFBaUI7WUFBRUE7UUFBZSxJQUFJLENBQUMsQ0FBQztJQUM5QztBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmlyZWNyYXdsLXNjcmFwZXItanMvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL3V0aWxzL21ldGFkYXRhLnRzPzNmOTgiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2hlZXJpb0FQSSB9IGZyb20gXCJjaGVlcmlvXCI7XG5pbnRlcmZhY2UgTWV0YWRhdGEge1xuICB0aXRsZT86IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIGxhbmd1YWdlPzogc3RyaW5nO1xuICBrZXl3b3Jkcz86IHN0cmluZztcbiAgcm9ib3RzPzogc3RyaW5nO1xuICBvZ1RpdGxlPzogc3RyaW5nO1xuICBvZ0Rlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBvZ1VybD86IHN0cmluZztcbiAgb2dJbWFnZT86IHN0cmluZztcbiAgb2dBdWRpbz86IHN0cmluZztcbiAgb2dEZXRlcm1pbmVyPzogc3RyaW5nO1xuICBvZ0xvY2FsZT86IHN0cmluZztcbiAgb2dMb2NhbGVBbHRlcm5hdGU/OiBzdHJpbmdbXTtcbiAgb2dTaXRlTmFtZT86IHN0cmluZztcbiAgb2dWaWRlbz86IHN0cmluZztcbiAgZGN0ZXJtc0NyZWF0ZWQ/OiBzdHJpbmc7XG4gIGRjRGF0ZUNyZWF0ZWQ/OiBzdHJpbmc7XG4gIGRjRGF0ZT86IHN0cmluZztcbiAgZGN0ZXJtc1R5cGU/OiBzdHJpbmc7XG4gIGRjVHlwZT86IHN0cmluZztcbiAgZGN0ZXJtc0F1ZGllbmNlPzogc3RyaW5nO1xuICBkY3Rlcm1zU3ViamVjdD86IHN0cmluZztcbiAgZGNTdWJqZWN0Pzogc3RyaW5nO1xuICBkY0Rlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBkY3Rlcm1zS2V5d29yZHM/OiBzdHJpbmc7XG4gIG1vZGlmaWVkVGltZT86IHN0cmluZztcbiAgcHVibGlzaGVkVGltZT86IHN0cmluZztcbiAgYXJ0aWNsZVRhZz86IHN0cmluZztcbiAgYXJ0aWNsZVNlY3Rpb24/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHRyYWN0TWV0YWRhdGEoc291cDogQ2hlZXJpb0FQSSwgdXJsOiBzdHJpbmcpOiBNZXRhZGF0YSB7XG4gIGxldCB0aXRsZTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIGxldCBkZXNjcmlwdGlvbjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIGxldCBsYW5ndWFnZTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIGxldCBrZXl3b3Jkczogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIGxldCByb2JvdHM6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBsZXQgb2dUaXRsZTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIGxldCBvZ0Rlc2NyaXB0aW9uOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgbGV0IG9nVXJsOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgbGV0IG9nSW1hZ2U6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBsZXQgb2dBdWRpbzogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIGxldCBvZ0RldGVybWluZXI6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBsZXQgb2dMb2NhbGU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBsZXQgb2dMb2NhbGVBbHRlcm5hdGU6IHN0cmluZ1tdIHwgbnVsbCA9IG51bGw7XG4gIGxldCBvZ1NpdGVOYW1lOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgbGV0IG9nVmlkZW86IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBsZXQgZGN0ZXJtc0NyZWF0ZWQ6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBsZXQgZGNEYXRlQ3JlYXRlZDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIGxldCBkY0RhdGU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBsZXQgZGN0ZXJtc1R5cGU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBsZXQgZGNUeXBlOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgbGV0IGRjdGVybXNBdWRpZW5jZTogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIGxldCBkY3Rlcm1zU3ViamVjdDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIGxldCBkY1N1YmplY3Q6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBsZXQgZGNEZXNjcmlwdGlvbjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIGxldCBkY3Rlcm1zS2V5d29yZHM6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBsZXQgbW9kaWZpZWRUaW1lOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgbGV0IHB1Ymxpc2hlZFRpbWU6IHN0cmluZyB8IG51bGwgPSBudWxsO1xuICBsZXQgYXJ0aWNsZVRhZzogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG4gIGxldCBhcnRpY2xlU2VjdGlvbjogc3RyaW5nIHwgbnVsbCA9IG51bGw7XG5cbiAgdHJ5IHtcbiAgICB0aXRsZSA9IHNvdXAoXCJ0aXRsZVwiKS50ZXh0KCkgfHwgbnVsbDtcbiAgICBkZXNjcmlwdGlvbiA9IHNvdXAoJ21ldGFbbmFtZT1cImRlc2NyaXB0aW9uXCJdJykuYXR0cihcImNvbnRlbnRcIikgfHwgbnVsbDtcbiAgICBcbiAgICAvLyBBc3N1bWluZyB0aGUgbGFuZ3VhZ2UgaXMgcGFydCBvZiB0aGUgVVJMIGFzIHBlciB0aGUgcmVnZXggcGF0dGVyblxuICAgIGNvbnN0IHBhdHRlcm4gPSAvKFthLXpBLVpdKy1bQS1aXXsyfSkvO1xuICAgIGNvbnN0IG1hdGNoID0gcGF0dGVybi5leGVjKHVybCk7XG4gICAgbGFuZ3VhZ2UgPSBtYXRjaCA/IG1hdGNoWzFdIDogbnVsbDtcblxuICAgIGtleXdvcmRzID0gc291cCgnbWV0YVtuYW1lPVwia2V5d29yZHNcIl0nKS5hdHRyKFwiY29udGVudFwiKSB8fCBudWxsO1xuICAgIHJvYm90cyA9IHNvdXAoJ21ldGFbbmFtZT1cInJvYm90c1wiXScpLmF0dHIoXCJjb250ZW50XCIpIHx8IG51bGw7XG4gICAgb2dUaXRsZSA9IHNvdXAoJ21ldGFbcHJvcGVydHk9XCJvZzp0aXRsZVwiXScpLmF0dHIoXCJjb250ZW50XCIpIHx8IG51bGw7XG4gICAgb2dEZXNjcmlwdGlvbiA9IHNvdXAoJ21ldGFbcHJvcGVydHk9XCJvZzpkZXNjcmlwdGlvblwiXScpLmF0dHIoXCJjb250ZW50XCIpIHx8IG51bGw7XG4gICAgb2dVcmwgPSBzb3VwKCdtZXRhW3Byb3BlcnR5PVwib2c6dXJsXCJdJykuYXR0cihcImNvbnRlbnRcIikgfHwgbnVsbDtcbiAgICBvZ0ltYWdlID0gc291cCgnbWV0YVtwcm9wZXJ0eT1cIm9nOmltYWdlXCJdJykuYXR0cihcImNvbnRlbnRcIikgfHwgbnVsbDtcbiAgICBvZ0F1ZGlvID0gc291cCgnbWV0YVtwcm9wZXJ0eT1cIm9nOmF1ZGlvXCJdJykuYXR0cihcImNvbnRlbnRcIikgfHwgbnVsbDtcbiAgICBvZ0RldGVybWluZXIgPSBzb3VwKCdtZXRhW3Byb3BlcnR5PVwib2c6ZGV0ZXJtaW5lclwiXScpLmF0dHIoXCJjb250ZW50XCIpIHx8IG51bGw7XG4gICAgb2dMb2NhbGUgPSBzb3VwKCdtZXRhW3Byb3BlcnR5PVwib2c6bG9jYWxlXCJdJykuYXR0cihcImNvbnRlbnRcIikgfHwgbnVsbDtcbiAgICBvZ0xvY2FsZUFsdGVybmF0ZSA9IHNvdXAoJ21ldGFbcHJvcGVydHk9XCJvZzpsb2NhbGU6YWx0ZXJuYXRlXCJdJykubWFwKChpLCBlbCkgPT4gc291cChlbCkuYXR0cihcImNvbnRlbnRcIikpLmdldCgpIHx8IG51bGw7XG4gICAgb2dTaXRlTmFtZSA9IHNvdXAoJ21ldGFbcHJvcGVydHk9XCJvZzpzaXRlX25hbWVcIl0nKS5hdHRyKFwiY29udGVudFwiKSB8fCBudWxsO1xuICAgIG9nVmlkZW8gPSBzb3VwKCdtZXRhW3Byb3BlcnR5PVwib2c6dmlkZW9cIl0nKS5hdHRyKFwiY29udGVudFwiKSB8fCBudWxsO1xuICAgIGFydGljbGVTZWN0aW9uID0gc291cCgnbWV0YVtuYW1lPVwiYXJ0aWNsZTpzZWN0aW9uXCJdJykuYXR0cihcImNvbnRlbnRcIikgfHwgbnVsbDtcbiAgICBhcnRpY2xlVGFnID0gc291cCgnbWV0YVtuYW1lPVwiYXJ0aWNsZTp0YWdcIl0nKS5hdHRyKFwiY29udGVudFwiKSB8fCBudWxsO1xuICAgIHB1Ymxpc2hlZFRpbWUgPSBzb3VwKCdtZXRhW3Byb3BlcnR5PVwiYXJ0aWNsZTpwdWJsaXNoZWRfdGltZVwiXScpLmF0dHIoXCJjb250ZW50XCIpIHx8IG51bGw7XG4gICAgbW9kaWZpZWRUaW1lID0gc291cCgnbWV0YVtwcm9wZXJ0eT1cImFydGljbGU6bW9kaWZpZWRfdGltZVwiXScpLmF0dHIoXCJjb250ZW50XCIpIHx8IG51bGw7XG4gICAgZGN0ZXJtc0tleXdvcmRzID0gc291cCgnbWV0YVtuYW1lPVwiZGN0ZXJtcy5rZXl3b3Jkc1wiXScpLmF0dHIoXCJjb250ZW50XCIpIHx8IG51bGw7XG4gICAgZGNEZXNjcmlwdGlvbiA9IHNvdXAoJ21ldGFbbmFtZT1cImRjLmRlc2NyaXB0aW9uXCJdJykuYXR0cihcImNvbnRlbnRcIikgfHwgbnVsbDtcbiAgICBkY1N1YmplY3QgPSBzb3VwKCdtZXRhW25hbWU9XCJkYy5zdWJqZWN0XCJdJykuYXR0cihcImNvbnRlbnRcIikgfHwgbnVsbDtcbiAgICBkY3Rlcm1zU3ViamVjdCA9IHNvdXAoJ21ldGFbbmFtZT1cImRjdGVybXMuc3ViamVjdFwiXScpLmF0dHIoXCJjb250ZW50XCIpIHx8IG51bGw7XG4gICAgZGN0ZXJtc0F1ZGllbmNlID0gc291cCgnbWV0YVtuYW1lPVwiZGN0ZXJtcy5hdWRpZW5jZVwiXScpLmF0dHIoXCJjb250ZW50XCIpIHx8IG51bGw7XG4gICAgZGNUeXBlID0gc291cCgnbWV0YVtuYW1lPVwiZGMudHlwZVwiXScpLmF0dHIoXCJjb250ZW50XCIpIHx8IG51bGw7XG4gICAgZGN0ZXJtc1R5cGUgPSBzb3VwKCdtZXRhW25hbWU9XCJkY3Rlcm1zLnR5cGVcIl0nKS5hdHRyKFwiY29udGVudFwiKSB8fCBudWxsO1xuICAgIGRjRGF0ZSA9IHNvdXAoJ21ldGFbbmFtZT1cImRjLmRhdGVcIl0nKS5hdHRyKFwiY29udGVudFwiKSB8fCBudWxsO1xuICAgIGRjRGF0ZUNyZWF0ZWQgPSBzb3VwKCdtZXRhW25hbWU9XCJkYy5kYXRlLmNyZWF0ZWRcIl0nKS5hdHRyKFwiY29udGVudFwiKSB8fCBudWxsO1xuICAgIGRjdGVybXNDcmVhdGVkID0gc291cCgnbWV0YVtuYW1lPVwiZGN0ZXJtcy5jcmVhdGVkXCJdJykuYXR0cihcImNvbnRlbnRcIikgfHwgbnVsbDtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBleHRyYWN0aW5nIG1ldGFkYXRhOlwiLCBlcnJvcik7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIC4uLih0aXRsZSA/IHsgdGl0bGUgfSA6IHt9KSxcbiAgICAuLi4oZGVzY3JpcHRpb24gPyB7IGRlc2NyaXB0aW9uIH0gOiB7fSksXG4gICAgLi4uKGxhbmd1YWdlID8geyBsYW5ndWFnZSB9IDoge30pLFxuICAgIC4uLihrZXl3b3JkcyA/IHsga2V5d29yZHMgfSA6IHt9KSxcbiAgICAuLi4ocm9ib3RzID8geyByb2JvdHMgfSA6IHt9KSxcbiAgICAuLi4ob2dUaXRsZSA/IHsgb2dUaXRsZSB9IDoge30pLFxuICAgIC4uLihvZ0Rlc2NyaXB0aW9uID8geyBvZ0Rlc2NyaXB0aW9uIH0gOiB7fSksXG4gICAgLi4uKG9nVXJsID8geyBvZ1VybCB9IDoge30pLFxuICAgIC4uLihvZ0ltYWdlID8geyBvZ0ltYWdlIH0gOiB7fSksXG4gICAgLi4uKG9nQXVkaW8gPyB7IG9nQXVkaW8gfSA6IHt9KSxcbiAgICAuLi4ob2dEZXRlcm1pbmVyID8geyBvZ0RldGVybWluZXIgfSA6IHt9KSxcbiAgICAuLi4ob2dMb2NhbGUgPyB7IG9nTG9jYWxlIH0gOiB7fSksXG4gICAgLi4uKG9nTG9jYWxlQWx0ZXJuYXRlID8geyBvZ0xvY2FsZUFsdGVybmF0ZSB9IDoge30pLFxuICAgIC4uLihvZ1NpdGVOYW1lID8geyBvZ1NpdGVOYW1lIH0gOiB7fSksXG4gICAgLi4uKG9nVmlkZW8gPyB7IG9nVmlkZW8gfSA6IHt9KSxcbiAgICAuLi4oZGN0ZXJtc0NyZWF0ZWQgPyB7IGRjdGVybXNDcmVhdGVkIH0gOiB7fSksXG4gICAgLi4uKGRjRGF0ZUNyZWF0ZWQgPyB7IGRjRGF0ZUNyZWF0ZWQgfSA6IHt9KSxcbiAgICAuLi4oZGNEYXRlID8geyBkY0RhdGUgfSA6IHt9KSxcbiAgICAuLi4oZGN0ZXJtc1R5cGUgPyB7IGRjdGVybXNUeXBlIH0gOiB7fSksXG4gICAgLi4uKGRjVHlwZSA/IHsgZGNUeXBlIH0gOiB7fSksXG4gICAgLi4uKGRjdGVybXNBdWRpZW5jZSA/IHsgZGN0ZXJtc0F1ZGllbmNlIH0gOiB7fSksXG4gICAgLi4uKGRjdGVybXNTdWJqZWN0ID8geyBkY3Rlcm1zU3ViamVjdCB9IDoge30pLFxuICAgIC4uLihkY1N1YmplY3QgPyB7IGRjU3ViamVjdCB9IDoge30pLFxuICAgIC4uLihkY0Rlc2NyaXB0aW9uID8geyBkY0Rlc2NyaXB0aW9uIH0gOiB7fSksXG4gICAgLi4uKGRjdGVybXNLZXl3b3JkcyA/IHsgZGN0ZXJtc0tleXdvcmRzIH0gOiB7fSksXG4gICAgLi4uKG1vZGlmaWVkVGltZSA/IHsgbW9kaWZpZWRUaW1lIH0gOiB7fSksXG4gICAgLi4uKHB1Ymxpc2hlZFRpbWUgPyB7IHB1Ymxpc2hlZFRpbWUgfSA6IHt9KSxcbiAgICAuLi4oYXJ0aWNsZVRhZyA/IHsgYXJ0aWNsZVRhZyB9IDoge30pLFxuICAgIC4uLihhcnRpY2xlU2VjdGlvbiA/IHsgYXJ0aWNsZVNlY3Rpb24gfSA6IHt9KSxcbiAgfTtcbn1cbiJdLCJuYW1lcyI6WyJleHRyYWN0TWV0YWRhdGEiLCJzb3VwIiwidXJsIiwidGl0bGUiLCJkZXNjcmlwdGlvbiIsImxhbmd1YWdlIiwia2V5d29yZHMiLCJyb2JvdHMiLCJvZ1RpdGxlIiwib2dEZXNjcmlwdGlvbiIsIm9nVXJsIiwib2dJbWFnZSIsIm9nQXVkaW8iLCJvZ0RldGVybWluZXIiLCJvZ0xvY2FsZSIsIm9nTG9jYWxlQWx0ZXJuYXRlIiwib2dTaXRlTmFtZSIsIm9nVmlkZW8iLCJkY3Rlcm1zQ3JlYXRlZCIsImRjRGF0ZUNyZWF0ZWQiLCJkY0RhdGUiLCJkY3Rlcm1zVHlwZSIsImRjVHlwZSIsImRjdGVybXNBdWRpZW5jZSIsImRjdGVybXNTdWJqZWN0IiwiZGNTdWJqZWN0IiwiZGNEZXNjcmlwdGlvbiIsImRjdGVybXNLZXl3b3JkcyIsIm1vZGlmaWVkVGltZSIsInB1Ymxpc2hlZFRpbWUiLCJhcnRpY2xlVGFnIiwiYXJ0aWNsZVNlY3Rpb24iLCJ0ZXh0IiwiYXR0ciIsInBhdHRlcm4iLCJtYXRjaCIsImV4ZWMiLCJtYXAiLCJpIiwiZWwiLCJnZXQiLCJlcnJvciIsImNvbnNvbGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/scraper/WebScraper/utils/metadata.ts\n");

/***/ }),

/***/ "(api)/./src/scraper/WebScraper/utils/pdfProcessor.ts":
/*!******************************************************!*\
  !*** ./src/scraper/WebScraper/utils/pdfProcessor.ts ***!
  \******************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   fetchAndProcessPdf: () => (/* binding */ fetchAndProcessPdf),\n/* harmony export */   processPdfToText: () => (/* binding */ processPdfToText)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! axios */ \"axios\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! node:fs */ \"node:fs\");\n/* harmony import */ var node_fs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(node_fs__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var form_data__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! form-data */ \"form-data\");\n/* harmony import */ var form_data__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(form_data__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var dotenv__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! dotenv */ \"dotenv\");\n/* harmony import */ var dotenv__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(dotenv__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var pdf_parse__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! pdf-parse */ \"pdf-parse\");\n/* harmony import */ var pdf_parse__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(pdf_parse__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var os__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! os */ \"os\");\n/* harmony import */ var os__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(os__WEBPACK_IMPORTED_MODULE_7__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_0__]);\naxios__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\n\n\ndotenv__WEBPACK_IMPORTED_MODULE_4___default().config();\nasync function fetchAndProcessPdf(url) {\n    const tempFilePath = await downloadPdf(url);\n    const content = await processPdfToText(tempFilePath);\n    fs__WEBPACK_IMPORTED_MODULE_1___default().unlinkSync(tempFilePath); // Clean up the temporary file\n    return content;\n}\nasync function downloadPdf(url) {\n    const response = await (0,axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n        url,\n        method: \"GET\",\n        responseType: \"stream\"\n    });\n    const tempFilePath = path__WEBPACK_IMPORTED_MODULE_6___default().join(os__WEBPACK_IMPORTED_MODULE_7___default().tmpdir(), `tempPdf-${Date.now()}.pdf`);\n    const writer = (0,node_fs__WEBPACK_IMPORTED_MODULE_2__.createWriteStream)(tempFilePath);\n    response.data.pipe(writer);\n    return new Promise((resolve, reject)=>{\n        writer.on(\"finish\", ()=>resolve(tempFilePath));\n        writer.on(\"error\", reject);\n    });\n}\nasync function processPdfToText(filePath) {\n    let content = \"\";\n    if (process.env.LLAMAPARSE_API_KEY) {\n        const apiKey = process.env.LLAMAPARSE_API_KEY;\n        const headers = {\n            Authorization: `Bearer ${apiKey}`\n        };\n        const base_url = \"https://api.cloud.llamaindex.ai/api/parsing\";\n        const fileType2 = \"application/pdf\";\n        try {\n            const formData = new (form_data__WEBPACK_IMPORTED_MODULE_3___default())();\n            formData.append(\"file\", (0,node_fs__WEBPACK_IMPORTED_MODULE_2__.createReadStream)(filePath), {\n                filename: filePath,\n                contentType: fileType2\n            });\n            const uploadUrl = `${base_url}/upload`;\n            const uploadResponse = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].post(uploadUrl, formData, {\n                headers: {\n                    ...headers,\n                    ...formData.getHeaders()\n                }\n            });\n            const jobId = uploadResponse.data.id;\n            const resultType = \"text\";\n            const resultUrl = `${base_url}/job/${jobId}/result/${resultType}`;\n            let resultResponse;\n            let attempt = 0;\n            const maxAttempts = 10; // Maximum number of attempts\n            let resultAvailable = false;\n            while(attempt < maxAttempts && !resultAvailable){\n                try {\n                    resultResponse = await axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].get(resultUrl, {\n                        headers\n                    });\n                    if (resultResponse.status === 200) {\n                        resultAvailable = true; // Exit condition met\n                    } else {\n                        // If the status code is not 200, increment the attempt counter and wait\n                        attempt++;\n                        await new Promise((resolve)=>setTimeout(resolve, 250)); // Wait for 2 seconds\n                    }\n                } catch (error) {\n                    console.error(\"Error fetching result:\", error);\n                    attempt++;\n                    await new Promise((resolve)=>setTimeout(resolve, 250)); // Wait for 2 seconds before retrying\n                // You may want to handle specific errors differently\n                }\n            }\n            if (!resultAvailable) {\n                content = await processPdf(filePath);\n            }\n            content = resultResponse.data[resultType];\n        } catch (error) {\n            console.error(\"Error processing document:\", filePath, error);\n            content = await processPdf(filePath);\n        }\n    } else {\n        content = await processPdf(filePath);\n    }\n    return content;\n}\nasync function processPdf(file) {\n    const fileContent = fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(file);\n    const data = await pdf_parse__WEBPACK_IMPORTED_MODULE_5___default()(fileContent);\n    return data.text;\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL3V0aWxzL3BkZlByb2Nlc3Nvci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUE2QztBQUN6QjtBQUMwQztBQUM3QjtBQUNMO0FBQ0E7QUFDSjtBQUNKO0FBRXBCSyxvREFBYUk7QUFFTixlQUFlQyxtQkFBbUJDLEdBQVc7SUFDbEQsTUFBTUMsZUFBZSxNQUFNQyxZQUFZRjtJQUN2QyxNQUFNRyxVQUFVLE1BQU1DLGlCQUFpQkg7SUFDdkNYLG9EQUFhZSxDQUFDSixlQUFlLDhCQUE4QjtJQUMzRCxPQUFPRTtBQUNUO0FBRUEsZUFBZUQsWUFBWUYsR0FBVztJQUNwQyxNQUFNTSxXQUFXLE1BQU1qQixpREFBS0EsQ0FBQztRQUMzQlc7UUFDQU8sUUFBUTtRQUNSQyxjQUFjO0lBQ2hCO0lBRUEsTUFBTVAsZUFBZUwsZ0RBQVNhLENBQUNaLGdEQUFTYSxJQUFJLENBQUMsUUFBUSxFQUFFQyxLQUFLQyxNQUFNLElBQUksQ0FBQztJQUN2RSxNQUFNQyxTQUFTckIsMERBQWlCQSxDQUFDUztJQUVqQ0ssU0FBU1EsS0FBS0MsS0FBS0Y7SUFFbkIsT0FBTyxJQUFJRyxRQUFRLENBQUNDLFNBQVNDO1FBQzNCTCxPQUFPTSxHQUFHLFVBQVUsSUFBTUYsUUFBUWhCO1FBQ2xDWSxPQUFPTSxHQUFHLFNBQVNEO0lBQ3JCO0FBQ0Y7QUFFTyxlQUFlZCxpQkFBaUJnQixRQUFnQjtJQUNyRCxJQUFJakIsVUFBVTtJQUVkLElBQUlrQixRQUFRQyxJQUFJQyxvQkFBb0I7UUFDbEMsTUFBTUMsU0FBU0gsUUFBUUMsSUFBSUM7UUFDM0IsTUFBTUUsVUFBVTtZQUNkQyxlQUFlLENBQUMsT0FBTyxFQUFFRixPQUFPLENBQUM7UUFDbkM7UUFDQSxNQUFNRyxXQUFXO1FBQ2pCLE1BQU1DLFlBQVk7UUFFbEIsSUFBSTtZQUNGLE1BQU1DLFdBQVcsSUFBSXBDLGtEQUFRQTtZQUM3Qm9DLFNBQVNDLE9BQU8sUUFBUXZDLHlEQUFnQkEsQ0FBQzZCLFdBQVc7Z0JBQ2xEVyxVQUFVWDtnQkFDVlksYUFBYUo7WUFDZjtZQUVBLE1BQU1LLFlBQVksQ0FBQyxFQUFFTixTQUFTLE9BQU8sQ0FBQztZQUN0QyxNQUFNTyxpQkFBaUIsTUFBTTdDLGtEQUFVOEMsQ0FBQ0YsV0FBV0osVUFBVTtnQkFDM0RKLFNBQVM7b0JBQ1AsR0FBR0EsT0FBTztvQkFDVixHQUFHSSxTQUFTTyxZQUFZO2dCQUMxQjtZQUNGO1lBRUEsTUFBTUMsUUFBUUgsZUFBZXBCLEtBQUt3QjtZQUNsQyxNQUFNQyxhQUFhO1lBQ25CLE1BQU1DLFlBQVksQ0FBQyxFQUFFYixTQUFTLEtBQUssRUFBRVUsTUFBTSxRQUFRLEVBQUVFLFdBQVcsQ0FBQztZQUVqRSxJQUFJRTtZQUNKLElBQUlDLFVBQVU7WUFDZCxNQUFNQyxjQUFjLElBQUksNkJBQTZCO1lBQ3JELElBQUlDLGtCQUFrQjtZQUV0QixNQUFPRixVQUFVQyxlQUFlLENBQUNDLGdCQUFpQjtnQkFDaEQsSUFBSTtvQkFDRkgsaUJBQWlCLE1BQU1wRCxpREFBU3dELENBQUNMLFdBQVc7d0JBQUVmO29CQUFRO29CQUN0RCxJQUFJZ0IsZUFBZUssV0FBVyxLQUFLO3dCQUNqQ0Ysa0JBQWtCLE1BQU0scUJBQXFCO29CQUMvQyxPQUFPO3dCQUNMLHdFQUF3RTt3QkFDeEVGO3dCQUNBLE1BQU0sSUFBSTFCLFFBQVEsQ0FBQ0MsVUFBWThCLFdBQVc5QixTQUFTLE9BQU8scUJBQXFCO29CQUNqRjtnQkFDRixFQUFFLE9BQU8rQixPQUFPO29CQUNkQyxRQUFRRCxNQUFNLDBCQUEwQkE7b0JBQ3hDTjtvQkFDQSxNQUFNLElBQUkxQixRQUFRLENBQUNDLFVBQVk4QixXQUFXOUIsU0FBUyxPQUFPLHFDQUFxQztnQkFDL0YscURBQXFEO2dCQUN2RDtZQUNGO1lBRUEsSUFBSSxDQUFDMkIsaUJBQWlCO2dCQUNwQnpDLFVBQVUsTUFBTStDLFdBQVc5QjtZQUM3QjtZQUNBakIsVUFBVXNDLGVBQWUzQixJQUFJLENBQUN5QixXQUFXO1FBQzNDLEVBQUUsT0FBT1MsT0FBTztZQUNkQyxRQUFRRCxNQUFNLDhCQUE4QjVCLFVBQVU0QjtZQUN0RDdDLFVBQVUsTUFBTStDLFdBQVc5QjtRQUM3QjtJQUNGLE9BQU87UUFDTGpCLFVBQVUsTUFBTStDLFdBQVc5QjtJQUM3QjtJQUNBLE9BQU9qQjtBQUNUO0FBRUEsZUFBZStDLFdBQVdDLElBQVk7SUFDcEMsTUFBTUMsY0FBYzlELHNEQUFlK0QsQ0FBQ0Y7SUFDcEMsTUFBTXJDLE9BQU8sTUFBTW5CLGdEQUFHQSxDQUFDeUQ7SUFDdkIsT0FBT3RDLEtBQUt3QztBQUNkIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmlyZWNyYXdsLXNjcmFwZXItanMvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL3V0aWxzL3BkZlByb2Nlc3Nvci50cz9mOTk2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBheGlvcywgeyBBeGlvc1Jlc3BvbnNlIH0gZnJvbSBcImF4aW9zXCI7XG5pbXBvcnQgZnMgZnJvbSBcImZzXCI7XG5pbXBvcnQgeyBjcmVhdGVSZWFkU3RyZWFtLCBjcmVhdGVXcml0ZVN0cmVhbSB9IGZyb20gXCJub2RlOmZzXCI7XG5pbXBvcnQgRm9ybURhdGEgZnJvbSBcImZvcm0tZGF0YVwiO1xuaW1wb3J0IGRvdGVudiBmcm9tIFwiZG90ZW52XCI7XG5pbXBvcnQgcGRmIGZyb20gXCJwZGYtcGFyc2VcIjtcbmltcG9ydCBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgb3MgZnJvbSBcIm9zXCI7XG5cbmRvdGVudi5jb25maWcoKTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGZldGNoQW5kUHJvY2Vzc1BkZih1cmw6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gIGNvbnN0IHRlbXBGaWxlUGF0aCA9IGF3YWl0IGRvd25sb2FkUGRmKHVybCk7XG4gIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCBwcm9jZXNzUGRmVG9UZXh0KHRlbXBGaWxlUGF0aCk7XG4gIGZzLnVubGlua1N5bmModGVtcEZpbGVQYXRoKTsgLy8gQ2xlYW4gdXAgdGhlIHRlbXBvcmFyeSBmaWxlXG4gIHJldHVybiBjb250ZW50O1xufVxuXG5hc3luYyBmdW5jdGlvbiBkb3dubG9hZFBkZih1cmw6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3Moe1xuICAgIHVybCxcbiAgICBtZXRob2Q6ICdHRVQnLFxuICAgIHJlc3BvbnNlVHlwZTogJ3N0cmVhbScsXG4gIH0pO1xuXG4gIGNvbnN0IHRlbXBGaWxlUGF0aCA9IHBhdGguam9pbihvcy50bXBkaXIoKSwgYHRlbXBQZGYtJHtEYXRlLm5vdygpfS5wZGZgKTtcbiAgY29uc3Qgd3JpdGVyID0gY3JlYXRlV3JpdGVTdHJlYW0odGVtcEZpbGVQYXRoKTtcblxuICByZXNwb25zZS5kYXRhLnBpcGUod3JpdGVyKTtcblxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIHdyaXRlci5vbignZmluaXNoJywgKCkgPT4gcmVzb2x2ZSh0ZW1wRmlsZVBhdGgpKTtcbiAgICB3cml0ZXIub24oJ2Vycm9yJywgcmVqZWN0KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBwcm9jZXNzUGRmVG9UZXh0KGZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICBsZXQgY29udGVudCA9IFwiXCI7XG5cbiAgaWYgKHByb2Nlc3MuZW52LkxMQU1BUEFSU0VfQVBJX0tFWSkge1xuICAgIGNvbnN0IGFwaUtleSA9IHByb2Nlc3MuZW52LkxMQU1BUEFSU0VfQVBJX0tFWTtcbiAgICBjb25zdCBoZWFkZXJzID0ge1xuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2FwaUtleX1gLFxuICAgIH07XG4gICAgY29uc3QgYmFzZV91cmwgPSBcImh0dHBzOi8vYXBpLmNsb3VkLmxsYW1haW5kZXguYWkvYXBpL3BhcnNpbmdcIjtcbiAgICBjb25zdCBmaWxlVHlwZTIgPSBcImFwcGxpY2F0aW9uL3BkZlwiO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICBmb3JtRGF0YS5hcHBlbmQoXCJmaWxlXCIsIGNyZWF0ZVJlYWRTdHJlYW0oZmlsZVBhdGgpLCB7XG4gICAgICAgIGZpbGVuYW1lOiBmaWxlUGF0aCxcbiAgICAgICAgY29udGVudFR5cGU6IGZpbGVUeXBlMixcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB1cGxvYWRVcmwgPSBgJHtiYXNlX3VybH0vdXBsb2FkYDtcbiAgICAgIGNvbnN0IHVwbG9hZFJlc3BvbnNlID0gYXdhaXQgYXhpb3MucG9zdCh1cGxvYWRVcmwsIGZvcm1EYXRhLCB7XG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAuLi5oZWFkZXJzLFxuICAgICAgICAgIC4uLmZvcm1EYXRhLmdldEhlYWRlcnMoKSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBqb2JJZCA9IHVwbG9hZFJlc3BvbnNlLmRhdGEuaWQ7XG4gICAgICBjb25zdCByZXN1bHRUeXBlID0gXCJ0ZXh0XCI7XG4gICAgICBjb25zdCByZXN1bHRVcmwgPSBgJHtiYXNlX3VybH0vam9iLyR7am9iSWR9L3Jlc3VsdC8ke3Jlc3VsdFR5cGV9YDtcblxuICAgICAgbGV0IHJlc3VsdFJlc3BvbnNlOiBBeGlvc1Jlc3BvbnNlO1xuICAgICAgbGV0IGF0dGVtcHQgPSAwO1xuICAgICAgY29uc3QgbWF4QXR0ZW1wdHMgPSAxMDsgLy8gTWF4aW11bSBudW1iZXIgb2YgYXR0ZW1wdHNcbiAgICAgIGxldCByZXN1bHRBdmFpbGFibGUgPSBmYWxzZTtcblxuICAgICAgd2hpbGUgKGF0dGVtcHQgPCBtYXhBdHRlbXB0cyAmJiAhcmVzdWx0QXZhaWxhYmxlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmVzdWx0UmVzcG9uc2UgPSBhd2FpdCBheGlvcy5nZXQocmVzdWx0VXJsLCB7IGhlYWRlcnMgfSk7XG4gICAgICAgICAgaWYgKHJlc3VsdFJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICByZXN1bHRBdmFpbGFibGUgPSB0cnVlOyAvLyBFeGl0IGNvbmRpdGlvbiBtZXRcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgdGhlIHN0YXR1cyBjb2RlIGlzIG5vdCAyMDAsIGluY3JlbWVudCB0aGUgYXR0ZW1wdCBjb3VudGVyIGFuZCB3YWl0XG4gICAgICAgICAgICBhdHRlbXB0Kys7XG4gICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAyNTApKTsgLy8gV2FpdCBmb3IgMiBzZWNvbmRzXG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyByZXN1bHQ6XCIsIGVycm9yKTtcbiAgICAgICAgICBhdHRlbXB0Kys7XG4gICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMjUwKSk7IC8vIFdhaXQgZm9yIDIgc2Vjb25kcyBiZWZvcmUgcmV0cnlpbmdcbiAgICAgICAgICAvLyBZb3UgbWF5IHdhbnQgdG8gaGFuZGxlIHNwZWNpZmljIGVycm9ycyBkaWZmZXJlbnRseVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghcmVzdWx0QXZhaWxhYmxlKSB7XG4gICAgICAgIGNvbnRlbnQgPSBhd2FpdCBwcm9jZXNzUGRmKGZpbGVQYXRoKTtcbiAgICAgIH1cbiAgICAgIGNvbnRlbnQgPSByZXN1bHRSZXNwb25zZS5kYXRhW3Jlc3VsdFR5cGVdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcHJvY2Vzc2luZyBkb2N1bWVudDpcIiwgZmlsZVBhdGgsIGVycm9yKTtcbiAgICAgIGNvbnRlbnQgPSBhd2FpdCBwcm9jZXNzUGRmKGZpbGVQYXRoKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgY29udGVudCA9IGF3YWl0IHByb2Nlc3NQZGYoZmlsZVBhdGgpO1xuICB9XG4gIHJldHVybiBjb250ZW50O1xufVxuXG5hc3luYyBmdW5jdGlvbiBwcm9jZXNzUGRmKGZpbGU6IHN0cmluZyl7XG4gIGNvbnN0IGZpbGVDb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZpbGUpO1xuICBjb25zdCBkYXRhID0gYXdhaXQgcGRmKGZpbGVDb250ZW50KTtcbiAgcmV0dXJuIGRhdGEudGV4dDtcbn0iXSwibmFtZXMiOlsiYXhpb3MiLCJmcyIsImNyZWF0ZVJlYWRTdHJlYW0iLCJjcmVhdGVXcml0ZVN0cmVhbSIsIkZvcm1EYXRhIiwiZG90ZW52IiwicGRmIiwicGF0aCIsIm9zIiwiY29uZmlnIiwiZmV0Y2hBbmRQcm9jZXNzUGRmIiwidXJsIiwidGVtcEZpbGVQYXRoIiwiZG93bmxvYWRQZGYiLCJjb250ZW50IiwicHJvY2Vzc1BkZlRvVGV4dCIsInVubGlua1N5bmMiLCJyZXNwb25zZSIsIm1ldGhvZCIsInJlc3BvbnNlVHlwZSIsImpvaW4iLCJ0bXBkaXIiLCJEYXRlIiwibm93Iiwid3JpdGVyIiwiZGF0YSIsInBpcGUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9uIiwiZmlsZVBhdGgiLCJwcm9jZXNzIiwiZW52IiwiTExBTUFQQVJTRV9BUElfS0VZIiwiYXBpS2V5IiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJiYXNlX3VybCIsImZpbGVUeXBlMiIsImZvcm1EYXRhIiwiYXBwZW5kIiwiZmlsZW5hbWUiLCJjb250ZW50VHlwZSIsInVwbG9hZFVybCIsInVwbG9hZFJlc3BvbnNlIiwicG9zdCIsImdldEhlYWRlcnMiLCJqb2JJZCIsImlkIiwicmVzdWx0VHlwZSIsInJlc3VsdFVybCIsInJlc3VsdFJlc3BvbnNlIiwiYXR0ZW1wdCIsIm1heEF0dGVtcHRzIiwicmVzdWx0QXZhaWxhYmxlIiwiZ2V0Iiwic3RhdHVzIiwic2V0VGltZW91dCIsImVycm9yIiwiY29uc29sZSIsInByb2Nlc3NQZGYiLCJmaWxlIiwiZmlsZUNvbnRlbnQiLCJyZWFkRmlsZVN5bmMiLCJ0ZXh0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/scraper/WebScraper/utils/pdfProcessor.ts\n");

/***/ }),

/***/ "(api)/./src/scraper/WebScraper/utils/replacePaths.ts":
/*!******************************************************!*\
  !*** ./src/scraper/WebScraper/utils/replacePaths.ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   replaceImgPathsWithAbsolutePaths: () => (/* binding */ replaceImgPathsWithAbsolutePaths),\n/* harmony export */   replacePathsWithAbsolutePaths: () => (/* binding */ replacePathsWithAbsolutePaths)\n/* harmony export */ });\nconst replacePathsWithAbsolutePaths = (documents)=>{\n    try {\n        documents.forEach((document)=>{\n            const baseUrl = new URL(document.metadata.sourceURL).origin;\n            const paths = document.content.match(/(!?\\[.*?\\])\\(((?:[^()]+|\\((?:[^()]+|\\([^()]*\\))*\\))*)\\)|href=\"([^\"]+)\"/g) || [];\n            paths.forEach((path)=>{\n                const isImage = path.startsWith(\"!\");\n                let matchedUrl = path.match(/\\(([^)]+)\\)/) || path.match(/href=\"([^\"]+)\"/);\n                let url = matchedUrl[1];\n                if (!url.startsWith(\"data:\") && !url.startsWith(\"http\")) {\n                    if (url.startsWith(\"/\")) {\n                        url = url.substring(1);\n                    }\n                    url = new URL(url, baseUrl).toString();\n                }\n                const markdownLinkOrImageText = path.match(/(!?\\[.*?\\])/)[0];\n                if (isImage) {\n                    document.content = document.content.replace(path, `${markdownLinkOrImageText}(${url})`);\n                } else {\n                    document.content = document.content.replace(path, `${markdownLinkOrImageText}(${url})`);\n                }\n            });\n        });\n        return documents;\n    } catch (error) {\n        console.error(\"Error replacing paths with absolute paths\", error);\n        return documents;\n    }\n};\nconst replaceImgPathsWithAbsolutePaths = (documents)=>{\n    try {\n        documents.forEach((document)=>{\n            const baseUrl = new URL(document.metadata.sourceURL).origin;\n            const images = document.content.match(/!\\[.*?\\]\\(((?:[^()]+|\\((?:[^()]+|\\([^()]*\\))*\\))*)\\)/g) || [];\n            images.forEach((image)=>{\n                let imageUrl = image.match(/\\(([^)]+)\\)/)[1];\n                let altText = image.match(/\\[(.*?)\\]/)[1];\n                if (!imageUrl.startsWith(\"data:image\")) {\n                    if (!imageUrl.startsWith(\"http\")) {\n                        if (imageUrl.startsWith(\"/\")) {\n                            imageUrl = imageUrl.substring(1);\n                        }\n                        imageUrl = new URL(imageUrl, baseUrl).toString();\n                    }\n                }\n                document.content = document.content.replace(image, `![${altText}](${imageUrl})`);\n            });\n        });\n        return documents;\n    } catch (error) {\n        console.error(\"Error replacing img paths with absolute paths\", error);\n        return documents;\n    }\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2NyYXBlci9XZWJTY3JhcGVyL3V0aWxzL3JlcGxhY2VQYXRocy50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUVPLE1BQU1BLGdDQUFnQyxDQUFDQztJQUM1QyxJQUFJO1FBQ0ZBLFVBQVVDLFFBQVEsQ0FBQ0M7WUFDakIsTUFBTUMsVUFBVSxJQUFJQyxJQUFJRixTQUFTRyxTQUFTQyxXQUFXQztZQUNyRCxNQUFNQyxRQUNKTixTQUFTTyxRQUFRQyxNQUNmLDhFQUNHLEVBQUU7WUFFVEYsTUFBTVAsUUFBUSxDQUFDVTtnQkFDYixNQUFNQyxVQUFVRCxLQUFLRSxXQUFXO2dCQUNoQyxJQUFJQyxhQUFhSCxLQUFLRCxNQUFNLGtCQUFrQkMsS0FBS0QsTUFBTTtnQkFDekQsSUFBSUssTUFBTUQsVUFBVSxDQUFDLEVBQUU7Z0JBRXZCLElBQUksQ0FBQ0MsSUFBSUYsV0FBVyxZQUFZLENBQUNFLElBQUlGLFdBQVcsU0FBUztvQkFDdkQsSUFBSUUsSUFBSUYsV0FBVyxNQUFNO3dCQUN2QkUsTUFBTUEsSUFBSUMsVUFBVTtvQkFDdEI7b0JBQ0FELE1BQU0sSUFBSVgsSUFBSVcsS0FBS1osU0FBU2M7Z0JBQzlCO2dCQUVBLE1BQU1DLDBCQUEwQlAsS0FBS0QsTUFBTSxjQUFjLENBQUMsRUFBRTtnQkFDNUQsSUFBSUUsU0FBUztvQkFDWFYsU0FBU08sVUFBVVAsU0FBU08sUUFBUVUsUUFDbENSLE1BQ0EsQ0FBQyxFQUFFTyx3QkFBd0IsQ0FBQyxFQUFFSCxJQUFJLENBQUMsQ0FBQztnQkFFeEMsT0FBTztvQkFDTGIsU0FBU08sVUFBVVAsU0FBU08sUUFBUVUsUUFDbENSLE1BQ0EsQ0FBQyxFQUFFTyx3QkFBd0IsQ0FBQyxFQUFFSCxJQUFJLENBQUMsQ0FBQztnQkFFeEM7WUFDRjtRQUNGO1FBRUEsT0FBT2Y7SUFDVCxFQUFFLE9BQU9vQixPQUFPO1FBQ2RDLFFBQVFELE1BQU0sNkNBQTZDQTtRQUMzRCxPQUFPcEI7SUFDVDtBQUNGLEVBQUU7QUFFSyxNQUFNc0IsbUNBQW1DLENBQUN0QjtJQUMvQyxJQUFJO1FBQ0ZBLFVBQVVDLFFBQVEsQ0FBQ0M7WUFDakIsTUFBTUMsVUFBVSxJQUFJQyxJQUFJRixTQUFTRyxTQUFTQyxXQUFXQztZQUNyRCxNQUFNZ0IsU0FDSnJCLFNBQVNPLFFBQVFDLE1BQ2YsNERBQ0csRUFBRTtZQUVUYSxPQUFPdEIsUUFBUSxDQUFDdUI7Z0JBQ2QsSUFBSUMsV0FBV0QsTUFBTWQsTUFBTSxjQUFjLENBQUMsRUFBRTtnQkFDNUMsSUFBSWdCLFVBQVVGLE1BQU1kLE1BQU0sWUFBWSxDQUFDLEVBQUU7Z0JBRXpDLElBQUksQ0FBQ2UsU0FBU1osV0FBVyxlQUFlO29CQUN0QyxJQUFJLENBQUNZLFNBQVNaLFdBQVcsU0FBUzt3QkFDaEMsSUFBSVksU0FBU1osV0FBVyxNQUFNOzRCQUM1QlksV0FBV0EsU0FBU1QsVUFBVTt3QkFDaEM7d0JBQ0FTLFdBQVcsSUFBSXJCLElBQUlxQixVQUFVdEIsU0FBU2M7b0JBQ3hDO2dCQUNGO2dCQUVBZixTQUFTTyxVQUFVUCxTQUFTTyxRQUFRVSxRQUNsQ0ssT0FDQSxDQUFDLEVBQUUsRUFBRUUsUUFBUSxFQUFFLEVBQUVELFNBQVMsQ0FBQyxDQUFDO1lBRWhDO1FBQ0Y7UUFFQSxPQUFPekI7SUFDVCxFQUFFLE9BQU9vQixPQUFPO1FBQ2RDLFFBQVFELE1BQU0saURBQWlEQTtRQUMvRCxPQUFPcEI7SUFDVDtBQUNGLEVBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9maXJlY3Jhd2wtc2NyYXBlci1qcy8uL3NyYy9zY3JhcGVyL1dlYlNjcmFwZXIvdXRpbHMvcmVwbGFjZVBhdGhzLnRzPzJlMTciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRG9jdW1lbnQgfSBmcm9tIFwiLi4vLi4vLi4vbGliL2VudGl0aWVzXCI7XG5cbmV4cG9ydCBjb25zdCByZXBsYWNlUGF0aHNXaXRoQWJzb2x1dGVQYXRocyA9IChkb2N1bWVudHM6IERvY3VtZW50W10pOiBEb2N1bWVudFtdID0+IHtcbiAgdHJ5IHtcbiAgICBkb2N1bWVudHMuZm9yRWFjaCgoZG9jdW1lbnQpID0+IHtcbiAgICAgIGNvbnN0IGJhc2VVcmwgPSBuZXcgVVJMKGRvY3VtZW50Lm1ldGFkYXRhLnNvdXJjZVVSTCkub3JpZ2luO1xuICAgICAgY29uc3QgcGF0aHMgPVxuICAgICAgICBkb2N1bWVudC5jb250ZW50Lm1hdGNoKFxuICAgICAgICAgIC8oIT9cXFsuKj9cXF0pXFwoKCg/OlteKCldK3xcXCgoPzpbXigpXSt8XFwoW14oKV0qXFwpKSpcXCkpKilcXCl8aHJlZj1cIihbXlwiXSspXCIvZ1xuICAgICAgICApIHx8IFtdO1xuXG4gICAgICBwYXRocy5mb3JFYWNoKChwYXRoOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgaXNJbWFnZSA9IHBhdGguc3RhcnRzV2l0aChcIiFcIik7XG4gICAgICAgIGxldCBtYXRjaGVkVXJsID0gcGF0aC5tYXRjaCgvXFwoKFteKV0rKVxcKS8pIHx8IHBhdGgubWF0Y2goL2hyZWY9XCIoW15cIl0rKVwiLyk7XG4gICAgICAgIGxldCB1cmwgPSBtYXRjaGVkVXJsWzFdO1xuXG4gICAgICAgIGlmICghdXJsLnN0YXJ0c1dpdGgoXCJkYXRhOlwiKSAmJiAhdXJsLnN0YXJ0c1dpdGgoXCJodHRwXCIpKSB7XG4gICAgICAgICAgaWYgKHVybC5zdGFydHNXaXRoKFwiL1wiKSkge1xuICAgICAgICAgICAgdXJsID0gdXJsLnN1YnN0cmluZygxKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdXJsID0gbmV3IFVSTCh1cmwsIGJhc2VVcmwpLnRvU3RyaW5nKCk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtYXJrZG93bkxpbmtPckltYWdlVGV4dCA9IHBhdGgubWF0Y2goLyghP1xcWy4qP1xcXSkvKVswXTtcbiAgICAgICAgaWYgKGlzSW1hZ2UpIHtcbiAgICAgICAgICBkb2N1bWVudC5jb250ZW50ID0gZG9jdW1lbnQuY29udGVudC5yZXBsYWNlKFxuICAgICAgICAgICAgcGF0aCxcbiAgICAgICAgICAgIGAke21hcmtkb3duTGlua09ySW1hZ2VUZXh0fSgke3VybH0pYFxuICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZG9jdW1lbnQuY29udGVudCA9IGRvY3VtZW50LmNvbnRlbnQucmVwbGFjZShcbiAgICAgICAgICAgIHBhdGgsXG4gICAgICAgICAgICBgJHttYXJrZG93bkxpbmtPckltYWdlVGV4dH0oJHt1cmx9KWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiBkb2N1bWVudHM7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJlcGxhY2luZyBwYXRocyB3aXRoIGFic29sdXRlIHBhdGhzXCIsIGVycm9yKTtcbiAgICByZXR1cm4gZG9jdW1lbnRzO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgcmVwbGFjZUltZ1BhdGhzV2l0aEFic29sdXRlUGF0aHMgPSAoZG9jdW1lbnRzOiBEb2N1bWVudFtdKTogRG9jdW1lbnRbXSA9PiB7XG4gIHRyeSB7XG4gICAgZG9jdW1lbnRzLmZvckVhY2goKGRvY3VtZW50KSA9PiB7XG4gICAgICBjb25zdCBiYXNlVXJsID0gbmV3IFVSTChkb2N1bWVudC5tZXRhZGF0YS5zb3VyY2VVUkwpLm9yaWdpbjtcbiAgICAgIGNvbnN0IGltYWdlcyA9XG4gICAgICAgIGRvY3VtZW50LmNvbnRlbnQubWF0Y2goXG4gICAgICAgICAgLyFcXFsuKj9cXF1cXCgoKD86W14oKV0rfFxcKCg/OlteKCldK3xcXChbXigpXSpcXCkpKlxcKSkqKVxcKS9nXG4gICAgICAgICkgfHwgW107XG5cbiAgICAgIGltYWdlcy5mb3JFYWNoKChpbWFnZTogc3RyaW5nKSA9PiB7XG4gICAgICAgIGxldCBpbWFnZVVybCA9IGltYWdlLm1hdGNoKC9cXCgoW14pXSspXFwpLylbMV07XG4gICAgICAgIGxldCBhbHRUZXh0ID0gaW1hZ2UubWF0Y2goL1xcWyguKj8pXFxdLylbMV07XG5cbiAgICAgICAgaWYgKCFpbWFnZVVybC5zdGFydHNXaXRoKFwiZGF0YTppbWFnZVwiKSkge1xuICAgICAgICAgIGlmICghaW1hZ2VVcmwuc3RhcnRzV2l0aChcImh0dHBcIikpIHtcbiAgICAgICAgICAgIGlmIChpbWFnZVVybC5zdGFydHNXaXRoKFwiL1wiKSkge1xuICAgICAgICAgICAgICBpbWFnZVVybCA9IGltYWdlVXJsLnN1YnN0cmluZygxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGltYWdlVXJsID0gbmV3IFVSTChpbWFnZVVybCwgYmFzZVVybCkudG9TdHJpbmcoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBkb2N1bWVudC5jb250ZW50ID0gZG9jdW1lbnQuY29udGVudC5yZXBsYWNlKFxuICAgICAgICAgIGltYWdlLFxuICAgICAgICAgIGAhWyR7YWx0VGV4dH1dKCR7aW1hZ2VVcmx9KWBcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGRvY3VtZW50cztcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVwbGFjaW5nIGltZyBwYXRocyB3aXRoIGFic29sdXRlIHBhdGhzXCIsIGVycm9yKTtcbiAgICByZXR1cm4gZG9jdW1lbnRzO1xuICB9XG59OyJdLCJuYW1lcyI6WyJyZXBsYWNlUGF0aHNXaXRoQWJzb2x1dGVQYXRocyIsImRvY3VtZW50cyIsImZvckVhY2giLCJkb2N1bWVudCIsImJhc2VVcmwiLCJVUkwiLCJtZXRhZGF0YSIsInNvdXJjZVVSTCIsIm9yaWdpbiIsInBhdGhzIiwiY29udGVudCIsIm1hdGNoIiwicGF0aCIsImlzSW1hZ2UiLCJzdGFydHNXaXRoIiwibWF0Y2hlZFVybCIsInVybCIsInN1YnN0cmluZyIsInRvU3RyaW5nIiwibWFya2Rvd25MaW5rT3JJbWFnZVRleHQiLCJyZXBsYWNlIiwiZXJyb3IiLCJjb25zb2xlIiwicmVwbGFjZUltZ1BhdGhzV2l0aEFic29sdXRlUGF0aHMiLCJpbWFnZXMiLCJpbWFnZSIsImltYWdlVXJsIiwiYWx0VGV4dCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/scraper/WebScraper/utils/replacePaths.ts\n");

/***/ }),

/***/ "(api)/./src/services/billing/credit_billing.ts":
/*!************************************************!*\
  !*** ./src/services/billing/credit_billing.ts ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   billTeam: () => (/* binding */ billTeam),\n/* harmony export */   checkTeamCredits: () => (/* binding */ checkTeamCredits),\n/* harmony export */   countCreditsAndRemainingForCurrentBillingPeriod: () => (/* binding */ countCreditsAndRemainingForCurrentBillingPeriod),\n/* harmony export */   supaBillTeam: () => (/* binding */ supaBillTeam),\n/* harmony export */   supaCheckTeamCredits: () => (/* binding */ supaCheckTeamCredits)\n/* harmony export */ });\n/* harmony import */ var _lib_withAuth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../lib/withAuth */ \"(api)/./src/lib/withAuth.ts\");\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../supabase */ \"(api)/./src/services/supabase.ts\");\n\n\nconst FREE_CREDITS = 300;\nasync function billTeam(team_id, credits) {\n    return (0,_lib_withAuth__WEBPACK_IMPORTED_MODULE_0__.withAuth)(supaBillTeam)(team_id, credits);\n}\nasync function supaBillTeam(team_id, credits) {\n    if (team_id === \"preview\") {\n        return {\n            success: true,\n            message: \"Preview team, no credits used\"\n        };\n    }\n    console.log(`Billing team ${team_id} for ${credits} credits`);\n    //   When the API is used, you can log the credit usage in the credit_usage table:\n    // team_id: The ID of the team using the API.\n    // subscription_id: The ID of the team's active subscription.\n    // credits_used: The number of credits consumed by the API call.\n    // created_at: The timestamp of the API usage.\n    // 1. get the subscription\n    const { data: subscription } = await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"subscriptions\").select(\"*\").eq(\"team_id\", team_id).eq(\"status\", \"active\").single();\n    // 2. Check for available coupons\n    const { data: coupons } = await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"coupons\").select(\"id, credits\").eq(\"team_id\", team_id).eq(\"status\", \"active\");\n    let couponCredits = 0;\n    if (coupons && coupons.length > 0) {\n        couponCredits = coupons.reduce((total, coupon)=>total + coupon.credits, 0);\n    }\n    let sortedCoupons = coupons.sort((a, b)=>b.credits - a.credits);\n    // using coupon credits:\n    if (couponCredits > 0) {\n        // if there is no subscription and they have enough coupon credits\n        if (!subscription) {\n            // using only coupon credits:\n            // if there are enough coupon credits\n            if (couponCredits >= credits) {\n                // remove credits from coupon credits\n                let usedCredits = credits;\n                while(usedCredits > 0){\n                    // update coupons\n                    if (sortedCoupons[0].credits < usedCredits) {\n                        usedCredits = usedCredits - sortedCoupons[0].credits;\n                        // update coupon credits\n                        await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"coupons\").update({\n                            credits: 0\n                        }).eq(\"id\", sortedCoupons[0].id);\n                        sortedCoupons.shift();\n                    } else {\n                        // update coupon credits\n                        await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"coupons\").update({\n                            credits: sortedCoupons[0].credits - usedCredits\n                        }).eq(\"id\", sortedCoupons[0].id);\n                        usedCredits = 0;\n                    }\n                }\n                return await createCreditUsage({\n                    team_id,\n                    credits: 0\n                });\n            // not enough coupon credits and no subscription\n            } else {\n                // update coupon credits\n                const usedCredits = credits - couponCredits;\n                for(let i = 0; i < sortedCoupons.length; i++){\n                    await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"coupons\").update({\n                        credits: 0\n                    }).eq(\"id\", sortedCoupons[i].id);\n                }\n                return await createCreditUsage({\n                    team_id,\n                    credits: usedCredits\n                });\n            }\n        }\n        // with subscription\n        // using coupon + subscription credits:\n        if (credits > couponCredits) {\n            // update coupon credits\n            for(let i = 0; i < sortedCoupons.length; i++){\n                await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"coupons\").update({\n                    credits: 0\n                }).eq(\"id\", sortedCoupons[i].id);\n            }\n            const usedCredits = credits - couponCredits;\n            return await createCreditUsage({\n                team_id,\n                subscription_id: subscription.id,\n                credits: usedCredits\n            });\n        } else {\n            let usedCredits = credits;\n            while(usedCredits > 0){\n                // update coupons\n                if (sortedCoupons[0].credits < usedCredits) {\n                    usedCredits = usedCredits - sortedCoupons[0].credits;\n                    // update coupon credits\n                    await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"coupons\").update({\n                        credits: 0\n                    }).eq(\"id\", sortedCoupons[0].id);\n                    sortedCoupons.shift();\n                } else {\n                    // update coupon credits\n                    await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"coupons\").update({\n                        credits: sortedCoupons[0].credits - usedCredits\n                    }).eq(\"id\", sortedCoupons[0].id);\n                    usedCredits = 0;\n                }\n            }\n            return await createCreditUsage({\n                team_id,\n                subscription_id: subscription.id,\n                credits: 0\n            });\n        }\n    }\n    // not using coupon credits\n    if (!subscription) {\n        return await createCreditUsage({\n            team_id,\n            credits\n        });\n    }\n    return await createCreditUsage({\n        team_id,\n        subscription_id: subscription.id,\n        credits\n    });\n}\nasync function checkTeamCredits(team_id, credits) {\n    return (0,_lib_withAuth__WEBPACK_IMPORTED_MODULE_0__.withAuth)(supaCheckTeamCredits)(team_id, credits);\n}\n// if team has enough credits for the operation, return true, else return false\nasync function supaCheckTeamCredits(team_id, credits) {\n    if (team_id === \"preview\") {\n        return {\n            success: true,\n            message: \"Preview team, no credits used\"\n        };\n    }\n    // Retrieve the team's active subscription\n    const { data: subscription, error: subscriptionError } = await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"subscriptions\").select(\"id, price_id, current_period_start, current_period_end\").eq(\"team_id\", team_id).eq(\"status\", \"active\").single();\n    // Check for available coupons\n    const { data: coupons } = await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"coupons\").select(\"credits\").eq(\"team_id\", team_id).eq(\"status\", \"active\");\n    let couponCredits = 0;\n    if (coupons && coupons.length > 0) {\n        couponCredits = coupons.reduce((total, coupon)=>total + coupon.credits, 0);\n    }\n    // Free credits, no coupons\n    if (subscriptionError || !subscription) {\n        // If there is no active subscription but there are available coupons\n        if (couponCredits >= credits) {\n            return {\n                success: true,\n                message: \"Sufficient credits available\"\n            };\n        }\n        const { data: creditUsages, error: creditUsageError } = await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"credit_usage\").select(\"credits_used\").is(\"subscription_id\", null).eq(\"team_id\", team_id);\n        // .gte(\"created_at\", subscription.current_period_start)\n        // .lte(\"created_at\", subscription.current_period_end);\n        if (creditUsageError) {\n            throw new Error(`Failed to retrieve credit usage for subscription_id: ${subscription.id}`);\n        }\n        const totalCreditsUsed = creditUsages.reduce((acc, usage)=>acc + usage.credits_used, 0);\n        console.log(\"totalCreditsUsed\", totalCreditsUsed);\n        // 5. Compare the total credits used with the credits allowed by the plan.\n        if (totalCreditsUsed + credits > FREE_CREDITS) {\n            return {\n                success: false,\n                message: \"Insufficient credits, please upgrade!\"\n            };\n        }\n        return {\n            success: true,\n            message: \"Sufficient credits available\"\n        };\n    }\n    // Calculate the total credits used by the team within the current billing period\n    const { data: creditUsages, error: creditUsageError } = await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"credit_usage\").select(\"credits_used\").eq(\"subscription_id\", subscription.id).gte(\"created_at\", subscription.current_period_start).lte(\"created_at\", subscription.current_period_end);\n    if (creditUsageError) {\n        throw new Error(`Failed to retrieve credit usage for subscription_id: ${subscription.id}`);\n    }\n    const totalCreditsUsed = creditUsages.reduce((acc, usage)=>acc + usage.credits_used, 0);\n    // Adjust total credits used by subtracting coupon value\n    const adjustedCreditsUsed = Math.max(0, totalCreditsUsed - couponCredits);\n    // Get the price details\n    const { data: price, error: priceError } = await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"prices\").select(\"credits\").eq(\"id\", subscription.price_id).single();\n    if (priceError) {\n        throw new Error(`Failed to retrieve price for price_id: ${subscription.price_id}`);\n    }\n    // Compare the adjusted total credits used with the credits allowed by the plan\n    if (adjustedCreditsUsed + credits > price.credits) {\n        return {\n            success: false,\n            message: \"Insufficient credits, please upgrade!\"\n        };\n    }\n    return {\n        success: true,\n        message: \"Sufficient credits available\"\n    };\n}\n// Count the total credits used by a team within the current billing period and return the remaining credits.\nasync function countCreditsAndRemainingForCurrentBillingPeriod(team_id) {\n    // 1. Retrieve the team's active subscription based on the team_id.\n    const { data: subscription, error: subscriptionError } = await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"subscriptions\").select(\"id, price_id, current_period_start, current_period_end\").eq(\"team_id\", team_id).single();\n    const { data: coupons } = await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"coupons\").select(\"credits\").eq(\"team_id\", team_id).eq(\"status\", \"active\");\n    let couponCredits = 0;\n    if (coupons && coupons.length > 0) {\n        couponCredits = coupons.reduce((total, coupon)=>total + coupon.credits, 0);\n    }\n    if (subscriptionError || !subscription) {\n        // Free\n        const { data: creditUsages, error: creditUsageError } = await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"credit_usage\").select(\"credits_used\").is(\"subscription_id\", null).eq(\"team_id\", team_id);\n        if (creditUsageError || !creditUsages) {\n            throw new Error(`Failed to retrieve credit usage for team_id: ${team_id}`);\n        }\n        const totalCreditsUsed = creditUsages.reduce((acc, usage)=>acc + usage.credits_used, 0);\n        const remainingCredits = FREE_CREDITS + couponCredits - totalCreditsUsed;\n        return {\n            totalCreditsUsed: totalCreditsUsed,\n            remainingCredits,\n            totalCredits: FREE_CREDITS + couponCredits\n        };\n    }\n    const { data: creditUsages, error: creditUsageError } = await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"credit_usage\").select(\"credits_used\").eq(\"subscription_id\", subscription.id).gte(\"created_at\", subscription.current_period_start).lte(\"created_at\", subscription.current_period_end);\n    if (creditUsageError || !creditUsages) {\n        throw new Error(`Failed to retrieve credit usage for subscription_id: ${subscription.id}`);\n    }\n    const totalCreditsUsed = creditUsages.reduce((acc, usage)=>acc + usage.credits_used, 0);\n    const { data: price, error: priceError } = await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"prices\").select(\"credits\").eq(\"id\", subscription.price_id).single();\n    if (priceError || !price) {\n        throw new Error(`Failed to retrieve price for price_id: ${subscription.price_id}`);\n    }\n    const remainingCredits = price.credits + couponCredits - totalCreditsUsed;\n    return {\n        totalCreditsUsed,\n        remainingCredits,\n        totalCredits: price.credits\n    };\n}\nasync function createCreditUsage({ team_id, subscription_id, credits }) {\n    const { data: credit_usage } = await _supabase__WEBPACK_IMPORTED_MODULE_1__.supabase_service.from(\"credit_usage\").insert([\n        {\n            team_id,\n            credits_used: credits,\n            subscription_id: subscription_id || null,\n            created_at: new Date()\n        }\n    ]).select();\n    return {\n        success: true,\n        credit_usage\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2VydmljZXMvYmlsbGluZy9jcmVkaXRfYmlsbGluZy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQThDO0FBQ0M7QUFFL0MsTUFBTUUsZUFBZTtBQUVkLGVBQWVDLFNBQVNDLE9BQWUsRUFBRUMsT0FBZTtJQUM3RCxPQUFPTCx1REFBUUEsQ0FBQ00sY0FBY0YsU0FBU0M7QUFDekM7QUFDTyxlQUFlQyxhQUFhRixPQUFlLEVBQUVDLE9BQWU7SUFDakUsSUFBSUQsWUFBWSxXQUFXO1FBQ3pCLE9BQU87WUFBRUcsU0FBUztZQUFNQyxTQUFTO1FBQWdDO0lBQ25FO0lBQ0FDLFFBQVFDLElBQUksQ0FBQyxhQUFhLEVBQUVOLFFBQVEsS0FBSyxFQUFFQyxRQUFRLFFBQVEsQ0FBQztJQUM1RCxrRkFBa0Y7SUFDbEYsNkNBQTZDO0lBQzdDLDZEQUE2RDtJQUM3RCxnRUFBZ0U7SUFDaEUsOENBQThDO0lBRTlDLDBCQUEwQjtJQUMxQixNQUFNLEVBQUVNLE1BQU1DLFlBQVksRUFBRSxHQUFHLE1BQU1YLHVEQUFnQkEsQ0FDbERZLEtBQUssaUJBQ0xDLE9BQU8sS0FDUEMsR0FBRyxXQUFXWCxTQUNkVyxHQUFHLFVBQVUsVUFDYkM7SUFFSCxpQ0FBaUM7SUFDakMsTUFBTSxFQUFFTCxNQUFNTSxPQUFPLEVBQUUsR0FBRyxNQUFNaEIsdURBQWdCQSxDQUM3Q1ksS0FBSyxXQUNMQyxPQUFPLGVBQ1BDLEdBQUcsV0FBV1gsU0FDZFcsR0FBRyxVQUFVO0lBRWhCLElBQUlHLGdCQUFnQjtJQUNwQixJQUFJRCxXQUFXQSxRQUFRRSxTQUFTLEdBQUc7UUFDakNELGdCQUFnQkQsUUFBUUcsT0FBTyxDQUFDQyxPQUFPQyxTQUFXRCxRQUFRQyxPQUFPakIsU0FBUztJQUM1RTtJQUVBLElBQUlrQixnQkFBZ0JOLFFBQVFPLEtBQUssQ0FBQ0MsR0FBR0MsSUFBTUEsRUFBRXJCLFVBQVVvQixFQUFFcEI7SUFDekQsd0JBQXdCO0lBQ3hCLElBQUlhLGdCQUFnQixHQUFH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QUFFM0IsT0FBTyxFQUFFNkIsZUFBZSxFQUFFNUIsT0FBTyxFQUFrRTtJQUNwSSxNQUFNLEVBQUVNLE1BQU1nRCxZQUFZLEVBQUUsR0FBRyxNQUFNMUQsdURBQWdCQSxDQUNsRFksS0FBSyxnQkFDTCtDLE9BQU87UUFDTjtZQUNFeEQ7WUFDQXlDLGNBQWN4QztZQUNkNEIsaUJBQWlCQSxtQkFBbUI7WUFDcEM0QixZQUFZLElBQUlDO1FBQ2xCO0tBQ0QsRUFDQWhEO0lBRUgsT0FBTztRQUFFUCxTQUFTO1FBQU1vRDtJQUFhO0FBQ3ZDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmlyZWNyYXdsLXNjcmFwZXItanMvLi9zcmMvc2VydmljZXMvYmlsbGluZy9jcmVkaXRfYmlsbGluZy50cz83YmYwIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHdpdGhBdXRoIH0gZnJvbSBcIi4uLy4uL2xpYi93aXRoQXV0aFwiO1xuaW1wb3J0IHsgc3VwYWJhc2Vfc2VydmljZSB9IGZyb20gXCIuLi9zdXBhYmFzZVwiO1xuXG5jb25zdCBGUkVFX0NSRURJVFMgPSAzMDA7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBiaWxsVGVhbSh0ZWFtX2lkOiBzdHJpbmcsIGNyZWRpdHM6IG51bWJlcikge1xuICByZXR1cm4gd2l0aEF1dGgoc3VwYUJpbGxUZWFtKSh0ZWFtX2lkLCBjcmVkaXRzKTtcbn1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzdXBhQmlsbFRlYW0odGVhbV9pZDogc3RyaW5nLCBjcmVkaXRzOiBudW1iZXIpIHtcbiAgaWYgKHRlYW1faWQgPT09IFwicHJldmlld1wiKSB7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogXCJQcmV2aWV3IHRlYW0sIG5vIGNyZWRpdHMgdXNlZFwiIH07XG4gIH1cbiAgY29uc29sZS5sb2coYEJpbGxpbmcgdGVhbSAke3RlYW1faWR9IGZvciAke2NyZWRpdHN9IGNyZWRpdHNgKTtcbiAgLy8gICBXaGVuIHRoZSBBUEkgaXMgdXNlZCwgeW91IGNhbiBsb2cgdGhlIGNyZWRpdCB1c2FnZSBpbiB0aGUgY3JlZGl0X3VzYWdlIHRhYmxlOlxuICAvLyB0ZWFtX2lkOiBUaGUgSUQgb2YgdGhlIHRlYW0gdXNpbmcgdGhlIEFQSS5cbiAgLy8gc3Vic2NyaXB0aW9uX2lkOiBUaGUgSUQgb2YgdGhlIHRlYW0ncyBhY3RpdmUgc3Vic2NyaXB0aW9uLlxuICAvLyBjcmVkaXRzX3VzZWQ6IFRoZSBudW1iZXIgb2YgY3JlZGl0cyBjb25zdW1lZCBieSB0aGUgQVBJIGNhbGwuXG4gIC8vIGNyZWF0ZWRfYXQ6IFRoZSB0aW1lc3RhbXAgb2YgdGhlIEFQSSB1c2FnZS5cblxuICAvLyAxLiBnZXQgdGhlIHN1YnNjcmlwdGlvblxuICBjb25zdCB7IGRhdGE6IHN1YnNjcmlwdGlvbiB9ID0gYXdhaXQgc3VwYWJhc2Vfc2VydmljZVxuICAgIC5mcm9tKFwic3Vic2NyaXB0aW9uc1wiKVxuICAgIC5zZWxlY3QoXCIqXCIpXG4gICAgLmVxKFwidGVhbV9pZFwiLCB0ZWFtX2lkKVxuICAgIC5lcShcInN0YXR1c1wiLCBcImFjdGl2ZVwiKVxuICAgIC5zaW5nbGUoKTtcblxuICAvLyAyLiBDaGVjayBmb3IgYXZhaWxhYmxlIGNvdXBvbnNcbiAgY29uc3QgeyBkYXRhOiBjb3Vwb25zIH0gPSBhd2FpdCBzdXBhYmFzZV9zZXJ2aWNlXG4gICAgLmZyb20oXCJjb3Vwb25zXCIpXG4gICAgLnNlbGVjdChcImlkLCBjcmVkaXRzXCIpXG4gICAgLmVxKFwidGVhbV9pZFwiLCB0ZWFtX2lkKVxuICAgIC5lcShcInN0YXR1c1wiLCBcImFjdGl2ZVwiKTtcblxuICBsZXQgY291cG9uQ3JlZGl0cyA9IDA7XG4gIGlmIChjb3Vwb25zICYmIGNvdXBvbnMubGVuZ3RoID4gMCkge1xuICAgIGNvdXBvbkNyZWRpdHMgPSBjb3Vwb25zLnJlZHVjZSgodG90YWwsIGNvdXBvbikgPT4gdG90YWwgKyBjb3Vwb24uY3JlZGl0cywgMCk7XG4gIH1cblxuICBsZXQgc29ydGVkQ291cG9ucyA9IGNvdXBvbnMuc29ydCgoYSwgYikgPT4gYi5jcmVkaXRzIC0gYS5jcmVkaXRzKTtcbiAgLy8gdXNpbmcgY291cG9uIGNyZWRpdHM6XG4gIGlmIChjb3Vwb25DcmVkaXRzID4gMCkge1xuICAgIC8vIGlmIHRoZXJlIGlzIG5vIHN1YnNjcmlwdGlvbiBhbmQgdGhleSBoYXZlIGVub3VnaCBjb3Vwb24gY3JlZGl0c1xuICAgIGlmICghc3Vic2NyaXB0aW9uKSB7XG4gICAgICAvLyB1c2luZyBvbmx5IGNvdXBvbiBjcmVkaXRzOlxuICAgICAgLy8gaWYgdGhlcmUgYXJlIGVub3VnaCBjb3Vwb24gY3JlZGl0c1xuICAgICAgaWYgKGNvdXBvbkNyZWRpdHMgPj0gY3JlZGl0cykge1xuICAgICAgICAvLyByZW1vdmUgY3JlZGl0cyBmcm9tIGNvdXBvbiBjcmVkaXRzXG4gICAgICAgIGxldCB1c2VkQ3JlZGl0cyA9IGNyZWRpdHM7XG4gICAgICAgIHdoaWxlICh1c2VkQ3JlZGl0cyA+IDApIHtcbiAgICAgICAgICAvLyB1cGRhdGUgY291cG9uc1xuICAgICAgICAgIGlmIChzb3J0ZWRDb3Vwb25zWzBdLmNyZWRpdHMgPCB1c2VkQ3JlZGl0cykge1xuICAgICAgICAgICAgdXNlZENyZWRpdHMgPSB1c2VkQ3JlZGl0cyAtIHNvcnRlZENvdXBvbnNbMF0uY3JlZGl0cztcbiAgICAgICAgICAgIC8vIHVwZGF0ZSBjb3Vwb24gY3JlZGl0c1xuICAgICAgICAgICAgYXdhaXQgc3VwYWJhc2Vfc2VydmljZVxuICAgICAgICAgICAgLmZyb20oXCJjb3Vwb25zXCIpXG4gICAgICAgICAgICAudXBkYXRlKHtcbiAgICAgICAgICAgICAgY3JlZGl0czogMFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5lcShcImlkXCIsIHNvcnRlZENvdXBvbnNbMF0uaWQpO1xuICAgICAgICAgICAgc29ydGVkQ291cG9ucy5zaGlmdCgpO1xuXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIHVwZGF0ZSBjb3Vwb24gY3JlZGl0c1xuICAgICAgICAgICAgYXdhaXQgc3VwYWJhc2Vfc2VydmljZVxuICAgICAgICAgICAgLmZyb20oXCJjb3Vwb25zXCIpXG4gICAgICAgICAgICAudXBkYXRlKHtcbiAgICAgICAgICAgICAgY3JlZGl0czogc29ydGVkQ291cG9uc1swXS5jcmVkaXRzIC0gdXNlZENyZWRpdHNcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZXEoXCJpZFwiLCBzb3J0ZWRDb3Vwb25zWzBdLmlkKTtcbiAgICAgICAgICAgIHVzZWRDcmVkaXRzID0gMDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXdhaXQgY3JlYXRlQ3JlZGl0VXNhZ2UoeyB0ZWFtX2lkLCBjcmVkaXRzOiAwIH0pO1xuXG4gICAgICAvLyBub3QgZW5vdWdoIGNvdXBvbiBjcmVkaXRzIGFuZCBubyBzdWJzY3JpcHRpb25cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIHVwZGF0ZSBjb3Vwb24gY3JlZGl0c1xuICAgICAgICBjb25zdCB1c2VkQ3JlZGl0cyA9IGNyZWRpdHMgLSBjb3Vwb25DcmVkaXRzO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHNvcnRlZENvdXBvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBhd2FpdCBzdXBhYmFzZV9zZXJ2aWNlXG4gICAgICAgICAgICAuZnJvbShcImNvdXBvbnNcIilcbiAgICAgICAgICAgIC51cGRhdGUoe1xuICAgICAgICAgICAgICBjcmVkaXRzOiAwXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmVxKFwiaWRcIiwgc29ydGVkQ291cG9uc1tpXS5pZCk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYXdhaXQgY3JlYXRlQ3JlZGl0VXNhZ2UoeyB0ZWFtX2lkLCBjcmVkaXRzOiB1c2VkQ3JlZGl0cyB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gd2l0aCBzdWJzY3JpcHRpb25cbiAgICAvLyB1c2luZyBjb3Vwb24gKyBzdWJzY3JpcHRpb24gY3JlZGl0czpcbiAgICBpZiAoY3JlZGl0cyA+IGNvdXBvbkNyZWRpdHMpIHtcbiAgICAgIC8vIHVwZGF0ZSBjb3Vwb24gY3JlZGl0c1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzb3J0ZWRDb3Vwb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGF3YWl0IHN1cGFiYXNlX3NlcnZpY2VcbiAgICAgICAgICAuZnJvbShcImNvdXBvbnNcIilcbiAgICAgICAgICAudXBkYXRlKHtcbiAgICAgICAgICAgIGNyZWRpdHM6IDBcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5lcShcImlkXCIsIHNvcnRlZENvdXBvbnNbaV0uaWQpO1xuICAgICAgfVxuICAgICAgY29uc3QgdXNlZENyZWRpdHMgPSBjcmVkaXRzIC0gY291cG9uQ3JlZGl0cztcbiAgICAgIHJldHVybiBhd2FpdCBjcmVhdGVDcmVkaXRVc2FnZSh7IHRlYW1faWQsIHN1YnNjcmlwdGlvbl9pZDogc3Vic2NyaXB0aW9uLmlkLCBjcmVkaXRzOiB1c2VkQ3JlZGl0cyB9KTtcblxuICAgIH0gZWxzZSB7IC8vIHVzaW5nIG9ubHkgY291cG9uIGNyZWRpdHNcbiAgICAgIGxldCB1c2VkQ3JlZGl0cyA9IGNyZWRpdHM7XG4gICAgICB3aGlsZSAodXNlZENyZWRpdHMgPiAwKSB7XG4gICAgICAgIC8vIHVwZGF0ZSBjb3Vwb25zXG4gICAgICAgIGlmIChzb3J0ZWRDb3Vwb25zWzBdLmNyZWRpdHMgPCB1c2VkQ3JlZGl0cykge1xuICAgICAgICAgIHVzZWRDcmVkaXRzID0gdXNlZENyZWRpdHMgLSBzb3J0ZWRDb3Vwb25zWzBdLmNyZWRpdHM7XG4gICAgICAgICAgLy8gdXBkYXRlIGNvdXBvbiBjcmVkaXRzXG4gICAgICAgICAgYXdhaXQgc3VwYWJhc2Vfc2VydmljZVxuICAgICAgICAgIC5mcm9tKFwiY291cG9uc1wiKVxuICAgICAgICAgIC51cGRhdGUoe1xuICAgICAgICAgICAgY3JlZGl0czogMFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmVxKFwiaWRcIiwgc29ydGVkQ291cG9uc1swXS5pZCk7XG4gICAgICAgICAgc29ydGVkQ291cG9ucy5zaGlmdCgpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gdXBkYXRlIGNvdXBvbiBjcmVkaXRzXG4gICAgICAgICAgYXdhaXQgc3VwYWJhc2Vfc2VydmljZVxuICAgICAgICAgIC5mcm9tKFwiY291cG9uc1wiKVxuICAgICAgICAgIC51cGRhdGUoe1xuICAgICAgICAgICAgY3JlZGl0czogc29ydGVkQ291cG9uc1swXS5jcmVkaXRzIC0gdXNlZENyZWRpdHNcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5lcShcImlkXCIsIHNvcnRlZENvdXBvbnNbMF0uaWQpO1xuICAgICAgICAgIHVzZWRDcmVkaXRzID0gMDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gYXdhaXQgY3JlYXRlQ3JlZGl0VXNhZ2UoeyB0ZWFtX2lkLCBzdWJzY3JpcHRpb25faWQ6IHN1YnNjcmlwdGlvbi5pZCwgY3JlZGl0czogMCB9KTtcbiAgICB9XG4gIH1cblxuICAvLyBub3QgdXNpbmcgY291cG9uIGNyZWRpdHNcbiAgaWYgKCFzdWJzY3JpcHRpb24pIHtcbiAgICByZXR1cm4gYXdhaXQgY3JlYXRlQ3JlZGl0VXNhZ2UoeyB0ZWFtX2lkLCBjcmVkaXRzIH0pO1xuICB9XG5cbiAgcmV0dXJuIGF3YWl0IGNyZWF0ZUNyZWRpdFVzYWdlKHsgdGVhbV9pZCwgc3Vic2NyaXB0aW9uX2lkOiBzdWJzY3JpcHRpb24uaWQsIGNyZWRpdHMgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjaGVja1RlYW1DcmVkaXRzKHRlYW1faWQ6IHN0cmluZywgY3JlZGl0czogbnVtYmVyKSB7XG4gIHJldHVybiB3aXRoQXV0aChzdXBhQ2hlY2tUZWFtQ3JlZGl0cykodGVhbV9pZCwgY3JlZGl0cyk7XG59XG4vLyBpZiB0ZWFtIGhhcyBlbm91Z2ggY3JlZGl0cyBmb3IgdGhlIG9wZXJhdGlvbiwgcmV0dXJuIHRydWUsIGVsc2UgcmV0dXJuIGZhbHNlXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc3VwYUNoZWNrVGVhbUNyZWRpdHModGVhbV9pZDogc3RyaW5nLCBjcmVkaXRzOiBudW1iZXIpIHtcbiAgaWYgKHRlYW1faWQgPT09IFwicHJldmlld1wiKSB7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogXCJQcmV2aWV3IHRlYW0sIG5vIGNyZWRpdHMgdXNlZFwiIH07XG4gIH1cblxuICAvLyBSZXRyaWV2ZSB0aGUgdGVhbSdzIGFjdGl2ZSBzdWJzY3JpcHRpb25cbiAgY29uc3QgeyBkYXRhOiBzdWJzY3JpcHRpb24sIGVycm9yOiBzdWJzY3JpcHRpb25FcnJvciB9ID0gYXdhaXQgc3VwYWJhc2Vfc2VydmljZVxuICAgIC5mcm9tKFwic3Vic2NyaXB0aW9uc1wiKVxuICAgIC5zZWxlY3QoXCJpZCwgcHJpY2VfaWQsIGN1cnJlbnRfcGVyaW9kX3N0YXJ0LCBjdXJyZW50X3BlcmlvZF9lbmRcIilcbiAgICAuZXEoXCJ0ZWFtX2lkXCIsIHRlYW1faWQpXG4gICAgLmVxKFwic3RhdHVzXCIsIFwiYWN0aXZlXCIpXG4gICAgLnNpbmdsZSgpO1xuXG4gIC8vIENoZWNrIGZvciBhdmFpbGFibGUgY291cG9uc1xuICBjb25zdCB7IGRhdGE6IGNvdXBvbnMgfSA9IGF3YWl0IHN1cGFiYXNlX3NlcnZpY2VcbiAgICAuZnJvbShcImNvdXBvbnNcIilcbiAgICAuc2VsZWN0KFwiY3JlZGl0c1wiKVxuICAgIC5lcShcInRlYW1faWRcIiwgdGVhbV9pZClcbiAgICAuZXEoXCJzdGF0dXNcIiwgXCJhY3RpdmVcIik7XG5cbiAgbGV0IGNvdXBvbkNyZWRpdHMgPSAwO1xuICBpZiAoY291cG9ucyAmJiBjb3Vwb25zLmxlbmd0aCA+IDApIHtcbiAgICBjb3Vwb25DcmVkaXRzID0gY291cG9ucy5yZWR1Y2UoKHRvdGFsLCBjb3Vwb24pID0+IHRvdGFsICsgY291cG9uLmNyZWRpdHMsIDApO1xuICB9XG5cbiAgLy8gRnJlZSBjcmVkaXRzLCBubyBjb3Vwb25zXG4gIGlmIChzdWJzY3JpcHRpb25FcnJvciB8fCAhc3Vic2NyaXB0aW9uKSB7XG4gICAgLy8gSWYgdGhlcmUgaXMgbm8gYWN0aXZlIHN1YnNjcmlwdGlvbiBidXQgdGhlcmUgYXJlIGF2YWlsYWJsZSBjb3Vwb25zXG4gICAgaWYgKGNvdXBvbkNyZWRpdHMgPj0gY3JlZGl0cykge1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogXCJTdWZmaWNpZW50IGNyZWRpdHMgYXZhaWxhYmxlXCIgfTtcbiAgICB9XG4gICAgICBcbiAgICBjb25zdCB7IGRhdGE6IGNyZWRpdFVzYWdlcywgZXJyb3I6IGNyZWRpdFVzYWdlRXJyb3IgfSA9XG4gICAgICBhd2FpdCBzdXBhYmFzZV9zZXJ2aWNlXG4gICAgICAgIC5mcm9tKFwiY3JlZGl0X3VzYWdlXCIpXG4gICAgICAgIC5zZWxlY3QoXCJjcmVkaXRzX3VzZWRcIilcbiAgICAgICAgLmlzKFwic3Vic2NyaXB0aW9uX2lkXCIsIG51bGwpXG4gICAgICAgIC5lcShcInRlYW1faWRcIiwgdGVhbV9pZCk7XG4gICAgLy8gLmd0ZShcImNyZWF0ZWRfYXRcIiwgc3Vic2NyaXB0aW9uLmN1cnJlbnRfcGVyaW9kX3N0YXJ0KVxuICAgIC8vIC5sdGUoXCJjcmVhdGVkX2F0XCIsIHN1YnNjcmlwdGlvbi5jdXJyZW50X3BlcmlvZF9lbmQpO1xuXG4gICAgaWYgKGNyZWRpdFVzYWdlRXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYEZhaWxlZCB0byByZXRyaWV2ZSBjcmVkaXQgdXNhZ2UgZm9yIHN1YnNjcmlwdGlvbl9pZDogJHtzdWJzY3JpcHRpb24uaWR9YFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCB0b3RhbENyZWRpdHNVc2VkID0gY3JlZGl0VXNhZ2VzLnJlZHVjZShcbiAgICAgIChhY2MsIHVzYWdlKSA9PiBhY2MgKyB1c2FnZS5jcmVkaXRzX3VzZWQsXG4gICAgICAwXG4gICAgKTtcblxuICAgIGNvbnNvbGUubG9nKFwidG90YWxDcmVkaXRzVXNlZFwiLCB0b3RhbENyZWRpdHNVc2VkKTtcbiAgICAvLyA1LiBDb21wYXJlIHRoZSB0b3RhbCBjcmVkaXRzIHVzZWQgd2l0aCB0aGUgY3JlZGl0cyBhbGxvd2VkIGJ5IHRoZSBwbGFuLlxuICAgIGlmICh0b3RhbENyZWRpdHNVc2VkICsgY3JlZGl0cyA+IEZSRUVfQ1JFRElUUykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IFwiSW5zdWZmaWNpZW50IGNyZWRpdHMsIHBsZWFzZSB1cGdyYWRlIVwiLFxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZTogXCJTdWZmaWNpZW50IGNyZWRpdHMgYXZhaWxhYmxlXCIgfTtcbiAgfVxuXG4gIC8vIENhbGN1bGF0ZSB0aGUgdG90YWwgY3JlZGl0cyB1c2VkIGJ5IHRoZSB0ZWFtIHdpdGhpbiB0aGUgY3VycmVudCBiaWxsaW5nIHBlcmlvZFxuICBjb25zdCB7IGRhdGE6IGNyZWRpdFVzYWdlcywgZXJyb3I6IGNyZWRpdFVzYWdlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlX3NlcnZpY2VcbiAgICAuZnJvbShcImNyZWRpdF91c2FnZVwiKVxuICAgIC5zZWxlY3QoXCJjcmVkaXRzX3VzZWRcIilcbiAgICAuZXEoXCJzdWJzY3JpcHRpb25faWRcIiwgc3Vic2NyaXB0aW9uLmlkKVxuICAgIC5ndGUoXCJjcmVhdGVkX2F0XCIsIHN1YnNjcmlwdGlvbi5jdXJyZW50X3BlcmlvZF9zdGFydClcbiAgICAubHRlKFwiY3JlYXRlZF9hdFwiLCBzdWJzY3JpcHRpb24uY3VycmVudF9wZXJpb2RfZW5kKTtcblxuICBpZiAoY3JlZGl0VXNhZ2VFcnJvcikge1xuICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHJldHJpZXZlIGNyZWRpdCB1c2FnZSBmb3Igc3Vic2NyaXB0aW9uX2lkOiAke3N1YnNjcmlwdGlvbi5pZH1gKTtcbiAgfVxuXG4gIGNvbnN0IHRvdGFsQ3JlZGl0c1VzZWQgPSBjcmVkaXRVc2FnZXMucmVkdWNlKChhY2MsIHVzYWdlKSA9PiBhY2MgKyB1c2FnZS5jcmVkaXRzX3VzZWQsIDApO1xuXG4gIC8vIEFkanVzdCB0b3RhbCBjcmVkaXRzIHVzZWQgYnkgc3VidHJhY3RpbmcgY291cG9uIHZhbHVlXG4gIGNvbnN0IGFkanVzdGVkQ3JlZGl0c1VzZWQgPSBNYXRoLm1heCgwLCB0b3RhbENyZWRpdHNVc2VkIC0gY291cG9uQ3JlZGl0cyk7XG5cbiAgLy8gR2V0IHRoZSBwcmljZSBkZXRhaWxzXG4gIGNvbnN0IHsgZGF0YTogcHJpY2UsIGVycm9yOiBwcmljZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZV9zZXJ2aWNlXG4gICAgLmZyb20oXCJwcmljZXNcIilcbiAgICAuc2VsZWN0KFwiY3JlZGl0c1wiKVxuICAgIC5lcShcImlkXCIsIHN1YnNjcmlwdGlvbi5wcmljZV9pZClcbiAgICAuc2luZ2xlKCk7XG5cbiAgaWYgKHByaWNlRXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byByZXRyaWV2ZSBwcmljZSBmb3IgcHJpY2VfaWQ6ICR7c3Vic2NyaXB0aW9uLnByaWNlX2lkfWApO1xuICB9XG5cbiAgLy8gQ29tcGFyZSB0aGUgYWRqdXN0ZWQgdG90YWwgY3JlZGl0cyB1c2VkIHdpdGggdGhlIGNyZWRpdHMgYWxsb3dlZCBieSB0aGUgcGxhblxuICBpZiAoYWRqdXN0ZWRDcmVkaXRzVXNlZCArIGNyZWRpdHMgPiBwcmljZS5jcmVkaXRzKSB7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiSW5zdWZmaWNpZW50IGNyZWRpdHMsIHBsZWFzZSB1cGdyYWRlIVwiIH07XG4gIH1cblxuICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlN1ZmZpY2llbnQgY3JlZGl0cyBhdmFpbGFibGVcIiB9O1xufVxuXG4vLyBDb3VudCB0aGUgdG90YWwgY3JlZGl0cyB1c2VkIGJ5IGEgdGVhbSB3aXRoaW4gdGhlIGN1cnJlbnQgYmlsbGluZyBwZXJpb2QgYW5kIHJldHVybiB0aGUgcmVtYWluaW5nIGNyZWRpdHMuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY291bnRDcmVkaXRzQW5kUmVtYWluaW5nRm9yQ3VycmVudEJpbGxpbmdQZXJpb2QoXG4gIHRlYW1faWQ6IHN0cmluZ1xuKSB7XG4gIC8vIDEuIFJldHJpZXZlIHRoZSB0ZWFtJ3MgYWN0aXZlIHN1YnNjcmlwdGlvbiBiYXNlZCBvbiB0aGUgdGVhbV9pZC5cbiAgY29uc3QgeyBkYXRhOiBzdWJzY3JpcHRpb24sIGVycm9yOiBzdWJzY3JpcHRpb25FcnJvciB9ID1cbiAgICBhd2FpdCBzdXBhYmFzZV9zZXJ2aWNlXG4gICAgICAuZnJvbShcInN1YnNjcmlwdGlvbnNcIilcbiAgICAgIC5zZWxlY3QoXCJpZCwgcHJpY2VfaWQsIGN1cnJlbnRfcGVyaW9kX3N0YXJ0LCBjdXJyZW50X3BlcmlvZF9lbmRcIilcbiAgICAgIC5lcShcInRlYW1faWRcIiwgdGVhbV9pZClcbiAgICAgIC5zaW5nbGUoKTtcblxuICBjb25zdCB7IGRhdGE6IGNvdXBvbnMgfSA9IGF3YWl0IHN1cGFiYXNlX3NlcnZpY2VcbiAgICAuZnJvbShcImNvdXBvbnNcIilcbiAgICAuc2VsZWN0KFwiY3JlZGl0c1wiKVxuICAgIC5lcShcInRlYW1faWRcIiwgdGVhbV9pZClcbiAgICAuZXEoXCJzdGF0dXNcIiwgXCJhY3RpdmVcIik7XG5cbiAgbGV0IGNvdXBvbkNyZWRpdHMgPSAwO1xuICBpZiAoY291cG9ucyAmJiBjb3Vwb25zLmxlbmd0aCA+IDApIHtcbiAgICBjb3Vwb25DcmVkaXRzID0gY291cG9ucy5yZWR1Y2UoKHRvdGFsLCBjb3Vwb24pID0+IHRvdGFsICsgY291cG9uLmNyZWRpdHMsIDApO1xuICB9XG5cbiAgaWYgKHN1YnNjcmlwdGlvbkVycm9yIHx8ICFzdWJzY3JpcHRpb24pIHtcbiAgICAvLyBGcmVlXG4gICAgY29uc3QgeyBkYXRhOiBjcmVkaXRVc2FnZXMsIGVycm9yOiBjcmVkaXRVc2FnZUVycm9yIH0gPVxuICAgICAgYXdhaXQgc3VwYWJhc2Vfc2VydmljZVxuICAgICAgICAuZnJvbShcImNyZWRpdF91c2FnZVwiKVxuICAgICAgICAuc2VsZWN0KFwiY3JlZGl0c191c2VkXCIpXG4gICAgICAgIC5pcyhcInN1YnNjcmlwdGlvbl9pZFwiLCBudWxsKVxuICAgICAgICAuZXEoXCJ0ZWFtX2lkXCIsIHRlYW1faWQpO1xuXG4gICAgaWYgKGNyZWRpdFVzYWdlRXJyb3IgfHwgIWNyZWRpdFVzYWdlcykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gcmV0cmlldmUgY3JlZGl0IHVzYWdlIGZvciB0ZWFtX2lkOiAke3RlYW1faWR9YCk7XG4gICAgfVxuXG4gICAgY29uc3QgdG90YWxDcmVkaXRzVXNlZCA9IGNyZWRpdFVzYWdlcy5yZWR1Y2UoXG4gICAgICAoYWNjLCB1c2FnZSkgPT4gYWNjICsgdXNhZ2UuY3JlZGl0c191c2VkLFxuICAgICAgMFxuICAgICk7XG5cbiAgICBjb25zdCByZW1haW5pbmdDcmVkaXRzID0gRlJFRV9DUkVESVRTICsgY291cG9uQ3JlZGl0cyAtIHRvdGFsQ3JlZGl0c1VzZWQ7XG4gICAgcmV0dXJuIHsgdG90YWxDcmVkaXRzVXNlZDogdG90YWxDcmVkaXRzVXNlZCwgcmVtYWluaW5nQ3JlZGl0cywgdG90YWxDcmVkaXRzOiBGUkVFX0NSRURJVFMgKyBjb3Vwb25DcmVkaXRzIH07XG4gIH1cblxuICBjb25zdCB7IGRhdGE6IGNyZWRpdFVzYWdlcywgZXJyb3I6IGNyZWRpdFVzYWdlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlX3NlcnZpY2VcbiAgICAuZnJvbShcImNyZWRpdF91c2FnZVwiKVxuICAgIC5zZWxlY3QoXCJjcmVkaXRzX3VzZWRcIilcbiAgICAuZXEoXCJzdWJzY3JpcHRpb25faWRcIiwgc3Vic2NyaXB0aW9uLmlkKVxuICAgIC5ndGUoXCJjcmVhdGVkX2F0XCIsIHN1YnNjcmlwdGlvbi5jdXJyZW50X3BlcmlvZF9zdGFydClcbiAgICAubHRlKFwiY3JlYXRlZF9hdFwiLCBzdWJzY3JpcHRpb24uY3VycmVudF9wZXJpb2RfZW5kKTtcblxuICBpZiAoY3JlZGl0VXNhZ2VFcnJvciB8fCAhY3JlZGl0VXNhZ2VzKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gcmV0cmlldmUgY3JlZGl0IHVzYWdlIGZvciBzdWJzY3JpcHRpb25faWQ6ICR7c3Vic2NyaXB0aW9uLmlkfWApO1xuICB9XG5cbiAgY29uc3QgdG90YWxDcmVkaXRzVXNlZCA9IGNyZWRpdFVzYWdlcy5yZWR1Y2UoKGFjYywgdXNhZ2UpID0+IGFjYyArIHVzYWdlLmNyZWRpdHNfdXNlZCwgMCk7XG5cbiAgY29uc3QgeyBkYXRhOiBwcmljZSwgZXJyb3I6IHByaWNlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlX3NlcnZpY2VcbiAgICAuZnJvbShcInByaWNlc1wiKVxuICAgIC5zZWxlY3QoXCJjcmVkaXRzXCIpXG4gICAgLmVxKFwiaWRcIiwgc3Vic2NyaXB0aW9uLnByaWNlX2lkKVxuICAgIC5zaW5nbGUoKTtcblxuICBpZiAocHJpY2VFcnJvciB8fCAhcHJpY2UpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byByZXRyaWV2ZSBwcmljZSBmb3IgcHJpY2VfaWQ6ICR7c3Vic2NyaXB0aW9uLnByaWNlX2lkfWApO1xuICB9XG5cbiAgY29uc3QgcmVtYWluaW5nQ3JlZGl0cyA9IHByaWNlLmNyZWRpdHMgKyBjb3Vwb25DcmVkaXRzIC0gdG90YWxDcmVkaXRzVXNlZDtcblxuICByZXR1cm4ge1xuICAgIHRvdGFsQ3JlZGl0c1VzZWQsXG4gICAgcmVtYWluaW5nQ3JlZGl0cyxcbiAgICB0b3RhbENyZWRpdHM6IHByaWNlLmNyZWRpdHNcbiAgfTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gY3JlYXRlQ3JlZGl0VXNhZ2UoeyB0ZWFtX2lkLCBzdWJzY3JpcHRpb25faWQsIGNyZWRpdHMgfTogeyB0ZWFtX2lkOiBzdHJpbmcsIHN1YnNjcmlwdGlvbl9pZD86IHN0cmluZywgY3JlZGl0czogbnVtYmVyIH0pIHtcbiAgY29uc3QgeyBkYXRhOiBjcmVkaXRfdXNhZ2UgfSA9IGF3YWl0IHN1cGFiYXNlX3NlcnZpY2VcbiAgICAuZnJvbShcImNyZWRpdF91c2FnZVwiKVxuICAgIC5pbnNlcnQoW1xuICAgICAge1xuICAgICAgICB0ZWFtX2lkLFxuICAgICAgICBjcmVkaXRzX3VzZWQ6IGNyZWRpdHMsXG4gICAgICAgIHN1YnNjcmlwdGlvbl9pZDogc3Vic2NyaXB0aW9uX2lkIHx8IG51bGwsXG4gICAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKCksXG4gICAgICB9LFxuICAgIF0pXG4gICAgLnNlbGVjdCgpO1xuXG4gIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNyZWRpdF91c2FnZSB9O1xufSJdLCJuYW1lcyI6WyJ3aXRoQXV0aCIsInN1cGFiYXNlX3NlcnZpY2UiLCJGUkVFX0NSRURJVFMiLCJiaWxsVGVhbSIsInRlYW1faWQiLCJjcmVkaXRzIiwic3VwYUJpbGxUZWFtIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJjb25zb2xlIiwibG9nIiwiZGF0YSIsInN1YnNjcmlwdGlvbiIsImZyb20iLCJzZWxlY3QiLCJlcSIsInNpbmdsZSIsImNvdXBvbnMiLCJjb3Vwb25DcmVkaXRzIiwibGVuZ3RoIiwicmVkdWNlIiwidG90YWwiLCJjb3Vwb24iLCJzb3J0ZWRDb3Vwb25zIiwic29ydCIsImEiLCJiIiwidXNlZENyZWRpdHMiLCJ1cGRhdGUiLCJpZCIsInNoaWZ0IiwiY3JlYXRlQ3JlZGl0VXNhZ2UiLCJpIiwic3Vic2NyaXB0aW9uX2lkIiwiY2hlY2tUZWFtQ3JlZGl0cyIsInN1cGFDaGVja1RlYW1DcmVkaXRzIiwiZXJyb3IiLCJzdWJzY3JpcHRpb25FcnJvciIsImNyZWRpdFVzYWdlcyIsImNyZWRpdFVzYWdlRXJyb3IiLCJpcyIsIkVycm9yIiwidG90YWxDcmVkaXRzVXNlZCIsImFjYyIsInVzYWdlIiwiY3JlZGl0c191c2VkIiwiZ3RlIiwiY3VycmVudF9wZXJpb2Rfc3RhcnQiLCJsdGUiLCJjdXJyZW50X3BlcmlvZF9lbmQiLCJhZGp1c3RlZENyZWRpdHNVc2VkIiwiTWF0aCIsIm1heCIsInByaWNlIiwicHJpY2VFcnJvciIsInByaWNlX2lkIiwiY291bnRDcmVkaXRzQW5kUmVtYWluaW5nRm9yQ3VycmVudEJpbGxpbmdQZXJpb2QiLCJyZW1haW5pbmdDcmVkaXRzIiwidG90YWxDcmVkaXRzIiwiY3JlZGl0X3VzYWdlIiwiaW5zZXJ0IiwiY3JlYXRlZF9hdCIsIkRhdGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/services/billing/credit_billing.ts\n");

/***/ }),

/***/ "(api)/./src/services/logging/log_job.ts":
/*!*****************************************!*\
  !*** ./src/services/logging/log_job.ts ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   logJob: () => (/* binding */ logJob)\n/* harmony export */ });\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../supabase */ \"(api)/./src/services/supabase.ts\");\n/* harmony import */ var dotenv_config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! dotenv/config */ \"dotenv/config\");\n/* harmony import */ var dotenv_config__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(dotenv_config__WEBPACK_IMPORTED_MODULE_1__);\n\n\nasync function logJob(job) {\n    try {\n        // Only log jobs in production\n        if (process.env.ENV !== \"production\") {\n            return;\n        }\n        const { data, error } = await _supabase__WEBPACK_IMPORTED_MODULE_0__.supabase_service.from(\"firecrawl_jobs\").insert([\n            {\n                success: job.success,\n                message: job.message,\n                num_docs: job.num_docs,\n                docs: job.docs,\n                time_taken: job.time_taken,\n                team_id: job.team_id === \"preview\" ? null : job.team_id,\n                mode: job.mode,\n                url: job.url,\n                crawler_options: job.crawlerOptions,\n                page_options: job.pageOptions,\n                origin: job.origin,\n                extractor_options: job.extractor_options,\n                num_tokens: job.num_tokens\n            }\n        ]);\n        if (error) {\n            console.error(\"Error logging job:\\n\", error);\n        }\n    } catch (error) {\n        console.error(\"Error logging job:\\n\", error);\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2VydmljZXMvbG9nZ2luZy9sb2dfam9iLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFDK0M7QUFFeEI7QUFFaEIsZUFBZUMsT0FBT0MsR0FBaUI7SUFDNUMsSUFBSTtRQUNGLDhCQUE4QjtRQUM5QixJQUFJQyxRQUFRQyxJQUFJQyxRQUFRLGNBQWM7WUFDcEM7UUFDRjtRQUdBLE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxLQUFLLEVBQUUsR0FBRyxNQUFNUCx1REFBZ0JBLENBQzNDUSxLQUFLLGtCQUNMQyxPQUFPO1lBQ047Z0JBQ0VDLFNBQVNSLElBQUlRO2dCQUNiQyxTQUFTVCxJQUFJUztnQkFDYkMsVUFBVVYsSUFBSVU7Z0JBQ2RDLE1BQU1YLElBQUlXO2dCQUNWQyxZQUFZWixJQUFJWTtnQkFDaEJDLFNBQVNiLElBQUlhLFlBQVksWUFBWSxPQUFPYixJQUFJYTtnQkFDaERDLE1BQU1kLElBQUljO2dCQUNWQyxLQUFLZixJQUFJZTtnQkFDVEMsaUJBQWlCaEIsSUFBSWlCO2dCQUNyQkMsY0FBY2xCLElBQUltQjtnQkFDbEJDLFFBQVFwQixJQUFJb0I7Z0JBQ1pDLG1CQUFtQnJCLElBQUlxQjtnQkFDdkJDLFlBQVl0QixJQUFJc0I7WUFDbEI7U0FDRDtRQUNILElBQUlqQixPQUFPO1lBQ1RrQixRQUFRbEIsTUFBTSx3QkFBd0JBO1FBQ3hDO0lBQ0YsRUFBRSxPQUFPQSxPQUFPO1FBQ2RrQixRQUFRbEIsTUFBTSx3QkFBd0JBO0lBQ3hDO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9maXJlY3Jhd2wtc2NyYXBlci1qcy8uL3NyYy9zZXJ2aWNlcy9sb2dnaW5nL2xvZ19qb2IudHM/YTg5MCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBFeHRyYWN0b3JPcHRpb25zIH0gZnJvbSAnLi8uLi8uLi9saWIvZW50aXRpZXMnO1xuaW1wb3J0IHsgc3VwYWJhc2Vfc2VydmljZSB9IGZyb20gXCIuLi9zdXBhYmFzZVwiO1xuaW1wb3J0IHsgRmlyZWNyYXdsSm9iIH0gZnJvbSBcIi4uLy4uL3R5cGVzXCI7XG5pbXBvcnQgXCJkb3RlbnYvY29uZmlnXCI7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dKb2Ioam9iOiBGaXJlY3Jhd2xKb2IpIHtcbiAgdHJ5IHtcbiAgICAvLyBPbmx5IGxvZyBqb2JzIGluIHByb2R1Y3Rpb25cbiAgICBpZiAocHJvY2Vzcy5lbnYuRU5WICE9PSBcInByb2R1Y3Rpb25cIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIFxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlX3NlcnZpY2VcbiAgICAgIC5mcm9tKFwiZmlyZWNyYXdsX2pvYnNcIilcbiAgICAgIC5pbnNlcnQoW1xuICAgICAgICB7XG4gICAgICAgICAgc3VjY2Vzczogam9iLnN1Y2Nlc3MsXG4gICAgICAgICAgbWVzc2FnZTogam9iLm1lc3NhZ2UsXG4gICAgICAgICAgbnVtX2RvY3M6IGpvYi5udW1fZG9jcyxcbiAgICAgICAgICBkb2NzOiBqb2IuZG9jcyxcbiAgICAgICAgICB0aW1lX3Rha2VuOiBqb2IudGltZV90YWtlbixcbiAgICAgICAgICB0ZWFtX2lkOiBqb2IudGVhbV9pZCA9PT0gXCJwcmV2aWV3XCIgPyBudWxsIDogam9iLnRlYW1faWQsXG4gICAgICAgICAgbW9kZTogam9iLm1vZGUsXG4gICAgICAgICAgdXJsOiBqb2IudXJsLFxuICAgICAgICAgIGNyYXdsZXJfb3B0aW9uczogam9iLmNyYXdsZXJPcHRpb25zLFxuICAgICAgICAgIHBhZ2Vfb3B0aW9uczogam9iLnBhZ2VPcHRpb25zLFxuICAgICAgICAgIG9yaWdpbjogam9iLm9yaWdpbixcbiAgICAgICAgICBleHRyYWN0b3Jfb3B0aW9uczogam9iLmV4dHJhY3Rvcl9vcHRpb25zLFxuICAgICAgICAgIG51bV90b2tlbnM6IGpvYi5udW1fdG9rZW5zXG4gICAgICAgIH0sXG4gICAgICBdKTtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBsb2dnaW5nIGpvYjpcXG5cIiwgZXJyb3IpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgbG9nZ2luZyBqb2I6XFxuXCIsIGVycm9yKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbInN1cGFiYXNlX3NlcnZpY2UiLCJsb2dKb2IiLCJqb2IiLCJwcm9jZXNzIiwiZW52IiwiRU5WIiwiZGF0YSIsImVycm9yIiwiZnJvbSIsImluc2VydCIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwibnVtX2RvY3MiLCJkb2NzIiwidGltZV90YWtlbiIsInRlYW1faWQiLCJtb2RlIiwidXJsIiwiY3Jhd2xlcl9vcHRpb25zIiwiY3Jhd2xlck9wdGlvbnMiLCJwYWdlX29wdGlvbnMiLCJwYWdlT3B0aW9ucyIsIm9yaWdpbiIsImV4dHJhY3Rvcl9vcHRpb25zIiwibnVtX3Rva2VucyIsImNvbnNvbGUiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/services/logging/log_job.ts\n");

/***/ }),

/***/ "(api)/./src/services/rate-limiter.ts":
/*!**************************************!*\
  !*** ./src/services/rate-limiter.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   crawlRateLimit: () => (/* binding */ crawlRateLimit),\n/* harmony export */   crawlStatusRateLimiter: () => (/* binding */ crawlStatusRateLimiter),\n/* harmony export */   getRateLimiter: () => (/* binding */ getRateLimiter),\n/* harmony export */   previewRateLimiter: () => (/* binding */ previewRateLimiter),\n/* harmony export */   serverRateLimiter: () => (/* binding */ serverRateLimiter)\n/* harmony export */ });\n/* harmony import */ var rate_limiter_flexible__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! rate-limiter-flexible */ \"rate-limiter-flexible\");\n/* harmony import */ var rate_limiter_flexible__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(rate_limiter_flexible__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _src_lib_redis__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../src/lib/redis */ \"(api)/./src/lib/redis.ts\");\n/* harmony import */ var _src_types__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../src/types */ \"(api)/./src/types.ts\");\n\n\n\nconst MAX_REQUESTS_PER_MINUTE_PREVIEW = 5;\nconst MAX_CRAWLS_PER_MINUTE_STARTER = 2;\nconst MAX_CRAWLS_PER_MINUTE_STANDARD = 4;\nconst MAX_CRAWLS_PER_MINUTE_SCALE = 20;\nconst MAX_REQUESTS_PER_MINUTE_ACCOUNT = 20;\nconst MAX_REQUESTS_PER_MINUTE_CRAWL_STATUS = 120;\nconst previewRateLimiter = new rate_limiter_flexible__WEBPACK_IMPORTED_MODULE_0__.RateLimiterRedis({\n    storeClient: _src_lib_redis__WEBPACK_IMPORTED_MODULE_1__[\"default\"],\n    keyPrefix: \"middleware\",\n    points: MAX_REQUESTS_PER_MINUTE_PREVIEW,\n    duration: 60\n});\nconst serverRateLimiter = new rate_limiter_flexible__WEBPACK_IMPORTED_MODULE_0__.RateLimiterRedis({\n    storeClient: _src_lib_redis__WEBPACK_IMPORTED_MODULE_1__[\"default\"],\n    keyPrefix: \"middleware\",\n    points: MAX_REQUESTS_PER_MINUTE_ACCOUNT,\n    duration: 60\n});\nconst crawlStatusRateLimiter = new rate_limiter_flexible__WEBPACK_IMPORTED_MODULE_0__.RateLimiterRedis({\n    storeClient: _src_lib_redis__WEBPACK_IMPORTED_MODULE_1__[\"default\"],\n    keyPrefix: \"middleware\",\n    points: MAX_REQUESTS_PER_MINUTE_CRAWL_STATUS,\n    duration: 60\n});\nfunction crawlRateLimit(plan) {\n    if (plan === \"standard\") {\n        return new rate_limiter_flexible__WEBPACK_IMPORTED_MODULE_0__.RateLimiterRedis({\n            storeClient: _src_lib_redis__WEBPACK_IMPORTED_MODULE_1__[\"default\"],\n            keyPrefix: \"middleware\",\n            points: MAX_CRAWLS_PER_MINUTE_STANDARD,\n            duration: 60\n        });\n    } else if (plan === \"scale\") {\n        return new rate_limiter_flexible__WEBPACK_IMPORTED_MODULE_0__.RateLimiterRedis({\n            storeClient: _src_lib_redis__WEBPACK_IMPORTED_MODULE_1__[\"default\"],\n            keyPrefix: \"middleware\",\n            points: MAX_CRAWLS_PER_MINUTE_SCALE,\n            duration: 60\n        });\n    }\n    return new rate_limiter_flexible__WEBPACK_IMPORTED_MODULE_0__.RateLimiterRedis({\n        storeClient: _src_lib_redis__WEBPACK_IMPORTED_MODULE_1__[\"default\"],\n        keyPrefix: \"middleware\",\n        points: MAX_CRAWLS_PER_MINUTE_STARTER,\n        duration: 60\n    });\n}\nfunction getRateLimiter(mode) {\n    switch(mode){\n        case _src_types__WEBPACK_IMPORTED_MODULE_2__.RateLimiterMode.Preview:\n            return previewRateLimiter;\n        case _src_types__WEBPACK_IMPORTED_MODULE_2__.RateLimiterMode.CrawlStatus:\n            return crawlStatusRateLimiter;\n        default:\n            return serverRateLimiter;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2VydmljZXMvcmF0ZS1saW1pdGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUF5RDtBQUNYO0FBQ0k7QUFFbEQsTUFBTUcsa0NBQWtDO0FBQ3hDLE1BQU1DLGdDQUFnQztBQUN0QyxNQUFNQyxpQ0FBaUM7QUFDdkMsTUFBTUMsOEJBQThCO0FBRXBDLE1BQU1DLGtDQUFrQztBQUV4QyxNQUFNQyx1Q0FBdUM7QUFJdEMsTUFBTUMscUJBQXFCLElBQUlULG1FQUFnQkEsQ0FBQztJQUNyRFUsYUFBYVQsc0RBQVdBO0lBQ3hCVSxXQUFXO0lBQ1hDLFFBQVFUO0lBQ1JVLFVBQVU7QUFDWixHQUFHO0FBRUksTUFBTUMsb0JBQW9CLElBQUlkLG1FQUFnQkEsQ0FBQztJQUNwRFUsYUFBYVQsc0RBQVdBO0lBQ3hCVSxXQUFXO0lBQ1hDLFFBQVFMO0lBQ1JNLFVBQVU7QUFDWixHQUFHO0FBRUksTUFBTUUseUJBQXlCLElBQUlmLG1FQUFnQkEsQ0FBQztJQUN6RFUsYUFBYVQsc0RBQVdBO0lBQ3hCVSxXQUFXO0lBQ1hDLFFBQVFKO0lBQ1JLLFVBQVU7QUFDWixHQUFHO0FBR0ksU0FBU0csZUFBZUMsSUFBWTtJQUN6QyxJQUFHQSxTQUFTLFlBQVc7UUFDckIsT0FBTyxJQUFJakIsbUVBQWdCQSxDQUFDO1lBQzFCVSxhQUFhVCxzREFBV0E7WUFDeEJVLFdBQVc7WUFDWEMsUUFBUVA7WUFDUlEsVUFBVTtRQUNaO0lBQ0YsT0FBTSxJQUFHSSxTQUFTLFNBQVE7UUFDeEIsT0FBTyxJQUFJakIsbUVBQWdCQSxDQUFDO1lBQzFCVSxhQUFhVCxzREFBV0E7WUFDeEJVLFdBQVc7WUFDWEMsUUFBUU47WUFDUk8sVUFBVTtRQUNaO0lBQ0Y7SUFDQSxPQUFPLElBQUliLG1FQUFnQkEsQ0FBQztRQUMxQlUsYUFBYVQsc0RBQVdBO1FBQ3hCVSxXQUFXO1FBQ1hDLFFBQVFSO1FBQ1JTLFVBQVU7SUFDWjtBQUVGO0FBS08sU0FBU0ssZUFBZUMsSUFBcUI7SUFDbEQsT0FBT0E7UUFDTCxLQUFLakIsdURBQWVBLENBQUNrQjtZQUNuQixPQUFPWDtRQUNULEtBQUtQLHVEQUFlQSxDQUFDbUI7WUFDbkIsT0FBT047UUFDVDtZQUNFLE9BQU9EO0lBQ1g7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2ZpcmVjcmF3bC1zY3JhcGVyLWpzLy4vc3JjL3NlcnZpY2VzL3JhdGUtbGltaXRlci50cz8yZDg3Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJhdGVMaW1pdGVyUmVkaXMgfSBmcm9tIFwicmF0ZS1saW1pdGVyLWZsZXhpYmxlXCI7XG5pbXBvcnQgcmVkaXNDbGllbnQgZnJvbSBcIi4uLy4uL3NyYy9saWIvcmVkaXNcIjtcbmltcG9ydCB7IFJhdGVMaW1pdGVyTW9kZSB9IGZyb20gXCIuLi8uLi9zcmMvdHlwZXNcIjtcblxuY29uc3QgTUFYX1JFUVVFU1RTX1BFUl9NSU5VVEVfUFJFVklFVyA9IDU7XG5jb25zdCBNQVhfQ1JBV0xTX1BFUl9NSU5VVEVfU1RBUlRFUiA9IDI7XG5jb25zdCBNQVhfQ1JBV0xTX1BFUl9NSU5VVEVfU1RBTkRBUkQgPSA0O1xuY29uc3QgTUFYX0NSQVdMU19QRVJfTUlOVVRFX1NDQUxFID0gMjA7XG5cbmNvbnN0IE1BWF9SRVFVRVNUU19QRVJfTUlOVVRFX0FDQ09VTlQgPSAyMDtcblxuY29uc3QgTUFYX1JFUVVFU1RTX1BFUl9NSU5VVEVfQ1JBV0xfU1RBVFVTID0gMTIwO1xuXG5cblxuZXhwb3J0IGNvbnN0IHByZXZpZXdSYXRlTGltaXRlciA9IG5ldyBSYXRlTGltaXRlclJlZGlzKHtcbiAgc3RvcmVDbGllbnQ6IHJlZGlzQ2xpZW50LFxuICBrZXlQcmVmaXg6IFwibWlkZGxld2FyZVwiLFxuICBwb2ludHM6IE1BWF9SRVFVRVNUU19QRVJfTUlOVVRFX1BSRVZJRVcsXG4gIGR1cmF0aW9uOiA2MCwgLy8gRHVyYXRpb24gaW4gc2Vjb25kc1xufSk7XG5cbmV4cG9ydCBjb25zdCBzZXJ2ZXJSYXRlTGltaXRlciA9IG5ldyBSYXRlTGltaXRlclJlZGlzKHtcbiAgc3RvcmVDbGllbnQ6IHJlZGlzQ2xpZW50LFxuICBrZXlQcmVmaXg6IFwibWlkZGxld2FyZVwiLFxuICBwb2ludHM6IE1BWF9SRVFVRVNUU19QRVJfTUlOVVRFX0FDQ09VTlQsXG4gIGR1cmF0aW9uOiA2MCwgLy8gRHVyYXRpb24gaW4gc2Vjb25kc1xufSk7XG5cbmV4cG9ydCBjb25zdCBjcmF3bFN0YXR1c1JhdGVMaW1pdGVyID0gbmV3IFJhdGVMaW1pdGVyUmVkaXMoe1xuICBzdG9yZUNsaWVudDogcmVkaXNDbGllbnQsXG4gIGtleVByZWZpeDogXCJtaWRkbGV3YXJlXCIsXG4gIHBvaW50czogTUFYX1JFUVVFU1RTX1BFUl9NSU5VVEVfQ1JBV0xfU1RBVFVTLFxuICBkdXJhdGlvbjogNjAsIC8vIER1cmF0aW9uIGluIHNlY29uZHNcbn0pO1xuXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmF3bFJhdGVMaW1pdChwbGFuOiBzdHJpbmcpe1xuICBpZihwbGFuID09PSBcInN0YW5kYXJkXCIpe1xuICAgIHJldHVybiBuZXcgUmF0ZUxpbWl0ZXJSZWRpcyh7XG4gICAgICBzdG9yZUNsaWVudDogcmVkaXNDbGllbnQsXG4gICAgICBrZXlQcmVmaXg6IFwibWlkZGxld2FyZVwiLFxuICAgICAgcG9pbnRzOiBNQVhfQ1JBV0xTX1BFUl9NSU5VVEVfU1RBTkRBUkQsXG4gICAgICBkdXJhdGlvbjogNjAsIC8vIER1cmF0aW9uIGluIHNlY29uZHNcbiAgICB9KTtcbiAgfWVsc2UgaWYocGxhbiA9PT0gXCJzY2FsZVwiKXtcbiAgICByZXR1cm4gbmV3IFJhdGVMaW1pdGVyUmVkaXMoe1xuICAgICAgc3RvcmVDbGllbnQ6IHJlZGlzQ2xpZW50LFxuICAgICAga2V5UHJlZml4OiBcIm1pZGRsZXdhcmVcIixcbiAgICAgIHBvaW50czogTUFYX0NSQVdMU19QRVJfTUlOVVRFX1NDQUxFLFxuICAgICAgZHVyYXRpb246IDYwLCAvLyBEdXJhdGlvbiBpbiBzZWNvbmRzXG4gICAgfSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBSYXRlTGltaXRlclJlZGlzKHtcbiAgICBzdG9yZUNsaWVudDogcmVkaXNDbGllbnQsXG4gICAga2V5UHJlZml4OiBcIm1pZGRsZXdhcmVcIixcbiAgICBwb2ludHM6IE1BWF9DUkFXTFNfUEVSX01JTlVURV9TVEFSVEVSLFxuICAgIGR1cmF0aW9uOiA2MCwgLy8gRHVyYXRpb24gaW4gc2Vjb25kc1xuICB9KTtcblxufVxuXG5cblxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmF0ZUxpbWl0ZXIobW9kZTogUmF0ZUxpbWl0ZXJNb2RlKXtcbiAgc3dpdGNoKG1vZGUpIHtcbiAgICBjYXNlIFJhdGVMaW1pdGVyTW9kZS5QcmV2aWV3OlxuICAgICAgcmV0dXJuIHByZXZpZXdSYXRlTGltaXRlcjtcbiAgICBjYXNlIFJhdGVMaW1pdGVyTW9kZS5DcmF3bFN0YXR1czpcbiAgICAgIHJldHVybiBjcmF3bFN0YXR1c1JhdGVMaW1pdGVyO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gc2VydmVyUmF0ZUxpbWl0ZXI7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJSYXRlTGltaXRlclJlZGlzIiwicmVkaXNDbGllbnQiLCJSYXRlTGltaXRlck1vZGUiLCJNQVhfUkVRVUVTVFNfUEVSX01JTlVURV9QUkVWSUVXIiwiTUFYX0NSQVdMU19QRVJfTUlOVVRFX1NUQVJURVIiLCJNQVhfQ1JBV0xTX1BFUl9NSU5VVEVfU1RBTkRBUkQiLCJNQVhfQ1JBV0xTX1BFUl9NSU5VVEVfU0NBTEUiLCJNQVhfUkVRVUVTVFNfUEVSX01JTlVURV9BQ0NPVU5UIiwiTUFYX1JFUVVFU1RTX1BFUl9NSU5VVEVfQ1JBV0xfU1RBVFVTIiwicHJldmlld1JhdGVMaW1pdGVyIiwic3RvcmVDbGllbnQiLCJrZXlQcmVmaXgiLCJwb2ludHMiLCJkdXJhdGlvbiIsInNlcnZlclJhdGVMaW1pdGVyIiwiY3Jhd2xTdGF0dXNSYXRlTGltaXRlciIsImNyYXdsUmF0ZUxpbWl0IiwicGxhbiIsImdldFJhdGVMaW1pdGVyIiwibW9kZSIsIlByZXZpZXciLCJDcmF3bFN0YXR1cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/services/rate-limiter.ts\n");

/***/ }),

/***/ "(api)/./src/services/redis.ts":
/*!*******************************!*\
  !*** ./src/services/redis.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   deleteKey: () => (/* binding */ deleteKey),\n/* harmony export */   getValue: () => (/* binding */ getValue),\n/* harmony export */   setValue: () => (/* binding */ setValue)\n/* harmony export */ });\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ioredis */ \"ioredis\");\n/* harmony import */ var ioredis__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(ioredis__WEBPACK_IMPORTED_MODULE_0__);\n\n// Initialize Redis client\nconst redis = new (ioredis__WEBPACK_IMPORTED_MODULE_0___default())(process.env.REDIS_URL);\n/**\n * Set a value in Redis with an optional expiration time.\n * @param {string} key The key under which to store the value.\n * @param {string} value The value to store.\n * @param {number} [expire] Optional expiration time in seconds.\n */ const setValue = async (key, value, expire)=>{\n    if (expire) {\n        await redis.set(key, value, \"EX\", expire);\n    } else {\n        await redis.set(key, value);\n    }\n};\n/**\n * Get a value from Redis.\n * @param {string} key The key of the value to retrieve.\n * @returns {Promise<string|null>} The value, if found, otherwise null.\n */ const getValue = async (key)=>{\n    const value = await redis.get(key);\n    return value;\n};\n/**\n * Delete a key from Redis.\n * @param {string} key The key to delete.\n */ const deleteKey = async (key)=>{\n    await redis.del(key);\n};\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2VydmljZXMvcmVkaXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBNEI7QUFFNUIsMEJBQTBCO0FBQzFCLE1BQU1DLFFBQVEsSUFBSUQsZ0RBQUtBLENBQUNFLFFBQVFDLElBQUlDO0FBRXBDOzs7OztDQUtDLEdBQ0QsTUFBTUMsV0FBVyxPQUFPQyxLQUFhQyxPQUFlQztJQUNsRCxJQUFJQSxRQUFRO1FBQ1YsTUFBTVAsTUFBTVEsSUFBSUgsS0FBS0MsT0FBTyxNQUFNQztJQUNwQyxPQUFPO1FBQ0wsTUFBTVAsTUFBTVEsSUFBSUgsS0FBS0M7SUFDdkI7QUFDRjtBQUVBOzs7O0NBSUMsR0FDRCxNQUFNRyxXQUFXLE9BQU9KO0lBQ3RCLE1BQU1DLFFBQVEsTUFBTU4sTUFBTVUsSUFBSUw7SUFDOUIsT0FBT0M7QUFDVDtBQUVBOzs7Q0FHQyxHQUNELE1BQU1LLFlBQVksT0FBT047SUFDdkIsTUFBTUwsTUFBTVksSUFBSVA7QUFDbEI7QUFFeUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9maXJlY3Jhd2wtc2NyYXBlci1qcy8uL3NyYy9zZXJ2aWNlcy9yZWRpcy50cz9mOTUxIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWRpcyBmcm9tICdpb3JlZGlzJztcblxuLy8gSW5pdGlhbGl6ZSBSZWRpcyBjbGllbnRcbmNvbnN0IHJlZGlzID0gbmV3IFJlZGlzKHByb2Nlc3MuZW52LlJFRElTX1VSTCk7XG5cbi8qKlxuICogU2V0IGEgdmFsdWUgaW4gUmVkaXMgd2l0aCBhbiBvcHRpb25hbCBleHBpcmF0aW9uIHRpbWUuXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgdW5kZXIgd2hpY2ggdG8gc3RvcmUgdGhlIHZhbHVlLlxuICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIFRoZSB2YWx1ZSB0byBzdG9yZS5cbiAqIEBwYXJhbSB7bnVtYmVyfSBbZXhwaXJlXSBPcHRpb25hbCBleHBpcmF0aW9uIHRpbWUgaW4gc2Vjb25kcy5cbiAqL1xuY29uc3Qgc2V0VmFsdWUgPSBhc3luYyAoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcsIGV4cGlyZT86IG51bWJlcikgPT4ge1xuICBpZiAoZXhwaXJlKSB7XG4gICAgYXdhaXQgcmVkaXMuc2V0KGtleSwgdmFsdWUsICdFWCcsIGV4cGlyZSk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgcmVkaXMuc2V0KGtleSwgdmFsdWUpO1xuICB9XG59O1xuXG4vKipcbiAqIEdldCBhIHZhbHVlIGZyb20gUmVkaXMuXG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5IFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIHJldHJpZXZlLlxuICogQHJldHVybnMge1Byb21pc2U8c3RyaW5nfG51bGw+fSBUaGUgdmFsdWUsIGlmIGZvdW5kLCBvdGhlcndpc2UgbnVsbC5cbiAqL1xuY29uc3QgZ2V0VmFsdWUgPSBhc3luYyAoa2V5OiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+ID0+IHtcbiAgY29uc3QgdmFsdWUgPSBhd2FpdCByZWRpcy5nZXQoa2V5KTtcbiAgcmV0dXJuIHZhbHVlO1xufTtcblxuLyoqXG4gKiBEZWxldGUgYSBrZXkgZnJvbSBSZWRpcy5cbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgVGhlIGtleSB0byBkZWxldGUuXG4gKi9cbmNvbnN0IGRlbGV0ZUtleSA9IGFzeW5jIChrZXk6IHN0cmluZykgPT4ge1xuICBhd2FpdCByZWRpcy5kZWwoa2V5KTtcbn07XG5cbmV4cG9ydCB7IHNldFZhbHVlLCBnZXRWYWx1ZSwgZGVsZXRlS2V5IH07XG4iXSwibmFtZXMiOlsiUmVkaXMiLCJyZWRpcyIsInByb2Nlc3MiLCJlbnYiLCJSRURJU19VUkwiLCJzZXRWYWx1ZSIsImtleSIsInZhbHVlIiwiZXhwaXJlIiwic2V0IiwiZ2V0VmFsdWUiLCJnZXQiLCJkZWxldGVLZXkiLCJkZWwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./src/services/redis.ts\n");

/***/ }),

/***/ "(api)/./src/services/supabase.ts":
/*!**********************************!*\
  !*** ./src/services/supabase.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabase_service: () => (/* binding */ supabase_service)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__);\n\n// SupabaseService class initializes the Supabase client conditionally based on environment variables.\nclass SupabaseService {\n    constructor(){\n        this.client = null;\n        const supabaseUrl = process.env.SUPABASE_URL;\n        const supabaseServiceToken = process.env.SUPABASE_SERVICE_TOKEN;\n        // Only initialize the Supabase client if both URL and Service Token are provided.\n        if (process.env.USE_DB_AUTHENTICATION === \"false\") {\n            // Warn the user that Authentication is disabled by setting the client to null\n            console.warn(\"\\x1b[33mAuthentication is disabled. Supabase client will not be initialized.\\x1b[0m\");\n            this.client = null;\n        } else if (!supabaseUrl || !supabaseServiceToken) {\n            console.error(\"\\x1b[31mSupabase environment variables aren't configured correctly. Supabase client will not be initialized. Fix ENV configuration or disable DB authentication with USE_DB_AUTHENTICATION env variable\\x1b[0m\");\n        } else {\n            this.client = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceToken);\n        }\n    }\n    // Provides access to the initialized Supabase client, if available.\n    getClient() {\n        return this.client;\n    }\n}\n// Using a Proxy to handle dynamic access to the Supabase client or service methods.\n// This approach ensures that if Supabase is not configured, any attempt to use it will result in a clear error.\nconst supabase_service = new Proxy(new SupabaseService(), {\n    get: function(target, prop, receiver) {\n        const client = target.getClient();\n        // If the Supabase client is not initialized, intercept property access to provide meaningful error feedback.\n        if (client === null) {\n            console.error(\"Attempted to access Supabase client when it's not configured.\");\n            return ()=>{\n                throw new Error(\"Supabase client is not configured.\");\n            };\n        }\n        // Direct access to SupabaseService properties takes precedence.\n        if (prop in target) {\n            return Reflect.get(target, prop, receiver);\n        }\n        // Otherwise, delegate access to the Supabase client.\n        return Reflect.get(client, prop, receiver);\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvc2VydmljZXMvc3VwYWJhc2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQXFFO0FBRXJFLHNHQUFzRztBQUN0RyxNQUFNQztJQUdKQyxhQUFjO2FBRk5DLFNBQWdDO1FBR3RDLE1BQU1DLGNBQWNDLFFBQVFDLElBQUlDO1FBQ2hDLE1BQU1DLHVCQUF1QkgsUUFBUUMsSUFBSUc7UUFDekMsa0ZBQWtGO1FBQ2xGLElBQUlKLFFBQVFDLElBQUlJLDBCQUEwQixTQUFTO1lBQ2pELDhFQUE4RTtZQUM5RUMsUUFBUUMsS0FDTjtZQUVGLElBQUksQ0FBQ1QsU0FBUztRQUNoQixPQUFPLElBQUksQ0FBQ0MsZUFBZSxDQUFDSSxzQkFBc0I7WUFDaERHLFFBQVFFLE1BQ047UUFFSixPQUFPO1lBQ0wsSUFBSSxDQUFDVixTQUFTSCxtRUFBWUEsQ0FBQ0ksYUFBYUk7UUFDMUM7SUFDRjtJQUVBLG9FQUFvRTtJQUNwRU0sWUFBbUM7UUFDakMsT0FBTyxJQUFJLENBQUNYO0lBQ2Q7QUFDRjtBQUVBLG9GQUFvRjtBQUNwRixnSEFBZ0g7QUFDekcsTUFBTVksbUJBQW1DLElBQUlDLE1BQ2xELElBQUlmLG1CQUNKO0lBQ0VnQixLQUFLLFNBQVVDLE1BQU0sRUFBRUMsSUFBSSxFQUFFQyxRQUFRO1FBQ25DLE1BQU1qQixTQUFTZSxPQUFPSjtRQUN0Qiw2R0FBNkc7UUFDN0csSUFBSVgsV0FBVyxNQUFNO1lBQ25CUSxRQUFRRSxNQUNOO1lBRUYsT0FBTztnQkFDTCxNQUFNLElBQUlRLE1BQU07WUFDbEI7UUFDRjtRQUNBLGdFQUFnRTtRQUNoRSxJQUFJRixRQUFRRCxRQUFRO1lBQ2xCLE9BQU9JLFFBQVFMLElBQUlDLFFBQVFDLE1BQU1DO1FBQ25DO1FBQ0EscURBQXFEO1FBQ3JELE9BQU9FLFFBQVFMLElBQUlkLFFBQVFnQixNQUFNQztJQUNuQztBQUNGLEdBQzZCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZmlyZWNyYXdsLXNjcmFwZXItanMvLi9zcmMvc2VydmljZXMvc3VwYWJhc2UudHM/MTI0NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQsIFN1cGFiYXNlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xuXG4vLyBTdXBhYmFzZVNlcnZpY2UgY2xhc3MgaW5pdGlhbGl6ZXMgdGhlIFN1cGFiYXNlIGNsaWVudCBjb25kaXRpb25hbGx5IGJhc2VkIG9uIGVudmlyb25tZW50IHZhcmlhYmxlcy5cbmNsYXNzIFN1cGFiYXNlU2VydmljZSB7XG4gIHByaXZhdGUgY2xpZW50OiBTdXBhYmFzZUNsaWVudCB8IG51bGwgPSBudWxsO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIGNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfVVJMO1xuICAgIGNvbnN0IHN1cGFiYXNlU2VydmljZVRva2VuID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9UT0tFTjtcbiAgICAvLyBPbmx5IGluaXRpYWxpemUgdGhlIFN1cGFiYXNlIGNsaWVudCBpZiBib3RoIFVSTCBhbmQgU2VydmljZSBUb2tlbiBhcmUgcHJvdmlkZWQuXG4gICAgaWYgKHByb2Nlc3MuZW52LlVTRV9EQl9BVVRIRU5USUNBVElPTiA9PT0gXCJmYWxzZVwiKSB7XG4gICAgICAvLyBXYXJuIHRoZSB1c2VyIHRoYXQgQXV0aGVudGljYXRpb24gaXMgZGlzYWJsZWQgYnkgc2V0dGluZyB0aGUgY2xpZW50IHRvIG51bGxcbiAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgXCJcXHgxYlszM21BdXRoZW50aWNhdGlvbiBpcyBkaXNhYmxlZC4gU3VwYWJhc2UgY2xpZW50IHdpbGwgbm90IGJlIGluaXRpYWxpemVkLlxceDFiWzBtXCJcbiAgICAgICk7XG4gICAgICB0aGlzLmNsaWVudCA9IG51bGw7XG4gICAgfSBlbHNlIGlmICghc3VwYWJhc2VVcmwgfHwgIXN1cGFiYXNlU2VydmljZVRva2VuKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICBcIlxceDFiWzMxbVN1cGFiYXNlIGVudmlyb25tZW50IHZhcmlhYmxlcyBhcmVuJ3QgY29uZmlndXJlZCBjb3JyZWN0bHkuIFN1cGFiYXNlIGNsaWVudCB3aWxsIG5vdCBiZSBpbml0aWFsaXplZC4gRml4IEVOViBjb25maWd1cmF0aW9uIG9yIGRpc2FibGUgREIgYXV0aGVudGljYXRpb24gd2l0aCBVU0VfREJfQVVUSEVOVElDQVRJT04gZW52IHZhcmlhYmxlXFx4MWJbMG1cIlxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jbGllbnQgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlU2VydmljZVRva2VuKTtcbiAgICB9XG4gIH1cblxuICAvLyBQcm92aWRlcyBhY2Nlc3MgdG8gdGhlIGluaXRpYWxpemVkIFN1cGFiYXNlIGNsaWVudCwgaWYgYXZhaWxhYmxlLlxuICBnZXRDbGllbnQoKTogU3VwYWJhc2VDbGllbnQgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5jbGllbnQ7XG4gIH1cbn1cblxuLy8gVXNpbmcgYSBQcm94eSB0byBoYW5kbGUgZHluYW1pYyBhY2Nlc3MgdG8gdGhlIFN1cGFiYXNlIGNsaWVudCBvciBzZXJ2aWNlIG1ldGhvZHMuXG4vLyBUaGlzIGFwcHJvYWNoIGVuc3VyZXMgdGhhdCBpZiBTdXBhYmFzZSBpcyBub3QgY29uZmlndXJlZCwgYW55IGF0dGVtcHQgdG8gdXNlIGl0IHdpbGwgcmVzdWx0IGluIGEgY2xlYXIgZXJyb3IuXG5leHBvcnQgY29uc3Qgc3VwYWJhc2Vfc2VydmljZTogU3VwYWJhc2VDbGllbnQgPSBuZXcgUHJveHkoXG4gIG5ldyBTdXBhYmFzZVNlcnZpY2UoKSxcbiAge1xuICAgIGdldDogZnVuY3Rpb24gKHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpIHtcbiAgICAgIGNvbnN0IGNsaWVudCA9IHRhcmdldC5nZXRDbGllbnQoKTtcbiAgICAgIC8vIElmIHRoZSBTdXBhYmFzZSBjbGllbnQgaXMgbm90IGluaXRpYWxpemVkLCBpbnRlcmNlcHQgcHJvcGVydHkgYWNjZXNzIHRvIHByb3ZpZGUgbWVhbmluZ2Z1bCBlcnJvciBmZWVkYmFjay5cbiAgICAgIGlmIChjbGllbnQgPT09IG51bGwpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcbiAgICAgICAgICBcIkF0dGVtcHRlZCB0byBhY2Nlc3MgU3VwYWJhc2UgY2xpZW50IHdoZW4gaXQncyBub3QgY29uZmlndXJlZC5cIlxuICAgICAgICApO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlN1cGFiYXNlIGNsaWVudCBpcyBub3QgY29uZmlndXJlZC5cIik7XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICAvLyBEaXJlY3QgYWNjZXNzIHRvIFN1cGFiYXNlU2VydmljZSBwcm9wZXJ0aWVzIHRha2VzIHByZWNlZGVuY2UuXG4gICAgICBpZiAocHJvcCBpbiB0YXJnZXQpIHtcbiAgICAgICAgcmV0dXJuIFJlZmxlY3QuZ2V0KHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpO1xuICAgICAgfVxuICAgICAgLy8gT3RoZXJ3aXNlLCBkZWxlZ2F0ZSBhY2Nlc3MgdG8gdGhlIFN1cGFiYXNlIGNsaWVudC5cbiAgICAgIHJldHVybiBSZWZsZWN0LmdldChjbGllbnQsIHByb3AsIHJlY2VpdmVyKTtcbiAgICB9LFxuICB9XG4pIGFzIHVua25vd24gYXMgU3VwYWJhc2VDbGllbnQ7XG4iXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50IiwiU3VwYWJhc2VTZXJ2aWNlIiwiY29uc3RydWN0b3IiLCJjbGllbnQiLCJzdXBhYmFzZVVybCIsInByb2Nlc3MiLCJlbnYiLCJTVVBBQkFTRV9VUkwiLCJzdXBhYmFzZVNlcnZpY2VUb2tlbiIsIlNVUEFCQVNFX1NFUlZJQ0VfVE9LRU4iLCJVU0VfREJfQVVUSEVOVElDQVRJT04iLCJjb25zb2xlIiwid2FybiIsImVycm9yIiwiZ2V0Q2xpZW50Iiwic3VwYWJhc2Vfc2VydmljZSIsIlByb3h5IiwiZ2V0IiwidGFyZ2V0IiwicHJvcCIsInJlY2VpdmVyIiwiRXJyb3IiLCJSZWZsZWN0Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./src/services/supabase.ts\n");

/***/ }),

/***/ "(api)/./src/types.ts":
/*!**********************!*\
  !*** ./src/types.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   RateLimiterMode: () => (/* binding */ RateLimiterMode)\n/* harmony export */ });\nvar RateLimiterMode;\n(function(RateLimiterMode) {\n    RateLimiterMode[\"Crawl\"] = \"crawl\";\n    RateLimiterMode[\"CrawlStatus\"] = \"crawl-status\";\n    RateLimiterMode[\"Scrape\"] = \"scrape\";\n    RateLimiterMode[\"Preview\"] = \"preview\";\n    RateLimiterMode[\"Search\"] = \"search\";\n})(RateLimiterMode || (RateLimiterMode = {}));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9zcmMvdHlwZXMudHMiLCJtYXBwaW5ncyI6Ijs7OztJQTZDTztVQUFLQSxlQUFlO0lBQWZBLGdCQUNWQyxXQUFRO0lBREVELGdCQUVWRSxpQkFBYztJQUZKRixnQkFHVkcsWUFBUztJQUhDSCxnQkFJVkksYUFBVTtJQUpBSixnQkFLVkssWUFBUztHQUxDTCxvQkFBQUEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9maXJlY3Jhd2wtc2NyYXBlci1qcy8uL3NyYy90eXBlcy50cz8yNjljIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV4dHJhY3Rvck9wdGlvbnMgfSBmcm9tIFwiLi9saWIvZW50aXRpZXNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBDcmF3bFJlc3VsdCB7XG4gIHNvdXJjZTogc3RyaW5nO1xuICBjb250ZW50OiBzdHJpbmc7XG4gIG9wdGlvbnM/OiB7XG4gICAgc3VtbWFyaXplPzogYm9vbGVhbjtcbiAgICBzdW1tYXJpemVfbWF4X2NoYXJzPzogbnVtYmVyO1xuICB9O1xuICBtZXRhZGF0YT86IGFueTtcbiAgcmF3X2NvbnRleHRfaWQ/OiBudW1iZXIgfCBzdHJpbmc7XG4gIHBlcm1pc3Npb25zPzogYW55W107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5nZXN0UmVzdWx0IHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgZXJyb3I6IHN0cmluZztcbiAgZGF0YTogQ3Jhd2xSZXN1bHRbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBXZWJTY3JhcGVyT3B0aW9ucyB7XG4gIHVybDogc3RyaW5nO1xuICBtb2RlOiBcImNyYXdsXCIgfCBcInNpbmdsZV91cmxzXCIgfCBcInNpdGVtYXBcIjtcbiAgY3Jhd2xlck9wdGlvbnM6IGFueTtcbiAgcGFnZU9wdGlvbnM6IGFueTtcbiAgdGVhbV9pZDogc3RyaW5nO1xuICBvcmlnaW4/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRmlyZWNyYXdsSm9iIHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBudW1fZG9jczogbnVtYmVyO1xuICBkb2NzOiBhbnlbXTtcbiAgdGltZV90YWtlbjogbnVtYmVyO1xuICB0ZWFtX2lkOiBzdHJpbmc7XG4gIG1vZGU6IHN0cmluZztcbiAgdXJsOiBzdHJpbmc7XG4gIGNyYXdsZXJPcHRpb25zPzogYW55O1xuICBwYWdlT3B0aW9ucz86IGFueTtcbiAgb3JpZ2luOiBzdHJpbmc7XG4gIGV4dHJhY3Rvcl9vcHRpb25zPzogRXh0cmFjdG9yT3B0aW9ucyxcbiAgbnVtX3Rva2Vucz86IG51bWJlclxufVxuXG5leHBvcnQgZW51bSBSYXRlTGltaXRlck1vZGUge1xuICBDcmF3bCA9IFwiY3Jhd2xcIixcbiAgQ3Jhd2xTdGF0dXMgPSBcImNyYXdsLXN0YXR1c1wiLFxuICBTY3JhcGUgPSBcInNjcmFwZVwiLFxuICBQcmV2aWV3ID0gXCJwcmV2aWV3XCIsXG4gIFNlYXJjaCA9IFwic2VhcmNoXCIsXG5cbn1cblxuZXhwb3J0IGludGVyZmFjZSBBdXRoUmVzcG9uc2Uge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICB0ZWFtX2lkPzogc3RyaW5nO1xuICBlcnJvcj86IHN0cmluZztcbiAgc3RhdHVzPzogbnVtYmVyO1xufVxuXG5cbiJdLCJuYW1lcyI6WyJSYXRlTGltaXRlck1vZGUiLCJDcmF3bCIsIkNyYXdsU3RhdHVzIiwiU2NyYXBlIiwiUHJldmlldyIsIlNlYXJjaCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/types.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./src/pages/api/scrape.ts"));
module.exports = __webpack_exports__;

})();